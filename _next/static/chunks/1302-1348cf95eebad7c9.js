"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1302],{5336:function(e,n,t){t.d(n,{C:function(){return T}});var i=t(85893),r=t(67294),o=t(45697),a=t.n(o),s=t(93946),l=t(25464),c=t(18972),d=t(57976),u=t(73890),h=t(69008),m=t(41687),x=t(60888),p=t(40535),v=t(63441),f=t(41733),g=t(77957),j=t(2548),Z=t(24519),b=t(2391),y=t(69308),w=t(79369),C=t(22961),S=t(28201),I=t(51233),P=t(15861),M={add:(0,i.jsx)(m.Z,{}),archive:(0,i.jsx)(u.Z,{}),avatar:(0,i.jsx)(S.Z,{}),check:(0,i.jsx)(x.Z,{}),delete:(0,i.jsx)(f.Z,{}),description:(0,i.jsx)(p.Z,{}),download:(0,i.jsx)(v.Z,{}),info:(0,i.jsx)(j.Z,{}),edit:(0,i.jsx)(g.Z,{}),location:(0,i.jsx)(y.Z,{}),unarchive:(0,i.jsx)(h.Z,{}),uploadFile:(0,i.jsx)(Z.Z,{}),receipt:(0,i.jsx)(b.Z,{}),visibility:(0,i.jsx)(C.Z,{})},E={default:(0,i.jsx)(d.Z,{}),defaultHoriz:(0,i.jsx)(w.Z,{}),description:(0,i.jsx)(p.Z,{})},T=function(e){var n=e.actionsData,t=e.icon,o=e.row,a=e.disabled,d=(0,r.useState)(null),u=d[0],h=d[1],m=function(e){e.stopPropagation(),h(e.currentTarget)},x=function(){h(null)};return(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:a,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:m,children:E[t]}),(0,i.jsx)(l.Z,{id:"simple-menu",anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:x,PaperProps:{sx:{borderRadius:2}},children:n(o).map(function(e,n){return(0,i.jsx)(c.Z,{disabled:e.disabled,onClick:function(n){e.onClick(n),x()},sx:{pl:3,pr:4},children:(0,i.jsxs)(I.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==M?void 0:M[e.icon])||null,(0,i.jsx)(P.Z,{children:e.tooltip})]})},n)})})]})};T.propTypes={actionsData:a().func.isRequired,icon:a().oneOf(["default","description"]),row:a().any.isRequired,disabled:a().bool},T.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},86267:function(e,n,t){t.d(n,{G:function(){return H}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t.n(a),l=t(6388),c=t(52824),d=t(15033),u=t(23892),h=t(39087),m=t(76256),x=t(40826),p=function(e,n){var t=function(){return(0,o.jsx)(x.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},i=function(){return(0,o.jsx)(x.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},r=function(){return(0,o.jsx)(x.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?(null==n?void 0:n.thumbnails)&&(null==n?void 0:n.thumbnails.length)?t:i:r},v=t(20705),f=t(2845),g=t(86532),j=t(22797),Z=t(38895),b=t(5616),y=t(11057),w=t(51233),C=t(21023),S=t(15861),I=t(14924),P=t(70872),M=t(58886),E=t(90948),T=t(67294),A=t(77314),D=(0,t(42850).bH)(A.ZP),k=function(e){var n=e.images,t=e.showPagination,r=e.height,a=(0,T.useState)(0),s=a[0],l=a[1],c=function(e){l(e)};return(0,o.jsxs)(w.Z,{width:"100%",alignItems:"center",children:[(0,o.jsx)(D,{index:s,onChangeIndex:c,enableMouseEvents:!0,interval:1e4,children:n.map(function(e){return(0,o.jsx)(b.Z,{component:"img",sx:{height:r,display:"block",overflow:"hidden",width:"100%",objectFit:"cover"},src:e.filename,alt:e.caption},e.caption)})}),t&&n.length>1&&(0,o.jsx)(q,{page:s+1,count:n.length,onChange:function(e,n){return c(n-1)},variant:"outlined",shape:"rounded",renderItem:function(e){return(0,o.jsx)(M.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})]})};k.defaultProps={images:[],showPagination:!0},k.propTypes={height:s().oneOfType([s().string,s().number]),images:s().arrayOf(s().shape({caption:s().string,filename:s().string.isRequired}).isRequired).isRequired,showPagination:s().bool};var q=(0,E.ZP)(P.Z)(function(e){e.hidePrevButton,e.hideNextButton;var n,t=e.theme;return n={},(0,I.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,I.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,I.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,I.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,I.Z)(n,"& button.Mui-selected",{color:t.palette.white.main,backgroundColor:t.palette.secondary.main}),n}),L=t(27434),N=t(5336),W=t(12547),F=t(64872),H=function(e){var n=e.carousel,t=e.category,a=e.data,s=e.entity,x=e.entityId,I=e.filters,P=e.listView,M=e.mediaMeta,E=e.onMediaAdd,T=e.onMediaRemove,A=e.showActionButtons,D=e.showEntityColumn,q=e.showItemActions,H=e.title,_=e.type,R=e.expanded,O=e.onChangeExpanded,Q=e.hideExpandIcon,Y=e.mediaFormProps,V=e.offCanvasProps,U=e.onlySingleMedia,z=e.elevation,B=e.accordionSx,G=e.refetch,X=(0,v.x)({filters:I}),J=X.initialData,K=X.ref,$=(0,f.x)(),ee=$.hasRole,en=$.user,et=(0,F.a)(),ei=(0,l.aM)(c.t,{variables:(0,r.Z)((0,i.Z)({},J),{entity:s,entityId:x,category:t,adminId:en.adminId,meta:M})}),er=ei.data,eo=void 0===er?{items:[],meta:{aggregate:{totalCount:0}}}:er,ea=eo.items,es=eo.meta,el=ei.loading,ec=ei.refetch,ed=function(e){et.close(),a.length||ec();var n=e.map(function(e){return(0,r.Z)((0,i.Z)({},e),{link:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.filename)})});E&&E(n),G&&G()},eu=function(e){et.close(),a.length||ec(),T&&T(e),G&&G()},eh=function(e){e.stopPropagation(),et.show((0,i.Z)({content:(0,o.jsx)(m.z,(0,i.Z)({accept:"image/*",adminId:en.adminId,category:t,entity:s,entityId:x,expiryShow:!1,mediaMeta:M,multiple:!0,onSuccess:ed,type:"image"},Y)),title:"Upload Photos"},V))},em=function(e){e.stopPropagation(),et.show((0,i.Z)({content:(0,o.jsx)(m.z,(0,i.Z)({accept:".pdf, .doc, .docx, .xlsx",adminId:en.adminId,category:t,entity:s,entityId:x,expiryShow:!1,mediaMeta:M,onSuccess:ed,type:"document"},Y)),title:"Upload Documents"},V))},ex=function(e){et.show({content:(0,o.jsx)(u.d,{mediaId:e.data.id,onSuccess:eu}),submit:!1,title:"Delete Media"})},ep=function(e){et.show({content:(0,o.jsx)(h.z,{media:e.data,toggleShow:et.close}),title:"Media Details",width:"50%"})},ev=function(e){return[{context:"primary",icon:"info",onClick:function(n){return ep(e)},tooltip:"Details"},{context:"danger",icon:"delete",onClick:function(n){return ex(e)},tooltip:"Delete"}]},ef=[],eg=ea.filter(function(e){var n=e.item;return(null==n?void 0:n.visibility)&&ee(null==n?void 0:n.visibility)}).map(function(e){var n=e.entity,t=e.entityId,i=e.id,r=e.item,o=r.caption,a=r.filename,s=r.meta,l=r.name,c=r.type,d=r.user,u=r.visibility;return{data:r,id:i,userId:null==d?void 0:d.id,filename:a,visibility:u.join(", "),file:o||l||a,entity:n&&"".concat(n,"#").concat(t),authority:s,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:p(c,s),actions:""}}),ej=(ea.filter(function(e){var n=e.item;return(null==n?void 0:n.visibility)&&ee(null==n?void 0:n.visibility)}).forEach(function(e){var n=e.item,t=n.caption,i=n.filename;"image"===n.type&&ef.push({caption:t,filename:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(i)})}),ef),eZ=ej.length;return(0,o.jsxs)(g.Z,{elevation:z,expanded:R,onChange:O,sx:B,children:[(0,o.jsx)(Z.Z,(0,r.Z)((0,i.Z)({},Q?{}:{expandIcon:(0,o.jsx)(L.Z,{})}),{children:(0,o.jsx)(S.Z,{variant:"h6",children:H})})),(0,o.jsxs)(j.Z,{children:[n&&eZ>0&&(0,o.jsx)(k,{height:"200px",images:ej}),(0,o.jsx)(d.i,{columns:[{field:"file",headerName:"File",flex:1,sortable:!1,renderCell:function(e){var n=e.row,t=e.value;return(0,o.jsx)(W.r,{color:"secondary",onClick:function(e){e.preventDefault(),window.open("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.filename))},children:t})}},{field:"visibility",headerName:"Visible to",flex:1,sortable:!1},{hide:!D,field:"entity",headerName:"Entity",flex:1,sortable:!1},{field:"authority",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.value;return(0,o.jsx)(o.Fragment,{children:(null==n?void 0:n.adminOnly)&&(0,o.jsx)(C.Z,{title:"Admin user only",children:(0,o.jsx)(b.Z,{component:"img",alt:"Admin Only",src:"/messaging/admin-only.svg",sx:{height:"24px"}})})})}},{field:"uploaded",headerName:"Uploaded by",flex:1,sortable:!1},{hide:!P,field:"thumbnails",headerName:"Thumbnails",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}},{hide:!q,field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.row;return ee("admin")?(0,o.jsx)(N.C,{actionsData:ev,row:n}):en.id===n.userId?(0,o.jsx)(N.C,{actionsData:ev,row:n}):null}}],rows:eg,loading:el,meta:es,ref:K,refetch:ec,columnVisibilityModel:{entity:D,thumbnails:P,actions:q}}),A&&!(U&&eg.length>0)&&(0,o.jsxs)(w.Z,{direction:"row",justifyContent:"center",spacing:2,mt:2,children:[(!_||"document"===_)&&(0,o.jsx)(y.Z,{variant:"contained",color:"secondary",onClick:em,children:"Add Document"}),(!_||"image"===_||"avatar"===_)&&(0,o.jsxs)(y.Z,{variant:"contained",color:"secondary",onClick:eh,children:["Add ",_?"".concat(_.charAt(0).toUpperCase()).concat(_.slice(1)):"Image"]})]})]})]})};H.propTypes={carousel:s().bool,category:s().string,data:s().array,entity:s().string,entityId:s().number,filters:s().object,listView:s().bool,mediaMeta:s().object,onMediaAdd:s().func,onMediaRemove:s().func,showActionButtons:s().bool,showEntityColumn:s().bool,showItemActions:s().bool,title:s().string,type:s().string,expanded:s().bool,onChangeExpanded:s().func,hideExpandIcon:s().bool,mediaFormProps:s().object,offCanvasProps:s().object,onlySingleMedia:s().bool,elevation:s().number,accordionSx:s().object,refetch:s().func},H.defaultProps={carousel:!0,data:[],filters:{},listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,title:"Media",type:null,onChangeExpanded:function(){},mediaFormProps:{},offCanvasProps:{},category:"media",onlySingleMedia:!1,elevation:1,accordionSx:{},refetch:function(){}}},33214:function(e,n,t){t.d(n,{t:function(){return Y}});var i=t(26042),r=t(69396),o=t(828),a=t(29815),s=t(85893),l=t(84808),c=t(11057),d=t(87918),u=t(98456),h=t(67720),m=t(86886),x=t(90629),p=t(51233),v=t(50135),f=t(15861),g=t(90948),j=t(61730),Z=t(45697),b=t.n(Z),y=t(9489),w=t(26936),C=t(42283),S=t(48580),I=t(6388),P=t(50319),M=t(4972),E=t(67294),T=t(74610),A=t(92321),D=t(70357),k=t(94572),q=t(32784),L=t(27593),N=t(79665),W=t(90486),F=t(33754),H=t(30381),_=t.n(H),R=t(6103),O=t(39641),Q=t(21269),Y=function(e){var n=e.isEdit,t=e.scheduleId,x=e.entity,g=e.entityId,Z=e.close,b=(0,j.Z)("(max-width: 600px)"),H=(0,O.D)(),Y=(0,E.useState)(void 0!==n&&n)[0],z=(0,E.useState)(t),B=z[0],G=z[1],X=(0,E.useState)([]),J=X[0],K=X[1],$=(0,E.useState)(""),ee=$[0],en=$[1],et=(0,E.useState)(""),ei=et[0],er=et[1],eo=(0,E.useState)(""),ea=eo[0],es=eo[1],el=(0,E.useState)(""),ec=el[0],ed=el[1],eu=(0,E.useState)(null),eh=eu[0],em=eu[1],ex=(0,C.cI)({defaultValues:{status:"active",coverageAreas:[]},resolver:(0,N.S)(W.r)}),ep=ex.handleSubmit,ev=ex.control,ef=ex.errors,eg=ex.register,ej=ex.watch,eZ=ex.setValue,eb=ex.reset,ey=(0,C.Dq)({control:ev,name:"days"}),ew=ej("service"),eC=ej("coverageAreas"),eS=(0,I.aM)(q.WC,{skip:!B,variables:{serviceScheduleId:B,includeParent:!!Y},onCompleted:function(e){var n=e.serviceSchedule,t=(0,L.Ty)(n);eb((0,i.Z)({},t)),Y||"Customer"!==x?Y&&"Customer"===x&&K(n.parent.postcodeAreas.map(function(e){return e.postcode.area})):K(n.postcodeAreas.map(function(e){return e.postcode.area}))}}).loading,eI=(0,I.aM)(M.kx,{variables:{q:""!==ee?"%".concat(ee,"%"):null,limit:50,offset:0}}),eP=eI.loading,eM=eI.data,eE=(void 0===eM?{items:[]}:eM).items,eT=(0,I.aM)(M.pY,{skip:!(null==ew?void 0:ew.value),variables:(0,r.Z)((0,i.Z)({},(0,L.AL)({defaultScheduleId:t,scheduleId:B,entity:x,entityId:g,editMode:Y})),{serviceId:null==ew?void 0:ew.value,q:""!==ei?"%".concat(ei,"%"):null,limit:50,offset:0})}),eA=eT.loading,eD=eT.data,ek=(void 0===eD?{items:[]}:eD).items,eq=(0,I.aM)(M.T_,{variables:{where:{name:{_eq:""!==ea?"%".concat(ea,"%"):null},subtype:{_eq:"reactive"}},limit:50,offset:0}}),eL=eq.loading,eN=eq.data,eW=(void 0===eN?{items:[]}:eN).items,eF=(0,I.aM)(M._d,{variables:{where:(0,r.Z)((0,i.Z)({},(0,L.dB)({areas:J})),{name:{_ilike:""!==ec?"%".concat(ec,"%"):null},status:{_eq:"active"},Account_Locations:{accountId:{_eq:g}}}),limit:50,offset:0},onCompleted:function(e){var n=e.items;!Y&&"Customer"===x&&(null==n?void 0:n.length)&&eZ("location",(0,a.Z)(n))}}),eH=eF.loading,e_=eF.data,eR=(void 0===e_?{items:[]}:e_).items,eO=(0,o.Z)((0,P.D)(q.Sx,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){H.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){H.show({content:"Service schedule was created",severity:"success"}),Z()}}),1)[0],eQ=(0,o.Z)((0,P.D)(q.kt,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){H.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){H.show({content:"Service schedule was updated",severity:"success"}),Z()}}),1)[0],eY=function(e){if(Y){var n=(0,L._L)({form:e,entity:x,entityId:g});eQ({variables:{data:(0,r.Z)((0,i.Z)({},n),{id:B})}})}else{var t=(0,L._L)({form:e,entity:x,entityId:g});eO({variables:{data:t}})}},eV=(0,E.useMemo)(function(){return Y?"Edit ".concat(U[x]," schedule"):"Add ".concat(U[x]," schedule")},[Y,x]);return(0,s.jsxs)("form",{onSubmit:ep(eY),children:[eS&&(0,s.jsx)(l.Z,{sx:{zIndex:1e5},open:!0,children:(0,s.jsx)(u.Z,{color:"secondary"})}),(0,s.jsx)(V,{is600pxOrLess:b,children:(0,s.jsxs)(p.Z,{height:"100%",width:"100%",children:[(0,s.jsx)(p.Z,{children:(0,s.jsx)(f.Z,{variant:"h5",fontWeight:700,children:eV})}),(0,s.jsx)(p.Z,{height:"100%",pt:2,pr:2,sx:{overflowY:"scroll"},children:(0,s.jsxs)(m.ZP,{container:!0,columnSpacing:2,children:[(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,md2:7,columnSpacing:2,rowSpacing:2,children:[(0,s.jsxs)(m.ZP,{item:!0,xs:12,sm2:6,children:[(0,s.jsxs)(p.Z,{spacing:2,mb:2,children:[(0,s.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,s.jsx)(f.Z,{mr:"29px",children:"Service"}),(0,s.jsx)(p.Z,{direction:"row",alignItems:"center",width:"100%",spacing:1,children:(0,s.jsx)(C.Qr,{name:"service",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,s.jsx)(S.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t||null,onChange:function(e,n){(null==n?void 0:n.value)?r(n):(G(null),eb((0,i.Z)({},T.FY)))},loading:eP,options:eE,setSearch:en,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Service",error:ef.service,helperText:null===(n=ef.service)||void 0===n?void 0:n.message},sx:{width:"170px"}})}})})]}),(0,s.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[(0,s.jsx)(f.Z,{children:"Schedule"}),(0,s.jsx)(C.Qr,{name:"schedule",control:ev,render:function(e){var n,t=e.value,o=e.onChange;return(0,s.jsx)(S.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t||null,onChange:function(e,n){(null==n?void 0:n.value)?(G(null==n?void 0:n.value),o(n)):(G(null),eb((0,r.Z)((0,i.Z)({},T.FY),{service:ew})))},loading:eA,options:ek,setSearch:er,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Schedule",error:ef.schedule,helperText:null===(n=ef.schedule)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,s.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,s.jsx)(f.Z,{mr:"34px",children:"Status"}),(0,s.jsx)(C.Qr,{name:"status",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)(A.P,{formControl:{fullWidth:!0,variant:"standard",color:"secondary",error:ef.status,helperText:null===(n=ef.status)||void 0===n?void 0:n.message},selectProps:{fullWidth:!0,sx:{width:"200px"}},value:t,onChange:i,options:T.hm})}})]})]}),(0,s.jsxs)(p.Z,{width:"100%",mb:2,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Priority"}),(0,s.jsx)(C.Qr,{name:"priority",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)(S.q,{multiple:!0,fullWidth:!0,disabled:"Supplier"===x||"Customer"===x||"Location"===x,color:"secondary",filterSelectedOptions:!0,loading:eL,value:t||[],onChange:function(e,n){i(n)},options:eW,setSearch:es,textFieldProps:{placeholder:"Select priority",variant:"standard",color:"secondary",error:ef.priority,helperText:null===(n=ef.priority)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,columnSpacing:2,rowSpacing:2,children:[(0,s.jsxs)(m.ZP,{item:!0,children:[(0,s.jsx)(f.Z,{children:"Minimum duration"}),(0,s.jsx)(C.Qr,{name:"minimumDuration",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:t,onChange:i,error:ef.minimumDuration,helperText:null===(n=ef.minimumDuration)||void 0===n?void 0:n.message})}})]}),(0,s.jsxs)(m.ZP,{item:!0,children:[(0,s.jsx)(f.Z,{children:"Minimum increment"}),(0,s.jsx)(C.Qr,{name:"minimumIncrement",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:t,onChange:i,error:ef.minimumIncrement,helperText:null===(n=ef.minimumIncrement)||void 0===n?void 0:n.message})}})]})]})]}),(0,s.jsxs)(m.ZP,{item:!0,xs:12,sm2:6,children:["Supplier"===x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.B,{paginationSize:4,entity:"ServiceSchedule",entityId:B,name:"coverageAreas",values:eC||[],setValue:eZ}),(0,s.jsx)("input",(0,r.Z)((0,i.Z)({},eg("coverageAreas")),{type:"hidden"}))]}),"Customer"===x&&(0,s.jsx)(C.Qr,{name:"location",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)(S.q,{multiple:!0,fullWidth:!0,color:"secondary",filterSelectedOptions:!0,loading:eH,value:t||[],onChange:function(e,n){i(n)},options:eR,setSearch:ed,textFieldProps:{label:"Select location",variant:"standard",color:"secondary",error:ef.location,helperText:null===(n=ef.location)||void 0===n?void 0:n.message}})}})]}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,children:[(0,s.jsxs)(m.ZP,{item:!0,sx:12,height:"27px",width:"100%",pr:2,mb:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Rates"}),(0,s.jsx)(h.Z,{})]}),(0,s.jsxs)(m.ZP,{width:"100%",container:!0,item:!0,xs:12,columnSpacing:2,rowSpacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(p.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Normal"}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(C.Qr,{name:"normal.firstHour",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.normal)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.normal)||void 0===t?void 0:null===(i=t.firstHour)||void 0===i?void 0:i.message})}})]}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(C.Qr,{name:"normal.subsequentHours",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.normal)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.normal)||void 0===t?void 0:null===(i=t.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(p.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(C.Qr,{name:"ooh.firstHour",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.ooh)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.ooh)||void 0===t?void 0:null===(i=t.firstHour)||void 0===i?void 0:i.message})}})]}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(C.Qr,{name:"ooh.subsequentHours",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.ooh)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.ooh)||void 0===t?void 0:null===(i=t.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(p.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(C.Qr,{name:"premium.firstHour",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.premium)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.premium)||void 0===t?void 0:null===(i=t.firstHour)||void 0===i?void 0:i.message})}})]}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(C.Qr,{name:"premium.subsequentHours",control:ev,render:function(e){var n,t,i,r=e.value,o=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:r,onChange:o,error:null===(n=ef.premium)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.premium)||void 0===t?void 0:null===(i=t.subsequentHours)||void 0===i?void 0:i.message})}})]})]})})]})]})]}),(0,s.jsx)(m.ZP,{item:!0,xs:12,md2:5,children:(0,s.jsxs)(p.Z,{spacing:1,children:[(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,mb:1,children:"Times"}),(0,s.jsx)(h.Z,{})]}),(0,s.jsxs)(p.Z,{spacing:.5,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,s.jsx)(p.Z,{spacing:.5,children:T.jT.map(function(e){var n,t,i;return(0,s.jsx)(D.k,{control:ev,name:"oohTimes.".concat(e.value),day:e.label,error:null===(n=ef.oohTimes)||void 0===n?void 0:n[e.value],helperText:null===(t=ef.oohTimes)||void 0===t?void 0:null===(i=t[e.value])||void 0===i?void 0:i.message})})})]}),(0,s.jsxs)(p.Z,{spacing:.5,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,s.jsx)(p.Z,{spacing:.5,children:T.jT.map(function(e){var n,t,i;return(0,s.jsx)(D.k,{control:ev,name:"premiumTimes.".concat(e.value),day:e.label,error:null===(n=ef.premiumTimes)||void 0===n?void 0:n[e.value],helperText:null===(t=ef.premiumTimes)||void 0===t?void 0:null===(i=t[e.value])||void 0===i?void 0:i.message})})})]})]})}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,mt:2,columnSpacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,xs:0,md2:7}),(0,s.jsx)(m.ZP,{item:!0,xs:12,md2:5,children:(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Days"}),(0,s.jsx)(p.Z,{direction:"row",spacing:1,flexWrap:"wrap",children:ey.fields.map(function(e,n){return(0,s.jsx)(d.Z,{label:_()(e).format("YYYY-MM-DD"),size:"small",onDelete:function(){return ey.remove(n)}})})}),(0,s.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,s.jsx)(F.M,{inputFormat:"YYYY-MM-DD",placeholder:"Select days",value:eh,onChange:function(e){em(e)},renderInput:function(e){return(0,s.jsx)(v.Z,(0,r.Z)((0,i.Z)({},e),{fullWidth:!0,color:"secondary",variant:"standard"}))}}),(0,s.jsx)(c.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:function(){return ey.append(eh)},children:(0,s.jsx)(R.Z,{})})]})]})})]}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},mt:2,children:(0,s.jsx)(f.Z,{color:"muiGray.main",children:"All job start times occurring outside times specified above will be charged based on Normal rates."})})]})}),(0,s.jsxs)(p.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,s.jsx)(c.Z,{color:"danger",variant:"contained",onClick:Z,children:"Cancel"}),(0,s.jsx)(c.Z,{color:"secondary",variant:"contained",type:"submit",children:Y?"Save":"Add schedule"})]})]})})]})};Y.propTypes={entity:b().oneOf(["Supplier","Customer","Location"]).isRequired},Y.defaultProps={};var V=(0,g.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"90vw",height:n?"100vh":"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),U={Supplier:"supplier",Customer:"customer",Location:"location"}},1589:function(e,n,t){t.d(n,{q:function(){return N}});var i=t(47568),r=t(26042),o=t(828),a=t(29815),s=t(97582),l=t(85893),c=t(67294),d=t(45697),u=t(11163),h=t.n(u),m=t(30381),x=t.n(m),p=t(51233),v=t(90629),f=t(11057),g=t(15861),j=t(69661),Z=t(66252),b=t(6388),y=t(50319),w=t(14651),C=t(5336),S=t(15033),I=t(93884),P=t(24237),M=t(86267),E=t(75327),T=t(20705),A=t(63626),D=t(20932),k=t(2845),q=t(64872),L=t(71225),N=function(e){var n=e.accountType,t=e.filters,d=(0,Z.x)(),u=(0,T.x)({filters:t}),m=u.initialData,N=u.ref,F=(0,q.a)(),H=(0,c.useState)(null),_=H[0],R=H[1],O=(0,k.x)(),Q=O.user,Y=O.hasRole,V=(0,b.aM)(E.fo,{variables:m}),U=V.data,z=void 0===U?{users:[],meta:{aggregate:{totalCount:0}}}:U,B=z.users,G=z.meta,X=V.loading,J=V.refetch,K=(0,o.Z)((0,y.D)(E.I4,{onCompleted:function(){F.close(),J()}}),2),$=K[0],ee=K[1].error,en=(0,o.Z)((0,y.D)(E.AX,{onCompleted:function(){F.close(),J()}}),2),et=en[0],ei=en[1].error,er=(0,o.Z)((0,y.D)(E.tW,{onCompleted:function(){J()}}),2),eo=er[0],ea=er[1].error;ee&&ee.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?R("Error: a user with this e-mail address already exists"):R("Error creating user")}),ei&&ei.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?R("Error, a user with this e-mail address already exists"):R("Error updating user")}),ea&&R("Error getting user`s locations");var es,el=function(e){return[{context:"secondary",icon:"edit",onClick:em(e),tooltip:"Edit"},{context:"secondary",icon:"avatar",onClick:eh(e),tooltip:"Avatar"}]},ec=[{headerName:"",field:"avatar",maxWidth:60,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(j.Z,{src:(0,L.Q)(n.media),sx:{marginLeft:"15px",width:"24px",height:"24px"}})}},{headerName:"Name",field:"name",minWidth:150,sortName:'{"nameFirst": "ORDER"}'},{headerName:"Email Address",field:"email",minWidth:150},{headerName:"Contact User",field:"contactUser",width:130,sortable:!1,renderCell:function(e){if(e.row.accountUser.isContact)return(0,l.jsx)(p.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"flex-start",children:(0,l.jsx)(w.Z,{color:"error"})})}},{headerName:"Phone",field:"phone",minWidth:100,sortable:!1},{headerName:"Position",field:"position",minWidth:100,sortable:!1},{headerName:"Role",field:"role",minWidth:110,sortable:!1},{headerName:"Status",field:"status",minWidth:110,sortable:!1},{headerName:"Date Added",field:"createdAt",minWidth:130}].concat((0,a.Z)(Y(["admin","customer","supplier"])?[{headerName:"Actions",field:"actions",minWidth:100,flex:1,sortable:!1,renderCell:function(e){var n=e.row;return Y(["customer_user","supplier_user"])?n.id===Q.id&&(0,l.jsx)(C.C,{actionsData:el,row:n}):(0,l.jsx)(C.C,{actionsData:el,row:n})}}]:[])),ed=(0,c.useMemo)(function(){var e=[];return B.forEach(function(n){var i=null;i=t.accountId?n.accounts.find(function(e){var n;return(null===(n=e.account)||void 0===n?void 0:n.id)===parseInt(t.accountId)}):n.accounts.find(function(e){return null!==e.account});var r={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:i&&i.account.id,type:i&&i.account.type,email:n.email,account:i?"".concat(i.account.name," (").concat(i.account.type,")"):"-",phone:n.phone,position:(null==i?void 0:i.position)?i.position:"N/A",accountUser:i,role:null==i?void 0:i.role,status:i?i.status:n.status,createdAt:x()(n.createdAt).format("YYYY-MM-DD"),media:n.media};e.push(r)}),e},[t.accountId,B]),eu=(0,c.useCallback)((es=(0,i.Z)(function(e,n){var t,i,o,a,l;return(0,s.__generator)(this,function(o){switch(o.label){case 0:return[4,(0,D.E)(d,e.email,!0)];case 1:if(t=o.sent(),i=(0,A.te)((0,r.Z)({},e),n,t),!e.id)return[3,2];return et({variables:(0,r.Z)({},i)}),e.location&&eo({variables:(0,r.Z)({},(0,A.qF)(e))}),[3,4];case 2:return[4,$({variables:{objects:i}})];case 3:l=o.sent().data.insert_Account_User.returning,e.location&&eo({variables:(0,r.Z)({},(0,A.qF)({location:e.location,accountUserId:l[0].id}))}),o.label=4;case 4:return[2]}})}),function(e,n){return es.apply(this,arguments)}),[eo,d,$,et]),eh=function(e){return function(n){n.stopPropagation(),F.show({content:(0,l.jsx)(M.G,{category:"avatar",entity:"User",entityId:e.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})}},em=(0,c.useCallback)(function(e){return function(i){var r;i.stopPropagation(),F.show({content:(0,l.jsx)(P.H,{accountType:n,userId:null!==(r=null==e?void 0:e.id)&&void 0!==r?r:null,submit:eu,submitError:_,accountId:t.accountId}),title:e?"Edit user":"Add user"})}},[n,F,eu,_,t.accountId]),ex=function(e){h().push("/dashboard/users/view?id=".concat(e.id))},ep=(0,c.useMemo)(function(){var e={};return ed.length||(e={title:"No users",subtitleFirstLine:"You currently have users set up in the system",subtitleSecondLine:"Click\xa0create user to get started building.",buttonText:"Create user",onAction:em(null)}),e},[em,ed]);return(0,l.jsxs)(p.Z,{spacing:2,sx:W.container,children:[(0,l.jsx)(p.Z,{width:"100%",direction:"row",sx:W.header,justifyContent:"flex-end",children:(0,l.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:em(null),children:"Create User"})}),(0,l.jsxs)(v.Z,{sx:W.tableContainer,children:[(0,l.jsx)(g.Z,{ml:2,variant:"h5",sx:W.title,children:"Users"}),(null==ed?void 0:ed.length)?(0,l.jsx)(S.i,{ref:N,loading:X,columns:ec,rows:ed,meta:G,refetch:J,autoHeight:!1,onRowClick:ex,containerHeight:"calc(100% - 52px)"}):!X&&(0,l.jsx)(I.C,(0,r.Z)({imageSrc:"/static/icons/no_locations_found.svg"},ep))]})]})},W={container:{width:"100%",height:"100%"},header:{margin:"1em 0",paddingRight:"1em"},tableContainer:{padding:"16px 0px",height:"calc(80vh - 22px)"},title:{fontWeight:600,marginBottom:"15px"}};N.propTypes={accountType:d.string,filters:d.object}}}]);