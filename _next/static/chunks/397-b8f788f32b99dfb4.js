"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[397],{23377:function(e,n,r){r.d(n,{J:function(){return ej}});var i=r(26042),t=r(69396),s=r(828),o=r(85893),a=r(45697),l=r.n(a),u=r(6388),c=r(20705),d=r(11057),h=r(39474),m=r(87918),x=r(90629),v=r(51233),p=r(15861),f=r(15033),g=r(32784),j=r(84808),Z=r(98456),b=r(67720),y=r(86886),S=r(50135),C=r(21023),w=r(90948),P=r(61730),I=r(9489),T=r(26936),H=r(42283),W=r(48580),q=r(50319),M=r(4972),O=r(67294),k=r(74610),A=r(92321),R=r(70357),L=r(94572),_=r(27593),F=r(79665),N=r(90486),E=r(33754),D=r(30381),Q=r.n(D),$=r(6103),V=r(39641),Y=[{label:"GBP",value:1},{label:"AUD",value:2},{label:"EUR",value:3}],z=r(73760),B=r(7297),G=r(75063);function U(){var e=(0,B.Z)(["\n  query GetService($id: Int!) {\n    service: Service_by_pk(id: $id) {\n      id\n      name\n      status\n      countryId\n      currencyId\n    }\n  }\n"]);return U=function(){return e},e}function J(){var e=(0,B.Z)(["\n  mutation AddService($services: [Service_insert_input!]!) {\n    insert_Service(objects: $services) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return J=function(){return e},e}function X(){var e=(0,B.Z)(["\n  mutation UpdateService($id: Int!, $changes: Service_set_input) {\n    update_Service_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return X=function(){return e},e}function K(){var e=(0,B.Z)(['\n  query GetServiceScheduleForAccounts($serviceId: Int!, $offset: Int = 0, $limit: Int = 50) {\n    serviceSchedules: ServiceSchedule(\n      where: { serviceId: { _eq: $serviceId }, entity: { _in: ["Customer", "Supplier"] } }\n      offset: $offset\n      limit: $limit\n    ) {\n      id\n      normal\n      ooh\n      premium\n      account: Account {\n        id\n        type\n        name\n      }\n    }\n    serviceSchedules: ServiceSchedule_aggregate(\n      where: { serviceId: { _eq: $serviceId }, entity: { _in: ["Customer", "Supplier"] } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return K=function(){return e},e}var ee=(0,G.Ps)(U()),en=(0,G.Ps)(J()),er=(0,G.Ps)(X()),ei=(0,G.Ps)(K()),et=r(74231),es=et.Ry().shape({name:et.Z_().required("Required"),country:et.Rx().oneOf(z.v.map(function(e){return e.value}),"Required"),currency:et.Rx().oneOf(Y.map(function(e){return e.value}),"Required"),status:et.Z_().oneOf(["active","inactive"]).required("Required")}),eo=r(2845),ea=r(75832),el=function(e){var n=e.serviceId,r=e.close,a=(0,P.Z)("(max-width: 600px)"),l=(0,V.D)(),h=(0,eo.x)().user,m=(0,c.x)({filters:{}}),x=m.ref,g=m.initialData,b=(0,H.cI)({defaultValues:{status:"active"},resolver:(0,F.S)(es)}),C=b.control,w=b.errors,I=b.handleSubmit,T=b.reset,W=(0,u.aM)(ee,{skip:!n,variables:{id:n},onCompleted:function(e){var n=e.service;T({name:n.name,country:n.countryId,currency:n.currencyId,status:n.status})}}).loading,M=(0,u.aM)(ei,{skip:!n,variables:(0,t.Z)((0,i.Z)({},g),{serviceId:n})}),k=M.data,R=void 0===k?{serviceSchedules:[],meta:{aggregate:{totalCount:0}}}:k,L=R.serviceSchedules,_=R.meta,N=M.loading,E=M.refetch,D=(0,s.Z)((0,q.D)(en,{onCompleted:function(){l.show({content:"Service was added successfully",severity:"success"}),r()},onError:function(e){l.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),Q=D[0],$=D[1].loading,B=(0,s.Z)((0,q.D)(er,{onCompleted:function(){l.show({content:"Service was updated successfully",severity:"success"}),r()},onError:function(e){l.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),G=B[0],U=B[1].loading,J=function(e){n?G({variables:{id:n,changes:{name:e.name,countryId:e.country,currencyId:e.currency,status:e.status}}}):Q({variables:{services:[{name:e.name,countryId:e.country,currencyId:e.currency,status:e.status,adminId:h.adminId}]}})},X=(0,O.useMemo)(function(){return[{flex:1,field:"accountName",headerName:"Account",sortable:!1},{flex:1,field:"accountType",headerName:"Type",sortable:!1},{flex:1,field:"normal",headerName:"Normal",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.normal.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.normal.subsequentHours)]})]})}},{flex:1,field:"ooh",headerName:"OOH",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.ooh.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.ooh.subsequentHours)]})]})}},{flex:1,field:"premium",headerName:"Premium",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.premium.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.premium.subsequentHours)]})]})}}]},[]),K=(0,O.useMemo)(function(){return L.map(function(e){return{id:e.id,accountName:e.account.name,accountType:e.account.type,normal:e.normal,ooh:e.ooh,premium:e.premium}})},[L]);return(0,o.jsxs)(o.Fragment,{children:[(W||$||U)&&(0,o.jsx)(j.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(Z.Z,{color:"secondary"})}),(0,o.jsx)("form",{id:"addServiceForm",onSubmit:function(e){e.stopPropagation(),I(J)(e)},children:(0,o.jsxs)(ec,{is600pxOrLess:a,children:[(0,o.jsxs)(v.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:n?"Edit Service":"Add Service"}),(0,o.jsx)(d.Z,{variant:"contained",color:"secondary",size:"small",form:"addServiceForm",type:"submit",children:n?"Submit":"Add"})]}),(0,o.jsxs)(y.ZP,{container:!0,rowSpacing:1,columnSpacing:4,children:[(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(y.ZP,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Name"})}),(0,o.jsx)(y.ZP,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(H.Qr,{name:"name",control:C,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(S.Z,{fullWidth:!0,label:"Name",color:"secondary",variant:"standard",value:r,onChange:i,error:w.name,helperText:null===(n=w.name)||void 0===n?void 0:n.message})}})})]}),(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(y.ZP,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Country"})}),(0,o.jsxs)(y.ZP,{item:!0,xs:10,sm2:9,md2:10,children:[" ",(0,o.jsx)(H.Qr,{name:"country",control:C,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(A.P,{value:n,onChange:r,options:z.v,label:"Country",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})]})]}),(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(y.ZP,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Currency"})}),(0,o.jsx)(y.ZP,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(H.Qr,{name:"currency",control:C,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(A.P,{value:n,onChange:r,options:Y,label:"Currency",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})})]}),(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(y.ZP,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Status"})}),(0,o.jsx)(y.ZP,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(H.Qr,{name:"status",control:C,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(A.P,{value:n,onChange:r,options:eu,label:"Status",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})})]})]}),n&&(0,o.jsxs)(v.Z,{mt:3,children:[(0,o.jsx)(v.Z,{direction:"row",children:(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:"Accounts"})}),(0,o.jsx)(f.i,{autoHeight:!1,loading:N,ref:x,columns:X,rows:K,meta:_,refetch:E,containerHeight:"calc(100vh - 400px)"})," "]})]})})]})};el.defaultProps={close:function(){}},el.propTypes={serviceId:l().number,close:l().func};var eu=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],ec=(0,w.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"80vw",height:"auto",maxHeight:n?"100vh":"70vh",padding:"16px 27px 36px 27px",borderRadius:"8px"}}),ed=r(62551),eh=r(21269),em=function(e){var n=e.scheduleId,r=e.entity,a=e.entityId,l=e.close,c=(0,P.Z)("(max-width: 600px)"),h=(0,V.D)(),x=(0,s.Z)((0,ed.d)(),2),f=x[0],w=x[1],D=(0,O.useState)(n),Y=D[0],z=D[1],B=(0,O.useState)(""),G=B[0],U=B[1],J=(0,O.useState)(""),X=J[0],K=J[1],ee=(0,O.useState)(""),en=ee[0],er=ee[1],ei=(0,O.useState)(null),et=ei[0],es=ei[1],eo=(0,H.cI)({defaultValues:{status:"active",coverageAreas:[]},resolver:(0,F.S)(N.r)}),ea=eo.handleSubmit,eu=eo.control,ec=eo.errors,em=eo.register,ep=eo.watch,ef=eo.setValue,eg=eo.reset,ej=(0,H.Dq)({control:eu,name:"days"}),eZ=ep("service"),eb=ep("coverageAreas"),ey=(0,u.aM)(g.Ey,{skip:!Y,variables:{serviceScheduleId:Y},onCompleted:function(e){var n=e.serviceSchedule,r=(0,_.Ty)(n);eg((0,i.Z)({},r))}}).loading,eS=(0,u.aM)(M.kx,{variables:{q:""!==G?"%".concat(G,"%"):null,limit:50,offset:0}}),eC=eS.loading,ew=eS.data,eP=(void 0===ew?{items:[]}:ew).items,eI=(0,u.aM)(M.pY,{skip:!(null==eZ?void 0:eZ.value),variables:{entity:r,serviceId:null==eZ?void 0:eZ.value,q:""!==X?"%".concat(X,"%"):null,limit:50,offset:0}}),eT=eI.loading,eH=eI.data,eW=(void 0===eH?{items:[]}:eH).items,eq=(0,u.aM)(M.T_,{variables:{where:{name:{_eq:""!==en?"%".concat(en,"%"):null},subtype:{_eq:"reactive"}},limit:50,offset:0}}),eM=eq.loading,eO=eq.data,ek=(void 0===eO?{items:[]}:eO).items,eA=(0,s.Z)((0,q.D)(g.Sx,{refetchQueries:["GetServiceSchedules"],onError:function(e){h.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){h.show({content:"Service schedule was created",severity:"success"}),l()}}),1)[0],eR=(0,s.Z)((0,q.D)(g.kt,{refetchQueries:["GetServiceSchedules"],onError:function(e){h.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){h.show({content:"Service schedule was updated",severity:"success"}),l()}}),1)[0],eL=function(e){if(Y||n){var s=(0,_.ee)({form:e,entity:r,entityId:a});eR({variables:{data:(0,t.Z)((0,i.Z)({},s),{id:Y})}})}else{var o=(0,_.ee)({form:e,entity:r,entityId:a});eA({variables:{data:o}})}},e_=function(e){e.stopPropagation(),w({content:function(e){var n=e.onClose;return(0,o.jsx)(el,{close:n})}})},eF=(0,O.useMemo)(function(){return Y||n?"Edit ".concat(ev[r]," schedule"):"Create ".concat(ev[r]," schedule")},[n,r,Y]);return(0,o.jsxs)("form",{onSubmit:ea(eL),children:[f,ey&&(0,o.jsx)(j.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(Z.Z,{color:"secondary"})}),(0,o.jsx)(ex,{is600pxOrLess:c,children:(0,o.jsxs)(v.Z,{height:"100%",width:"100%",children:[(0,o.jsx)(v.Z,{children:(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:eF})}),(0,o.jsx)(v.Z,{height:"100%",pt:2,pr:2,sx:{overflowY:"scroll"},children:(0,o.jsxs)(y.ZP,{container:!0,columnSpacing:2,children:[(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,md2:7,columnSpacing:2,rowSpacing:2,children:[(0,o.jsxs)(y.ZP,{item:!0,xs:12,sm2:6,children:[(0,o.jsxs)(v.Z,{spacing:2,mb:2,children:[(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,o.jsx)(p.Z,{mr:"29px",children:"Service"}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:1,children:[(0,o.jsx)(H.Qr,{name:"service",control:eu,render:function(e){var n,r=e.value,t=e.onChange;return(0,o.jsx)(W.q,{fullWidth:!0,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?t(n):(z(null),eg((0,i.Z)({},k.FY)))},loading:eC,options:eP,setSearch:U,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Service",error:ec.service,helperText:null===(n=ec.service)||void 0===n?void 0:n.message}})}}),(0,o.jsx)(C.Z,{title:"Add service",children:(0,o.jsx)(d.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:e_,children:"+"})})]})]}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[(0,o.jsx)(p.Z,{children:"Schedule"}),Y||n?(0,o.jsx)(H.Qr,{name:"schedule",control:eu,render:function(e){var n,r=e.value,s=e.onChange;return(0,o.jsx)(W.q,{fullWidth:!0,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?(z(null==n?void 0:n.value),s(n)):(z(null),eg((0,t.Z)((0,i.Z)({},k.FY),{service:eZ})))},loading:eT,options:eW,setSearch:K,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Schedule",error:ec.schedule,helperText:null===(n=ec.schedule)||void 0===n?void 0:n.message}})}}):(0,o.jsx)(H.Qr,{name:"scheduleName",control:eu,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",placeholder:"Schedule name",value:n,onChange:r})}})]}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,o.jsx)(p.Z,{mr:"34px",children:"Status"}),(0,o.jsx)(H.Qr,{name:"status",control:eu,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(A.P,{formControl:{fullWidth:!0,variant:"standard",color:"secondary",error:ec.status,helperText:null===(n=ec.status)||void 0===n?void 0:n.message},selectProps:{fullWidth:!0},value:r,onChange:i,options:k.hm})}})]})]}),(0,o.jsxs)(v.Z,{width:"100%",mb:2,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Priority"}),(0,o.jsx)(H.Qr,{name:"priority",control:eu,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(W.q,{multiple:!0,fullWidth:!0,color:"secondary",filterSelectedOptions:!0,loading:eM,value:r||[],onChange:function(e,n){i(n)},options:ek,setSearch:er,textFieldProps:{placeholder:"Select priority",variant:"standard",color:"secondary",error:ec.priority,helperText:null===(n=ec.priority)||void 0===n?void 0:n.message}})}})]}),(0,o.jsxs)(y.ZP,{container:!0,item:!0,columnSpacing:2,rowSpacing:2,children:[(0,o.jsxs)(y.ZP,{item:!0,xs:12,md:6,md2:12,lg2:6,children:[(0,o.jsx)(p.Z,{children:"Minimum duration"}),(0,o.jsx)(H.Qr,{name:"minimumDuration",control:eu,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(eh.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{minWidth:"60px"},type:"number",value:r,onChange:i,error:ec.minimumDuration,helperText:null===(n=ec.minimumDuration)||void 0===n?void 0:n.message})}})]}),(0,o.jsxs)(y.ZP,{item:!0,xs:12,md:6,md2:12,lg2:6,children:[(0,o.jsx)(p.Z,{children:"Minimum increment"}),(0,o.jsx)(H.Qr,{name:"minimumIncrement",control:eu,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(eh.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{minWidth:"60px"},type:"number",value:r,onChange:i,error:ec.minimumIncrement,helperText:null===(n=ec.minimumIncrement)||void 0===n?void 0:n.message})}})]})]})]}),(0,o.jsxs)(y.ZP,{item:!0,xs:12,sm2:6,children:[(0,o.jsx)(L.B,{editable:!0,paginationSize:4,entity:"ServiceSchedule",entityId:Y,name:"coverageAreas",values:eb||[],setValue:ef}),(0,o.jsx)("input",(0,t.Z)((0,i.Z)({},em("coverageAreas")),{type:"hidden"}))]}),(0,o.jsxs)(y.ZP,{width:"100%",container:!0,item:!0,xs:12,columnSpacing:2,children:[(0,o.jsxs)(y.ZP,{item:!0,xs:12,width:"100%",pr:2,mb:1,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Rates"}),(0,o.jsx)(b.Z,{})]}),(0,o.jsx)(y.ZP,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Normal"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(H.Qr,{name:"normal.firstHour",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.normal)||void 0===n?void 0:n.firstHour,helperText:null===(r=ec.normal)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(H.Qr,{name:"normal.subsequentHours",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.normal)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ec.normal)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,o.jsx)(y.ZP,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(H.Qr,{name:"ooh.firstHour",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.ooh)||void 0===n?void 0:n.firstHour,helperText:null===(r=ec.ooh)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(H.Qr,{name:"ooh.subsequentHours",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.ooh)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ec.ooh)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,o.jsx)(y.ZP,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(H.Qr,{name:"premium.firstHour",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.premium)||void 0===n?void 0:n.firstHour,helperText:null===(r=ec.premium)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(H.Qr,{name:"premium.subsequentHours",control:eu,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(I.I,{fullWidth:!0,leftLabel:(0,o.jsx)(T.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ec.premium)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ec.premium)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})})]})]}),(0,o.jsx)(y.ZP,{item:!0,xs:12,md2:5,children:(0,o.jsxs)(v.Z,{spacing:1,children:[(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,mb:1,children:"Times"}),(0,o.jsx)(b.Z,{})]}),(0,o.jsxs)(v.Z,{spacing:.5,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,o.jsx)(v.Z,{spacing:1,children:k.jT.map(function(e){var n,r,i;return(0,o.jsx)(R.k,{control:eu,name:"oohTimes.".concat(e.value),day:e.label,error:null===(n=ec.oohTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ec.oohTimes)||void 0===r?void 0:null===(i=r[e.value])||void 0===i?void 0:i.message})})})]}),(0,o.jsxs)(v.Z,{spacing:.5,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,o.jsx)(v.Z,{spacing:1,children:k.jT.map(function(e){var n,r,i;return(0,o.jsx)(R.k,{control:eu,name:"premiumTimes.".concat(e.value),day:e.label,error:null===(n=ec.premiumTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ec.premiumTimes)||void 0===r?void 0:null===(i=r[e.value])||void 0===i?void 0:i.message})})})]})]})}),(0,o.jsxs)(y.ZP,{container:!0,item:!0,xs:12,mt:2,columnSpacing:2,children:[(0,o.jsx)(y.ZP,{item:!0,xs:0,md2:7}),(0,o.jsx)(y.ZP,{item:!0,xs:12,md2:5,children:(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Days"}),(0,o.jsx)(v.Z,{direction:"row",spacing:1,flexWrap:"wrap",children:ej.fields.map(function(e,n){return(0,o.jsx)(m.Z,{label:Q()(e).format("YYYY-MM-DD"),size:"small",onDelete:function(){return ej.remove(n)}})})}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,o.jsx)(E.M,{inputFormat:"YYYY-MM-DD",placeholder:"Select days",value:et,onChange:function(e){es(e)},renderInput:function(e){return(0,o.jsx)(S.Z,(0,t.Z)((0,i.Z)({},e),{fullWidth:!0,color:"secondary",variant:"standard"}))}}),(0,o.jsx)(d.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:function(){return ej.append(et)},children:(0,o.jsx)($.Z,{})})]})]})})]}),(0,o.jsx)(y.ZP,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},mt:2,children:(0,o.jsx)(p.Z,{color:"muiGray.main",children:"All job start times occurring outside times specified above will be charged based on Normal rates."})})]})}),(0,o.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,o.jsx)(d.Z,{color:"danger",variant:"contained",onClick:l,children:"Cancel"}),(0,o.jsx)(d.Z,{color:"secondary",variant:"contained",type:"submit",children:Y||n?"Save":"Add schedule"})]})]})})]})};em.propTypes={entity:l().oneOf(["System-Customer","System-Supplier"]).isRequired},em.defaultProps={};var ex=(0,w.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"90vw",height:n?"100vh":"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),ev={"System-Customer":"customer","System-Supplier":"supplier"},ep=r(5336),ef=r(36663),eg=r(15843),ej=function(e){var n=e.initialFilters,r=e.entity,a=e.entityId,l=e.tableHeight,j=e.paperHeight,Z=(0,s.Z)((0,ed.d)(),2),b=Z[0],y=Z[1],S=(0,O.useState)({}),C=S[0],w=S[1],P=(0,O.useState)(!1),I=P[0],T=P[1],H=(0,c.x)({filters:C}),W=H.ref,q=H.initialData,M=(0,u.aM)(g.pB,{variables:(0,t.Z)((0,i.Z)({},q),{entity:r})}),k=M.data,A=void 0===k?{schedules:[],meta:{aggregate:{totalCount:0}}}:k,R=A.schedules,L=A.meta,_=M.loading,F=M.refetch,N=function(e){e.stopPropagation(),y({content:function(e){var n=e.onClose;return(0,o.jsx)(em,{entity:r,entityId:a,close:n})}})},E=(0,O.useCallback)(function(e){y({content:function(n){var i=n.onClose;return(0,o.jsx)(em,{scheduleId:e,entity:r,entityId:a,close:i})}})},[r,a,y]),D=(0,O.useCallback)(function(e){y({content:function(n){var r=n.onClose;return(0,o.jsx)(el,{serviceId:e,close:r})}})},[y]),Q=(0,O.useCallback)(function(e){return[{icon:"edit",onClick:function(n){n.stopPropagation(),E(e.id)},tooltip:"Edit Schedule"},{icon:"edit",onClick:function(n){n.stopPropagation(),D(e.serviceId)},tooltip:"Edit Service"}]},[D,E]),$=(0,O.useMemo)(function(){return[{sortable:!1,flex:1,minWidth:180,field:"serviceLine",headerName:"Service line"},{sortable:!1,flex:1,minWidth:180,field:"schedule",headerName:"Schedule"},{sortable:!1,flex:1,minWidth:180,field:"rate",headerName:"\xa3/H",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.rate.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.rate.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"rateOOH",headerName:"\xa3/H OOH",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.rateOOH.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.rateOOH.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"ratePremium",headerName:"\xa3/H Premium",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.ratePremium.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.ratePremium.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:150,field:"coverageArea",headerName:"Coverage area"},{sortable:!1,flex:1,field:"minimumDuration",headerName:"Min duration"},{sortable:!1,flex:1,field:"minimumIncrement",headerName:"Min increment"},{sortable:!1,flex:1,minWidth:100,field:"status",headerName:"Status",renderCell:function(e){var n=e.row;return(0,o.jsx)(m.Z,{label:"active"===n.status?"Active":"Inactive",color:"active"===n.status?"success":"danger",size:"small"})}},{sortable:!1,width:100,field:"actions",headerName:"Actions",renderCell:function(e){var n=e.row;return(0,o.jsx)(ep.C,{row:n,actionsData:Q})}}]},[Q]),V=(0,O.useMemo)(function(){return R.map(function(e){return{id:e.id,serviceLine:e.service.name,schedule:e.name,rate:e.normal,rateOOH:e.ooh,ratePremium:e.premium,coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,status:e.status,serviceId:e.serviceId}})},[R]);return(0,o.jsxs)(o.Fragment,{children:[b,(0,o.jsx)(ef.X,{open:I,close:function(){return T(!1)},initialFilters:n,setFilters:w}),(0,o.jsx)(v.Z,{width:"100%",spacing:2,children:(0,o.jsxs)(x.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:j},children:[(0,o.jsxs)(v.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,children:[(0,o.jsx)(p.Z,{variant:"h5",sx:{fontWeight:600},children:"Services"}),(0,o.jsxs)(h.Z,{children:[(0,o.jsx)(d.Z,{color:"secondary",variant:"contained",onClick:N,children:"Add schedule"}),(0,o.jsx)(d.Z,{startIcon:(0,o.jsx)(eg.Z,{}),variant:"contained",onClick:function(){return T(!0)},children:"Filters"})]})]}),(0,o.jsx)(f.i,{autoHeight:!1,loading:_,ref:W,columns:$,rows:V,meta:L,refetch:F,containerHeight:l,columnVisibilityModel:{},onRowClick:function(e){return E(e.row.id)}})]})})]})};ej.propTypes={initialFilters:l().object,entity:l().oneOf(["System-Customer","System-Supplier"]).isRequired,entityId:l().string,tableHeight:l().string,paperHeight:l().string},ej.defaultProps={tableHeight:"calc(100% - 42px)",paperHeight:"calc(100vh - 90px)"}},4790:function(e,n,r){r.d(n,{O:function(){return l}});var i=r(26042),t=r(85893),s=r(90948),o=r(40044),a=(0,s.ZP)(function(e){return(0,t.jsx)(o.Z,(0,i.Z)({disableRipple:!0},e))})(function(e){var n=e.theme;return{textTransform:"none",color:n.palette.text.primary,"&.Mui-selected":{fontWeight:600,color:n.palette.secondary.contrastText,backgroundColor:n.palette.secondary.main},"&.Mui-focusVisible":{backgroundColor:"rgba(100, 95, 228, 0.32)"}}}),l=function(e){return(0,t.jsx)(a,(0,i.Z)({},e))};l.defaultProps={},l.propTypes={}},23914:function(e,n,r){r.d(n,{m:function(){return x}});var i=r(26042),t=r(69396),s=r(99534),o=r(85893),a=r(45697),l=r.n(a),u=r(90948),c=r(3892),d=r(11163),h=r.n(d),m=(0,u.ZP)(function(e){return(0,o.jsx)(c.Z,(0,i.Z)({},e))})(function(e){var n=e.theme,r=e.size;return(0,t.Z)((0,i.Z)({},"small"===r&&{height:"32px",minHeight:"32px"}),{"& .MuiTabs-scroller":(0,i.Z)({overflow:"scroll !important"},"small"===r&&{height:"60px",minHeight:"60px"}),"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-flexContainer > .MuiTab-root":(0,t.Z)((0,i.Z)({},"small"===r&&{height:"32px",minHeight:"32px"}),{border:1,borderStyle:"solid",borderColor:n.palette.divider,"&:first-child":(0,i.Z)({borderTopLeftRadius:"10px",borderBottomLeftRadius:"10px"},"small"===r&&{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}),"&:last-child":(0,i.Z)({borderTopRightRadius:"10px",borderBottomRightRadius:"10px"},"small"===r&&{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"})})})}),x=function(e){var n=e.onChange,r=e.changeQuery,t=(0,s.Z)(e,["onChange","changeQuery"]),a=(0,d.useRouter)(),l=function(e,i){n(e,i),r&&u(i)},u=function(e){var n=a.query;delete n.tab,n.tab=e,h().push({pathname:a.pathname,query:n,shallow:!0})};return(0,o.jsx)(m,(0,i.Z)({onChange:l},t))};x.defaultProps={size:"small"},x.propTypes={size:l().oneOf(["small",void 0])}}}]);