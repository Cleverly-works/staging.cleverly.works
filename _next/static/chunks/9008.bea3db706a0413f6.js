"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9008],{29422:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(77349),o=n(11640),r=n(19013),s=n(13882),i=n(83946);function c(e,t){if((0,s.Z)(2,arguments),!t||"object"!=typeof t)return new Date(NaN);var n=t.years?(0,i.Z)(t.years):0,c=t.months?(0,i.Z)(t.months):0,l=t.weeks?(0,i.Z)(t.weeks):0,u=t.days?(0,i.Z)(t.days):0,d=t.hours?(0,i.Z)(t.hours):0,h=t.minutes?(0,i.Z)(t.minutes):0,m=t.seconds?(0,i.Z)(t.seconds):0,p=(0,r.Z)(e),v=c||n?(0,o.Z)(p,c+12*n):p,y=u||l?(0,a.Z)(v,u+7*l):v;return new Date(y.getTime()+1e3*(m+60*(h+60*d)))}},1209:function(e,t,n){n.r(t),n.d(t,{default:function(){return ev}});var a=n(47568),o=n(14924),r=n(26042),s=n(69396),i=n(828),c=n(7297),l=n(97582),u=n(85893),d=n(67294),h=n(45697),m=n(66252),p=n(6388),v=n(50319),y=n(75063);function b(){var e=(0,c.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $timezone: String\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $currentUserId: Int\n    $yearStart: timestamptz\n  ) {\n    dashboardTilesData: getDashboard_HomeTiles(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      thresholdApprovals\n      outstandingInvoices\n      outstandingInvoicesValues\n      invoiceUnsent\n      reactiveJobsToday\n      plannedJobsToday\n      complianceJobToday\n      liveP1Jobs\n      offeredJobs\n      quotesToday\n      quotesNotSent\n      quotesOverdue\n      quotesDueThisWeek\n      inprogressJobs\n      numberOfOpenJobs\n      jobsInDispute\n      worksValueMTD\n      worksValueYTD\n      overdueComplianceJobs\n      onHold\n      upliftRequested\n      ppmOverdue\n      reactiveOverdue\n      failedJobs\n      imminentJobSlaBreaches\n      openRemedialQuotes\n      openQuotes\n      imminentQuoteSlaBreaches\n      quoteSlaBreached\n      jobSlaBreachedOnSite\n      jobSlaBreachedJobReport\n    }\n    chartJobsPerDay: getDashboard_HomeTiles_Jobs_perDay(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      jobsOnThisMonth\n    }\n    chartRevenuesPerDay: getDashboard_HomeTiles_Revenues_perDay(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      revenuesOnThisMonth\n    }\n    chartRevenuesPerYear: getDashboard_HomeTiles_Revenues_perYear(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      revenuesOnThisYear\n    }\n  }\n"]);return b=function(){return e},e}function g(){var e=(0,c.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n  ) {\n    ",": getDashboard_HomeTiles_","(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      sum\n    }\n  }\n"]);return g=function(){return e},e}function f(){var e=(0,c.Z)(["\n  query GetSuppliersLocation($where: UserLocation_bool_exp) {\n    suppliersLocation: UserLocation(distinct_on: userId, where: $where) {\n      id\n      geo\n      account: Account {\n        id\n        name\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n  }\n"]);return f=function(){return e},e}function I(){var e=(0,c.Z)(['\n  query GetJobsLocation($where: Job_bool_exp) {\n    jobsLocation: Job(where: $where, order_by: { createdAt: desc }) {\n      id\n      number\n      type\n      location: Location {\n        id\n        name\n        addresses: Addresses(\n          where: { registered: { _eq: true }, entity: { _eq: "Location" } }\n          order_by: { createdAt: desc }\n        ) {\n          address: Address {\n            addressLine1\n            addressLine2\n            addressLine3\n            postCode\n            name\n            geo\n          }\n        }\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n  }\n']);return I=function(){return e},e}var w=(0,y.Ps)(b()),Z=(0,y.Ps)(f()),k=(0,y.Ps)(I()),S=n(11163),T=n.n(S),j=n(83894),D=n(23855),M=n(43703),B=n(69119),J=n(38148),x=n(74975),A=n(10367),_=[{type:"tile",pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"reactiveJobsToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},name:"plannedJobsToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},name:"quotesToday",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},name:"liveP1Jobs",greaterIsBetter:!0},{type:"tile",pinned:!0,colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},name:"offeredJobs",greaterIsBetter:!0},{type:"chart",name:"chartJobMetrics"},{type:"mapChart",name:"mapChart"},{type:"chart",name:"numberOfNotifications"}],C=n(29815),q=n(7069),N=n(77349),L=n(29383),$=n(96486),z=function(e){var t=[];return e.forEach(function(e){if(!e.hide){if("chart"===e.type&&"object"==typeof e.values&&Object.keys(e.values).length>0){var n={};Object.keys(e.values).forEach(function(t){var a=e.values[t];Array.isArray(a)&&a.forEach(function(e){e.hide||(Array.isArray(n[t])?n[t].push(e):n[t]=[e])})}),t.push((0,s.Z)((0,r.Z)({},e),{values:n}))}else t.push(e)}}),t},P="/dashboard",R=function(e){var t,n,a,o,i,c,l,u,d,h,m=e.isCustomerUser,p=e.hasQuotesModule,v=e.hasFinancesModule,y=e.asAt,b=e.userTiles,g=e.dashboardTilesData,f=e.userId,I=e.accountId,w=g||{},Z=w.thresholdApprovals,k=w.outstandingInvoices,S=w.outstandingInvoicesValues,T=w.complianceJobToday,j=w.inprogressJobs,D=w.liveP1Jobs,M=w.plannedJobsToday,B=w.quotesDueThisWeek,J=w.quotesToday,A=w.reactiveJobsToday,_=w.upliftRequested,R=w.worksValueMTD,O=w.worksValueYTD,E=w.jobsOnThisMonth,Q=w.revenuesOnThisMonth,U=w.revenuesOnThisYear,V=w.jobsLocation,W=w.failedJobs,Y=w.imminentJobSlaBreaches,G=w.openRemedialQuotes,H=w.openQuotes,F=w.imminentQuoteSlaBreaches,K=w.quoteSlaBreached,X=w.jobSlaBreachedOnSite,ee=w.jobSlaBreachedJobReport,et=[],en=[],ea=[],eo=[],er=[],es=[],ei=[],ec=[],el=[],eu=[];if(E&&E.length>0&&E.forEach(function(e,t){var n=e.date,a=e.ppmJobsOnThisMonth,o=e.reactiveJobsOnThisMonth,r=new Date(y),s=new Date(n);if(s>=(0,q.Z)(r,8)&&s<=(0,N.Z)(r,7)){if(E[t-1])for(var i=E[t-1].date,c=(0,L.Z)(s,new Date(i)),l=1;l<c;l++)et.push({date:(0,q.Z)(s,l),values:[]}),eo.push({date:(0,q.Z)(s,l),values:[]});et.push({date:s,values:a}),eo.push({date:s,values:o})}if(s>=(0,q.Z)(r,15)&&s<=(0,N.Z)(r,14)){if(E[t-1])for(var u=E[t-1].date,d=(0,L.Z)(s,new Date(u)),h=1;h<d;h++)en.push({date:(0,q.Z)(s,h),values:[]}),er.push({date:(0,q.Z)(s,h),values:[]});en.push({date:s,values:a}),er.push({date:s,values:o})}if(s>=(0,q.Z)(r,31)&&s<=(0,N.Z)(r,30)){if(E[t-1])for(var m=E[t-1].date,p=(0,L.Z)(s,new Date(m)),v=1;v<p;v++)ea.push({date:(0,q.Z)(s,v),values:[]}),es.push({date:(0,q.Z)(s,v),values:[]});ea.push({date:s,values:a}),es.push({date:s,values:o})}}),Q&&Q.length>0){var ed="dd/MM";Q.forEach(function(e,t){var n=e.date,a=e.revenuesOnThisDay,o=new Date(y),r=new Date(n);if(r>=(0,q.Z)(o,8)){if(Q[t-1])for(var s=Q[t-1].date,i=(0,L.Z)(new Date(s),r),c=1;c<i;c++)ei.push({date:(0,N.Z)(r,c),sum:[]});ei.push({date:r,sum:a,formatDate:ed})}if(r>=(0,q.Z)(o,15)){if(Q[t-1])for(var l=Q[t-1].date,u=(0,L.Z)(new Date(l),r),d=1;d<u;d++)ec.push({date:(0,N.Z)(r,d),sum:[]});ec.push({date:r,sum:a,formatDate:ed})}if(r>=(0,q.Z)(o,31)){if(Q[t-1])for(var h=Q[t-1].date,m=(0,L.Z)(new Date(h),r),p=1;p<m;p++)el.push({date:(0,N.Z)(r,p),sum:[]});el.push({date:r,sum:a,formatDate:ed})}})}U&&U.length>0&&U.forEach(function(e){var t=e.date,n=e.revenuesOnThisMonth;eu.push({date:t,sum:n,formatDate:"MM/yyyy"})});var eh=y?(0,x.Z)(y,"yyyy-MM-dd"):"",em=z([{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},title:"Reactive jobs today",description:"Reactive jobs scheduled to happen today",name:"reactiveJobsToday",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=reactiveJobsToday").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==A?void 0:A.today)||0,week:(null==A?void 0:A.week)||0,month:(null==A?void 0:A.month)||0,threeMonth:(null==A?void 0:A.threeMonth)||0,year:(null==A?void 0:A.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"PPM jobs today",description:"Planned maintenance jobs scheduled to happen today",name:"plannedJobsToday",to:"".concat(P,"/issues?type=ppm&asAt=").concat(eh,"&tileName=plannedJobsToday").concat(f?"&userId=".concat(f):""),values:{today:(null==M?void 0:M.today)||0,week:(null==M?void 0:M.week)||0,month:(null==M?void 0:M.month)||0,threeMonth:(null==M?void 0:M.threeMonth)||0,year:(null==M?void 0:M.year)||0},greaterIsBetter:!0},{hide:!p&&m,type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Quotes today",description:"Quotes where due date is today",name:"quotesToday",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=quotesToday").concat(f?"&userId=".concat(f):""),values:{today:(null==J?void 0:J.today)||0,week:(null==J?void 0:J.week)||0,month:(null==J?void 0:J.month)||0,threeMonth:(null==J?void 0:J.threeMonth)||0,year:(null==J?void 0:J.year)||0},greaterIsBetter:!0},{type:"chart",size:[2,1],title:"Jobs metrics",name:"chartJobMetrics",values:{week:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(t=(0,$.orderBy)(et,"date","asc"))&&void 0!==t?t:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(n=(0,$.orderBy)(eo,"date","asc"))&&void 0!==n?n:[]}]},{hide:m&&!v,groupLabel:"Spend per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(a=(0,$.orderBy)(ei,"date","asc"))&&void 0!==a?a:[]}]}],twoWeeks:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(o=(0,$.orderBy)(en,"date","asc"))&&void 0!==o?o:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(i=(0,$.orderBy)(er,"date","asc"))&&void 0!==i?i:[]}]},{hide:m&&!v,groupLabel:"Spend per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(c=(0,$.orderBy)(ec,"date","asc"))&&void 0!==c?c:[]}]}],month:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(l=(0,$.orderBy)(ea,"date","asc"))&&void 0!==l?l:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(u=(0,$.orderBy)(es,"date","asc"))&&void 0!==u?u:[]}]},{hide:m&&!v,groupLabel:"Spend per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(d=(0,$.orderBy)(el,"date","asc"))&&void 0!==d?d:[]}]}],year:[{hide:m&&!v,groupLabel:"Monthly job spend",groupName:"revenuesPerYear",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(h=(0,$.orderBy)(eu,"date","asc"))&&void 0!==h?h:[]}]}]}},{type:"mapChart",size:[2,1],title:"Geolocation info",name:"mapChart",values:{month:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.month)||[]}]}],threeMonth:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.threeMonth)||[]}]}],tomorrow:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.tomorrow)||[]}]}],today:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.today)||[]}]}],nextWeek:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.nextWeek)||[]}]}],nextTwoWeeks:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.nextTwoWeeks)||[]}]}],nextMonth:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.nextMonth)||[]}]}],week:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==V?void 0:V.week)||[]}]}]}},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Live P1 jobs",description:"Jobs with P1 status scheduled for today but not completed",name:"liveP1Jobs",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=liveP1Jobs").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==D?void 0:D.today)||0,week:(null==D?void 0:D.week)||0,month:(null==D?void 0:D.month)||0,threeMonth:(null==D?void 0:D.threeMonth)||0,year:(null==D?void 0:D.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Compliance jobs today",description:"Compliance work orders that are scheduled to take place today",name:"complianceJobToday",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=complianceJobToday").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==T?void 0:T.today)||0,week:(null==T?void 0:T.week)||0,month:(null==T?void 0:T.month)||0,threeMonth:(null==T?void 0:T.threeMonth)||0,year:(null==T?void 0:T.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,20],danger:[21,40],warning:[41,null]},title:"Jobs in progress",description:"Jobs currently in progress",name:"inprogressJobs",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=inprogressJobs").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==j?void 0:j.today)||0,week:(null==j?void 0:j.week)||0,month:(null==j?void 0:j.month)||0,threeMonth:(null==j?void 0:j.threeMonth)||0,year:(null==j?void 0:j.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Uplift requests",description:"Jobs where an uplift has been requested but not yet approved or rejected",name:"upliftRequested",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=upliftRequested").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==_?void 0:_.today)||0,week:(null==_?void 0:_.week)||0,month:(null==_?void 0:_.month)||0,threeMonth:(null==_?void 0:_.threeMonth)||0,year:(null==_?void 0:_.year)||0},greaterIsBetter:!0},{hide:!v&&m,type:"tile",size:[1,1],colourConfig:{success:[0,9],danger:[10,10],warning:[11,null]},title:"Work order value (MTD)",description:"Value of jobs completed in the month to date",name:"worksValueMTD",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=worksValueMTD").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==R?void 0:R.today)||0,week:(null==R?void 0:R.week)||0,month:(null==R?void 0:R.month)||0,threeMonth:(null==R?void 0:R.threeMonth)||0,year:(null==R?void 0:R.year)||0},greaterIsBetter:!0,valueType:"price"},{hide:!v&&m,type:"tile",size:[1,1],colourConfig:{success:[0,9],danger:[10,10],warning:[11,null]},title:"Work order value (YTD)",description:"Value of jobs completed in the year to date",name:"worksValueYTD",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=worksValueYTD").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==O?void 0:O.today)||0,week:(null==O?void 0:O.week)||0,month:(null==O?void 0:O.month)||0,threeMonth:(null==O?void 0:O.threeMonth)||0,year:(null==O?void 0:O.year)||0},greaterIsBetter:!0,valueType:"price"},{hide:!p&&m,type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Quotes due this week",description:"Quotes where due date is within next 7 days",name:"quotesDueThisWeek",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=quotesDueThisWeek").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==B?void 0:B.today)||0,week:(null==B?void 0:B.week)||0,month:(null==B?void 0:B.month)||0,threeMonth:(null==B?void 0:B.threeMonth)||0,year:(null==B?void 0:B.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Number of outstanding invoices",description:"The number of invoices that have been sent to customers but not reconciled",name:"outstandingInvoices",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=outstandingInvoices").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==k?void 0:k.today)||0,week:(null==k?void 0:k.week)||0,month:(null==k?void 0:k.month)||0,threeMonth:(null==k?void 0:k.threeMonth)||0,year:(null==k?void 0:k.year)||0},greaterIsBetter:!0},{hide:!v&&m,type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Value of outstanding invoices",description:"The value of invoices that have been sent to customers but not reconciled",name:"outstandingInvoicesValues",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=outstandingInvoices").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==S?void 0:S.today)||0,week:(null==S?void 0:S.week)||0,month:(null==S?void 0:S.month)||0,threeMonth:(null==S?void 0:S.threeMonth)||0,year:(null==S?void 0:S.year)||0},greaterIsBetter:!0,valueType:"price"},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Threshold approvals outstanding",description:"Work orders and quotes where approval is required based on threshold levels",name:"thresholdApprovals",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=thresholdApprovals").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==Z?void 0:Z.today)||0,week:(null==Z?void 0:Z.week)||0,month:(null==Z?void 0:Z.month)||0,threeMonth:(null==Z?void 0:Z.threeMonth)||0,year:(null==Z?void 0:Z.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Failed jobs",description:"Jobs where supplier has reported failures and these have not been resolved.",name:"failedJobs",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=failedJobs").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==W?void 0:W.today)||0,week:(null==W?void 0:W.week)||0,month:(null==W?void 0:W.month)||0,threeMonth:(null==W?void 0:W.threeMonth)||0,year:(null==W?void 0:W.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Imminent job SLA breaches",description:"These are jobs where there is a potential SLA breach in 1 hour or less.",name:"imminentJobSlaBreaches",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=imminentJobSlaBreaches").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==Y?void 0:Y.today)||0,week:(null==Y?void 0:Y.week)||0,month:(null==Y?void 0:Y.month)||0,threeMonth:(null==Y?void 0:Y.threeMonth)||0,year:(null==Y?void 0:Y.year)||0},greaterIsBetter:!0},{hide:!p&&m,type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Open remedial quotes",description:"These are remedial quotes that have not yet been resolved -\n        for example, accepted or rejected by the customer or closed.",name:"openRemedialQuotes",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=openRemedialQuotes").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==G?void 0:G.today)||0,week:(null==G?void 0:G.week)||0,month:(null==G?void 0:G.month)||0,threeMonth:(null==G?void 0:G.threeMonth)||0,year:(null==G?void 0:G.year)||0},greaterIsBetter:!0},{hide:!p&&m,type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Open quotes",description:"These are quotes that have not yet been resolved -\n      for example, accepted or rejected by the customer or closed.",name:"openQuotes",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=openQuotes").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==H?void 0:H.today)||0,week:(null==H?void 0:H.week)||0,month:(null==H?void 0:H.month)||0,threeMonth:(null==H?void 0:H.threeMonth)||0,year:(null==H?void 0:H.year)||0},greaterIsBetter:!0},{hide:!p&&m,type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Imminent quote SLA breaches",description:"These are quotes where there is a potential SLA breach in 1 day or less.",name:"imminentQuoteSlaBreaches",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=imminentQuoteSlaBreaches").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==F?void 0:F.today)||0,week:(null==F?void 0:F.week)||0,month:(null==F?void 0:F.month)||0,threeMonth:(null==F?void 0:F.threeMonth)||0,year:(null==F?void 0:F.year)||0},greaterIsBetter:!0},{hide:!p&&m,type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Quotes - Quote return time",description:"These are quotes where the SLA was not returned within the relevant timeframe.",name:"quoteSlaBreached",to:"".concat(P,"/quotes?asAt=").concat(eh,"&tileName=quoteSlaBreached").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==K?void 0:K.today)||0,week:(null==K?void 0:K.week)||0,month:(null==K?void 0:K.month)||0,threeMonth:(null==K?void 0:K.threeMonth)||0,year:(null==K?void 0:K.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Work orders - On site time",description:"These are jobs where the time taken for the engineer /\n       operative to arrive on site was beyond the relevant SLA. ",name:"jobSlaBreachedOnSite",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=jobSlaBreachedOnSite").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==X?void 0:X.today)||0,week:(null==X?void 0:X.week)||0,month:(null==X?void 0:X.month)||0,threeMonth:(null==X?void 0:X.threeMonth)||0,year:(null==X?void 0:X.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Work orders - Report submission time",description:"These are jobs where the time taken to submit the report\n        to the customer was more than the relevant SL.A.",name:"jobSlaBreachedJobReport",to:"".concat(P,"/issues?asAt=").concat(eh,"&tileName=jobSlaBreachedJobReport").concat(f?"&userId=".concat(f):"").concat(I?"&accountId=".concat(I):""),values:{today:(null==ee?void 0:ee.today)||0,week:(null==ee?void 0:ee.week)||0,month:(null==ee?void 0:ee.month)||0,threeMonth:(null==ee?void 0:ee.threeMonth)||0,year:(null==ee?void 0:ee.year)||0},greaterIsBetter:!0}]),ep=em.map(function(e){return e.name}),ev={success:[0,10],danger:[11,20],warning:[21,null]},ey=b.reduce(function(e,t){var n,a=t.colourConfig,o=t.pinned,i=t.greaterIsBetter,c=t.name,l=em.find(function(e){return e.name===c});return l?(0,C.Z)(e).concat([(0,s.Z)((0,r.Z)({},l),{pinned:null!==(n=null!=o?o:l.pinned)&&void 0!==n&&n,colourConfig:void 0===a?ev:a,greaterIsBetter:void 0===i||i})]):e},[]).sort(function(e,t){return ep.indexOf(e)-ep.indexOf(t)});return{fullTilesList:em,userTilesList:ey}},O=n(5616),E=n(98456),Q=n(86886),U=n(5339),V=n(98572),W=n(67868),Y=n(83537),G=n(6425),H=n(75327),F=n(29422),K=n(30734),X=function(e){var t=e.groupName,n=e.time,a=e.asAt,o=null,r={};switch(t){case"jobsLocation":o=k;break;case"suppliersLocation":o=Z}if("jobsLocation"===t)switch(r.Location={Addresses:{registered:{_eq:!0},entity:{_eq:"Location"},Address:{geo:{_is_null:!1}}}},n){case"today":r._and=[{timingStart:{_lte:a}},{timingStart:{_gte:(0,B.Z)(a)}}];break;case"tomorrow":r._and=[{timingStart:{_lte:(0,F.Z)(a,{days:1})}},{timingStart:{_gte:(0,F.Z)((0,B.Z)(a),{days:1})}}];break;case"nextWeek":r._and=[{timingStart:{_lte:(0,F.Z)(a,{weeks:1})}},{timingStart:{_gte:(0,F.Z)((0,B.Z)(a),{days:1})}}];break;case"nextTwoWeeks":r._and=[{timingStart:{_lte:(0,F.Z)(a,{weeks:2})}},{timingStart:{_gte:(0,F.Z)((0,B.Z)(a),{days:1})}}];break;case"nextMonth":r._and=[{timingStart:{_lte:(0,F.Z)(a,{months:1})}},{timingStart:{_gte:(0,F.Z)((0,B.Z)(a),{days:1})}}];break;case"week":r._and=[{timingStart:{_lte:a}},{timingStart:{_gte:(0,K.Z)(a,{weeks:1})}}];break;case"month":r._and=[{timingStart:{_lte:a}},{timingStart:{_gte:(0,K.Z)(a,{months:1})}}];break;case"threeMonth":r._and=[{timingStart:{_lte:a}},{timingStart:{_gte:(0,K.Z)(a,{months:3})}}]}else r.geo={_is_null:!1},"month"===n&&(r._and=[{createdAt:{_lte:a}},{createdAt:{_gte:(0,K.Z)(a,{months:1})}}]);return{query:o,variables:{where:r}}},ee=function(e){var t=e.state,n=e.data,a=e.groupName,i=e.time,c={};if("suppliersLocation"===a)c=(0,s.Z)((0,r.Z)({},t[a]||{}),(0,o.Z)({},i,n[a].map(function(e){var t,n,a,o=e.id,r=e.geo;return{id:o,account:e.account,user:e.user,position:{lat:null===(t=r.coordinates)||void 0===t?void 0:t[1],lng:null===(n=r.coordinates)||void 0===n?void 0:n[0]}}})));else{var l=n[a].map(function(e){var t,n,a,o,r,s=e.id,i=e.number,c=e.type,l=e.location;return{id:s,number:i,type:c,location:l,supplier:e.supplier,service:e.service,position:{lat:null===(t=l.addresses[0].address.geo)||void 0===t?void 0:null===(n=t.coordinates)||void 0===n?void 0:n[1],lng:null===(a=l.addresses[0].address.geo)||void 0===a?void 0:null===(o=a.coordinates)||void 0===o?void 0:o[0]}}});c=(0,s.Z)((0,r.Z)({},t[a]||{}),(0,o.Z)({},i,l))}return c},et=function(e){var t=e.prevData,n=e.data,a=e.type;return Object.keys(n).reduce(function(e,i){return(0,s.Z)((0,r.Z)({},e),(0,o.Z)({},i,(0,s.Z)((0,r.Z)({},(null==t?void 0:t[i])||{}),(0,o.Z)({},a,n[i]))))},{})},en=function(e){var t,n=e.name,a=e.asAt,o=e.userId,r=e.adminId,s=e.accountId,i=e.time,c=(0,y.Ps)(g(),n,n),l=null;switch(i){case"week":l=(0,K.Z)(a,{weeks:1});break;case"month":l=(0,K.Z)(a,{months:1});break;case"threeMonth":l=(0,K.Z)(a,{months:3});break;case"year":l=(0,K.Z)(a,{years:1})}return{query:c,variables:{adminId:r,accountId:s,asAt:l,dayStart:(0,B.Z)(l),monthStart:(0,M.Z)(l),userId:o,yearStart:(0,J.Z)(l)}}},ea=n(18586),eo=n(2845);function er(){var e=(0,c.Z)(["\n  width: 100%;\n  height: 100%;\n\n  .firstBlock {\n    margin: 0;\n    flex-basis: 50% !important;\n    max-width: 50% !important;\n    min-width: auto;\n  }\n\n  .firstBlockItem {\n    padding-left: 24px;\n    padding-top: 24px;\n  }\n\n  .bigTile {\n    flex-basis: 50% !important;\n    max-width: 50%;\n  }\n\n  .secondBlock {\n    margin: 0;\n    flex-basis: 50% !important;\n    min-width: auto;\n  }\n\n  .secondBlockItem {\n    flex-basis: 50% !important;\n    max-width: 50% !important;\n    padding-left: 24px;\n    padding-top: 24px;\n  }\n\n  @media (max-width: 1550px) {\n    .firstBlock {\n      margin: 0;\n      flex-basis: 100% !important;\n      max-width: 100% !important;\n    }\n\n    .bigTile {\n      flex-basis: 100% !important;\n      max-width: 100%;\n    }\n\n    .secondBlock {\n      flex-basis: 100% !important;\n    }\n    .restTilesBoxItem {\n      flex-basis: 100% !important;\n    }\n  }\n\n  @media (max-width: 800px) {\n    .secondBlock {\n      flex-basis: 100% !important;\n    }\n    .secondBlockItem {\n      flex-basis: 100% !important;\n      max-width: 100% !important;\n  }\n"]);return er=function(){return e},e}function es(){var e=(0,c.Z)(["\n  align-content: flex-start;\n  height: auto;\n  min-height: 400px;\n  justify-content: space-between;\n"]);return es=function(){return e},e}function ei(){var e=(0,c.Z)(["\n  display: flex;\n  flex-wrap: wrap;\n\n  min-width: 824px;\n\n  justify-content: space-between;\n  align-content: space-between;\n"]);return ei=function(){return e},e}function ec(){var e=(0,c.Z)(["\n  justify-content: space-between;\n"]);return ec=function(){return e},e}var el=(0,j.Z)(new Date),eu=function(e){var t,n,c=e.user;e.theme;var h=(0,ea.q)().hasUserModule,y=(0,eo.x)().hasRole,b=(0,S.useRouter)(),g=(0,m.x)(),f=y("customer_user"),I=h("quotes"),Z=h("finances"),k=(0,d.useState)(!1),A=k[0],C=k[1],q=(0,d.useState)({}),N=q[0],L=q[1],$=(0,d.useState)(_),z=$[0],P=$[1],F=(0,d.useState)([]),K=F[0],er=F[1],es=(0,d.useState)([]),ei=es[0],ec=es[1],eu=(0,d.useState)(b.query.asAt?(0,j.Z)((0,D.Z)(b.query.asAt)):el)[0],ev=(0,d.useState)({monthStart:(0,M.Z)(eu),todayEnd:(0,j.Z)(eu),todayStart:(0,B.Z)(eu),yearStart:(0,J.Z)(eu)})[0],ey=(0,d.useState)(b.query.userId?b.query.userId:c.id)[0];(0,d.useEffect)(function(){"/dashboard"===T().pathname&&T().push({pathname:"/dashboard",query:(0,s.Z)((0,r.Z)({},b.query),{asAt:(0,x.Z)(eu,"yyyy-MM-dd"),userId:ey})})},[eu,ey]);var eb=(0,p.aM)(H.iM,{variables:{userId:c.id,accountId:c.accountId}}),eg=eb.data,ef=eb.refetch,eI=(null==eg?void 0:null===(t=eg.accountUser)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.meta)||{},ew=(0,i.Z)((0,v.D)(H.fA),1)[0];(0,d.useEffect)(function(){(null==eI?void 0:eI.dashboard)&&P(eI.dashboard)},[eI]),(0,d.useEffect)(function(){var e=R({isCustomerUser:f,hasQuotesModule:I,hasFinancesModule:Z,asAt:eu,dashboardTilesData:(0,r.Z)({},N),userTiles:z,accountId:c.accountId,userId:ey}),t=e.userTilesList,n=e.fullTilesList;ec(t),er(n)},[eu,N,I,Z,f,c.accountId,ey,z]);var eZ,ek,eS,eT=(0,p.aM)(w,{variables:{accountId:c.accountId,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,adminId:c.adminId,asAt:eu,currentUserId:c.id,dayStart:ev.todayStart,monthStart:ev.monthStart,userId:ey,yearStart:ev.yearStart},onCompleted:function(e){L(function(t){return(0,r.Z)((0,s.Z)((0,r.Z)({},t,et({prevData:t,data:e.dashboardTilesData[0],type:"today"})),{jobsOnThisMonth:e.chartJobsPerDay.jobsOnThisMonth}),e.chartRevenuesPerDay[0],e.chartRevenuesPerYear[0])}),eM()}}),ej=eT.loading,eD=eT.refetch,eM=(eZ=(0,a.Z)(function(){var e,t;return(0,l.__generator)(this,function(e){switch(e.label){case 0:var n;return[4,Promise.all(z.map((n=(0,a.Z)(function(e){var t,n,a,r,s,u,d,h,m,p;return(0,l.__generator)(this,function(n){switch(n.label){case 0:if(t=e.name,"tile"!==e.type)return[2,{}];return r=(a=en({name:t,asAt:eu,adminId:c.adminId,accountId:c.accountId,userId:ey,time:"week"})).query,s=a.variables,[4,g.query({query:r,variables:s})];case 1:return h=void 0===(d=n.sent().data)?(0,o.Z)({},t,[{sum:0}]):d,p=(0,i.Z)(h[t],1)[0].sum,[2,(0,o.Z)({},t,p||0)]}})}),function(e){return n.apply(this,arguments)})))];case 1:return t=e.sent().reduce(function(e,t){return(0,r.Z)({},e,t)},{}),L(function(e){return(0,r.Z)({},e,et({prevData:e,data:t,type:"week"}))}),[2]}})}),function(){return eZ.apply(this,arguments)}),eB=function(e){var t=e.tiles,n=e.skipRefetch,a=e.skipRefetchMeta;ew({variables:{userId:c.id,accountId:c.accountId,changes:{meta:(0,s.Z)((0,r.Z)({},eI),{dashboard:t})}}}).then(function(){n||eD(),a||ef()})},eJ=function(e){eB({tiles:z.filter(function(t){return t.name!==e})})},ex=function(e,t){eB({tiles:z.map(function(n){return n.name===e?(0,s.Z)((0,r.Z)({},n),{colourConfig:t}):n}),skipRefetch:!0})},eA=(ek=(0,a.Z)(function(e,t){var n,a,u,d,h,m,p,v;return(0,l.__generator)(this,function(l){switch(l.label){case 0:return a=(n=en({name:e,asAt:eu,adminId:c.adminId,accountId:c.accountId,userId:ey,time:t})).query,u=n.variables,[4,g.query({query:a,variables:u})];case 1:return m=void 0===(h=l.sent().data)?(0,o.Z)({},e,[{sum:0}]):h,v=(0,i.Z)(m[e],1)[0].sum,L(function(n){return(0,s.Z)((0,r.Z)({},n),(0,o.Z)({},e,(0,s.Z)((0,r.Z)({},n[e]||{}),(0,o.Z)({},t,v||0))))}),[2]}})}),function(e,t){return ek.apply(this,arguments)}),e_=(eS=(0,a.Z)(function(e,t){var n,a,i,c;return(0,l.__generator)(this,function(l){switch(l.label){case 0:return a=(n=X({groupName:e,time:t,asAt:eu})).query,i=n.variables,[4,g.query({query:a,variables:i})];case 1:return c=l.sent().data,L(function(n){return(0,s.Z)((0,r.Z)({},n),(0,o.Z)({},e,ee({state:n,data:c,groupName:e,time:t})))}),[2]}})}),function(e,t){return eS.apply(this,arguments)}),eC=(0,d.useCallback)(function(){var e=[],t=[],n=[],a=[];if(ei.forEach(function(e){"tile"===e.type&&e.pinned?t.push(e):"mapChart"===e.type||"chart"===e.type?n.push(e):a.push(e)}),t.length){var o=(0,u.jsx)(em,{container:!0,spacing:3,className:"firstBlock",children:t.map(function(e,t){var n=e.title,a=e.subtitle,o=e.name,r=e.description,s=e.colourConfig,i=e.values,c=e.valueType,l=e.size,d=e.to,h=e.greaterIsBetter;return(0,u.jsx)(V.Z,{name:o,asAt:eu,className:"firstBlockItem",xs:12,sm3:6,colourConfig:s,title:n,subtitle:a,description:r,to:d,values:i,valueType:c,size:l,greaterIsBetter:h,editable:!0,onEdit:function(){return C(!0)},onVersusChange:eA,onConfigChange:ex})})});e.push(o)}if(n.length){var r=n.map(function(e){var t=e.type,n=e.title,a=e.description,o=e.name,r=e.values,s=e.size;return"chart"===t?(0,u.jsx)(Q.ZP,{item:!0,className:"bigTile",children:(0,u.jsx)(W.Z,{asAt:eu,title:n,description:a,showLegend:!0,name:o,data:r,size:s})}):"mapChart"===t?(0,u.jsx)(Q.ZP,{item:!0,className:"bigTile",children:(0,u.jsx)(Y.Z,{asAt:eu,title:n,description:a,showLegend:!0,name:o,data:r,size:s,onChangeChartGroup:e_})}):null});e.push(r)}if(n.length%2==0){var s=a.splice(0,4),i=(0,u.jsx)(em,{container:!0,spacing:3,className:"secondBlock",children:s.slice(0,4).map(function(e,t){var n=e.title,a=e.subtitle,o=e.name,r=e.description,i=e.colourConfig,c=e.values,l=e.valueType,d=e.size,h=e.to,m=e.greaterIsBetter;return(0,u.jsx)(V.Z,{name:o,asAt:eu,className:"secondBlockItem",sm:12,lg:6,xl:t===s.length-4?12:4,colourConfig:i,title:n,subtitle:a,description:r,to:h,values:c,valueType:l,size:d,greaterIsBetter:m,onVersusChange:eA,onConfigChange:ex})})});e.push(i)}var c=a.map(function(e){var t=e.name,n=e.subtitle,a=e.title,o=e.description,r=e.colourConfig,s=e.values,i=e.valueType,c=e.size,l=e.to,d=e.greaterIsBetter;return(0,u.jsx)(V.Z,{asAt:eu,xs:12,sm3:6,xl:3,className:"restTilesBoxItem",colourConfig:r,name:t,title:a,subtitle:n,description:o,to:l,values:s,valueType:i,size:c,greaterIsBetter:d,editable:!0,onEdit:function(){return C(!0)},deletable:!0,onDelete:eJ,onVersusChange:eA,onConfigChange:ex})});K.length>ei.length&&c.push((0,u.jsx)(U.Z,{width:"100%",xs:12,sm3:6,xl:3,onAddCard:function(){return C(!0)}}));var l=(0,u.jsx)(ep,{container:!0,spacing:3,m:0,sx:{justifyContent:"flex-start"},children:c});return e.push(l),(0,u.jsx)(eh,{container:!0,spacing:3,children:e})},[ei]);return(0,u.jsxs)(O.Z,{sx:{width:"100%",height:"100%"},children:[(0,u.jsx)(ed,{children:ej?(0,u.jsx)(O.Z,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(E.Z,{})}):eC()}),(0,u.jsx)(G.Z,{open:A,fullTilesList:K,selectedTiles:z,onSaveTilesList:function(e){return eB({tiles:e})},onClose:function(){return C(!1)}})]})},ed=(0,A.ZP)(O.Z).withConfig({displayName:"dashboard__DashboardBox",componentId:"sc-bf85f171-0"})(er()),eh=(0,A.ZP)(Q.ZP).withConfig({displayName:"dashboard__SecondRowBox",componentId:"sc-bf85f171-1"})(es()),em=(0,A.ZP)(Q.ZP).withConfig({displayName:"dashboard__FirstBox",componentId:"sc-bf85f171-2"})(ei()),ep=(0,A.ZP)(Q.ZP).withConfig({displayName:"dashboard__RestTilesBox",componentId:"sc-bf85f171-3"})(ec());eu.propTypes={user:h.object.isRequired};var ev=(0,A.Zz)(eu)}}]);