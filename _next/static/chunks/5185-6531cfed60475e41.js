"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5185],{9489:function(n,e,t){t.d(e,{I:function(){return m}});var o=t(26042),i=t(69396),r=t(99534),a=t(85893),u=t(5616),c=t(51233),s=t(50135),d=t(90948),l=t(15861),m=function(n){var e=n.leftLabel,t=n.rightLabel,u=n.error,s=(0,r.Z)(n,["leftLabel","rightLabel","error"]);return(0,a.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(p,{sx:{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},children:e})}),(0,a.jsx)(v,(0,i.Z)((0,o.Z)({},s),{variant:"outlined",size:"small",error:u})),(0,a.jsx)(p,{sx:{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},variant:"body2",fontWeight:700,children:t})})]})},p=(0,d.ZP)(u.Z)(function(n){var e=n.theme;return{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:n.error?e.palette.danger.main:"#D9D9D9",minwidth:"28px",height:"28px",padding:"0 5px"}}),v=(0,d.ZP)(s.Z)(function(n){var e=n.theme,t=n.error;return{height:"28px","& .MuiInputBase-root ":{borderRadius:"0px","&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:t?e.palette.danger.main:"#D9D9D9"}},"& .MuiInputBase-input":{padding:"2px 14px",borderColor:t?e.palette.danger.main:"#D9D9D9",borderStyle:"solid",borderBottomWidth:"2.5px",borderTopWidth:"2px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}}})},9873:function(n,e,t){t.d(e,{K:function(){return o}});var o=function(n){return 1}},82058:function(n,e,t){t.d(e,{N:function(){return o}});var o=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:e.onEditClick,to:"".concat(n,"manage"),tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:e.onDeleteClick,tooltip:"Delete"}]}},6538:function(n,e,t){t.d(e,{e:function(){return r}});var o=t(29815),i=t(22244),r=function(n,e){var t=(0,o.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return i.yW.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return i.yW.find(function(n){return n.value===t&&t!==e})})}},35381:function(n,e,t){t.d(e,{il:function(){return r},j$:function(){return o},wo:function(){return i}});var o=function(n,e){if(Array.isArray(e)){var t,o,i=null;return e.forEach(function(e){var t,o,r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});i=(null==r?void 0:null===(o=r.user)||void 0===o?void 0:o.fullName)||i}),i}var r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==r?void 0:null===(o=r.user)||void 0===o?void 0:o.fullName)||null},i=function(n,e){if(Array.isArray(e)){var t,o=null;return e.forEach(function(e){var t,i=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});o=(null==i?void 0:i.id)||o}),o}var i=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==i?void 0:i.id)||null},r=function(n,e){return!n||n>e}},22081:function(n,e,t){t.d(e,{Io:function(){return d},Lq:function(){return c},yG:function(){return s}});var o=t(26042),i=t(29815),r=t(74297),a=t(26186),u=t(79033),c=function(n,e){var t=n.itemType,o=n.paymentStatus;return"paymentReceipt"===t?e.COLOUR.black:"creditNote"===t?e.COLOUR.dark:"paid"===o?e.COLOUR.success:"partial"===o?e.COLOUR.female:e.COLOUR.danger},s=function(n,e){var t=e||{},o=t.numberPrefix,i=void 0===o?"":o,c=t.numberSuffix,s=void 0===c?"":c;return n.map(function(n){var e,t,o,c,d,l,m,p,v,f,g,h,b,y,I,x,Z=(null==n?void 0:null===(e=n.reconciliations)||void 0===e?void 0:null===(t=e.aggregate)||void 0===t?void 0:null===(o=t.sum)||void 0===o?void 0:o.amount)||null,j=null===(c=n.invoices)||void 0===c?void 0:c[0],_=null;return["invoice","proformaInvoice"].includes(n.type)?_="".concat((0,u.y)(null==j?void 0:null===(I=j.Job)||void 0===I?void 0:I.type)," ").concat(i," ").concat(null==j?void 0:null===(x=j.Job)||void 0===x?void 0:x.number," ").concat(s," / ").concat(null==j?void 0:j.invoiceNumber):"ppmInvoice"===n.type&&(_="PM / ".concat((null==j?void 0:j.invoiceNumber)||"")),{itemType:(0,r.Z)(n.type),invoice:_,reference:(null===(d=n.meta)||void 0===d?void 0:d.paymentReference)||(null==j?void 0:null===(l=j.Job)||void 0===l?void 0:l.reference),date:(0,a.Z)(n.createdAt),daysOutstanding:null==n?void 0:n.outstandingdays,status:null==j?void 0:null===(m=j.Job)||void 0===m?void 0:m.status,service:null==j?void 0:null===(p=j.Job)||void 0===p?void 0:null===(v=p.service)||void 0===v?void 0:v.name,address:null==j?void 0:null===(f=j.Job)||void 0===f?void 0:null===(g=f.location)||void 0===g?void 0:g.name,sublocation:null==j?void 0:null===(h=j.Job)||void 0===h?void 0:null===(b=h.sublocation)||void 0===b?void 0:b.name,debit:n.debit,credit:n.credit,balance:n.balance,reconciledAmount:null!=Z?Z:0,amountOutstanding:n.outstandingAmount,paymentStatus:n.paymentStatus,comment:null===(y=n.meta)||void 0===y?void 0:y.comment}})},d=function(n){var e=n.accountId,t=n.from,r=void 0===t?null:t,a=n.jobNumber,u=n.locationId,c=n.outstandingLevel,s=n.to,d=void 0===s?null:s,l=n.type,m=n.invoicesForJobOnly,p={},v={},f=[],g=[],h=[];return u&&(f=[{_or:[{locationId:{_eq:u}},{PaymentReconciliations:{locationId:{_eq:u}}}]}]),l&&(p.type={_in:(0,i.Z)(l).concat(["ppmInvoice","invoice"])},p.paymentStatus={_in:(0,i.Z)(l)}),e&&(p.accountId={_eq:e}),c&&(p.outstandingdays={_gte:c.split("-")[0]||null,_lte:c.split("-")[1]||null}),(d||r)&&(h=[{_and:[{_or:[{_and:[{createdAt:{_gte:r}},{createdAt:{_lte:d}}]}]}]}]),a&&(g=void 0!==m&&m?[{Invoices:{Job:{number:{_ilike:a}}}}]:[{_or:[{Invoices:{invoiceNumber:{_eq:a}}},{Invoices:{Job:{number:{_ilike:a}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{invoiceNumber:{_eq:a}}}}},{PaymentReconciliations:{InvoiceEntry:{Invoices:{Job:{number:{_ilike:a}}}}}}]}]),(f.length>0||g.length>0||h.length>0)&&(v={_and:(0,i.Z)(f).concat((0,i.Z)(g),(0,i.Z)(h))}),(0,o.Z)({},p,v)}},67212:function(n,e,t){t.d(e,{q:function(){return G}});var o=t(47568),i=t(26042),r=t(69396),a=t(828),u=t(7297),c=t(29815),s=t(97582),d=t(85893),l=t(67294),m=t(45697),p=t(6388),v=t(50319),f=t(26695),g=t(42283),h=t(79665),b=t(10367),y=t(46901),I=t(98456),x=t(77651),Z=t(73987),j=t(16551),_=t(55563),q=t(77439),w=t(40826),A=t(11082),$=t(26186),S=t(9270),T=t(76600),R=t(62140),C=t(49501),P=t(28497),D=t(6710),E=t(62047),N=t(11587),k=t(45416),Q=t(21300),J=t(9873),O=t(14149),U=t(74231),L=(0,U.Ry)().shape({dateReceived:(0,U.hT)().required(),paymentReference:(0,U.Z_)().required(),amountReceived:(0,U.Rx)().required(),comment:(0,U.Z_)(),connectedAmount:(0,U.IX)().of((0,U.Ry)().shape({id:(0,U.Rx)().required(),outstandingAmount:(0,U.Rx)().required(),amount:(0,U.Rx)().max((0,U.iH)("outstandingAmount")).min(0).required(),meta:(0,U.Ry)()})).required()}),M=t(22081),F=t(20705),z=t(91272);function B(){var n=(0,u.Z)(["\n  padding-left: 1rem;\n  padding-right: ",";\n  flex-flow: ",";\n"]);return B=function(){return n},n}function V(){var n=(0,u.Z)(["\n  border: 1px solid ",";\n"]);return V=function(){return n},n}var G=function(n){var e,t=n.type,u=n.accountId,m=n.locationId,b=n.adminId,U=n.jobNumber,B=(n.refetch,n.toggleShow),V=n.numberPrefix,G=n.numberSuffix,K=n.invoicesForJobOnly,Y=n.xeroUserId,X=n.xeroCompanyId,nn=n.onSendPaymentToXero,ne=(0,l.useContext)(Z.Z).user,nt=(0,F.x)({filters:null}),no=nt.initialData,ni=nt.ref,nr=(0,l.useState)(!1),na=nr[0],nu=nr[1],nc=(0,l.useState)(0),ns=nc[0],nd=nc[1],nl=(0,l.useState)({error:!1,message:null}),nm=nl[0],np=nl[1],nv=(0,l.useState)(!1),nf=nv[0],ng=nv[1],nh=(0,g.cI)({resolver:(0,h.S)(L)}),nb=nh.control,ny=nh.errors,nI=nh.getValues,nx=nh.handleSubmit,nZ=nh.register,nj=nh.setValue,n_=(0,g.Dq)({control:nb,name:"connectedAmount"}).fields,nq=(0,g.qo)({control:nb,name:"amountReceived",defaultValue:0}),nw=(0,p.aM)(f.v8,{variables:(0,r.Z)((0,i.Z)({},no),{where:(0,r.Z)((0,i.Z)({},(0,M.Io)({accountId:u,locationId:m,adminId:b,jobNumber:U?"".concat(U):null,invoiceNumber:U?Number(U):null,type:["proformaInvoice","partial","unpaid"],invoicesForJobOnly:K})),{debit:{_gt:0},outstandingAmount:{_gt:0}}),locationId:m})}),nA=nw.data,n$=void 0===nA?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:nA,nS=n$.accountEntries,nT=n$.meta,nR=nw.loading,nC=nw.refetch,nP=(0,a.Z)((0,v.D)(f.Vr,{}),2),nD=nP[0],nE=nP[1].error,nN=(0,a.Z)((0,v.D)(f._0,{refetchQueries:["GetAccountEntries"]}),1)[0],nk=(e=(0,o.Z)(function(n){var e,i,r,a;return(0,s.__generator)(this,function(d){switch(d.label){case 0:if(d.trys.push([0,,6,7]),ng(!0),Number(ns).toFixed(2)>Number(n.amountReceived).toFixed(2))return[2,np({error:!0,message:"You can not reconcile more than payment amount"})];if(Number(ns).toFixed(2)<Number(n.amountReceived).toFixed(2))return[2,np({error:!0,message:"You can not reconcile less than payment amount"})];if(e=n.connectedAmount.filter(function(n){return n.amount>0}),i={accountId:u,balance:0,credit:parseFloat(n.amountReceived).toFixed(2),currencyId:(0,J.K)(u),debit:0,meta:{paymentReference:n.paymentReference,comment:n.paymentReference},type:"paymentReceipt",paymentStatus:"paymentReceipt",dateReceived:(0,O.v)(n.dateReceived),PaymentReconciliations:{data:e.map(function(n){var e,t=n.amount;return{creditEntity:"PaymentReceipt",debitEntity:"Invoice",debitEntityId:n.id,locationId:n.locationId,amount:t}})}},r=e.reduce(function(n,e){if(e.amount!==e.outstandingAmount)return n;var t=nS.find(function(n){return n.id===e.id}).invoices.map(function(n){return n.Job.id});return(0,c.Z)(n).concat((0,c.Z)(t))},[]),!((a=e.reduce(function(e,t){return t.xeroInvoiceId?(0,c.Z)(e).concat([{invoiceId:Number(t.invoiceId),invoiceNumber:t.invoiceNumber,xeroInvoiceId:t.xeroInvoiceId,credit:t.amount,dateReceived:(0,O.v)(n.dateReceived)}]):e},[])).length&&X&&Y))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,nn({adminId:b,xeroCompanyId:X,xeroAccountId:Y,payments:a})];case 2:case 3:return d.sent(),[3,4];case 4:return[4,nD({variables:{object:i,jobIds:r,changes:{status:"".concat(t,"Paid"),paid:!0},timing:r.map(function(n){return{status:"".concat(t,"Paid"),jobId:n,userId:ne.id}})}}).then((0,o.Z)(function(){var n,t,o,i,r,a,u;return(0,s.__generator)(this,function(c){switch(c.label){case 0:n=!0,t=!1,o=void 0,c.label=1;case 1:c.trys.push([1,6,7,8]),i=e[Symbol.iterator](),c.label=2;case 2:if(n=(r=i.next()).done)return[3,5];return[4,nN({variables:{id:(a=r.value).id,changes:{outstandingAmount:a.outstandingAmount-a.amount,balance:a.outstandingAmount-a.amount}}})];case 3:c.sent(),c.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return u=c.sent(),t=!0,o=u,[3,8];case 7:try{n||null==i.return||i.return()}finally{if(t)throw o}return[7];case 8:return[2]}})}))];case 5:return d.sent(),B(),[3,7];case 6:return ng(!1),[7];case 7:return[2]}})}),function(n){return e.apply(this,arguments)}),nQ={control:nb,errors:ny,register:nZ},nJ=function(){var n,e=nI();nd((null==e?void 0:null===(n=e.connectedAmount)||void 0===n?void 0:n.reduce(function(n,e){return n+Number(e.amount)},0))||0),np({error:!1,message:""})},nO=function(n,e){nj(n,e),nJ()},nU=function(n){var e=n.id,t=n.invoiceId,o=n.amount,a=n.index,u=n.locationId,c=n.outstandingAmount,s=n.invoices,l=n.meta,m=n.invoiceNumber,p=Number(c).toFixed(2)===Number(o).toFixed(2)?"success":"info";return c||(p="danger"),(0,d.jsxs)(j.Z,{children:[(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].id"),value:e,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].invoiceId"),value:t,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].invoices"),value:s,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].locationId"),value:u,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].xeroInvoiceId"),value:l.xeroInvoiceId,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].invoiceNumber"),value:m,type:"hidden"})),(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"connectedAmount[".concat(a,"].outstandingAmount"),value:c,type:"hidden"})),(0,d.jsx)(H,(0,r.Z)((0,i.Z)({},nQ),{context:na?p:null,name:"connectedAmount[".concat(a,"].amount"),onChange:nJ,size:"sm",type:"number",step:"0.01",defaultValue:0})),(0,d.jsx)(q.Z,{context:"light","data-tip":"Button",onClick:function(){nO("connectedAmount[".concat(a,"].amount"),c)},size:"xs",title:"copy amount",children:(0,d.jsx)(w.Z,{context:"secondary",icon:"clone",size:"lg"})})]})},nL=(0,l.useMemo)(function(){return[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Number",formatter:function(n){var e=n.row;return"ppmInvoice"===e.type?"PM ".concat(e.invoiceNumber):(0,d.jsx)(k.D,{id:e.jobId,number:e.jobNumber,invoiceNumber:e.invoiceNumber,numberPrefix:V,numberSuffix:G,openCanvas:!0,type:e.jobType})}},{sortable:!0,sortName:"createdAt",text:"Date"},{sortable:!0,sortName:"daysOutstanding",text:"Days Outstanding"},{sortable:!0,sortName:"outstandingAmount",text:"Amount Outstanding",formatter:function(n){var e=n.row;return(0,A.Z)(e.outstandingAmount)}},{text:"Reconciled Amount",formatter:function(n){return nU(n.row)}},{hidden:!0},{hidden:!0}]},[]),nM=function(n){nu(!na)};return((0,l.useEffect)(function(){nj("connectedAmount",nS.map(function(n,e){var t,o,i,r,a=null===(t=n.invoices)||void 0===t?void 0:t[0];return{index:e,id:n.id,type:n.type,jobId:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.id,locationId:n.locationId,jobNumber:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.number,jobType:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.type,invoiceNumber:null==a?void 0:a.invoiceNumber,date:(0,$.Z)(n.createdAt),daysOutstanding:n.outstandingdays,outstandingAmount:n.outstandingAmount,amount:0,invoiceId:null==a?void 0:a.id,meta:n.meta}}))},[nS]),(0,l.useEffect)(function(){if(na){var n=Number(nq);n_.forEach(function(e,t){var o=n>=e.outstandingAmount?Number(e.outstandingAmount).toFixed(2):Number(n).toFixed(2);n-=o,nj("connectedAmount[".concat(e.index,"].amount"),o)}),nJ()}},[nq,na,n_]),(0,l.useEffect)(function(){nE?np({error:!0,message:null==nE?void 0:nE.message}):np(!1)},[nE]),nf)?(0,d.jsx)(S.Z,{style:{justifyContent:"center",alignItems:"center"},children:(0,d.jsx)(I.Z,{size:30})}):(0,d.jsxs)(T.Z,{id:"offCanvasForm",handleSubmit:nx(nk),children:[(0,d.jsx)(x.Z,{open:null==nm?void 0:nm.error,autoHideDuration:6e3,onClose:function(){np({error:!1,message:null})},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,d.jsx)(y.Z,{onClose:function(){return np({error:!1,message:null})},severity:"error",variant:"filled",sx:{width:"500px"},children:(null==nm?void 0:nm.message)||"Oops some error occurred. Please try again later"})}),(0,d.jsxs)(S.Z,{children:[(0,d.jsxs)(R.Z,{md:6,children:[(0,d.jsx)(C.Z,{label:"Date Received"}),(0,d.jsx)(Q.M,(0,r.Z)((0,i.Z)({},nQ),{name:"dateReceived"}))]}),(0,d.jsx)(R.Z,{md:6,children:(0,d.jsx)(C.Z,{label:"Payment Reference",children:(0,d.jsx)(_.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"paymentReference"}))})})]}),(0,d.jsxs)(S.Z,{children:[(0,d.jsx)(R.Z,{md:6,children:(0,d.jsx)(W,{align:"center",children:(0,d.jsx)(P.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"amountReceived",label:"Amount Received",vat:!0}))})}),(0,d.jsx)(R.Z,{md:6,children:(0,d.jsx)(C.Z,{label:"Comment",children:(0,d.jsx)(D.Z,(0,r.Z)((0,i.Z)({},nQ),{name:"comment",rows:2}))})})]}),(0,d.jsx)(C.Z,{label:"Auto reconcile",children:(0,d.jsx)(E.Z,(0,r.Z)((0,i.Z)({},nQ),{onToggle:function(n){return nM(n)},size:"sm",toggled:na}))}),(0,d.jsx)(z.t,{columns:nL,loading:nR,history:!1,meta:nT,ref:ni,refetch:nC,rows:n_}),(0,d.jsx)(W,{reverse:!0,pr:!0,children:(0,d.jsx)(N.Z,{content:"Sum: ".concat((0,A.Z)(ns)),context:Number(ns).toFixed(2)===Number(nq).toFixed(2)?"success":"danger"})})]})},W=(0,b.ZP)(S.Z).withConfig({displayName:"paymentReceivedForm__StyledRow",componentId:"sc-772f8482-0"})(B(),function(n){return n.pr?"5rem":null},function(n){return n.reverse?"row-reverse":null}),H=(0,b.ZP)(_.Z).withConfig({displayName:"paymentReceivedForm__StyledInput",componentId:"sc-772f8482-1"})(V(),function(n){return n.theme.COLOUR[n.context]});G.propTypes={type:(0,m.oneOf)(["customer","supplier"]).isRequired,accountId:m.number.isRequired,locationId:m.number,jobNumber:m.string,numberPrefix:m.string,numberSuffix:m.string,adminId:m.number.isRequired,refetch:m.func.isRequired,toggleShow:m.func.isRequired,invoicesForJobOnly:m.bool.isRequired}},26695:function(n,e,t){t.d(e,{BH:function(){return q},Dn:function(){return I},UA:function(){return _},Vr:function(){return x},_0:function(){return Z},to:function(){return A},v8:function(){return j},yz:function(){return $},zn:function(){return w}});var o=t(7297),i=t(75063);function r(){var n=(0,o.Z)(["\n  query GetFinance($accountId: Int!) {\n    financial: Account_by_pk(id: $accountId) {\n      name\n      website\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        bank\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,o.Z)(["\n  mutation AddPaymentReceipt(\n    $object: AccountEntry_insert_input!\n    $jobIds: [Int]!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n    update_Job(where: { id: { _in: $jobIds } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(["\n  mutation UpdateAccountEntry($id: Int!, $changes: AccountEntry_set_input!) {\n    update_AccountEntry_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      meta\n      outstandingAmount\n      balance\n    }\n  }\n"]);return u=function(){return n},n}function c(){var n=(0,o.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return c=function(){return n},n}function s(){var n=(0,o.Z)(["\n  query GetAccountEntries($where: AccountEntry_bool_exp, $accountId: Int, $locationId: Int) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      where: $where\n      args: { location_id: $locationId }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          sublocation: Sublocation {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n      reconciliations: InvoiceReconciliations_aggregate {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,o.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n        }\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,o.Z)(["\n  query GetAccoutEntrySumByAccounntInJob($jobId: Int!, $accountId: Int!) {\n    accountEntryAggregate: AccountEntry_aggregate(\n      where: { Invoices: { Job: { id: { _eq: $jobId } } }, accountId: { _eq: $accountId } }\n    ) {\n      aggregate {\n        sum {\n          outstandingAmount\n        }\n      }\n    }\n  }\n"]);return l=function(){return n},n}function m(){var n=(0,o.Z)(["\n  query GetJobMeta($id: Int!) {\n    job: Job(where: { id: { _eq: $id } }) {\n      id\n      meta\n    }\n  }\n"]);return m=function(){return n},n}function p(){var n=(0,o.Z)(["\n  mutation UpdateJob($changes: Job_set_input, $ids: [Int]) {\n    update_Job(where: { id: { _in: $ids } }, _set: $changes) {\n      affected_rows\n    }\n  }\n"]);return p=function(){return n},n}function v(){var n=(0,o.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $insertTiming: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $timing) @include(if: $insertTiming) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return v=function(){return n},n}function f(){var n=(0,o.Z)(['\n  mutation DeletePayment($jobIds: [Int!], $timingStatuses: [String!], $paymentId: Int!) {\n    delete_JobTiming(where: { status: { _in: $timingStatuses }, jobId: { _in: $jobIds } }) {\n      returning {\n        id\n      }\n    }\n\n    delete_AccountEntry(\n      where: { type: { _in: ["paymentReceipt", "creditNote"] }, id: { _eq: $paymentId } }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n']);return f=function(){return n},n}function g(){var n=(0,o.Z)(['\n  query GetRelatedAccountEntries($accountEntryId: Int!) {\n    reconciliations: Reconciliation(\n      where: {\n        creditEntityId: { _eq: $accountEntryId }\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n      }\n    ) {\n      id\n      amount\n      createdAt\n      accountEntryPayment: PaymentEntry {\n        id\n      }\n      accountEntryInvoice: InvoiceEntry {\n        id\n        type\n        invoices: Invoices {\n          id\n          invoiceType\n          invoiceNumber\n          job: Job {\n            id\n            number\n            type\n            status\n            timings: JobTimings(order_by: { createdAt: desc }) {\n              id\n              status\n              createdAt\n            }\n          }\n        }\n      }\n    }\n  }\n']);return g=function(){return n},n}function h(){var n=(0,o.Z)(["\n  query GetRelatedInvoces($accountEntryId: Int!) {\n    invoices: Invoice(where: { accountEntryId: { _eq: $accountEntryId } }) {\n      id\n      invoiceNumber\n      Job {\n        id\n        number\n        type\n        status\n      }\n    }\n  }\n"]);return h=function(){return n},n}function b(){var n=(0,o.Z)(['\n  query GetCalendarJobs($customerId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        customerId: { _eq: $customerId }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return b=function(){return n},n}function y(){var n=(0,o.Z)(["\n  mutation AddCreditNote($object: AccountEntry_insert_input!) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n  }\n"]);return y=function(){return n},n}var I=(0,i.Ps)(r()),x=(0,i.Ps)(a()),Z=(0,i.Ps)(u()),j=(0,i.Ps)(c()),_=(0,i.Ps)(s()),q=(0,i.Ps)(d());(0,i.Ps)(l()),(0,i.Ps)(m()),(0,i.Ps)(p()),(0,i.Ps)(v());var w=(0,i.Ps)(f()),A=(0,i.Ps)(g()),$=(0,i.Ps)(h());(0,i.Ps)(b()),(0,i.Ps)(y())},25771:function(n,e,t){t.d(e,{By:function(){return m},Rm:function(){return d},WG:function(){return l},bK:function(){return p}});var o=t(7297),i=t(75063);function r(){var n=(0,o.Z)(['\n  query getInvoices($jobId: Int!) {\n    invoices: Invoice(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return r=function(){return n},n}function a(){var n=(0,o.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return a=function(){return n},n}function u(){var n=(0,o.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return u=function(){return n},n}function c(){var n=(0,o.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: {\n        entityId: { _eq: $jobId }\n        entity: { _eq: "Job" }\n        invoiceType: { _eq: $invoiceType }\n      }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return c=function(){return n},n}function s(){var n=(0,o.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      data\n      success\n    }\n  }\n"]);return s=function(){return n},n}var d=(0,i.Ps)(r());(0,i.Ps)(a());var l=(0,i.Ps)(u()),m=(0,i.Ps)(c()),p=(0,i.Ps)(s())},95465:function(n,e,t){t.d(e,{m:function(){return ng}});var o=t(26042),i=t(85893),r=t(6388),a=t(13640),u=t(47568),c=t(69396),s=t(828),d=t(97582),l=t(67294),m=t(30381),p=t.n(m),v=t(50319),f=t(5481),g=t(42283),h=t(79665),b=t(78289),y=t(77439),I=t(76600),x=t(9270),Z=t(62140),j=t(11587),_=t(55377),q=t(49501),w=t(55563),A=t(95103),$=t(6710),S=t(16551),T=t(21300),R=t(35418),C=t(14924),P=t(52019),D=t(11082),E=t(7297),N=t(45697),k=t(10367),Q=t(68956),J=t(33006),O=t(8500),U=t(82058),L=t(74231),M=t(28497),F=t(51466),z=t(94054),B=t(56815),V=t(15861),G=function(n){var e,t,r=n.editMode,m=n.onSuccess,p=n.rawData,f=n.quotationId,b=(n.setQuote,n.supplierId),j=n.type,S=n.toggleShow,T=(0,l.useContext)(P.Z).hasRole,R=(0,g.cI)({defaultValues:{description:r?p.description:"",qty:r?p.qty:"",qtyUnit:r?p.qtyUnit:"hours",unitRate:r?p.unitRate:"",item:r?p.item:"",total:r?p.total:""},resolver:(0,h.S)(W),context:{isAdmin:T("admin")}}),C=R.control,E=R.errors,N=R.handleSubmit,k=R.register,Q=R.watch,J={control:C,errors:E,register:k},O=Q("qty"),U=Q("unitRate"),L=Q("total"),G=Q("description"),H=(0,s.Z)((0,v.D)(a.Ih,{onCompleted:function(n){var e=n.insert_SupplierQuoteLineItem.returning[0].id;m&&m(e)}}),2),K=H[0],Y=H[1].loading,X=(0,s.Z)((0,v.D)(a.EA,{onCompleted:function(n){var e=n.update_SupplierQuoteLineItem_by_pk.id;m&&m(e)}}),2),nn=X[0],ne=X[1].loadingUpdate,nt=(t=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:if(!r)return[3,2];return n.supplierTotal=n.qty*n.unitRate,[4,nn({variables:{id:null==p?void 0:p.id,changes:n}})];case 1:return e.sent(),[3,4];case 2:return n.accountId=Number(b),n.type=j,n.quoteId=Number(f),n.supplierTotal=n.qty*n.unitRate,[4,K({variables:{objects:[n]}})];case 3:e.sent(),e.label=4;case 4:return[2]}})}),function(n){return t.apply(this,arguments)});return(0,i.jsxs)(I.Z,{handleSubmit:N(nt),children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(Z.Z,{md:12,children:(0,i.jsx)(z.Z,{fullWidth:!0,error:!!(null==E?void 0:E.description),children:(0,i.jsxs)(q.Z,{label:"Description",children:[(0,i.jsx)($.Z,(0,c.Z)((0,o.Z)({},J),{name:"description",rows:2})),(null==E?void 0:E.description)&&(0,i.jsx)(B.Z,{sx:{m:0},children:null==E?void 0:null===(e=E.description)||void 0===e?void 0:e.message}),(0,i.jsxs)(V.Z,{children:[G.length,"/500"]})]})})})}),(0,i.jsxs)(x.Z,{children:[(0,i.jsx)(Z.Z,{md:4,children:(0,i.jsx)(q.Z,{label:"Quantity",children:(0,i.jsx)(w.Z,(0,c.Z)((0,o.Z)({},J),{name:"qty",type:"number",step:"0.01"}))})}),"Labour"===j&&(0,i.jsx)(Z.Z,{md:4,children:(0,i.jsx)(q.Z,{label:"Quantity Unit",children:(0,i.jsx)(A.Z,(0,c.Z)((0,o.Z)({},J),{name:"qtyUnit",options:[{text:"Hours",value:"hours",disabled:!1},{text:"Days",value:"days",disabled:!1},{text:"Weeks",value:"weeks",disabled:!1}]}))})}),(0,i.jsx)(Z.Z,{md:4,children:(0,i.jsx)(M.Z,(0,c.Z)((0,o.Z)({},J),{label:T("supplier")?"Unit Rate":"Supplier Unit Rate",name:"unitRate",vat:"Ex VAT"}))})]}),(0,i.jsxs)(F.Z,{children:["Supplier Total: ",(0,D.Z)(O*U)]}),(0,i.jsx)(_.Z,{}),T("admin")&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(Z.Z,{md:12,children:(0,i.jsx)(M.Z,(0,c.Z)((0,o.Z)({},J),{label:"Customer Unit Rate",name:"total",vat:"Ex VAT"}))})}),(0,i.jsxs)(F.Z,{children:["Customer Total (Labour Item): ",(0,D.Z)(O*L)]}),(0,i.jsx)(_.Z,{})]}),(0,i.jsxs)(x.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,i.jsx)(y.Z,{content:"Cancel",onClick:S,style:{margin:"0 5px"}}),(0,i.jsx)(y.Z,{content:r?"Save":"Add",disabled:Y||ne,type:"submit"})]}),(0,i.jsx)("div",{style:{clear:"both"}})]})};G.propTypes={editMode:N.bool,onSuccess:N.func,rawData:N.object,quotationId:N.number,supplierId:N.number,type:N.string,toggleShow:N.func},G.defaultProps={rawData:{}};var W=L.Ry({qty:L.Rx().required("Quantity is a required field"),unitRate:L.Rx().required("Unit rate is a required field"),total:L.Rx().when("isAdmin",{is:function(n){return!0===n},then:function(){return(0,N.number)().required("Customer Unit Rate is a required field")}}),description:L.Z_().max(500,"Description must have a maximum of 500 characters.").test("maxLines","Textarea should not exceed 10 lines",function(n){return!n||n.split("\n").length<=10})}),H=t(84808),K=t(98456);function Y(){var n=(0,E.Z)(["\n  margin: 0 5px;\n"]);return Y=function(){return n},n}function X(){var n=(0,E.Z)(["\n  margin: 0;\n"]);return X=function(){return n},n}var nn=function(n){var e=n.quotation,t=n.quotationId,o=n.type,u=n.updateTotal,c=n.readOnly,d=(0,l.useContext)(P.Z).hasRole,m=(0,l.useContext)(b.Z),p=(0,r.aM)(a.cu,{variables:{quotationId:t,type:o}}),f=p.data,g=(void 0===f?{lineItems:[]}:f).lineItems,h=p.loading,I=p.refetch,x=(0,s.Z)((0,v.D)(a.nc,{onCompleted:function(n){I()}}),1)[0];(0,l.useEffect)(function(){u(g)},[g]);var Z=function(){I(),m.close()},j=function(n,r){var a;m.show({content:(0,i.jsx)(G,{editMode:!!(null==r?void 0:r.rawData),onSuccess:Z,rawData:null==r?void 0:r.rawData,toggleShow:m.close,quotationId:t,supplierId:null===(a=e.supplier)||void 0===a?void 0:a.id,type:o}),submit:!1,title:"".concat(r?"Edit":"Insert"," ").concat(o," Item")})},_=function(n,e){x({variables:{id:e.id}})},q=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!d(["admin","supplier"]),text:"Qty"},{hidden:!d(["admin","supplier"]),text:"Rate"},{hidden:!d(["admin","supplier"]),text:"Supplier Total"},{hidden:!d(["admin","customer"]),text:"Customer Total"},{hidden:!d(["admin","supplier"])||c,formatter:Q.Z,formatterData:(0,U.N)("/dashboard/quotes/",{onEditClick:j,onDeleteClick:_}),text:"Actions"},{text:"Raw Data",hidden:!0}],w=g.reduce(function(n,e){return n+e.total*e.qty},0),A=g.reduce(function(n,e){return n+e.supplierTotal},0);return h?(0,i.jsx)(H.Z,{sx:{zIndex:1e5},open:!0,children:(0,i.jsx)(K.Z,{color:"secondary"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(J.Z,{content:(0,i.jsxs)(ne,{align:"center",justify:"between",children:[(0,i.jsx)("span",{children:o}),d(["admin","supplier"])&&!c&&(0,i.jsx)(y.Z,{content:"Insert ".concat(o," Item"),context:"secondary",onClick:j,size:"sm"})]}),tag:"h4"}),(0,i.jsx)(O.Z,{columns:q,rows:g.map(function(n){return{id:n.id,description:n.description,qty:"Labour"===n.type?"".concat(n.qty," ").concat(n.qtyUnit):n.qty,rate:(0,D.Z)(n.unitRate),supplierTotal:(0,D.Z)(n.supplierTotal),total:(0,D.Z)(n.total*n.qty),action:"",rawData:n}})}),(0,i.jsxs)("div",{style:{textAlign:"right"},children:[d(["admin","supplier"])&&(0,i.jsxs)(nt,{children:["Subtotal - ",o," ",d(["admin"])&&"- Supplier",": ",(0,D.Z)(A)]}),d(["admin","customer"])&&(0,i.jsxs)(nt,{children:["Subtotal - ",o,": ",(0,D.Z)(w)]})]})]})},ne=(0,k.ZP)(x.Z).attrs(function(){return{align:"center",justify:"between"}}).withConfig({displayName:"lineItemTable__StyledRow",componentId:"sc-93db134c-0"})(Y()),nt=k.ZP.p.withConfig({displayName:"lineItemTable__StyledP",componentId:"sc-93db134c-1"})(X());nn.propTypes={quotationId:N.number.isRequired,quotation:N.object.isRequired,type:N.string,updateTotal:N.func.isRequired};var no=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return n.reduce(function(n,t){return"total"===e?n+=t[e]*t.qty:n+=t[e]},0)},ni=function(n){var e=n.quotation,t=n.total,r=n.setTotal,a=(n.supplierTotal,n.setSupplierTotal),u=(n.customerTotal,n.setCustomerTotal),s=n.readOnly,d=(0,l.useContext)(P.Z).hasRole,m=function(n,e){return r(function(t){return(0,c.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"total")))})},p=function(n,e){return a(function(t){return(0,c.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"supplierTotal")))})},v=function(n,e){return u(function(t){return(0,c.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"total")))})},f=t.labour+t.materials,g=.2*f;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(Z.Z,{md:12,children:(0,i.jsx)(nn,{quotationId:e.id,quotation:e,type:"Labour",updateTotal:function(n){m("labour",n),p("labour",n),v("labour",n)},readOnly:s})})}),(0,i.jsx)(_.Z,{}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(Z.Z,{md:12,children:(0,i.jsx)(nn,{quotationId:e.id,quotation:e,type:"Materials",updateTotal:function(n){m("materials",n),p("materials",n),v("materials",n)},readOnly:s})})}),(0,i.jsx)(_.Z,{}),d(["admin","customer"])&&(0,i.jsx)(x.Z,{children:(0,i.jsxs)(Z.Z,{md:12,style:{textAlign:"right"},children:[(0,i.jsxs)("div",{children:["Sub Total: ",(0,D.Z)(f)]}),(0,i.jsxs)("div",{children:["VAT (20%): ",(0,D.Z)(g)]}),(0,i.jsxs)("div",{children:["Total: ",(0,D.Z)(f+g)]})]})})]})},nr=(0,L.Ry)().shape({totalDuration:(0,L.Z_)().required(),totalDurationUnit:(0,L.Z_)().required(),methodStatement:(0,L.Z_)().required(),startDate:(0,L.hT)().required(),rebate:(0,L.Z_)(),notes:(0,L.Z_)()}),na=t(42251),nu=t(63139),nc=t(14564),ns=t(51233),nd=t(79369),nl=t(35381),nm=function(n){var e,t,r,a,m,C,P,D,E,N=n.quotation,k=n.status,Q=n.user,J=n.hasRole,O=n.onSuccess,U=(0,l.useContext)(b.Z),L=null==Q?void 0:Q.quoteThreshold,M=(0,l.useState)({labour:0,materials:0}),F=M[0],z=M[1],B=(0,l.useState)({labour:0,materials:0}),V=B[0],G=B[1],W=(0,l.useState)({labour:0,materials:0}),H=W[0],K=W[1],Y=(0,l.useState)(null),X=Y[0],nn=Y[1],ne=(0,nu.s)(),nt=function(n){nn(n.currentTarget)},no=function(){nn(null)},nm=V.labour+V.materials,np=null==N?void 0:null===(e=N.job)||void 0===e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(n){return n.quoteId===N.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproval")}),nv=null==N?void 0:null===(r=N.job)||void 0===r?void 0:null===(a=r.timings)||void 0===a?void 0:a.find(function(n){return n.quoteId===N.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproved")}),nf=np&&nv&&(null==np?void 0:null===(m=np.meta)||void 0===m?void 0:m.to)===(null==nv?void 0:nv.userId),ng=(0,s.Z)((0,v.D)(f.HI),1)[0],nh=(0,g.cI)({defaultValues:{totalDuration:(null==N?void 0:N.totalDuration)||"",totalDurationUnit:(null==N?void 0:N.totalDurationUnit)||"hour",startDate:(null==N?void 0:N.startDate)?new Date(N.startDate):"",methodStatement:(null==N?void 0:N.methodStatement)||"",rebate:(null==N?void 0:N.rebate)||"",notes:(null==N?void 0:N.notes)||"",siteVisitAt:(null==N?void 0:N.siteVisitAt)?new Date(N.siteVisitAt):""},resolver:(0,h.S)(nr)}),nb=nh.control,ny=nh.errors,nI=nh.handleSubmit,nx=nh.register,nZ=J("customer")||J("supplier")&&("quotationAccepted"===N.status||"quotationRejected"===N.status||"supplierQuoteSent"===N.status),nj=(C=(0,u.Z)(function(n){var e,t,o,i;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status=(null==N?void 0:N.job.status)==="quoteSent"?"supplierQuoteUpdated":"supplierQuoteComplete",n.startDate&&(n.startDate=p()(n.startDate).format()),[4,ng({variables:{id:N.id,changes:n,recommend:!1}})];case 1:return o=(t=e.sent().data.update_SupplierQuote_by_pk).id,i=t.status,O&&O({id:o,status:i}),[2]}})}),function(n){return C.apply(this,arguments)}),n_=(P=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status="supplierQuoteDraft",n.startDate&&(n.startDate=p()(n.startDate).format()),[4,ng({variables:{id:N.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(n){return P.apply(this,arguments)}),nq=(D=(0,u.Z)(function(){var n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return(n={}).status="supplierQuoteRefused",[4,ng({variables:{id:N.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(){return D.apply(this,arguments)}),nw=function(){U.close()},nA=function(){U.show({title:"Upload Risk Assessments",content:(0,i.jsx)(R.G,{entity:"Quotation",entityId:N.id})})},n$=(E=(0,u.Z)(function(){return(0,d.__generator)(this,function(n){switch(n.label){case 0:return[4,ng({variables:{changes:{recommended:!0},id:N.id,jobId:N.jobId,recommend:!0}})];case 1:return n.sent(),[2]}})}),function(){return E.apply(this,arguments)}),nS={control:nb,errors:ny,register:nx},nT=J(["admin","supplier"])&&!nZ&&(0,i.jsx)(y.Z,{content:"Cancel",onClick:nw,type:"button",style:ne?{padding:"0 8px",marginRight:8,width:"auto"}:null}),nR=J(["admin","supplier"])&&!nZ&&(0,i.jsx)(y.Z,{content:"Save",context:"secondary",onClick:nI(n_),style:ne?{padding:"0 8px",marginRight:8,marginBottom:8,width:"auto"}:null}),nC=J(["admin"])&&(0,i.jsx)(y.Z,{content:"Reject quote",context:"danger",onClick:nq,style:ne?{padding:"0 8px",marginRight:8}:null}),nP=function(){if(!nZ){if(J(["admin"])||J(["supplier"])&&(0,nl.il)(L,nm)||J(["supplier"])&&nf)return(0,i.jsx)(y.Z,{content:"Submit quote",type:"submit",style:ne?{padding:"0 8px",marginRight:8}:null});if(J(["supplier"])&&!(0,nl.il)(L,nm))return(0,i.jsx)(y.Z,{content:"Request approval",onClick:function(){var n;return(0,na.I_)({type:"quote",role:"admin"===Q.accountType?"adminSupplier":Q.accountType,jobId:null==N?void 0:null===(n=N.job)||void 0===n?void 0:n.id,quotationId:N.id,accountId:Q.accountId,amount:nm,offCanvas:U})},style:ne?{padding:"0 8px",marginRight:8}:null})}};return(0,i.jsxs)(I.Z,{handleSubmit:nI(nj),children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(Z.Z,{md:12,children:["Status: ",(0,i.jsx)(j.Z,{content:k.text,size:"md",context:k.context}),J("admin")&&(0,i.jsx)(y.Z,{content:"Recommend This Quotation",context:"secondary",onClick:n$,size:"sm"})]})}),(0,i.jsx)(_.Z,{}),(0,i.jsx)(ni,{quotation:N,total:F,setTotal:z,supplierTotal:V,setSupplierTotal:G,customerTotal:H,setCustomerTotal:K,readOnly:nZ}),(0,i.jsx)(_.Z,{}),(0,i.jsxs)(x.Z,{children:[(0,i.jsx)(Z.Z,{md:3,children:(0,i.jsx)(q.Z,{label:"Total Duration",children:(0,i.jsx)(w.Z,(0,c.Z)((0,o.Z)({},nS),{name:"totalDuration",type:"number",readOnly:nZ}))})}),(0,i.jsx)(Z.Z,{md:3,children:(0,i.jsx)(q.Z,{label:"Total Duration Unit",children:(0,i.jsx)(A.Z,(0,c.Z)((0,o.Z)({},nS),{name:"totalDurationUnit",options:[{text:"Hour",value:"hour",disabled:!1},{text:"Day",value:"day",disabled:!1},{text:"Week",value:"week",disabled:!1}],readOnly:nZ}))})}),(0,i.jsxs)(Z.Z,{md:3,children:[(0,i.jsx)(q.Z,{label:"Available Start date"}),(0,i.jsx)(T.M,(0,c.Z)((0,o.Z)({},nS),{name:"startDate",readOnly:nZ}))]})]}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(Z.Z,{md:12,children:(0,i.jsx)(q.Z,{label:"Method Statement",children:(0,i.jsx)($.Z,(0,c.Z)((0,o.Z)({},nS),{name:"methodStatement",readOnly:nZ,rows:2}))})})}),J(["admin","supplier"])&&!nZ&&(0,i.jsx)(x.Z,{children:(0,i.jsxs)(Z.Z,{md:12,children:[(0,i.jsx)(q.Z,{label:"Risk Assessments & Method Statements"}),(0,i.jsx)(q.Z,{label:"Where RAMS are required, please upload them here.",children:(0,i.jsx)(y.Z,{content:"Upload",context:"secondary",onClick:nA,size:"sm"})})]})}),(0,i.jsx)(x.Z,{justify:ne?"center":"end",style:{margin:"5px 0 30px 0"},children:ne?(0,i.jsxs)(x.Z,{justify:"center",children:[nP(),nC,(0,i.jsx)(y.Z,{onClick:nt,context:"secondary",children:(0,i.jsx)(nd.Z,{})}),(0,i.jsx)(nc.ZP,{open:!!X,anchorEl:X,onClose:no,sx:{zIndex:9999},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,i.jsxs)(ns.Z,{flexDirection:"columnn",alignItems:"center",justifyContent:"space-evenly",p:2,children:[nR,nT]})})]}):(0,i.jsxs)(S.Z,{children:[nT,nR,nC,nP()]})}),(0,i.jsx)("div",{style:{clear:"both"}})]})},np=t(22244),nv=t(2845),nf=t(75327),ng=function(n){var e=n.quotationId,t=n.onSuccess,u=(0,nv.x)(),c=u.hasRole,s=u.user,d=(0,r.aM)(a.Ib,{variables:{id:e}}),l=d.data,m=(void 0===l?{quotation:{}}:l).quotation,p=d.loading,v=(0,r.aM)(nf.nh,{variables:{id:s.id}}).data,f=(void 0===v?{user:{}}:v).user,g=np.E6.find(function(n){return n.value===m.status})||{text:"-",context:"info"};return p?(0,i.jsx)(H.Z,{sx:{zIndex:1e5},open:!0,children:(0,i.jsx)(K.Z,{color:"secondary"})}):(0,i.jsx)(nm,{quotation:m,quotationId:e,user:(0,o.Z)({},s,f),hasRole:c,onSuccess:t,status:g})}},13640:function(n,e,t){t.d(e,{EA:function(){return g},Ib:function(){return m},Ih:function(){return f},JE:function(){return p},cu:function(){return v},nc:function(){return h}});var o=t(7297),i=t(75063),r=t(75327);function a(){var n=(0,o.Z)(["\n  query GetQuotation($id: Int!) {\n    quotation: SupplierQuote_by_pk(id: $id) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      siteVisitAt\n      job: Job {\n        id\n        status\n        timings: JobTimings(order_by: { id: desc }) {\n          id\n          status\n          notes\n          meta\n          userId\n          quoteId\n          createdAt\n        }\n      }\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(['\n  query GetQuotations($accountId: Int, $status: [String!], $q: String, $limit: Int, $offset: Int) {\n    quotations: SupplierQuote(\n      limit: $limit\n      offset: $offset\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n      order_by: { quoteNumber: desc }\n    ) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      type\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      labourTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Labour" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      materialsTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Materials" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      total: SupplierQuoteLineItems_aggregate {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      job: Job {\n        description\n        title\n        type\n        number\n        status\n        customer: Customer {\n          id\n          name\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n        location: Location {\n          addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n            id\n            status\n            address: Address {\n              id\n              name\n              addressLine1\n              postCode\n            }\n          }\n        }\n        timings: JobTimings(order_by: { createdAt: asc }) {\n          id\n          status\n          notes\n          createdAt\n          user: User {\n            ...UserFields\n          }\n        }\n      }\n    }\n    meta: SupplierQuote_aggregate(\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return u=function(){return n},n}function c(){var n=(0,o.Z)(["\n  query GetQuotationLineItems($quotationId: Int!, $type: String!) {\n    lineItems: SupplierQuoteLineItem(\n      where: { quoteId: { _eq: $quotationId }, type: { _eq: $type } }\n    ) {\n      id\n      description\n      item\n      qty\n      qtyUnit\n      quoteId\n      supplierTotal\n      total\n      type\n      unitRate\n    }\n  }\n"]);return c=function(){return n},n}function s(){var n=(0,o.Z)(["\n  mutation InsertSupplierQuoteLineItem($objects: [SupplierQuoteLineItem_insert_input!]!) {\n    insert_SupplierQuoteLineItem(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,o.Z)(["\n  mutation UpdateSupplierQuoteLineItem($id: Int!, $changes: SupplierQuoteLineItem_set_input) {\n    update_SupplierQuoteLineItem_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,o.Z)(["\n  mutation DeleteSupplierQuoteLineItem($id: Int!) {\n    delete_SupplierQuoteLineItem_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return l=function(){return n},n}var m=(0,i.Ps)(a()),p=(0,i.Ps)(u(),r.Px),v=(0,i.Ps)(c()),f=(0,i.Ps)(s()),g=(0,i.Ps)(d()),h=(0,i.Ps)(l())},5481:function(n,e,t){t.d(e,{Dg:function(){return l},HI:function(){return d},j6:function(){return s}});var o=t(7297),i=t(75063);function r(){var n=(0,o.Z)(["\n  mutation AddQuotation($objects: [SupplierQuote_insert_input!]!) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,o.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $recommend: Boolean!\n    $jobId: Int\n  ) {\n    update_SupplierQuote(where: { jobId: { _eq: $jobId } }, _set: { recommended: false })\n      @include(if: $recommend) {\n      returning {\n        id\n      }\n    }\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $supplierOffer: [SupplierOffer_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_SupplierOffer(objects: $supplierOffer) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return n},n}function c(){var n=(0,o.Z)(['\n  mutation UpdateQuotation($jobId: Int, $changes: SupplierQuote_set_input) {\n    update_SupplierQuote(\n      where: {\n        jobId: { _eq: $jobId }\n        status: { _neq: "quotationAccepted" }\n        type: { _eq: "quote" }\n      }\n      _set: $changes\n    ) {\n      returning {\n        id\n        jobId\n        status\n      }\n    }\n  }\n']);return c=function(){return n},n}var s=(0,i.Ps)(r()),d=(0,i.Ps)(a()),l=(0,i.Ps)(u());(0,i.Ps)(c())},66321:function(n,e,t){t.d(e,{E:function(){return g}});var o=t(26042),i=t(69396),r=t(85893),a=t(45697),u=t.n(a),c=t(94054),s=t(50480),d=t(56815),l=t(40476),m=t(79717),p=t(36872),v=t(51233),f=t(15861),g=function(n){var e=n.label,t=n.options,a=n.error,u=n.helperText,g=n.stackProps,b=n.formControlProps,y=n.labelLeft,I=function(n){var e=n.children;return(0,r.jsx)(r.Fragment,{children:e})};return(0,r.jsxs)(c.Z,(0,i.Z)((0,o.Z)({sx:{m:3},error:a,variant:"standard"},void 0===b?{}:b),{children:[(0,r.jsxs)(v.Z,(0,i.Z)((0,o.Z)({},y&&h),{children:[e&&(0,r.jsx)(l.Z,{id:"radio-group",color:"secondary",children:e}),(0,r.jsx)(m.Z,(0,i.Z)((0,o.Z)({},n),{"aria-labelledby":"radio-group",children:(0,r.jsx)(v.Z,(0,i.Z)((0,o.Z)({},void 0===g?{}:g),{children:t.map(function(n){var e=n.value,t=n.label,o=n.icon,i=n.ParentComponent;return(0,r.jsx)(void 0===i?I:i,{children:(0,r.jsx)(s.Z,{value:e,control:(0,r.jsx)(p.Z,{color:"secondary"}),label:(0,r.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:1,children:[o,(0,r.jsx)(f.Z,{children:t})]})})})})}))}))]})),(0,r.jsx)(d.Z,{children:u})]}))};g.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},g.propTypes={label:u().string,options:u().arrayOf(u().shape({label:u().string.isRequired,value:u().any.isRequired,ParentComponent:u().elementType})).isRequired,error:u().bool,helperText:u().string,stackProps:u().object,formControlProps:u().object,labelLeft:u().bool};var h={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},86021:function(n,e,t){t.d(e,{_Z:function(){return m}});var o=t(47568),i=t(7297),r=t(97582),a=t(75063),u=t(13777),c=t(63139);function s(){var n=(0,i.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,i.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return d=function(){return n},n}var l,m=(l=(0,o.Z)(function(n){var e,t,o,i,a,s,d,l;return(0,r.__generator)(this,function(r){switch(r.label){case 0:switch(e=n.client,t=n.jobId,o=n.type,i=n.getUrl,a=n.preview,s="",o){case"supplier":s=v;break;case"customerVat":s=p;break;default:return[2]}return(0,c.a)()||i||(d=window.open("/download","_blank")),l="",[4,e.mutate({mutation:s,variables:{jobId:t,preview:a}}).then(function(n){var e,t,o,r=n.data.invoice.key;i?l="".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(r):(null==d||null===(e=d.location)||void 0===e||e.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(r)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(o=t.Plugins)||void 0===o?void 0:o.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(r)}))}).catch(function(n){(0,u.Tb)({message:n,section:"fetch"})})];case 1:return r.sent(),[2,l]}})}),function(n){return l.apply(this,arguments)}),p=(0,a.Ps)(s()),v=(0,a.Ps)(d())},56063:function(n,e,t){t.d(e,{$:function(){return c}});var o,i=t(47568),r=t(97582),a=t(63139),u=t(13777),c=(o=(0,i.Z)(function(n){var e;return(0,r.__generator)(this,function(t){switch(t.label){case 0:return(0,a.a)()||(e=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(function(n){return n.json()}).then(function(n){var t,o,i;null==e||null===(t=e.location)||void 0===t||t.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(o=window.Capacitor)||void 0===o?void 0:null===(i=o.Plugins)||void 0===i?void 0:i.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,u.Tb)({message:n,section:"fetch"})})];case 1:return t.sent(),[2]}})}),function(n){return o.apply(this,arguments)})},80695:function(n,e,t){t.d(e,{u:function(){return d}});var o,i=t(47568),r=t(26042),a=t(69396),u=t(97582),c=t(13777),s=t(63139),d=(o=(0,i.Z)(function(n){var e,t,o,i,d,l,m,p,v,f,g,h,b,y,I,x;return(0,u.__generator)(this,function(u){switch(u.label){case 0:return e=n.meta,t=n.invoice,I=(0,a.Z)((0,r.Z)({},e),{title:"Proforma Invoice",amountPaid:null==t?void 0:null===(o=t.amountPaid)||void 0===o?void 0:null===(i=o.reconciliations)||void 0===i?void 0:null===(d=i.aggregate)||void 0===d?void 0:null===(l=d.sum)||void 0===l?void 0:l.amount,amountDeducted:null==t?void 0:null===(m=t.amountDeducted)||void 0===m?void 0:null===(p=m.reconciliations)||void 0===p?void 0:null===(v=p.aggregate)||void 0===v?void 0:null===(f=v.sum)||void 0===f?void 0:f.amount,reconciledAmount:null==t?void 0:null===(g=t.reconciledAmount)||void 0===g?void 0:null===(h=g.reconciliations)||void 0===h?void 0:null===(b=h.aggregate)||void 0===b?void 0:null===(y=b.sum)||void 0===y?void 0:y.amount}),(0,s.a)()||(x=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(I)}).then(function(n){return n.json()}).then(function(n){var e,t,o;null==x||null===(e=x.location)||void 0===e||e.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(o=t.Plugins)||void 0===o?void 0:o.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,c.Tb)({message:n,section:"fetch"})})];case 1:return u.sent(),[2]}})}),function(n){return o.apply(this,arguments)})},42251:function(n,e,t){t.d(e,{i$:function(){return C},Ii:function(){return P},I_:function(){return D}});var o=t(47568),i=t(97582),r=t(85893),a=t(828),u=t(67294),c=t(45697),s=t(42283),d=t(79665),l=t(50319),m=t(73987),p=t(76600),v=t(49501),f=t(6710),g=t(913),h=t(74231),b=t(6538),y=t(29815),I=t(22244),x=function(n,e){var t=(0,y.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&t!==e})})},Z=function(n){var e,t,c=n.type,y=n.status,I=n.role,Z=n.job,j=n.quoteId,_=n.toggleShow,q=n.refetch,w=(0,u.useContext)(m.Z).user,A=(0,a.Z)((0,l.D)(g.qD,{onCompleted:function(n){}}),1)[0],$=(0,a.Z)((0,l.D)(g.r2,{onCompleted:function(n){}}),1)[0],S=(0,a.Z)((0,l.D)(g.k7,{onCompleted:function(n){}}),1)[0],T=(0,s.cI)({defaultValues:{comments:""},resolver:(0,d.S)((e="QuoteThresholdRejected"===y||"ThresholdRejected"===y,(0,h.Ry)().shape({comments:e&&(0,h.Z_)().required()})))}),R=T.errors,C=T.handleSubmit,P=T.register,D=(t=(0,o.Z)(function(n){var e,t,o,r;return(0,i.__generator)(this,function(i){return o={id:Z.id,status:"quote"===c?"QuoteThresholdApproved"===y?"".concat(I,"QuoteThresholdRejected"):"".concat(I,"QuoteThresholdApproved"):"ThresholdApproved"===y?"".concat(I,"ThresholdRejected"):"".concat(I,"ThresholdApproved"),userId:w.id,quoteId:"quote"===c?j:void 0},S({variables:o}),r={notes:n.comments,status:"".concat(I).concat(y),jobId:Z.id,userId:w.id,quoteId:j},$({variables:{objects:[r]}}),A({variables:{id:Z.id,changes:{status:"quote"===c?null===(e=x(Z))||void 0===e?void 0:e.status:null===(t=(0,b.e)(Z))||void 0===t?void 0:t.status}}}),_&&_(),q&&q(),[2]})}),function(n){return t.apply(this,arguments)});return(0,r.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:C(D),children:(0,r.jsx)(v.Z,{label:"Comments",children:(0,r.jsx)(f.Z,{errors:R,name:"comments",register:P,rows:3})})})};Z.propTypes={job:c.object.isRequired,status:c.string.isRequired,toggleShow:c.func.isRequired};var j,_,q=t(26042),w=t(69396),A=t(66812),$=t(2845),S=t(5481),T=(0,h.Ry)().shape({manager:(0,h.Ry)().shape({value:(0,h.Rx)().integer().required(),label:(0,h.Z_)()}).required()}),R=function(n){var e,t=n.role,u=n.type,c=n.quotations,m=n.jobId,v=n.quotationId,f=n.accountId,h=n.amount,b=n.toggleShow,y=(0,$.x)().user,I=(0,a.Z)((0,l.D)(g.r2,{onCompleted:function(n){}}),1)[0],x=(0,a.Z)((0,l.D)(g.qD,{onCompleted:function(n){}}),1)[0],Z=(0,a.Z)((0,l.D)(S.HI),1)[0],j=(0,s.cI)({resolver:(0,d.S)(T),defaultValues:{manager:[]}}),_=j.errors,R=j.handleSubmit,C=j.register,P=j.control,D=(e=(0,o.Z)(function(n){return(0,i.__generator)(this,function(e){switch(e.label){case 0:if("issue"!==u)return[3,2];return[4,I({variables:{objects:[{status:"".concat(t,"ThresholdApproval"),jobId:m,userId:y.id,quoteId:v,meta:{to:n.manager.value}}]}})];case 1:case 3:return e.sent(),[3,7];case 2:var r;if(!("quote"===u&&"adminCustomer"===t))return[3,4];return[4,Promise.all(c.map((r=(0,o.Z)(function(e){return(0,i.__generator)(this,function(o){switch(o.label){case 0:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:m,userId:y.id,quoteId:e.id,meta:{to:n.manager.value}}]}})];case 1:return o.sent(),[4,Z({variables:{id:e.id,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 2:return o.sent(),[2]}})}),function(n){return r.apply(this,arguments)})))];case 4:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:m,userId:y.id,quoteId:v,meta:{to:n.manager.value}}]}})];case 5:return e.sent(),[4,Z({variables:{id:v,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 6:e.sent(),e.label=7;case 7:return[4,x({variables:{id:m,changes:{status:"waitingThresholdApproval"}}})];case 8:return e.sent(),b(),[2]}})}),function(n){return e.apply(this,arguments)});return(0,r.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:R(D),children:(0,r.jsx)(A.P,(0,w.Z)((0,q.Z)({},{control:P,register:C,errors:_}),{label:"Please choose an approver from the list below.",accountId:f,userId:y.id,invoiceThreshold:"issue"===u?h:null,quoteThreshold:"quote"===u?h:null,name:"manager",type:"thresholdManagers"}))})},C=(j=(0,o.Z)(function(n){var e,t,o,a,u,c;return(0,i.__generator)(this,function(i){return e=n.type,t=n.role,o=n.job,a=n.quoteId,u=n.offCanvas,c=n.refetch,u.show({content:(0,r.jsx)(Z,{type:e,role:t,job:o,quoteId:a,status:"quote"===e?"QuoteThresholdApproved":"ThresholdApproved",toggleShow:u.show,refetch:c}),title:"Approve threshold"}),[2]})}),function(n){return j.apply(this,arguments)}),P=(_=(0,o.Z)(function(n){var e,t,o,a,u,c;return(0,i.__generator)(this,function(i){return e=n.type,t=n.role,o=n.job,a=n.quoteId,u=n.offCanvas,c=n.refetch,u.show({content:(0,r.jsx)(Z,{type:e,role:t,job:o,quoteId:a,status:"quote"===e?"QuoteThresholdRejected":"ThresholdRejected",toggleShow:u.show,refetch:c}),title:"Reject threshold"}),[2]})}),function(n){return _.apply(this,arguments)}),D=function(n){var e=n.type,t=n.role,o=n.quotations,i=n.jobId,a=n.quotationId,u=n.accountId,c=n.amount,s=n.offCanvas;s.show({content:(0,r.jsx)(R,{role:t,type:e,jobId:i,quotations:o,quotationId:a,accountId:u,amount:c,toggleShow:s.show}),title:"Threshold approval"})}},97432:function(n,e,t){t.d(e,{l:function(){return o}});var o=function(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}},98552:function(n,e,t){t.d(e,{SR:function(){return a},Tq:function(){return u},YK:function(){return r},cJ:function(){return i},pX:function(){return o}});var o=["customerVat","supplier"],i=["ProformaInvoiceCustomer","ProformaInvoiceSupplier"],r=["customerPpmInvoice","supplierPpmInvoice"],a={customer:["customerVat","ProformaInvoiceCustomer","customerPpmInvoice"],supplier:["supplier","ProformaInvoiceSupplier","supplierPpmInvoice"]},u={customerVat:"Customer VAT Invoice",supplier:"Supplier Invoice",ProformaInvoiceCustomer:"Customer ad-hoc Invoice",ProformaInvoiceSupplier:"Supplier ad-hoc Invoice",customerPpmInvoice:"PPM Customer Invoice",supplierPpmInvoice:"PPM Supplier Invoice"}}}]);