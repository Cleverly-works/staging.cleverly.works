"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1],{66779:function(e,n,t){t.d(n,{G5:function(){return m},UB:function(){return p},Ve:function(){return h},Wn:function(){return g},bD:function(){return b},kJ:function(){return v},rM:function(){return f}});var o=t(7297),i=t(75063);function r(){var e=(0,o.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n\n      slaId\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return r=function(){return e},e}function a(){var e=(0,o.Z)(['\n  query GetCustomers(\n    $customerManagerId: Int\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Account_order_by!\n    $status: String\n  ) {\n    customers: Account(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $customerManagerId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      createdAt\n      name\n      companyNumber\n      vatId\n      website\n      status\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(\n      where: {\n        type: { _eq: "customer" }\n        createdAt: { _eq: $date }\n        managerId: { _eq: $customerManagerId }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return a=function(){return e},e}function c(){var e=(0,o.Z)(['\n  query GetCustomer($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      clientType: ClientType {\n        id\n        name\n      }\n      structure\n      companyNumber\n      vatId\n      website\n      status\n      createdAt\n      updatedAt\n      status\n      type\n      meta\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n      propertiesMeta: Account_Locations_aggregate {\n        aggregate {\n          count\n        }\n      }\n      jobsMeta: CustomerJobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n        phone\n        email\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n      jobs: CustomerJobs {\n        id\n        title\n      }\n      finance: Financial {\n        id\n        invoicing\n        serviceRate\n        stripeId\n        totalRevenue\n        unpaidInvoices\n        creditLimit\n        creditRating\n        createdAt\n        amountOutstanding\n        accountId\n        approvalThreshold\n        arrangementFee\n        spendThreshold\n        defaultPaymentMethod\n      }\n      accountEntries: AccountEntries(order_by: { createdAt: asc }) {\n        id\n        outstandingAmount\n        type\n        entryId\n        currencyId\n        createdAt\n        balance\n        amount\n        accountId\n        updatedAt\n      }\n    }\n  }\n']);return c=function(){return e},e}function s(){var e=(0,o.Z)(["\n  query GetCustomerManage($id: Int!) {\n    customer: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      meta\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        isContact\n        userId\n        user: User {\n          id\n          email\n          fullName\n          meta\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n        }\n      }\n      clientType: ClientType {\n        id\n        label: name\n        value: id\n      }\n      status\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,o.Z)(["\n  mutation AddCustomer($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,o.Z)(["\n  mutation UpdateCustomer(\n    $customerId: Int!\n    $customer: Account_set_input\n    $userId: Int!\n    $user: User_set_input\n    $hasUpdateUser: Boolean!\n  ) {\n    update_Account_by_pk(pk_columns: { id: $customerId }, _set: $customer) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $userId }, _set: $user) @include(if: $hasUpdateUser) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}function l(){var e=(0,o.Z)(["\n  mutation AddFinancial($objects: [Financial_insert_input!]!) {\n    insert_Financial(objects: $objects) {\n      returning {\n        id\n        accountId\n        locationId\n      }\n    }\n  }\n"]);return l=function(){return e},e}var m=(0,i.Ps)(r()),v=(0,i.Ps)(a()),p=(0,i.Ps)(c()),f=(0,i.Ps)(s()),h=(0,i.Ps)(u()),g=(0,i.Ps)(d()),b=(0,i.Ps)(l())},8052:function(e,n,t){t.d(n,{y:function(){return D}});var o=t(26042),i=t(85893),r=t(45697),a=t(68956),c=t(26186),s=t(16551),u=t(77439),d=t(11585),l=t(8500),m=t(47568),v=t(69396),p=t(828),f=t(97582),h=t(50319),g=t(7297),b=t(75063);function x(){var e=(0,g.Z)(["\n  mutation AddBankAccount($objects: [BankAccount_insert_input!]!) {\n    insert_BankAccount(objects: $objects) {\n      returning {\n        id\n        stripeId\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        createdAt\n      }\n    }\n  }\n"]);return x=function(){return e},e}function y(){var e=(0,g.Z)(["\n  mutation UpdateBankAccount($id: Int!, $changes: BankAccount_set_input) {\n    update_BankAccount_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return y=function(){return e},e}var Z=(0,b.Ps)(x()),I=(0,b.Ps)(y()),j=t(42283),_=t(79665),w=t(76600),R=t(49501),S=t(55563),T=t(58594),C=t(74231),A=(0,C.Ry)().shape({bank:(0,C.Z_)().required(),accountNumber:(0,C.Z_)().required(),bic:(0,C.Z_)().required(),iban:(0,C.Z_)().required(),routingNumber:(0,C.Z_)().required()}),N=function(e){var n,t=e.accountId,r=e.data,a=e.refetch,c=e.toggleShow,s=(0,j.cI)({defaultValues:r,resolver:(0,_.S)(A)}),u=s.errors,d=s.handleSubmit,l=s.register,g=(0,p.Z)((0,h.D)(Z,{onCompleted:function(){a()}}),1)[0],b=(0,p.Z)((0,h.D)(I,{onCompleted:function(){a()}}),1)[0],x=(n=(0,m.Z)(function(e){var n;return(0,f.__generator)(this,function(i){switch(i.label){case 0:if((n=(0,o.Z)({},e)).stripeId="ba_42g2s45sh46jl46h",n.accountId=t,n.status="active",n.countryId=1,n.currencyId=1,n.meta={showInInvoice:Boolean(n.showInInvoice)},delete n.showInInvoice,!(null==r?void 0:r.id))return[3,1];return b({variables:{id:r.id,changes:n}}),[3,3];case 1:return[4,g({variables:{objects:[n]}})];case 2:i.sent(),i.label=3;case 3:return c(),[2]}})}),function(e){return n.apply(this,arguments)}),y={errors:u,register:l};return(0,i.jsxs)(w.Z,{id:"offCanvasForm",handleSubmit:d(x),children:[(0,i.jsx)(R.Z,{label:"Bank name",children:(0,i.jsx)(S.Z,(0,v.Z)((0,o.Z)({},y),{name:"bank"}))}),(0,i.jsx)(R.Z,{label:"Account number",children:(0,i.jsx)(S.Z,(0,v.Z)((0,o.Z)({},y),{name:"accountNumber"}))}),(0,i.jsx)(R.Z,{label:"Routing number",children:(0,i.jsx)(S.Z,(0,v.Z)((0,o.Z)({},y),{name:"routingNumber"}))}),(0,i.jsx)(R.Z,{label:"BIC",children:(0,i.jsx)(S.Z,(0,v.Z)((0,o.Z)({},y),{name:"bic"}))}),(0,i.jsx)(R.Z,{label:"IBAN",children:(0,i.jsx)(S.Z,(0,v.Z)((0,o.Z)({},y),{name:"iban"}))}),(0,i.jsx)(T.Z,(0,v.Z)((0,o.Z)({},y),{data:[{id:"1",label:"Show in invoice",value:"true"}],name:"showInInvoice"}))]})};N.propTypes={accountId:r.number,toggleShow:r.func,updateRows:r.func};var q=t(64872),D=function(e){var n=e.accountId,t=e.data,r=e.edit,m=e.refetch,v=(0,q.a)(),p=[{hidden:!0},{text:"Bank"},{text:"Account number"},{text:"Routing"},{text:"BIC"},{text:"IBAN"},{text:"Stripe ID",hidden:!0},{text:"Date Added"},{formatter:function(e){return!0===e.row.showInInvoice?"True":"False"},text:"Show In Invoice"},{formatter:a.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return g(e,n)},tooltip:"Edit"}],text:"Actions"}],f=function(e){var n,t;return{id:e.id,bank:null==e?void 0:e.bank,accountNumber:null==e?void 0:e.accountNumber,routingNumber:null==e?void 0:e.routingNumber,bic:null==e?void 0:e.bic,iban:null==e?void 0:e.iban,stripeId:e.stripeId,date:(0,c.Z)(e.createdAt),showInInvoice:null!==(n=e.meta)&&void 0!==n&&!!n.showInInvoice&&(null===(t=e.meta)||void 0===t?void 0:t.showInInvoice),actions:""}},h=function(e){e.stopPropagation(),v.show({content:(0,i.jsx)(N,{accountId:n,refetch:m,toggleShow:v.close}),title:"Add Bank Account"})},g=function(e,t){e.stopPropagation(),v.show({content:(0,i.jsx)(N,{accountId:n,data:(0,o.Z)({},t)||{},refetch:m,toggleShow:v.close}),title:"Add Bank Account"})},b=function(){return(0,i.jsx)(s.Z,{children:(0,i.jsx)(u.Z,{context:"secondary",content:"Add",onClick:h,size:"sm"})})};return(0,i.jsx)(d.Z,{open:!0,title:"Bank Accounts",toolbar:r&&(0,i.jsx)(b,{}),children:(0,i.jsx)(l.Z,{columns:p,rows:t.map(function(e){return f(e)})})})};D.propTypes={data:r.array},D.defaultProps={data:[],edit:!0}},6033:function(e,n,t){t.d(n,{r:function(){return o}});var o=[{text:"All work orders",value:""},{text:"All outstanding invoices",value:"0-"},{text:"1 - 30",value:"1-30"},{text:"31 - 60",value:"31-60"},{text:"61 - 90",value:"61-90"},{text:"> 90",value:"90-"}]},55185:function(e,n,t){t.d(n,{b:function(){return ne}});var o=t(47568),i=t(97582),r=t(85893),a=t(67294),c=t(45697),s=t(11163),u=t(6388),d=t(26695),l=t(78289),m=t(11082),v=t(16551),p=t(77439),f=t(9270),h=t(62140),g=t(11585),b=t(8500),x=t(8052),y=t(7297),Z=t(10367),I=t(86036),j=t(55377),_=t(11587),w=t(25742),R=t(35418),S=t(26042),T=t(69396),C=t(828),A=t(50319),N=t(66779),q=t(42283),D=t(76600),k=t(28497),$=t(49501),F=t(55563),P=function(e){var n,t=e.accountId,a=e.meta,c=e.refetch,s=e.toggleShow,u=(0,S.Z)({},null==a?void 0:a.finance)||{},d=(0,q.cI)({defaultValues:{creditLimit:u.creditLimit||0,creditRating:u.creditRating||0}}),l=d.errors,m=d.handleSubmit,v=d.register,p=(0,C.Z)((0,A.D)(N.Wn),1)[0],f=(n=(0,o.Z)(function(e){return(0,i.__generator)(this,function(n){return p({variables:{customerId:t,customer:h(e)}}).then(function(){c(),s()}),[2]})}),function(e){return n.apply(this,arguments)}),h=function(e){var n={};return n.meta=(0,S.Z)({},a)||{},n.meta.finance=u||{},n.meta.finance.creditLimit=Number(e.creditLimit),n.meta.finance.creditRating=Number(e.creditRating),n},g={errors:l,register:v};return(0,r.jsxs)(D.Z,{id:"offCanvasForm",handleSubmit:m(f),children:[(0,r.jsx)(k.Z,(0,T.Z)((0,S.Z)({},g),{name:"creditLimit",label:"Credit Limit"})),(0,r.jsx)($.Z,{label:"Credit Rating",children:(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},g),{name:"creditRating",type:"number"}))})]})};P.propTypes={finance:c.object.isRequired,refetch:c.func.isRequired,toggleShow:c.func.isRequired};var L=function(e){var n=e.percent,t=e.breakPoints;return((!t||t.length<2)&&(t=[70,90]),n<=t[0])?"success":n<=t[1]?"warning":"danger"},E=t(97432);function z(){var e=(0,y.Z)(["\n  margin-bottom: 0;\n"]);return z=function(){return e},e}var B=function(e){var n,t,o=e.accountId,i=e.edit,a=e.meta,c=e.offCanvas,s=e.customerBalance,u=e.refetch,d=(null==a?void 0:a.finance)||{};n=!(s>=0)&&(null==d?void 0:d.creditLimit)?-1*(0,E.l)(s/(null==d?void 0:d.creditLimit)*100,0):0;var l=function(){c.show({title:"Edit Credit Details",content:(0,r.jsx)(P,{accountId:o,meta:a,refetch:u,toggleShow:c.close})})};return(0,r.jsxs)(R.G,{carousel:!1,details:!0,entity:"CreditReport",entityId:null==d?void 0:d.id,summary:"Credit Report",children:[(0,r.jsx)(I.Z,{content:"Balance",text:(0,m.Z)(null!=s?s:0)}),(0,r.jsx)(I.Z,{content:"Credit Limit",text:(0,r.jsxs)(r.Fragment,{children:["".concat((0,m.Z)(null!==(t=null==d?void 0:d.creditLimit)&&void 0!==t?t:0)," "),(0,r.jsx)(U,{size:"sm",content:"".concat(n,"%"),context:L({percent:n})})]})}),(0,r.jsx)(I.Z,{content:"Credit Rating",text:(null==d?void 0:d.creditRating)||0}),i&&(0,r.jsx)(w.H,{content:"Edit",handleClick:l}),(0,r.jsx)(j.Z,{size:"sm"})]})};B.defaultProps={edit:!0};var U=(0,Z.ZP)(_.Z).withConfig({displayName:"creditReport__StyledBadge",componentId:"sc-e5cfbb1e-0"})(z()),X=t(66252),M=t(73359),J=t(57460),O=t.n(J),V=t(40826),G=t(68956),W=t(26186),H=t(95103),Q=t(55843),Y=t(67427),K=t(98456),ee=t(84808),en=t(22081),et=t(62047),eo=t(91272),ei=t(45416),er=t(20705),ea=t(13077);function ec(){var e=(0,y.Z)(["\n  background-color: ",";\n"]);return ec=function(){return e},e}var es=function(e){var n=e.adminId,t=e.accountId,o=e.locationId,i=e.onSendEntities;e.toggleShow;var c=(0,a.useState)(!1),l=c[0],v=c[1],p=function(e,n){var t=e.id;X(U.map(function(e){return e.id===t&&(e.assigned=n),e}))},f=[{hidden:!0},{hidden:!0},{text:"Number",formatter:function(e){var n,t=e.row;return"ppmInvoice"===t.type?"PM ".concat(t.invoiceNumber):(0,r.jsx)(ei.D,{id:t.jobId,number:t.number,invoiceNumber:null===(n=t.invoice)||void 0===n?void 0:n.invoiceNumber,type:t.jobType})}},{formatter:function(e){var n=e.row,t=e.row.itemType;return(0,r.jsx)(ed,{content:t,row:n,size:"sm"})},text:"Type"},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Amount Outstanding",formatter:function(e){var n=e.row;return"invoice"===n.itemType||"proformaInvoice"===n.itemType?(0,m.Z)(n.outstandingAmount):"-"}},{text:"Status",formatter:function(e){var n=e.row;return n.status?(0,r.jsx)(ea.B,{value:n.status}):""}},{hidden:!0},{hidden:!0},{formatter:function(e){var n,t,o,i,a=e.row;return(0,r.jsx)(et.Z,{context:"secondary",size:"sm",onToggle:function(e){return p(a,e)},toggled:a.assigned||(null===(n=a.meta)||void 0===n?void 0:n.xeroInvoiceId)||(null===(t=a.meta)||void 0===t?void 0:t.xeroCreditNoteId),disabled:(null===(o=a.meta)||void 0===o?void 0:o.xeroInvoiceId)||(null===(i=a.meta)||void 0===i?void 0:i.xeroCreditNoteId)})},text:(0,r.jsx)(et.Z,{context:"secondary",size:"sm",onToggle:function(e){return g(e)}})}],h=function(e){return P.map(function(n){var t,o,i,r,a,c,s,u,d,l,m,v,p,f,h;return{id:n.id,jobId:null==n?void 0:null===(t=n.invoices)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:null===(i=o.Job)||void 0===i?void 0:i.id,number:null==n?void 0:null===(r=n.invoices)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:null===(c=a.Job)||void 0===c?void 0:c.number,itemType:n.type,jobType:null==n?void 0:null===(s=n.invoices)||void 0===s?void 0:null===(u=s[0])||void 0===u?void 0:null===(d=u.Job)||void 0===d?void 0:d.type,invoiceNumber:null==n?void 0:null===(l=n.invoices)||void 0===l?void 0:null===(m=l[0])||void 0===m?void 0:m.invoiceNumber,invoice:(null==n?void 0:n.invoices)?null==n?void 0:null===(v=n.invoices)||void 0===v?void 0:v[0]:null,outstandingAmount:n.outstandingAmount,status:null==n?void 0:null===(p=n.invoices)||void 0===p?void 0:null===(f=p[0])||void 0===f?void 0:null===(h=f.Job)||void 0===h?void 0:h.status,paymentStatus:n.paymentStatus,meta:null==n?void 0:n.meta,assigned:e,actions:""}})},g=function(e){X(h(e))},b=function(){v(!1)},x=function(e){e.preventDefault(),v(!0),i(U.filter(function(e){var n,t;return e.assigned&&!((null===(n=e.meta)||void 0===n?void 0:n.xeroInvoiceId)||(null===(t=e.meta)||void 0===t?void 0:t.xeroCreditNoteId))}).map(function(e){return"creditNote"===e.itemType?{id:e.id,entity:e.itemType}:{entity:e.itemType,invoiceType:e.invoice.invoiceType||null,invoiceId:e.id||null}}),b)},y=(0,s.useRouter)().query,Z={endDate:y.endDate&&new Date(y.endDate),outstandingLevel:y.outstandingLevel,startDate:y.startDate&&new Date(y.startDate),type:["ppmInvoice","proformaInvoice","partial","paid","unpaid"]},I=(0,a.useState)(Z)[0],j=I.endDate,_=I.outstandingLevel,w=I.startDate,R=I.type,C=(0,er.x)({filters:I}),A=C.initialData,N=C.ref,q=(0,T.Z)((0,S.Z)({},A),{limit:25}),k=(0,u.aM)(d.BH,{fetchPolicy:"no-cache",variables:(0,T.Z)((0,S.Z)({},q),{where:(0,T.Z)((0,S.Z)({},(0,en.Io)({outstandingLevel:_,adminId:n,accountId:t,to:j,from:w,locationId:o,type:R})),{_or:[{_and:[{meta:{_is_null:!1}},{_not:{meta:{_has_key:"xeroInvoiceId"}}},{_not:{meta:{_has_key:"xeroCreditNoteId"}}}]},{meta:{_is_null:!0}}]}),locationId:o})}),$=k.data,F=void 0===$?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0},balance:{balance:0}}}}:$,P=F.accountEntries,L=F.meta,E=k.loading,z=k.refetch,B=(0,a.useState)([]),U=B[0],X=B[1];return(0,a.useEffect)(function(){X(h(!1))},[E]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ee.Z,{sx:{color:"#fff",zIndex:function(e){return e.zIndex.drawer+1}},open:l,children:(0,r.jsx)(K.Z,{color:"inherit"})}),(0,r.jsx)(D.Z,{id:"offCanvasForm",handleSubmit:x,children:(0,r.jsx)(eo.t,{columns:f,loading:E,meta:L,ref:N,refetch:z,rows:U,xeroPageSize:25})})]})};es.propTypes={adminId:c.number.isRequired,accountId:c.number.isRequired,locationId:c.number,toggleShow:c.func,onSendEntities:c.func.isRequired};var eu,ed=(0,Z.ZP)(_.Z).withConfig({displayName:"accountEntriesSyncXero__StyledBadge",componentId:"sc-3d48349-0"})(ec(),function(e){return(0,en.Lq)(e.row,e.theme)}),el=t(21300),em=t(13777),ev=(eu=(0,o.Z)(function(e){var n,t,o,r,a,c,s,u,d,l,m;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=e.adminId,t=e.accountId,o=e.locationId,r=e.from,a=e.invoiceNumber,c=e.jobId,s=e.outstandingLevel,[4,{adminId:n,accountId:t,currency:"\xa3",locationId:o,from:r,invoiceNumber:a,jobId:c,outstandingLevel:s,to:u=e.to,type:e.type}];case 1:return l=i.sent(),m=window.open("/download","_blank"),[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/statement/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(l)}).then(function(e){return e.json()}).then(function(e){m.location.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key))}).catch(function(e){(0,em.Tb)({message:e,section:"fetch"})})];case 2:return i.sent(),[2]}})}),function(e){return eu.apply(this,arguments)}),ep=t(86021),ef=t(80695),eh=t(67212),eg=t(29815),eb=t(79665),ex=t(46901),ey=t(77651),eZ=t(73987),eI=t(6710),ej=t(9873),e_=t(14149),ew=t(74231),eR=(0,ew.Ry)().shape({dateReceived:(0,ew.hT)().required(),amountReceived:(0,ew.Rx)().required(),reason:(0,ew.Z_)(),connectedAmount:(0,ew.IX)().of((0,ew.Ry)().shape({id:(0,ew.Rx)().required(),outstandingAmount:(0,ew.Rx)().required(),amount:(0,ew.Rx)().max((0,ew.iH)("outstandingAmount")).min(0).required()})).required()});function eS(){var e=(0,y.Z)(["\n  padding-left: 1rem;\n  padding-right: ",";\n  flex-flow: ",";\n"]);return eS=function(){return e},e}function eT(){var e=(0,y.Z)(["\n  border: 1px solid ",";\n"]);return eT=function(){return e},e}var eC=function(e){var n,t,c=e.type,s=e.accountId,l=e.locationId,g=e.adminId,b=e.jobNumber,x=(e.refetch,e.toggleShow),y=e.numberPrefix,Z=e.numberSuffix,I=e.invoicesForJobOnly,j=e.xeroCompanyId,w=e.xeroUserId,R=e.onSendCreditNotesToXero,N=(0,a.useContext)(eZ.Z).user,P=(0,er.x)({filters:null}),L=P.initialData,E=P.ref,z=(0,a.useState)(!1),B=z[0],U=z[1],X=(0,a.useState)(0),M=X[0],J=X[1],O=(0,a.useState)({error:!1,message:null}),G=O[0],H=O[1],Q=(0,a.useState)(!1),Y=Q[0],ee=Q[1],ea=(0,q.cI)({resolver:(0,eb.S)(eR)}),ec=ea.control,es=ea.errors,eu=ea.getValues,ed=ea.handleSubmit,em=ea.register,ev=ea.setValue,ep=(0,q.Dq)({control:ec,name:"connectedAmount"}).fields,ef=(0,q.qo)({control:ec,name:"amountReceived",defaultValue:0}),eh=(0,u.aM)(d.v8,{variables:(0,T.Z)((0,S.Z)({},L),{where:(0,T.Z)((0,S.Z)({},(0,en.Io)({accountId:s,locationId:l,adminId:g,jobNumber:b?"".concat(b):null,invoiceNumber:b?Number(b):null,type:["proformaInvoice","partial","unpaid"],invoicesForJobOnly:I})),{debit:{_gt:0},outstandingAmount:{_gt:0}}),locationId:l})}),ew=eh.data,eS=void 0===ew?{accountEntries:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:ew,eT=eS.accountEntries,eC=eS.meta,eq=eh.loading,eD=eh.refetch,ek=(0,C.Z)((0,A.D)(d.Vr,{onCompleted:(n=(0,o.Z)(function(e){var n,t;return(0,i.__generator)(this,function(o){switch(o.label){case 0:if(t=null==e?void 0:null===(n=e.insert_AccountEntry_one)||void 0===n?void 0:n.id,!(j&&w&&t))return[3,2];return[4,R(t)];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(e){return n.apply(this,arguments)})}),2),e$=ek[0],eF=ek[1].error,eP=(0,C.Z)((0,A.D)(d._0,{refetchQueries:function(){return["GetAccountEntries"]}}),1)[0],eL=(t=(0,o.Z)(function(e){var n,t,r;return(0,i.__generator)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,,2,3]),ee(!0),Number(M).toFixed(2)>Number(e.amountReceived).toFixed(2))return[2,H({error:!0,message:"You can not reconcile more than credit note amount"})];if(Number(M).toFixed(2)<Number(e.amountReceived).toFixed(2))return[2,H({error:!0,message:"You can not reconcile less than credit note amount"})];return n=e.connectedAmount.filter(function(e){return e.amount>0}),t={accountId:s,balance:0,credit:parseFloat(e.amountReceived).toFixed(2),currencyId:(0,ej.K)(s),debit:0,meta:{paymentReference:e.paymentReference,comment:e.paymentReference},type:"creditNote",paymentStatus:"creditNote",dateReceived:(0,e_.v)(e.dateReceived),PaymentReconciliations:{data:n.map(function(e){var n,t=e.amount;return{creditEntity:"CreditNote",debitEntity:"Invoice",debitEntityId:e.id,locationId:e.locationId,amount:t}})}},[4,e$({variables:{object:t,jobIds:r=n.reduce(function(e,n){if(n.amount!==n.outstandingAmount)return e;var t=eT.find(function(e){return e.id===n.id}).invoices.map(function(e){return e.Job.id});return(0,eg.Z)(e).concat((0,eg.Z)(t))},[]),changes:{status:"".concat(c,"Paid"),paid:!0},timing:r.map(function(e){return{status:"".concat(c,"Paid"),jobId:e,userId:N.id}})}}).then((0,o.Z)(function(){var e,t,o,r,a,c,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:e=!0,t=!1,o=void 0,i.label=1;case 1:i.trys.push([1,6,7,8]),r=n[Symbol.iterator](),i.label=2;case 2:if(e=(a=r.next()).done)return[3,5];return[4,eP({variables:{id:(c=a.value).id,changes:{outstandingAmount:c.outstandingAmount-c.amount,balance:c.outstandingAmount-c.amount}}})];case 3:i.sent(),i.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return s=i.sent(),t=!0,o=s,[3,8];case 7:try{e||null==r.return||r.return()}finally{if(t)throw o}return[7];case 8:return[2]}})}))];case 1:return a.sent(),x(),[3,3];case 2:return ee(!1),[7];case 3:return[2]}})}),function(e){return t.apply(this,arguments)}),eE={control:ec,errors:es,register:em},ez=function(){var e,n=eu();J((null==n?void 0:null===(e=n.connectedAmount)||void 0===e?void 0:e.reduce(function(e,n){return e+Number(n.amount)},0))||0),H({error:!1,message:""})},eB=function(e,n){ev(e,n),ez()},eU=function(e){var n=e.id,t=e.amount,o=e.index,i=e.locationId,a=e.outstandingAmount,c=e.invoices,s=Number(a).toFixed(2)===Number(t).toFixed(2)?"success":"info";return a||(s="danger"),(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},eE),{name:"connectedAmount[".concat(o,"].id"),value:n,type:"hidden"})),(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},eE),{name:"connectedAmount[".concat(o,"].invoices"),value:c,type:"hidden"})),(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},eE),{name:"connectedAmount[".concat(o,"].locationId"),value:i,type:"hidden"})),(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},eE),{name:"connectedAmount[".concat(o,"].outstandingAmount"),value:a,type:"hidden"})),(0,r.jsx)(eN,(0,T.Z)((0,S.Z)({},eE),{context:B?s:null,name:"connectedAmount[".concat(o,"].amount"),onChange:ez,size:"sm",type:"number",step:"0.01",defaultValue:0})),(0,r.jsx)(p.Z,{context:"light","data-tip":"Button",onClick:function(){eB("connectedAmount[".concat(o,"].amount"),a)},size:"xs",title:"copy amount",children:(0,r.jsx)(V.Z,{context:"secondary",icon:"clone",size:"lg"})})]})},eX=(0,a.useMemo)(function(){return[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Number",formatter:function(e){var n=e.row;return"ppmInvoice"===n.type?"PM ".concat(n.invoiceNumber):(0,r.jsx)(ei.D,{id:n.jobId,number:n.jobNumber,invoiceNumber:n.invoiceNumber,numberPrefix:y,numberSuffix:Z,openCanvas:!0,type:n.jobType})}},{sortable:!0,sortName:"createdAt",text:"Date"},{sortable:!0,sortName:"daysOutstanding",text:"Days Outstanding"},{sortable:!0,sortName:"outstandingAmount",text:"Amount Outstanding",formatter:function(e){var n=e.row;return(0,m.Z)(n.outstandingAmount)}},{text:"Reconciled Amount",formatter:function(e){return eU(e.row)}}]},[]),eM=function(e){U(!B)};return((0,a.useEffect)(function(){ev("connectedAmount",eT.map(function(e,n){var t,o,i,r,a=null===(t=e.invoices)||void 0===t?void 0:t[0];return{index:n,id:e.id,type:e.type,jobId:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.id,locationId:e.locationId,jobNumber:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.number,jobType:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.type,invoiceNumber:null==a?void 0:a.invoiceNumber,date:(0,W.Z)(e.createdAt),daysOutstanding:e.outstandingdays,outstandingAmount:e.outstandingAmount,amount:0}}))},[eT]),(0,a.useEffect)(function(){if(B){var e=Number(ef);ep.forEach(function(n,t){var o=e>=n.outstandingAmount?Number(n.outstandingAmount).toFixed(2):Number(e).toFixed(2);e-=o,ev("connectedAmount[".concat(n.index,"].amount"),o)}),ez()}},[ef,B,ep]),(0,a.useEffect)(function(){eF?H({error:!0,message:null==eF?void 0:eF.message}):H(!1)},[eF]),Y)?(0,r.jsx)(f.Z,{style:{justifyContent:"center",alignItems:"center"},children:(0,r.jsx)(K.Z,{size:30})}):(0,r.jsxs)(D.Z,{id:"offCanvasForm",handleSubmit:ed(eL),children:[(0,r.jsx)(ey.Z,{open:null==G?void 0:G.error,autoHideDuration:6e3,onClose:function(){H({error:!1,message:null})},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,r.jsx)(ex.Z,{onClose:function(){return H({error:!1,message:null})},severity:"error",variant:"filled",sx:{width:"500px"},children:(null==G?void 0:G.message)||"Oops some error occurred. Please try again later"})}),(0,r.jsxs)(f.Z,{children:[(0,r.jsxs)(h.Z,{md:6,children:[(0,r.jsx)($.Z,{label:"Date Received"}),(0,r.jsx)(el.M,(0,T.Z)((0,S.Z)({},eE),{name:"dateReceived"}))]}),(0,r.jsx)(h.Z,{md:6,children:(0,r.jsx)(eA,{align:"center",children:(0,r.jsx)(k.Z,(0,T.Z)((0,S.Z)({},eE),{name:"amountReceived",label:"Amount",vat:!0}))})})]}),(0,r.jsx)(f.Z,{children:(0,r.jsx)(h.Z,{md:6,children:(0,r.jsx)($.Z,{label:"Reason",children:(0,r.jsx)(eI.Z,(0,T.Z)((0,S.Z)({},eE),{name:"reason",rows:2}))})})}),(0,r.jsx)($.Z,{label:"Auto reconcile",children:(0,r.jsx)(et.Z,(0,T.Z)((0,S.Z)({},eE),{onToggle:function(e){return eM(e)},size:"sm",toggled:B}))}),(0,r.jsx)(eo.t,{columns:eX,loading:eq,history:!1,meta:eC,ref:E,refetch:eD,rows:ep}),(0,r.jsx)(eA,{reverse:!0,pr:!0,children:(0,r.jsx)(_.Z,{content:"Sum: ".concat((0,m.Z)(M)),context:Number(M).toFixed(2)===Number(ef).toFixed(2)?"success":"danger"})})]})},eA=(0,Z.ZP)(f.Z).withConfig({displayName:"creditNoteForm__StyledRow",componentId:"sc-d856ac14-0"})(eS(),function(e){return e.pr?"5rem":null},function(e){return e.reverse?"row-reverse":null}),eN=(0,Z.ZP)(F.Z).withConfig({displayName:"creditNoteForm__StyledInput",componentId:"sc-d856ac14-1"})(eT(),function(e){return e.theme.COLOUR[e.context]});eC.propTypes={type:(0,c.oneOf)(["customer","supplier"]).isRequired,accountId:c.number.isRequired,locationId:c.number,jobNumber:c.string,numberPrefix:c.string,numberSuffix:c.string,adminId:c.number.isRequired,refetch:c.func.isRequired,toggleShow:c.func.isRequired,invoicesForJobOnly:c.bool.isRequired};var eq=t(51466);function eD(){var e=(0,y.Z)(["\n  align-items: center;\n  display: flex;\n"]);return eD=function(){return e},e}var ek=function(e){var n=e.onFilter,t=(0,a.useState)(["creditNote","partial","paid","paymentReceipt","proformaInvoice","unpaid"]),o=t[0],i=t[1],c=function(e,t){var r;r=t?(0,eg.Z)(o).concat([e]):o.filter(function(n){return n!==e}),n(r),i(r)};return(0,r.jsxs)(f.Z,{children:[(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"dark",onToggle:function(e){return c("creditNote",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Credit Note"})]}),(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"black",onToggle:function(e){return c("paymentReceipt",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Payment"})]}),(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"danger",onToggle:function(e){return c("proformaInvoice",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Proforma Invoice"})]}),(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"danger",onToggle:function(e){return c("unpaid",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Unpaid"})]}),(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"female",onToggle:function(e){return c("partial",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Partially Paid"})]}),(0,r.jsxs)(e$,{md:2,children:[(0,r.jsx)(et.Z,{context:"success",onToggle:function(e){return c("paid",e)},size:"sm",toggled:!0}),(0,r.jsx)(Q.Z,{marginLeft:"sm"}),(0,r.jsx)(eq.Z,{size:"sm",children:"Paid"})]})]})},e$=(0,Z.ZP)(h.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-1eb0cf64-0"})(eD());ek.propTypes={onFilter:c.func.isRequired};var eF=t(6033),eP=t(9492),eL=t(2845),eE=t(18586),ez=t(63139),eB=t(25771),eU=t(56063),eX=t(64872);function eM(){var e=(0,y.Z)(["\n  background-color: ",";\n"]);return eM=function(){return e},e}function eJ(){var e=(0,y.Z)(["\n  float: right;\n"]);return eJ=function(){return e},e}var eO=function(e){var n,t,c,l,b,x,y=e.type,Z=e.accountId,I=e.accountName,w=e.edit,R=e.locationId,A=e.xeroUserId,N=e.xeroCompanyId,k=e.showXeroSyncButton,$=e.onClickXeroSync,P=e.onSendEntitiesToXero,L=e.onSendPaymentToXero,E=e.onReceiveUpdatesFromXero,z=(0,a.useState)(!1),B=z[0],U=z[1],J=(0,eX.a)(),ee=(0,eL.x)().user,et=(0,X.x)(),ec=ee.adminId,eu=(0,eE.q)(),ed=null===(n=eu.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,em=null===(t=eu.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,eg=(0,s.useRouter)().query,eb={endDate:eg.endDate&&new Date(eg.endDate),outstandingLevel:eg.outstandingLevel,startDate:eg.startDate&&new Date(eg.startDate),type:["creditNote","paymentReceipt","proformaInvoice","ppmInvoice","partial","paid","unpaid"]},ex=(0,a.useState)(eb),ey=ex[0],eZ=ex[1],eI=ey.endDate,ej=ey.invoiceNumber,e_=ey.outstandingLevel,ew=ey.startDate,eR=ey.type,eS=ey.paymentStatus,eT=(0,er.x)({filters:ey}),eA=eT.initialData,eN=eT.ref,eq=(0,q.cI)({defaultValues:{endDate:eI,invoiceNumber:ej,outstandingLevel:e_,startDate:ew}}),eD=eq.control,e$=eq.errors,eM=eq.handleSubmit,eJ=eq.register,eO=/^\d+$/.test(ej),eW=(0,u.aM)(d.v8,{fetchPolicy:"no-cache",variables:(0,T.Z)((0,S.Z)({},eA),{where:(0,S.Z)({},(0,en.Io)({outstandingLevel:e_,adminId:ec,accountId:Z,to:eI,from:ew,locationId:R,jobNumber:eO?"".concat(ej):null,type:eR})),locationId:R})}),eH=eW.data,eQ=void 0===eH?{accountEntries:[],balances:[],meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0},balance:{balance:0}}}}:eH,eY=eQ.accountEntries,eK=eQ.meta,e0=eW.loading,e1=eW.refetch,e2=eK.aggregate.debitTotal.debit,e3=eK.aggregate.creditTotal.credit,e6=function(){J.show({content:(0,r.jsx)(eh.q,{type:y,accountId:Z,locationId:R,adminId:ec,refetch:e1,numberPrefix:ed,numberSuffix:em,toggleShow:J.close,invoicesForJobOnly:!1,xeroUserId:A,xeroCompanyId:N,onSendPaymentToXero:L}),title:"Add Payment Received",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e5=function(){J.show({content:(0,r.jsx)(eC,{type:y,accountId:Z,locationId:R,adminId:ec,refetch:e1,toggleShow:J.close,numberPrefix:ed,numberSuffix:em,xeroUserId:A,xeroCompanyId:N,onSendCreditNotesToXero:ne}),title:"Add credit note",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e4=function(){J.show({content:(0,r.jsx)(es,{accountId:Z,locationId:R,adminId:ec,toggleShow:J.close,onSendEntities:nn}),title:"Send Account Entries to Xero",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},e8=function(e){var n=e.adminId,t=e.endDate,o=e.accountId,i=e.invoiceNumber,a=e.locationId,c=e.outstandingLevel,s=e.startDate,u=e.queryIsNumber,l=e.type,m=e.showXeroSyncButton,v=e.onClickXeroSync,f=(0,C.Z)((0,M.t)(d.UA,{variables:{where:(0,S.Z)({},(0,en.Io)({outstandingLevel:c,adminId:n,accountId:o,to:t,from:s,locationId:a,jobNumber:u?"".concat(i):null,type:l})),locationId:a},onCompleted:function(e){var n=(0,en.yG)(e.accountEntries,{numberPrefix:ed,numberSuffix:em}),t=O().unparse(n),o="data:application/octet-stream,"+encodeURIComponent(t);(0,eP.S)(o,"account-entries.csv")}}),2),h=f[0],g=f[1].loading,b=function(){ev({adminId:n,accountId:o,locationId:a,from:s,invoiceNumber:u?Number(i):null,jobId:u?"".concat(i):null,outstandingLevel:c>0?c:null,to:t,type:l})};return(0,r.jsxs)(eG,{children:[!!A&&m&&(0,r.jsx)(p.Z,{context:"info",style:{marginRight:"10px"},onClick:function(e){e.preventDefault(),e.stopPropagation(),v()},title:"Login Xero",size:"md",children:"Connect to Xero"}),!!A&&!m&&(0,r.jsx)(p.Z,{context:"info",style:{marginRight:"10px"},onClick:function(e){e.preventDefault(),e.stopPropagation(),e4()},title:"Group sync Entries with Xero",size:"md",children:"Send Account Entries to Xero"}),!(0,ez.s)()&&(0,r.jsx)(p.Z,{disabled:g,context:"white",onClick:function(e){e.preventDefault(),e.stopPropagation(),h()},title:"Export to CSV",size:"md",children:g?(0,r.jsx)(K.Z,{size:30}):(0,r.jsx)(V.Z,{context:"secondary",icon:"file-csv",size:"lg"})}),(0,r.jsx)(p.Z,{disabled:!0,context:"white",onClick:function(e){e.preventDefault(),e.stopPropagation(),b()},title:"Export to PDF",children:(0,r.jsx)(V.Z,{context:"secondary",icon:"file-pdf",size:"lg"})})]})},e7=(c=(0,o.Z)(function(e,n){var t,o,r,a,c,s,u,d,l,m,v;return(0,i.__generator)(this,function(i){switch(i.label){case 0:switch(e.preventDefault(),e.stopPropagation(),o=void 0===(t=n.invoice)?{}:t,r=n.itemType){case"proformaInvoice":return[3,1];case"invoice":return[3,3];case"ppmInvoice":return[3,4]}return[3,6];case 1:return[4,et.query({query:eB.WG,variables:{id:o.id}})];case 2:return u=i.sent().data.invoice,(0,ef.u)({meta:null==u?void 0:null===(a=u.accountEntry)||void 0===a?void 0:a.meta,invoice:u}),[3,7];case 3:return(0,ep._Z)({client:et,jobId:n.jobId,type:o.invoiceType}),[3,7];case 4:return[4,et.query({query:eB.By,variables:{jobId:n.jobId,invoiceType:o.invoiceType}})];case 5:return v=null==(m=i.sent().data.invoices)?void 0:m[0],(0,eU.$)(null==v?void 0:null===(d=v.accountEntry)||void 0===d?void 0:d.meta),[3,7];case 6:return[3,7];case 7:return[2]}})}),function(e,n){return c.apply(this,arguments)}),e9=(l=(0,o.Z)(function(e,n){var t,o,r,a,c;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return e.preventDefault(),e.stopPropagation(),t=n.id,o=n.itemType,a=void 0===(r=n.invoice)?[]:r,c=[],"creditNote"===o?c.push({entity:"creditNote",id:t}):c.push({entity:o,invoiceType:a.invoiceType||null,invoiceId:t||null}),[4,nn(c)];case 1:return i.sent(),[2]}})}),function(e,n){return l.apply(this,arguments)}),ne=(b=(0,o.Z)(function(e){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return U(!0),[4,nn([{entity:"creditNote",id:e}])];case 1:return n.sent(),[2]}})}),function(e){return b.apply(this,arguments)}),nn=(x=(0,o.Z)(function(e,n){return(0,i.__generator)(this,function(t){return U(!0),P({accountId:Z,entities:e}).then(function(){e1(),U(!1),J.close(),n&&n()}),[2]})}),function(e,n){return x.apply(this,arguments)}),nt=[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row,t=e.row.itemType;return(0,r.jsx)(eV,{content:t,row:n,size:"sm"})},text:"Type"},{hidden:!0},{text:"Number",formatter:function(e){var n=e.row;return"ppmInvoice"===n.itemType?"PM ".concat(null==n?void 0:n.invoiceNumber):(0,r.jsx)(ei.D,{id:n.jobId,number:n.number,invoiceNumber:null==n?void 0:n.invoiceNumber,numberPrefix:ed,numberSuffix:em,openCanvas:!!n.jobId,type:n.jobType})}},{hidden:!0},{text:"Reference"},{hidden:!0},{text:"Date"},{hidden:!w,text:"Days Outstanding"},{hidden:!0,text:"Service"},{hidden:!0},{text:"Amount Outstanding",formatter:function(e){var n=e.row;return"creditNote"===n.itemType||"paymentReceipt"===n.itemType?"-":(0,m.Z)(n.outstandingAmount)}},{text:"Status",formatter:function(e){var n=e.row;return n.status?(0,r.jsx)(ea.B,{value:n.status}):""}},{text:"Debit",formatter:function(e){var n=e.row;return n.debit?(0,m.Z)(n.debit):"-"}},{text:"Credit",formatter:function(e){var n=e.row;return n.credit?(0,m.Z)(n.credit):"-"}},{text:"Balance",formatter:function(e){var n=e.row;return(0,m.Z)(n.balance)}},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:G.Z,formatterData:function(e){var n,t,o,i,r=[{context:"secondary",icon:["fas","download"],onClick:function(e,n){return e7(e,n)},tooltip:"Download",disabled:"creditNote"===e.itemType||"paymentReceipt"===e.itemType}];return A&&!((null===(n=e.meta)||void 0===n?void 0:n.xeroInvoiceId)||(null===(t=e.meta)||void 0===t?void 0:t.xeroCreditNoteId))&&"paymentReceipt"!==e.itemType&&"creditNote"!==e.itemType&&r.unshift({context:"primary",icon:["fas","circle"],onClick:function(e,n){return e9(e,n)},tooltip:"Sync invoice with Xero",disabled:k||B}),A&&(null===(o=e.meta)||void 0===o?void 0:o.xeroInvoiceId)&&(r.unshift({context:"primary",icon:["fas","check"],tooltip:"Sync",disabled:!0}),(null===(i=e.meta)||void 0===i?void 0:i.syncedWithXero)||r.unshift({context:"info",icon:["fas","circle"],onClick:function(e,n){return E(e,n)},tooltip:"Invoice has changes in Xero. Click to update it in Cleverly"})),r},text:"Actions"}],no=function(e){J.show({content:(0,r.jsx)(Y.u,{type:y,accountEntryType:e.itemType,data:e,numberSuffix:em,numberPrefix:ed,refetch:e1,toggleShow:J.close}),title:"Account Entry Details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},ni=function(e){e.invoiceNumber||e.startDate||e.endDate||e.outstandingLevel?eZ((0,T.Z)((0,S.Z)({},ey),{endDate:e.endDate,invoiceNumber:e.invoiceNumber?e.invoiceNumber:null,outstandingLevel:e.outstandingLevel,startDate:e.startDate})):Array.isArray(e)?eZ((0,T.Z)((0,S.Z)({},ey),{type:e})):eZ(eb)},nr={control:eD,errors:e$,register:eJ};return(0,r.jsxs)(g.Z,{open:!0,title:"Account Entries",toolbar:(0,r.jsx)(e8,{adminId:ec,accountId:Z,accountName:I,endDate:eI,invoiceNumber:ej,locationId:R,outstandingLevel:e_,startDate:ew,queryIsNumber:eO,type:eR,paymentStatus:eS,showXeroSyncButton:k,onClickXeroSync:$}),children:[(0,r.jsxs)(D.Z,{handleSubmit:eM(ni),children:[(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(h.Z,{md:2,children:(0,r.jsx)(el.M,(0,T.Z)((0,S.Z)({},nr),{name:"startDate",placeholder:"Start date"}))}),(0,r.jsx)(h.Z,{md:2,children:(0,r.jsx)(el.M,(0,T.Z)((0,S.Z)({},nr),{name:"endDate",placeholder:"End date"}))}),(0,r.jsx)(h.Z,{md:3,children:(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},nr),{name:"invoiceNumber",placeholder:"Id / Invoice"}))}),(0,r.jsx)(h.Z,{md:3,children:(0,r.jsx)(H.Z,(0,T.Z)((0,S.Z)({},nr),{name:"outstandingLevel",options:eF.r}))}),(0,r.jsx)(h.Z,{md:1,children:(0,r.jsx)(p.Z,{content:"Filter",context:"secondary",size:"sm",type:"submit"})})]}),(0,r.jsx)(Q.Z,{marginBottom:"md"}),(0,r.jsx)(ek,{onFilter:ni})]}),(0,r.jsx)(eo.t,{columns:nt,loading:e0,meta:eK,ref:eN,refetch:e1,rowClick:no,rows:eY.map(function(e){var n,t,o,i,r,a,c,s,u,d,l,m,v,p="creditNote"!==e.type&&"paymentReceipt"!==e.type?e.outstandingdays:"-",f=null===(n=e.invoices)||void 0===n?void 0:n[0];return{id:e.id,jobId:null==f?void 0:null===(t=f.Job)||void 0===t?void 0:t.id,jobIds:null===(o=e.invoices)||void 0===o?void 0:o.map(function(e){var n;return null==e?void 0:null===(n=e.job)||void 0===n?void 0:n.id}),number:null==f?void 0:null===(i=f.Job)||void 0===i?void 0:i.number,itemType:e.type,jobType:null==f?void 0:null===(r=f.Job)||void 0===r?void 0:r.type,invoiceNumber:null==f?void 0:f.invoiceNumber,invoice:f,reference:e.reference||(null===(a=e.meta)||void 0===a?void 0:a.paymentReference),comment:null===(c=e.meta)||void 0===c?void 0:c.comment,date:(0,W.Z)(e.createdAt),outstandingDays:p,service:null==f?void 0:null===(s=f.Job)||void 0===s?void 0:null===(u=s.service)||void 0===u?void 0:u.name,address:null==f?void 0:null===(d=f.Job)||void 0===d?void 0:null===(l=d.location)||void 0===l?void 0:l.name,outstandingAmount:e.outstandingAmount,status:null==f?void 0:null===(m=f.Job)||void 0===m?void 0:m.status,debit:e.debit,credit:e.credit,balance:e.balance,paid:null==f?void 0:null===(v=f.Job)||void 0===v?void 0:v.paid,paymentStatus:e.paymentStatus,entryId:e.entryId,meta:e.meta,actions:""}})}),(0,r.jsx)(Q.Z,{marginBottom:"md"}),(0,r.jsx)(f.Z,{children:(0,r.jsxs)(h.Z,{md:12,style:{textAlign:"end"},children:[(0,r.jsx)(_.Z,{content:"Total Debit: ".concat((0,m.Z)(e2)),context:"info",size:"sm"}),(0,r.jsx)(_.Z,{content:"Total Credit: ".concat((0,m.Z)(e3)),context:"info",size:"sm"}),(0,r.jsx)(_.Z,{content:"Balance:".concat((0,m.Z)(e2-e3)),context:"".concat(e2-e3<0?"warning":"success"),size:"sm"})]})}),(0,r.jsx)(j.Z,{size:"sm"}),(0,r.jsx)(v.Z,{align:"flex-end",children:w&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{content:"Add Payment Received",context:"secondary",onClick:e6,size:"sm"}),"customer"===y&&(0,r.jsx)(p.Z,{content:"Add Credit note",context:"secondary",onClick:e5,size:"sm"})]})})]})},eV=(0,Z.ZP)(_.Z).withConfig({displayName:"accountEntries__StyledBadge",componentId:"sc-ab805788-0"})(eM(),function(e){return(0,en.Lq)(e.row,e.theme)}),eG=Z.ZP.div.withConfig({displayName:"accountEntries__StyledToolbar",componentId:"sc-ab805788-1"})(eJ());eO.propTypes={type:(0,c.oneOf)(["customer","supplier"]).isRequired,accountId:c.number.isRequired,accountName:c.string,edit:c.bool,jobsRefetch:c.func,locationId:c.number,xeroUserId:c.string,xeroCompanyId:c.string,showXeroSyncButton:c.bool,onClickXeroSync:c.func,onSendEntitiesToXero:c.func},eO.defaultProps={edit:!0};var eW=t(14924),eH=t(99534),eQ=t(32979),eY=(0,ew.Ry)().shape({serviceRateType:(0,ew.Z_)().when("rateType",{is:"serviceRate",then:(0,ew.Z_)().oneOf(["grossPercent","costPlus"]).required("This field is required!")}),serviceRateLabour:(0,ew.Rx)().when("rateType",{is:"serviceRate",then:(0,ew.Rx)().min(0).required()}),serviceRateExpenses:(0,ew.Rx)().when("rateType",{is:"serviceRate",then:(0,ew.Rx)().min(0).required()}),arrangementFee:(0,ew.Rx)().when("rateType",{is:"rebate",then:(0,ew.Rx)().min(0).lessThan(100,"Rebate can`t be more than 99.99%").required()}),approvalThreshold:(0,ew.Rx)().min(0).required(),spendThreshold:(0,ew.Rx)().min(0).required(),invoiceDueDate:(0,ew.Rx)().min(0).required()}),eK=t(66321),e0=t(9928),e1=t(21023),e2=t(48999),e3=t(5616),e6=t(10166),e5=function(e){var n,t=e.accountId,a=e.meta,c=e.refetch,s=e.toggleShow,u=(0,X.x)(),d=(0,S.Z)({},null==a?void 0:a.finance)||{},l=(0,q.cI)({defaultValues:{approvalThreshold:d.approvalThreshold||0,arrangementFee:d.arrangementFee||0,serviceRateLabour:d.serviceRateLabour||0,serviceRateExpenses:d.serviceRateExpenses||0,spendThreshold:d.spendThreshold||0,invoiceDueDate:d.invoiceDueDate||0,rateType:(d.serviceRateLabour||d.serviceRateExpenses)&&"serviceRate"||d.arrangementFee&&"rebate",serviceRateType:d.serviceRateType},resolver:(0,eb.S)(eY)}),m=l.errors,v=l.handleSubmit,p=l.register,f=l.watch,h=l.control,g=(0,C.Z)((0,A.D)(N.Wn,{onCompleted:(0,o.Z)(function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,(0,e0.j)({client:u,customerId:t})];case 1:return e.sent(),[2]}})})}),1)[0],b=(n=(0,o.Z)(function(e){return(0,i.__generator)(this,function(n){return g({variables:{customerId:t,customer:y(e),hasUpdateUser:!1,userId:t}}).then(function(){c(),s()}),[2]})}),function(e){return n.apply(this,arguments)}),x=f("rateType"),y=function(e){var n={};return n.meta=(0,S.Z)({},a)||{},n.meta.finance=d||{},"serviceRate"===x?(n.meta.finance.serviceRateType=e.serviceRateType,n.meta.finance.serviceRateLabour=e.serviceRateLabour,n.meta.finance.serviceRateExpenses=e.serviceRateExpenses,n.meta.finance.arrangementFee=0):"rebate"===x&&(n.meta.finance.serviceRateLabour=0,n.meta.finance.serviceRateExpenses=0,n.meta.finance.arrangementFee=e.arrangementFee),n.meta.finance.approvalThreshold=e.approvalThreshold,n.meta.finance.spendThreshold=e.spendThreshold,n.meta.finance.invoiceDueDate=e.invoiceDueDate,n},Z={errors:m,register:p,type:"number"},I={direction:"row",sx:{"& .MuiTypography-root":{fontFamily:"Arial,sans-serif,sans-serif"}}},j=function(e){return function(n){var t=n.children;return(0,r.jsx)(e4,{title:e,children:t})}};return(0,r.jsxs)(D.Z,{id:"offCanvasForm",handleSubmit:v(b),children:[(0,r.jsx)(e3.Z,{children:(0,r.jsx)(q.Qr,{name:"rateType",control:h,render:function(e){var n,t=e.value,o=e.onChange;return(0,r.jsx)(eK.E,{stackProps:I,formControlProps:{sx:{m:0}},value:t,onChange:o,options:[{label:"Service Rate",value:"serviceRate"},{label:"Rebate",value:"rebate"}],error:m.rateType,helperText:null===(n=m.rateType)||void 0===n?void 0:n.message})}})}),"serviceRate"===x&&(0,r.jsxs)(e3.Z,{children:[(0,r.jsx)(q.Qr,{name:"serviceRateType",control:h,render:function(e){var n,t=e.value,o=e.onChange;return(0,r.jsx)(eK.E,{stackProps:I,formControlProps:{sx:{m:0}},value:t,onChange:o,options:[{label:"% of Gross",value:"grossPercent",ParentComponent:j("This will calculate your service rate as a % of the customer invoice e.g.\n                      if this is 5%, you will earn \xa35 on a \xa3100 customer invoice.")},{label:"Cost plus",value:"costPlus",ParentComponent:j("Cost plus will add the percentage indicated to the supplier amount e.g.\n                      if this is 5% on a \xa3100 supplier invoice, customer invoice will be \xa3105.")}],error:m.serviceRateType,helperText:null===(n=m.serviceRateType)||void 0===n?void 0:n.message})}}),(0,r.jsxs)($.Z,{label:"Service Rate",children:[(0,r.jsx)(eQ.Z,(0,T.Z)((0,S.Z)({},Z),{label:"Labour",name:"serviceRateLabour"})),(0,r.jsx)(eQ.Z,(0,T.Z)((0,S.Z)({},Z),{label:"Expenses and Materials",name:"serviceRateExpenses"}))]})]}),"rebate"===x&&(0,r.jsx)(eQ.Z,(0,T.Z)((0,S.Z)({},Z),{label:"Rebate",name:"arrangementFee"})),(0,r.jsx)(k.Z,(0,T.Z)((0,S.Z)({},Z),{label:"Approval Threshold",name:"approvalThreshold"})),(0,r.jsx)(k.Z,(0,T.Z)((0,S.Z)({},Z),{label:"Spend Threshold",name:"spendThreshold"})),(0,r.jsx)($.Z,{label:"Invoice Due Date",children:(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},Z),{name:"invoiceDueDate"}))})]})};e5.propTypes={meta:c.object,refetch:c.func.isRequired,toggleShow:c.func.isRequired};var e4=(0,e6.Z)(function(e){var n=e.className,t=(0,eH.Z)(e,["className"]);return(0,r.jsx)(e1.Z,(0,T.Z)((0,S.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,eW.Z)({},"& .".concat(e2.Z.tooltip),{backgroundColor:n.palette.dark.main,boxShadow:n.shadows[1],fontSize:13})}),e8=(0,ew.Ry)().shape({code:(0,ew.Z_)()}),e7=function(e){var n,t=e.onSuccess,a=e.meta,c=e.accountId,s={code:null==a?void 0:a.sageCode},u=(0,q.cI)({defaultValues:s,resolver:(0,eb.S)(e8)}),d=u.control,l=u.errors,m=u.handleSubmit,v=u.register,p=(0,C.Z)((0,A.D)(N.Wn,{onCompleted:t}),2),f=p[0],h=p[1].error,g=(n=(0,o.Z)(function(e){var n,t;return(0,i.__generator)(this,function(o){return n=e.code,(t=(0,S.Z)({},a)||{}).sageCode=n,f({variables:{customerId:c,customer:{meta:t}}}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(D.Z,{id:"offCanvasForm",handleSubmit:m(g),children:[(0,r.jsx)($.Z,{label:"Sage Code",children:(0,r.jsx)(F.Z,(0,T.Z)((0,S.Z)({},{control:d,errors:l,register:v}),{name:"code"}))}),(0,r.jsx)(eq.Z,{children:null==h?void 0:h.message})]})};e7.propTypes={accountId:c.number.isRequired,meta:c.object,onSuccess:c.func.isRequired};var e9=t(41255),ne=function(e){var n,t,c=e.type,y=e.accountId,Z=e.accountName,I=e.accountRefetch,j=e.locationId,_=e.meta,w=e.hasSageIntegration,R=(0,a.useState)(!1),S=R[0],T=R[1],C=(0,s.useRouter)().query,A=(0,eL.x)(),N=A.hasRole,q=A.user,D=(0,e9.RM)(null==q?void 0:q.id),k=(0,eX.a)(),$=(0,a.useContext)(l.Z),F=N("admin"),P=(0,u.aM)(d.Dn,{variables:{accountId:y}}),L=P.data,E=(void 0===L?{financial:{}}:L).financial,z=P.loading,U=P.refetch,X=(0,e9.BR)({adminId:q.id,xeroClientId:null==C?void 0:C.clientId,onSaveXeroTokenCallback:function(){return U()}},[q]),M=X.tokenStatus,J=X.onCallAuthorize,O=X.onCallRefreshToken,V=X.onSendEntitiesToXero,G=X.onSendPaymentToXero,W=X.onReceiveUpdatesFromXero;(0,a.useEffect)(function(){"unauthenticated"===M||"disconnected"===M?T(!0):T(!1)},[M]);var H=(null==_?void 0:_.finance)||{},Q=E.bankAccounts,Y=function(){$.close(),I()},K=function(e){e.stopPropagation(),$.show({content:(0,r.jsx)(e7,{meta:_,onSuccess:Y,accountId:y}),title:(null==_?void 0:_.sageCode)?"Add Sage Code":"Update Sage Code"})},ee=function(e){e.stopPropagation(),k.show({content:(0,r.jsx)(e5,{accountId:y,meta:_,refetch:I,toggleShow:k.close}),title:"Edit Finance Details"})};if(z)return null;var en,et,eo,ei=function(){return(0,r.jsx)(v.Z,{children:(0,r.jsx)(p.Z,{context:"secondary",content:"Edit",onClick:ee,size:"sm"})})},er=function(){return(0,r.jsx)(v.Z,{children:(0,r.jsx)(p.Z,{context:"secondary",content:"Edit",onClick:K,size:"sm"})})},ea=(en=(0,o.Z)(function(e,n){var t,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return e.preventDefault(),e.stopPropagation(),[4,W((null===(t=n.meta)||void 0===t?void 0:t.xeroInvoiceId)||(null===(o=n.meta)||void 0===o?void 0:o.xeroCreditNoteId),null==D?void 0:D.companyId,y)];case 1:return i.sent(),U(),[2]}})}),function(e,n){return en.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{children:(0,r.jsx)(h.Z,{md:12,children:(0,r.jsx)(eO,{type:c,accountId:y,accountName:Z,edit:F,locationId:j,meta:_,xeroCompanyId:null==D?void 0:D.companyId,xeroUserId:null==D?void 0:D.clientId,refetchXeroToken:O,showXeroSyncButton:S,onSendEntitiesToXero:V,onClickXeroSync:function(){return J(window.location.href)},onSendPaymentToXero:G,onReceiveUpdatesFromXero:ea})})}),N("admin")&&(0,r.jsxs)(f.Z,{children:[(0,r.jsxs)(h.Z,{md:"customer"===c?6:12,children:["customer"===c&&(0,r.jsx)(g.Z,{toolbar:F&&(0,r.jsx)(ei,{}),title:"Overview",open:!0,children:(0,r.jsx)(b.Z,{rows:[{key:"Service Rate Labour",value:"".concat(H.serviceRateLabour||0,"%")},{key:"Service Rate Expenses and Materials",value:"".concat(H.serviceRateExpenses||0,"%")},{key:"Rebate",value:"".concat((null==H?void 0:H.arrangementFee)||0,"%")},{key:"Approval Threshold",value:(0,m.Z)(null!==(n=null==H?void 0:H.approvalThreshold)&&void 0!==n?n:0)},{key:"Spend Threshold",value:(0,m.Z)(null!==(t=null==H?void 0:H.spendThreshold)&&void 0!==t?t:0)},{key:"Stripe ID",value:H.stripeId||"-"},{key:"Invoice Due Date",value:H.invoiceDueDate||"-"}]})}),(0,r.jsx)(x.y,{accountId:y,data:Q,edit:F,refetch:I}),"customer"===c&&(0,r.jsx)(g.Z,{toolbar:(0,r.jsx)(er,{}),title:"Integration",open:!0,children:(0,r.jsx)(b.Z,{rows:(eo=[],w&&eo.push({key:"Sage Code",value:(null==_?void 0:null===(et=_.sageCode)||void 0===et?void 0:et.length)>0?null==_?void 0:_.sageCode:"not set"}),eo)})})]}),(0,r.jsxs)(h.Z,{md:6,children:["customer"===c&&(0,r.jsx)(g.Z,{title:"Balance",open:!0,children:(0,r.jsx)(b.Z,{rows:[{key:"Total Outstanding",value:(0,m.Z)(H.amountOutstanding||0)},{key:"Total Revenues",value:(0,m.Z)(H.totalRevenue||0)}]})}),"customer"===c&&(0,r.jsx)(B,{accountId:y,edit:F,meta:_,offCanvas:k,refetch:I,customerBalance:0})]})]})]})};ne.propTypes={type:(0,c.oneOf)(["customer","supplier"]).isRequired,accountId:c.number.isRequired,accountName:c.string.isRequired,accountRefetch:c.func.isRequired,locationId:c.number.isRequired,meta:c.object.isRequired}},55862:function(e,n,t){t.d(n,{J:function(){return I}});var o=t(26042),i=t(69396),r=t(99534),a=t(828),c=t(85893),s=t(11163),u=t(67294),d=t(45697),l=t(9270),m=t(62140),v=t(42283),p=t(76600),f=t(11585),h=t(49501),g=t(75903),b=t(77439),x=t(25742),y=t(59938),Z=function(e){var n=e.initialValues,t=e.renderFilters,r=e.setFilters,s=e.lastQuery,d=e.filters,Z=(0,a.Z)((0,y.X)("form_data_".concat(n.filterType),n),2),I=Z[0],j=Z[1],_=(0,v.cI)({defaultValues:I||n}),w=_.control,R=_.errors,S=_.handleSubmit,T=_.register,C=_.reset,A=_.watch,N=_.setValue,q=A(),D=(0,i.Z)((0,o.Z)({},q),{filterType:n.filterType});(0,u.useEffect)(function(){C(D)},[C]),(0,u.useEffect)(function(){j(D)},[d]);var k=function(e){var t=e.query;if(t!==s){var i={q:"%".concat(t,"%")||0},a=/^\d+$/.test(t);"id"in n&&(i.id=a?Number(t):null),"meta"in n&&(i.meta=a?{invoiceNumbers:[t]}:null),"jobNumber"in n&&(i.jobNumber=a?String(t):null,i.invoiceNumber=a?Number(t):null),r(function(e){return(0,o.Z)({},e,i)})}},$=function(e){Object.keys(n).map(function(e){return N(e,null)}),r(n),C(n),k("")};return(0,c.jsx)(p.Z,{handleSubmit:S(k),children:(0,c.jsxs)(f.Z,{title:"Filters",children:[(0,c.jsxs)(l.Z,{children:[(0,c.jsx)(m.Z,{sm:12,lg:12,children:(0,c.jsx)(h.Z,{label:"",children:(0,c.jsx)(g.Z,{errors:R,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:T,type:"search"})})}),(0,c.jsx)(m.Z,{sm:12,lg:12,children:t({control:w,errors:R,initialValues:n,register:T,setFilters:r,watch:A,setValue:N,reset:C})})]}),(0,c.jsx)(x.H,{content:"Search",context:"secondary",handleClick:k,type:"submit",children:(0,c.jsx)(b.Z,{content:"Clear",context:"danger",onClick:$,size:"sm"})})]})})};Z.propTypes={initialValues:d.object,renderFilters:d.func.isRequired,setFilters:d.func.isRequired};var I=function(e){var n=e.FiltersComp,t=e.initialFilters,d=e.TableComp,v=(0,r.Z)(e,["FiltersComp","initialFilters","TableComp"]),p=(0,a.Z)((0,y.X)("form_data_".concat(t.filterType),t),2),f=p[0],h=p[1],g=(0,u.useState)(f||t),b=g[0],x=g[1],I=(0,s.useRouter)().query.show;return(0,u.useEffect)(function(){h(b)},[b,h]),(0,c.jsx)(l.Z,{children:(0,c.jsxs)(m.Z,{sm:12,lg:12,children:[(0,c.jsx)(Z,{initialValues:t,renderFilters:function(e){return(0,c.jsx)(n,(0,i.Z)((0,o.Z)({},e,v),{show:I}))},setFilters:x,filters:b}),(0,c.jsx)(d,(0,o.Z)({filters:b,initialFilters:t},v))]})})};I.propTypes={FiltersComp:d.func,initialFilters:d.object.isRequired,TableComp:d.func}}}]);