"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{46929:function(e,t,n){n.d(t,{r:function(){return s}});var i=n(85893),r=n(45697),a=n(95103),s=function(e){var t=e.errors,n=e.name,r=e.onChange,s=e.options,o=e.register;return(0,i.jsx)(a.Z,{errors:t,name:n,onChange:r,options:s,register:o})};s.propTypes={errors:r.object.isRequired,name:r.string,onChange:r.func,options:r.array.isRequired,register:r.func.isRequired},s.defaultProps={name:"status"}},91272:function(e,t,n){n.d(t,{t:function(){return l}});var i=n(85893),r=n(67294),a=n(45697),s=n(11163),o=n(46003),u=n(8500),l=(0,r.forwardRef)(function(e,t){var n=e.columns,a=e.history,l=e.initialSort,c=e.loading,d=e.meta,p=e.paginationSize,m=e.refetch,f=e.submissionsRefetch,v=e.rowClick,h=e.rows,g=e.xeroPageSize,y=(0,s.useRouter)(),Z=y.query,b=void 0===Z?{}:Z,x=(0,r.useState)(parseInt(null==b?void 0:b.page,10)||1),j=x[0],S=x[1],T=(0,r.useState)(g||o.C1.paginationSize),I=T[0],C=T[1];l||(l={item:"createdAt",order:"desc"});var q=(0,r.useState)({item:l.item,order:l.order}),w=q[0],k=q[1],_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var i=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(i)},F=function(){k({item:l.item,order:l.order}),S(1);var e=_();y.push(e),C(g||o.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:j,pageSize:I,sort:w,resetPagination:function(){F()}}});var O=function(e){var t=_(e);a&&y.push(t),S(e),!a&&m&&m()&&f&&f()},Q=function(e){e!==o.C1.paginationSize&&(C(e),m&&m()&&f&&f())},R=function(e){var t;k({item:e.item,order:e.order}),m&&m()&&f&&f()};return(0,i.jsx)(u.Z,{columns:n,loading:c,paginationSize:p,pagination:d&&!0,paginationProps:d&&{currentPage:j,onPageChange:O,onPageSizeChange:Q,pageCount:Math.ceil(d.aggregate.totalCount/I),perPage:I},rowClick:v,rows:h,sort:w,setSort:R})});l.propTypes={columns:a.array.isRequired,history:a.bool,initialSort:a.object,loading:a.bool,meta:a.object,refetch:a.func,submissionsRefetch:a.func,rowClick:a.func,rows:a.array.isRequired},l.defaultProps={history:!0,loading:!0,paginationSize:!1}},23390:function(e,t,n){n.d(t,{R:function(){return g}});var i=n(26042),r=n(69396),a=n(85893),s=n(45697),o=n(6388),u=n(42575),l=n(68956),c=n(74297),d=n(25742),p=n(70616),m=n(91272),f=n(20705),v=n(64872),h={item:"name",order:"asc"},g=function(e){var t=e.entity,n=e.entityId,s=e.refetchCompliance,g=e.parentId,y=e.type,Z=(0,v.a)(),b=(0,f.x)({filters:{},initialSort:h}),x=b.initialData,j=b.ref,S=(0,r.Z)((0,i.Z)({},x),{parentId:g}),T=(0,o.aM)(u.Im,{variables:S}),I=T.data,C=void 0===I?{taxonomy:[],meta:{aggregate:{totalCount:0}}}:I,q=C.taxonomy,w=C.meta,k=T.loading,_=T.refetch,F=function(){_(),s&&s(),Z.close()},O=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(0,r.Z)((0,i.Z)({},s),{type:y});"assetQuestion"!==y||o.id||(o.name="assetQuestionField-".concat(q.length)),Z.show({title:s.id?"Edit":"Add",content:(0,a.jsx)(p.j,{entity:t,entityId:n,defaultValues:o,onSuccess:F,groups:{},parentId:g})})},Q=function(e){var t;return[{context:"secondary",disabled:null===(t=e.data.meta)||void 0===t?void 0:t.isSystem,icon:["fas","edit"],onClick:function(e,t){return O("edit",t.data)},tooltip:"Edit"}]},R=[{hidden:!0},{hidden:!0},{text:"Name",formatter:function(e){var t,n,i=e.row;return"assetQuestion"===y?null==i?void 0:null===(t=i.data)||void 0===t?void 0:null===(n=t.meta)||void 0===n?void 0:n.label:i.name}},{hidden:!0},{text:"Status"},{formatter:l.Z,formatterData:Q,text:"Actions"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.t,{columns:R,loading:k,meta:w,ref:j,refetch:_,rows:q.map(function(e){return{data:e,id:e.id,name:e.name,status:e.status,statusText:(0,c.Z)(e.status),actions:""}})}),(0,a.jsx)(d.H,{content:"Add New",handleClick:O})]})};g.propTypes={entity:s.string,entityId:s.number,refetchCompliance:s.func,type:s.string,parentId:s.number}},70616:function(e,t,n){n.d(t,{j:function(){return U}});var i=n(47568),r=n(26042),a=n(69396),s=n(828),o=n(97582),u=n(85893),l=n(67294),c=n(45697),d=n(50319),p=n(42575),m=n(42283),f=n(79665),v=n(76600),h=n(49501),g=n(55563),y=n(95103),Z=n(62047),b=n(58594),x=n(15214),j=n(9270),S=n(62140),T=n(29005),I=n(55843),C=[{disabled:!0,text:"Please choose...",value:""},{text:"Checkbox",value:"checkbox",hasOptions:!0},{text:"CurrencyInput",value:"currencyInput",hasOptions:!1},{text:"Datepicker",value:"datepicker",hasOptions:!1},{text:"Input",value:"input",hasOptions:!1},{text:"Radio",value:"radio",hasOptions:!0},{text:"Select",value:"select",hasOptions:!0},{text:"Range(1 - 10)",value:"selectRange",hasOptions:!1},{text:"TextArea",value:"textArea",hasOptions:!1},{text:"Upload File",value:"media",hasOptions:!1}],q=[{text:"Email",value:"email"},{text:"Number",value:"number"},{text:"Text",value:"text"}],w=function(e){var t=e.defaultOptions,n=(0,m.qo)({control:t.control,name:"input"}),i=n&&C.find(function(e){return e.value===n}).hasOptions,s=(0,m.Dq)({control:t.control,name:"options"}),o=s.fields,c=s.append,d=s.remove;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(h.Z,{label:"Label",children:(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},t),{name:"label"}))}),(0,u.jsx)(h.Z,{label:"Input",children:(0,u.jsx)(y.Z,(0,a.Z)((0,r.Z)({},t),{name:"input",options:C}))}),"input"===n&&(0,u.jsx)(h.Z,{label:"Type",children:(0,u.jsx)(y.Z,(0,a.Z)((0,r.Z)({},t),{name:"inputType",options:q}))}),i&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(j.Z,{children:[(0,u.jsx)(S.Z,{xs:4,md:4,children:(0,u.jsx)(h.Z,{label:"Options"})}),(0,u.jsx)(S.Z,{children:(0,u.jsx)(T.Z,{iconName:"plus",onClick:c})})]}),o.map(function(e,n){return(0,u.jsxs)(l.Fragment,{children:[(0,u.jsxs)(j.Z,{align:"center",children:[(0,u.jsx)(S.Z,{xs:5,md:5,children:(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},t),{defaultValue:e.label,name:"options[".concat(n,"].label"),placeholder:"Label"}))}),(0,u.jsx)(S.Z,{xs:5,md:5,children:(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},t),{defaultValue:e.value,name:"options[".concat(n,"].value"),placeholder:"Value"}))}),(0,u.jsx)(S.Z,{xs:2,md:2,children:(0,u.jsx)(T.Z,{iconName:"delete",onClick:function(){return d(n)}})})]}),(0,u.jsx)(I.Z,{marginBottom:"md"})]},e.id)})]}),(0,u.jsx)(b.Z,(0,a.Z)((0,r.Z)({},t),{name:"required",data:[{label:"Required",value:!0}],stacked:!0}))]})};w.propTypes={defaultOptions:c.object};var k,_=n(21789),F=n(35292),O=n(29815),Q=[{name:"acquisitionCost",meta:{input:"currencyInput",inputType:"number",label:"Acquisition cost",isSystem:!0,questionType:"tco",required:!0}},{name:"datePutInService",meta:{input:"datepicker",inputType:"text",label:"Date put in service",isSystem:!0,questionType:"tco",required:!0}},{name:"usefulLife",meta:{input:"input",inputType:"number",label:"Useful life (months)",isSystem:!0,questionType:"tco",required:!0}},{name:"maintenanceSpend",meta:{input:"currencyInput",inputType:"number",label:"Maintenance spend (\xa3 p/m)",isSystem:!0,questionType:"tco",required:!0}},{name:"residualValue",meta:{input:"currencyInput",inputType:"number",label:"Residual Value",isSystem:!0,questionType:"tco",required:!0}}],R=[{name:"type",meta:{input:"select",inputType:"text",label:"Type",options:[{label:"Thermo",value:"thermo"},{label:"Occupancy",value:"occupancy"}],questionType:"sensor",isSystem:!0,required:!0}},{name:"brand",meta:{input:"select",inputType:"text",label:"Brand",options:[{label:"AirThings",value:"airthings"},{label:"Other",value:"other"}],questionType:"sensor",isSystem:!0,required:!0}}],P=(k=(0,i.Z)(function(e){var t,n,i,r,a,s,u,l,c;return(0,o.__generator)(this,function(a){switch(a.label){case 0:return t=e.addTaxonomy,n=e.adminId,i=e.hasSensorQuestions,r=e.hasTCOQuestions,l={status:"active",adminId:n,parentId:e.parentId,type:"assetQuestion"},c=[],r&&(s=c).push.apply(s,(0,O.Z)(V(Q,l))),i&&(u=c).push.apply(u,(0,O.Z)(V(R,l))),[4,t({variables:{objects:(0,O.Z)(c)}})];case 1:return a.sent(),[2]}})}),function(e){return k.apply(this,arguments)}),V=function(e,t){return e.map(function(e){return e=(0,r.Z)({},e,t)})},A=n(2845),N=n(51233),U=function(e){var t,n,c,j,S,T,I,C,q=e.defaultValues,k=e.entity,O=e.entityId,Q=e.groups,R=e.hasSublocation,V=e.isAssetCategoryParent,U=e.onSuccess,z=e.parentId,X=void 0===z?null:z,D=e.systemQuestions,E=(0,A.x)().user,$=(0,l.useState)(!1),B=$[0],M=$[1],G=q.type,H=(0,l.useState)(!1),J=H[0],L=H[1],Y=(0,l.useState)(!1),W=Y[0],K=Y[1],ee=(0,m.cI)({defaultValues:(0,a.Z)((0,r.Z)({},q),{input:null==q?void 0:null===(t=q.meta)||void 0===t?void 0:t.input,inputType:null==q?void 0:null===(n=q.meta)||void 0===n?void 0:n.inputType,sensor:(null==q?void 0:q.hasSensor)||!1,label:null==q?void 0:null===(c=q.meta)||void 0===c?void 0:c.label,options:null==q?void 0:null===(j=q.meta)||void 0===j?void 0:j.options,required:null==q?void 0:null===(S=q.meta)||void 0===S?void 0:S.required,customerSignature:null==q?void 0:null===(T=q.meta)||void 0===T?void 0:T.customerSignature,supplierSignature:null==q?void 0:null===(I=q.meta)||void 0===I?void 0:I.supplierSignature,sublocation:(null==q?void 0:null===(C=q.meta)||void 0===C?void 0:C.sublocation)||!1}),resolver:(0,f.S)((0,F.S)(G))}),et=ee.control,en=ee.errors,ei=ee.handleSubmit,er=ee.register,ea=ee.setValue,es=ee.watch,eo=es("sublocation");eo="false"!==eo&&Boolean(eo);var eu=es("sensor");eu="false"!==eu&&Boolean(eu);var el,ec=function(e,t){ea(e,t),ed()},ed=function(){K(!1),L(!1)},ep=(0,s.Z)((0,d.D)(p.mW,{onCompleted:function(e){var t=e.insert_Taxonomy.returning[0],n=t.id,i=t.type;(B||eu)&&"assetQuestion"!==i?P({hasTCOQuestions:B,hasSensorQuestions:eu,addTaxonomy:ep,adminId:E.accountId,parentId:n}):U&&U(n)}}),1)[0],em=(0,s.Z)((0,d.D)(p.ze,{onCompleted:function(e){var t=e.update_Taxonomy_by_pk,n=t.id,i=t.type;!D.sensor&&eu&&"assetQuestion"!==i?P({hasTCOQuestions:B,hasSensorQuestions:eu,addTaxonomy:ep,adminId:E.accountId,parentId:n}):U&&U(n)}}),1)[0],ef=(el=(0,i.Z)(function(e){return(0,o.__generator)(this,function(t){switch(t.label){case 0:if(X&&(e.parentId=X),eo&&eu)return[2,K(!0)];if(R&&eo&&!q.id)return[2,L(!0)];if(V&&(e.isGroup=!0),e.entity=k,e.entityId=O,e.meta=(0,a.Z)((0,r.Z)({},(null==q?void 0:q.meta)||{}),{input:e.input,options:e.options,inputType:e.inputType,label:e.label,required:e.required,customerSignature:e.customerSignature,supplierSignature:e.supplierSignature,sublocation:e.sublocation}),delete e.input,delete e.inputType,delete e.sensor,delete e.label,delete e.options,delete e.required,delete e.sublocation,delete e.customerSignature,delete e.supplierSignature,e.adminId=E.accountId,!(null==q?void 0:q.id))return[3,2];return[4,em({variables:{id:q.id,changes:e}})];case 1:return t.sent(),[3,4];case 2:return[4,ep({variables:{objects:[e]}})];case 3:t.sent(),t.label=4;case 4:return[2]}})}),function(e){return el.apply(this,arguments)}),ev={control:et,errors:en,register:er},eh=(0,a.Z)((0,r.Z)({},ev),{context:"secondary",size:"sm"});return(0,u.jsxs)(v.Z,{id:"offCanvasForm",handleSubmit:ei(ef),children:["assetQuestion"!==G&&(0,u.jsx)(h.Z,{label:"Name",children:(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},ev),{name:"name"}))}),("assetQuestion"===G||"complianceQuestions"===G||"supplierQuestion"===G)&&(0,u.jsx)(w,{defaultOptions:ev}),(null==Q?void 0:Q.length)>0&&(0,u.jsx)(h.Z,{label:"Group",children:(0,u.jsx)(y.Z,(0,a.Z)((0,r.Z)({},ev),{name:"parentId",options:Q}))}),(0,u.jsx)(h.Z,{label:"Status",children:(0,u.jsx)(y.Z,(0,a.Z)((0,r.Z)({},ev),{name:"status",options:_.bg}))}),"assetCategory"===G&&!V&&!q.id&&(0,u.jsx)(h.Z,{label:"Total cost of ownership",children:(0,u.jsx)(Z.Z,{context:"secondary",onToggle:function(e){return M(e)},size:"sm",toggled:B})}),"assetCategory"===G&&!V&&(0,u.jsx)(h.Z,{label:"Sensor",children:(0,u.jsx)(Z.Z,{context:"secondary",disabled:D.sensor,onToggle:function(e){return ec("sensor",e)},size:"sm",toggled:eu})}),"assetCategory"===G&&!V&&(0,u.jsx)(h.Z,{label:"Sublocation",children:(0,u.jsx)(Z.Z,(0,a.Z)((0,r.Z)({},eh),{onToggle:function(e){return ec("sublocation",e)},toggled:eo}))}),"signatures"===G&&(0,u.jsxs)(N.Z,{spacing:10,direction:"row",children:[(0,u.jsx)(b.Z,(0,a.Z)((0,r.Z)({},ev),{name:"customerSignature",data:[{label:"Customer",value:!0}],stacked:!0})),(0,u.jsx)(b.Z,(0,a.Z)((0,r.Z)({},ev),{name:"supplierSignature",data:[{label:"Supplier",value:!0}],stacked:!0}))]}),J&&(0,u.jsx)(x.Z,{content:"You can only create one sublocation",context:"warning"}),W&&(0,u.jsx)(x.Z,{content:"You can only select a sub-location or a sensor",context:"warning"}),"assetQuestion"===G&&(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},ev),{name:"name",type:"hidden"})),(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},ev),{name:"sensor",type:"hidden"})),"assetCategory"===G&&(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},ev),{name:"sublocation",type:"hidden"})),(0,u.jsx)(g.Z,(0,a.Z)((0,r.Z)({},ev),{name:"type",type:"hidden"}))]})};U.propTypes={defaultValues:c.object,entity:c.string,entityId:c.number,hasSublocation:c.bool,isAssetCategoryParent:c.bool,onSuccess:c.func.isRequired,systemQuestions:c.object},U.defaultProps={hasSublocation:!1,isAssetCategoryParent:!1,systemQuestions:{sensor:!1}}},35292:function(e,t,n){n.d(t,{S:function(){return r},b:function(){return a}});var i=n(74231),r=function(e){var t="assetQuestion"===e||"complianceQuestions"===e||"supplierQuestion"===e;return(0,i.Ry)().shape({group:(0,i.Rx)(),input:t&&(0,i.Z_)().required(),label:t&&(0,i.Z_)().required(),name:(0,i.Z_)().required(),questions:(0,i.Xg)(),status:(0,i.Z_)().oneOf(["active","inactive"]).required(),sublocation:(0,i.Xg)(),required:(0,i.Xg)(),customerSignature:(0,i.Xg)(),supplierSignature:(0,i.Xg)()})},a=(0,i.Ry)().shape({reportPassFail:(0,i.Xg)(),reportPassFailTitle:(0,i.Z_)().when(["reportPassFail"],function(e,t){return e?t.max(50).required():t.nullable()})})},59938:function(e,t,n){n.d(t,{X:function(){return f}});var i=n(14924),r=n(82670),a=n(828),s=n(7297),o=n(67294),u=n(6388),l=n(50319),c=n(75063),d=n(18586);function p(){var e=(0,s.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return p=function(){return e},e}function m(){var e=(0,s.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return m=function(){return e},e}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",s=(0,d.q)().user,c=(0,o.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(i){return t}}),p=c[0],m=c[1],f=function(t){try{var a=(0,r.Z)(t,Function)?t(p):t;switch(m(a),n){case"network":g({variables:{accountUserId:null==s?void 0:s.accountUserId,filters:(0,i.Z)({},e,a)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(a))}}catch(o){}};(0,u.aM)(v,{variables:{accountUserId:null==s?void 0:s.accountUserId},skip:"network"!==n,onCompleted:function(n){var i=n.accountUser;i&&m(i.filters[e]||t)}});var g=(0,a.Z)((0,l.D)(h),1)[0];return[p,f]}var v=(0,c.Ps)(p()),h=(0,c.Ps)(m())},21789:function(e,t,n){n.d(t,{bg:function(){return i}});var i=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},55862:function(e,t,n){n.d(t,{J:function(){return j}});var i=n(26042),r=n(69396),a=n(99534),s=n(828),o=n(85893),u=n(11163),l=n(67294),c=n(45697),d=n(9270),p=n(62140),m=n(42283),f=n(76600),v=n(11585),h=n(49501),g=n(75903),y=n(77439),Z=n(25742),b=n(59938),x=function(e){var t=e.initialValues,n=e.renderFilters,a=e.setFilters,u=e.lastQuery,c=e.filters,x=(0,s.Z)((0,b.X)("form_data_".concat(t.filterType),t),2),j=x[0],S=x[1],T=(0,m.cI)({defaultValues:j||t}),I=T.control,C=T.errors,q=T.handleSubmit,w=T.register,k=T.reset,_=T.watch,F=T.setValue,O=_(),Q=(0,r.Z)((0,i.Z)({},O),{filterType:t.filterType});(0,l.useEffect)(function(){k(Q)},[k]),(0,l.useEffect)(function(){S(Q)},[c]);var R=function(e){var n=e.query;if(n!==u){var r={q:"%".concat(n,"%")||0},s=/^\d+$/.test(n);"id"in t&&(r.id=s?Number(n):null),"meta"in t&&(r.meta=s?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(r.jobNumber=s?String(n):null,r.invoiceNumber=s?Number(n):null),a(function(e){return(0,i.Z)({},e,r)})}},P=function(e){Object.keys(t).map(function(e){return F(e,null)}),a(t),k(t),R("")};return(0,o.jsx)(f.Z,{handleSubmit:q(R),children:(0,o.jsxs)(v.Z,{title:"Filters",children:[(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(p.Z,{sm:12,lg:12,children:(0,o.jsx)(h.Z,{label:"",children:(0,o.jsx)(g.Z,{errors:C,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:w,type:"search"})})}),(0,o.jsx)(p.Z,{sm:12,lg:12,children:n({control:I,errors:C,initialValues:t,register:w,setFilters:a,watch:_,setValue:F,reset:k})})]}),(0,o.jsx)(Z.H,{content:"Search",context:"secondary",handleClick:R,type:"submit",children:(0,o.jsx)(y.Z,{content:"Clear",context:"danger",onClick:P,size:"sm"})})]})})};x.propTypes={initialValues:c.object,renderFilters:c.func.isRequired,setFilters:c.func.isRequired};var j=function(e){var t=e.FiltersComp,n=e.initialFilters,c=e.TableComp,m=(0,a.Z)(e,["FiltersComp","initialFilters","TableComp"]),f=(0,s.Z)((0,b.X)("form_data_".concat(n.filterType),n),2),v=f[0],h=f[1],g=(0,l.useState)(v||n),y=g[0],Z=g[1],j=(0,u.useRouter)().query.show;return(0,l.useEffect)(function(){h(y)},[y,h]),(0,o.jsx)(d.Z,{children:(0,o.jsxs)(p.Z,{sm:12,lg:12,children:[(0,o.jsx)(x,{initialValues:n,renderFilters:function(e){return(0,o.jsx)(t,(0,r.Z)((0,i.Z)({},e,m),{show:j}))},setFilters:Z,filters:y}),(0,o.jsx)(c,(0,i.Z)({filters:y,initialFilters:n},m))]})})};j.propTypes={FiltersComp:c.func,initialFilters:c.object.isRequired,TableComp:c.func}}}]);