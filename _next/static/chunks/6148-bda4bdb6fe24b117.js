"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6148],{25993:function(n,e,t){t.d(e,{V:function(){return M}});var a=t(47568),r=t(26042),i=t(69396),o=t(828),s=t(97582),u=t(85893),d=t(67294),l=t(45697),c=t(6388),m=t(50319),p=t(51809),f=t(11163),v=t.n(f),h=t(42283),_=t(79665),g=t(76600),y=t(15214),b=t(9270),q=t(62140),I=t(49501),$=t(55563),x=t(6710),Z=t(95103),S=t(84043),j=t(11057),A=t(69368),k=t(50480),C=t(6054),w=t(66812),D=function(n){var e=n.accountId,t=n.accountName,a=n.canSelectAccount,o=n.control,s=n.errors,l=n.setValue,c=n.watch,m=e?{value:e,label:t}:c("propertyOwner"),p=(0,C.Z)(m),f=function(n){l("contactUser",null)};(0,d.useEffect)(function(){m!==p&&p&&f(m)},[m]);var v={control:o,errors:s};return(0,u.jsxs)(b.Z,{children:[(0,u.jsx)(q.Z,{md:6,children:(0,u.jsx)(w.P,(0,i.Z)((0,r.Z)({},v),{defaultValue:e&&{value:e,label:t},errors:(0,r.Z)({},s),isDisabled:!a,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,u.jsx)(q.Z,{md:6,children:(0,u.jsx)(w.P,(0,i.Z)((0,r.Z)({},v),{accountId:(null==m?void 0:m.value)||null,errors:(0,r.Z)({},s),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};D.propTypes={accountId:l.number,accountName:l.string,canSelectAccount:l.bool.isRequired,control:l.func.isRequired,errors:l.object.isRequired,setValue:l.func.isRequired,watch:l.func.isRequired};var N=t(22595),R=function(n,e){var t=n.propertyOwner,a=n.contactUser;return n.Account_Locations={data:{accountId:t.value}},delete n.propertyOwner,n.contactUserId=(null==a?void 0:a.value)||null,delete n.contactUser,e&&delete n.Account_Locations,n},T=function(n,e,t,a){var r={location:R(n,!0),locationId:e.locationId,accountId:e.accountId,newAccountId:e.newAccountId,hasChanged:e.hasChanged};a({variables:r})},F=t(74231),U=t(46602),L=t(21789),P=t(2845),E=t(64872),J="/dashboard/properties/",M=function(n){var e,t,l,f,C=n.accountId,w=n.accountName,M=n.entity,Q=n.data,O=n.refetch,V=n.onAddressCreated,z=n.isPropsComponent,W=n.initialValues,B=n.xeroContactId,H=n.displayXeroContacts,X=n.xeroContacts,G=n.displaySignin,Y=n.handleXeroAuthorize,K=n.onClose,nn=(0,E.a)(),ne=(0,P.x)().hasRole,nt=(0,d.useState)(!1),na=nt[0],nr=nt[1],ni=null==X?void 0:X.find(function(n){return n.value===B}),no=(0,i.Z)((0,r.Z)({},Q?(location.propertyOwner={label:Q.customer[0].account.name,value:Q.customer[0].account.id},location.contactUser=(null==Q?void 0:Q.user)&&Q.customer[0].account.id&&{label:Q.user.fullName,value:Q.user.id},location.access=Q.access,location.name=Q.name,location.status=Q.status,location.permitsRequired=Q.permitsRequired,location):{},W),{xeroContact:ni})||{},ns=(0,h.cI)({defaultValues:no,resolver:(0,_.S)((0,F.Ry)().shape({access:(0,F.Z_)().required(),contactUser:(0,F.Ry)().required(),name:(0,F.Z_)().required(),propertyOwner:(0,F.Ry)().required(),status:ne("admin")&&(0,F.Z_)().required(),permitsRequired:(0,F.O7)()}))}),nu=ns.control,nd=ns.errors,nl=ns.handleSubmit,nc=ns.register,nm=ns.setValue,np=ns.getValues,nf=ns.watch,nv=(0,c.aM)(p.yf,{variables:{id:null==Q?void 0:Q.id},skip:!(null==Q?void 0:Q.id)}).data,nh=(void 0===nv?{property:{}}:nv).property,n_=(l=(0,a.Z)(function(n){var e,t,a,i,o,u,d,l,c,m,p;return(0,s.__generator)(this,function(o){switch(o.label){case 0:var s,d;return e=n.addressFormData,t=n.outerFormData,a={Addresses:{data:{Address:{data:(0,r.Z)({},e)},entity:M}}},i=(0,r.Z)({},np(),a,t),ne("customer")&&(i.status="active"),[4,nb({variables:{objects:[R(s=i)]}})];case 1:return p=void 0===(m=(void 0===(l=(void 0===(u=o.sent().data)?{}:u).insert_Location)?{}:l).returning)?{}:m,V&&V(p),nn.close(),[2]}})}),function(n){return l.apply(this,arguments)}),ng=(f=(0,a.Z)(function(n){return(0,s.__generator)(this,function(e){return nn.show({title:"Add new address",content:(0,u.jsx)(U.k,{onCancel:function(){},onSubmit:function(e){n_({addressFormData:e,outerFormData:n})},type:"text"}),submit:!1}),[2]})}),function(n){return f.apply(this,arguments)}),ny=(0,o.Z)((0,m.D)(p.A1,{onCompleted:function(n){if(!z){var e=n.insert_Location.returning[0].id;nn.close(),O?O():v().push("".concat(J,"view?id=").concat(e))}}}),2),nb=ny[0],nq=ny[1].loading,nI=(0,o.Z)((0,m.D)(p.$A,{onCompleted:function(n){var e=n.update_Location_by_pk.id;nn.close(),O?O():v().push("".concat(J,"view?id=").concat(e))}}),2),n$=nI[0],nx=nI[1].loading,nZ=(0,o.Z)((0,m.D)(p.$E),1)[0],nS=function(n){if(nr(!1),Q){if("inactive"===n.status&&!(e=nh.jobs).every(function(n){return!!(0,N.E)(n,["completed","closed"])})){nr(!0);return}n.xeroContact&&nZ({variables:{id:null===(s=null==Q?void 0:Q.customer[0])||void 0===s?void 0:s.account.id,changes:{meta:(0,i.Z)((0,r.Z)({},null===(u=null==Q?void 0:Q.customer[0])||void 0===u?void 0:u.account.meta),{xeroContactId:n.xeroContact.value})}}});var e,t,a,o,s,u,d={locationId:null==Q?void 0:Q.id,accountId:null===(t=null==Q?void 0:Q.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==n?void 0:null===(a=n.propertyOwner)||void 0===a?void 0:a.value,hasChanged:(null===(o=null==Q?void 0:Q.customer[0])||void 0===o?void 0:o.account.id)!==(null==n?void 0:n.propertyOwner.value)};T((0,i.Z)((0,r.Z)({},n),{xeroContact:void 0}),d,Q.id,n$),K()}else ng(n),K()},nj={control:nu,errors:nd,register:nc};return(0,u.jsxs)(g.Z,{disabled:nq||nx,id:"offCanvasForm",handleSubmit:nl(nS),children:[na&&(0,u.jsx)(y.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,u.jsx)(b.Z,{children:(0,u.jsx)(q.Z,{md:12,children:(0,u.jsx)(D,(0,i.Z)((0,r.Z)({},nj),{accountId:C,accountName:w,canSelectAccount:!C,setValue:nm,watch:nf}))})}),(0,u.jsx)(I.Z,{label:"Name",children:(0,u.jsx)($.Z,(0,i.Z)((0,r.Z)({},nj),{name:"name"}))}),(0,u.jsx)(I.Z,{label:"Access information",children:(0,u.jsx)(x.Z,(0,i.Z)((0,r.Z)({},nj),{name:"access",rows:4}))}),ne("admin")&&(0,u.jsx)(I.Z,{label:"Status",children:(0,u.jsx)(Z.Z,(0,i.Z)((0,r.Z)({},nj),{name:"status",options:L.bg}))}),(0,u.jsx)(h.Qr,{name:"permitsRequired",control:nu,render:function(n){var e=n.value,t=n.onChange;return(0,u.jsx)(k.Z,{control:(0,u.jsx)(A.Z,{color:"secondary",checked:e||!1,onChange:function(n){return t(n.target.checked)}}),label:"Permits required"})}}),ne("admin")&&void 0!==H&&H&&(0,u.jsx)(I.Z,{label:"Xero Contact",children:G?(0,u.jsx)(j.Z,{variant:"contained",onClick:function(){Y()},children:"Connect to Xero to select Contact"}):(0,u.jsx)(S.Z,(0,i.Z)((0,r.Z)({options:X},nj),{name:"xeroContact"}))})]})};D.propTypes={accountId:l.number,accountName:l.string,data:l.object,refetch:l.func,offCanvas:l.func}},6924:function(n,e,t){t.d(e,{r:function(){return I}});var a=t(26042),r=t(69396),i=t(828),o=t(7297),s=t(85893),u=t(67294),d=t(45697),l=t(52019),c=t(9270),m=t(62140),p=t(49501),f=t(84043),v=t(22244),h=t(66812),_=t(21300),g=t(83894),y=t(10367),b=t(92148);function q(){var n=(0,o.Z)(["\n  div > div > div {\n    background: ",";\n  }\n  div > div {\n    background: ",";\n  }\n"]);return q=function(){return n},n}var I=function(n){var e=n.control,t=n.errors,o=n.initialValues,d=n.register,f=n.setFilters,y=n.setValue,q=n.watch,I=(0,u.useContext)(l.Z).hasRole,x={control:e,errors:t,register:d},Z=q("customerId"),S=q("supplierId"),j=q("startDate"),A=q("userId"),k=!o.customerId;(0,u.useEffect)(function(){var n=(0,i.Z)(C.filter(function(n){return"quoteOffered"===n.value}),1)[0];f(function(e){return(0,r.Z)((0,a.Z)({},e),{status:j?[n.value]:null})}),y("status",j?[n]:null)},[j]);var C=v.iz.map(function(n){return I("supplier")?{label:n.supplierText,value:n.value}:I("customer")?{label:n.customerText,value:n.value}:{label:n.text,value:n.value}}).filter(function(n){return null!==n.label});(0,u.useEffect)(function(){k&&f(function(n){return(0,r.Z)((0,a.Z)({},n),{customerId:(null==Z?void 0:Z.value)||null})})},[Z]),(0,u.useEffect)(function(){k&&f(function(n){return(0,r.Z)((0,a.Z)({},n),{supplierId:(null==S?void 0:S.value)||null})})},[S]),(0,u.useEffect)(function(){f(function(n){return(0,r.Z)((0,a.Z)({},n),{userId:"number"==typeof A?A:(null==A?void 0:A.value)||null})})},[A]);var w=function(n){var e=n.map(function(n){return n.value});f(function(n){return(0,r.Z)((0,a.Z)({},n),{status:e.length>0?e:null})}),y("status",n)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(_.M,(0,r.Z)((0,a.Z)({},x),{name:"startDate",onChange:function(n){f(function(e){return(0,r.Z)((0,a.Z)({},e),{startDate:n||null})}),y("startDate",n)},placeholder:"Quote offered date"}))}),(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(_.M,(0,r.Z)((0,a.Z)({},x),{name:"endDate",onChange:function(n){var e=n?(0,g.Z)(n):n;f(function(n){return(0,r.Z)((0,a.Z)({},n),{endDate:e})}),y("endDate",e)},placeholder:"Quote due date"}))})]}),(0,s.jsxs)(c.Z,{align:"baseline",children:[(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(p.Z,{label:null,children:(0,s.jsx)($,(0,r.Z)((0,a.Z)({},x),{isDisabled:Boolean(j),placeholder:"Select status",name:"status",isMulti:Boolean(!j),onChange:w,options:C}))})}),!I(["customer","supplier"])&&(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(h.P,(0,r.Z)((0,a.Z)({},x),{label:"",name:"customerId",placeholder:"Select customer",isClearable:!0,type:"customer"}))}),I(b.n)&&(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(h.P,(0,r.Z)((0,a.Z)({},x),{errors:(0,a.Z)({},t),label:"",userId:o.userId,name:"userId",placeholder:"Select user",type:"user"}))})]}),!I(["supplier","customer"])&&!j&&(0,s.jsx)(c.Z,{children:(0,s.jsx)(m.Z,{md:6,children:(0,s.jsx)(h.P,(0,r.Z)((0,a.Z)({},x),{label:"",name:"supplierId",isClearable:!0,placeholder:"Select supplier",type:"supplier"}))})})]})},$=(0,y.ZP)(f.Z).withConfig({displayName:"filter__StyledSelect",componentId:"sc-285617a5-0"})(q(),function(n){return n.isDisabled&&"#dddddd"},function(n){return n.isDisabled&&"#dddddd"});I.propTypes={errors:d.object.isRequired,register:d.func.isRequired,setFilters:d.func.isRequired}},26576:function(n,e,t){t.d(e,{w:function(){return v},L:function(){return f}});var a=t(7297),r=t(75063),i=t(45815),o=t(85488),s=t(66312);function u(){var n=(0,a.Z)(["\n  fragment QuoteFields on Job {\n    quoteNumber\n    quoteDue\n    quoteCharge\n  }\n"]);return u=function(){return n},n}function d(){var n=(0,a.Z)(["\n  query Quote($id: Int!) {\n    job: Job_by_pk(id: $id) {\n      id\n      title\n      description\n      costCategory\n      status\n      workStatus\n      scheduledAt\n      createdAt\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      tenantId\n      reference\n      amount\n      accountByTenantid {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customer: Account {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      messages: Messages {\n        id\n        message\n        priority\n        taskId\n        jobId\n        locationId\n        description\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n      }\n      supplier: Suplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return n},n}var l=(0,r.Ps)(u());(0,r.Ps)(d());var c=t(75327);function m(){var n=(0,a.Z)(["\n  query GetQuotes(\n    $endDate: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobSupplierFields\n      ...QuoteFields\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return m=function(){return n},n}function p(){var n=(0,a.Z)(["\n  query GetQuotes(\n    $customerId: Int\n    $date: timestamptz\n    $endDate: timestamptz\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $customerManagerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n    $type: String\n    $userId: Int\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ",'\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        customerUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      ...QuoteFields\n      statusLog\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n        lineItems: SupplierQuoteLineItems {\n          id\n          qty\n          total\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ',"\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n        customerUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return p=function(){return n},n}var f=(0,r.Ps)(m(),i.z,o.aL,l,o.H_,c.Px),v=function(n){var e=n.tagsWhere;return(0,r.Ps)(p(),e,e,i.z,s.WW,o.aL,o.wd,l,c.Px)}},93243:function(n,e,t){t.d(e,{v:function(){return Y}});var a=t(26042),r=t(69396),i=t(828),o=t(7297),s=t(29815),u=t(85893),d=t(67294),l=t(45697),c=t(11163),m=t.n(c),p=t(6388),f=t(73359),v=t(57460),h=t.n(v),_=t(78289),g=t(62466),y=t(11082),b=t(26186),q=t(68956),I=t(16551),$=t(55843),x=t(77439),Z=t(40826),S=t(11585),j=t(26576),A=t(42608),k=t(83894),C=t(23855),w=function(n,e,t,r){var i=n.limit,o=n.offset,s=n.orderBy,u=n.q,d=n.status,l=n.tagsWhere;return t.hasOwnProperty("tileName")?{query:A.Z,variables:(0,a.Z)({q:null,accountId:null,userId:null,currentUserId:null==e?void 0:e.id,asAt:(0,k.Z)((0,C.Z)(r.asAt)),tileName:null==t?void 0:t.tileName,limit:50,offset:0,orderBy:{jobId:"desc"},monthStart:r.monthStart,dayStart:r.todayStart,yearStart:r.yearStart,adminId:null==e?void 0:e.adminId},n)}:"supplier"===e.accountType?{query:j.L,variables:(0,a.Z)({limit:i,offset:o,orderBy:s,q:u,status:d},n)}:{query:(0,j.w)({tagsWhere:l}),variables:(0,a.Z)({},n)}},D=t(91272),N=t(22244),R=t(97768),T=t(45416),F=t(2845),U=t(18586),L=t(9492),P=t(20705),E=t(63139),J=t(95465),M=t(43703),Q=t(69119),O=t(38148),V=function(n){var e=(0,M.Z)(n),t=(0,Q.Z)(n),a=(0,k.Z)(n),r=(0,O.Z)(n);return{monthStart:e,todayEnd:a,todayStart:t,yearStart:r}},z=t(13304),W=t(66137),B=t(10367);function H(){var n=(0,o.Z)(["\n  cursor: pointer;\n  margin: 2px 0px;\n  padding: 8px 5px;\n  color: rgb(41, 41, 204);\n  background-color: transparent;\n  border: none;\n  &:hover {\n    background-color: #dddddd;\n    border-radius: 5px;\n  }\n"]);return H=function(){return n},n}function X(){var n=(0,o.Z)(["\n  line-height: 1.5em;\n  height: 3em;\n  overflow: hidden;\n"]);return X=function(){return n},n}function G(){var n=(0,o.Z)(["\n  white-space: nowrap;\n"]);return G=function(){return n},n}var Y=function(n){var e,t,o,l,v,j=n.filters,A=(0,d.useContext)(_.Z),k=(0,U.q)(),C=(0,c.useRouter)().query,M=(0,d.useState)(!1),Q=M[0],O=M[1],B=null===(e=k.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,H=null===(o=k.admin)||void 0===o?void 0:null===(l=o.jobSetting)||void 0===l?void 0:l.jobNumberSuffix,X=(0,F.x)(),G=X.hasRole,Y=X.user,nt=(0,P.x)({filters:j}),na=nt.initialData,nr=nt.ref,ni=(0,r.Z)((0,a.Z)({},na),{managerId:j.managerId?Y.id:null,tagsWhere:(0,W.Y)(na.tags)}),no=new Date(C.asAt),ns=(0,d.useState)({monthStart:V(no).monthStart,todayEnd:V(no).todayEnd,todayStart:V(no).todayStart,yearStart:V(no).yearStart,asAt:C.asAt}),nu=ns[0],nd=ns[1];(0,d.useEffect)(function(){var n,e=V(no),t=e.monthStart,a=e.todayEnd;nd({monthStart:t,todayEnd:a,todayStart:e.todayStart,yearStart:e.yearStart,asAt:C.asAt})},[null==j?void 0:j.asAt]);var nl=w(ni,Y,C,nu),nc=nl.query,nm=nl.variables;"Accepted"===nm.status?(nm.type="reactive",delete nm.status):delete nm.type;var np=(0,p.aM)(nc,{variables:nm}),nf=np.data,nv=void 0===nf?{quotes:[],meta:{aggregate:{totalCount:0}}}:nf,nh=nv.quotes,n_=nv.meta,ng=np.loading,ny=np.refetch,nb=(0,i.Z)((0,f.t)(nc,{variables:(0,r.Z)((0,a.Z)({},nm),{limit:(null==n_?void 0:null===(v=n_.aggregate)||void 0===v?void 0:v.totalCount)||150}),onCompleted:function(n){var e=n.quotes;if(Q){var t=h().unparse(nT(e,!0)),a="data:application/octet-stream,"+encodeURIComponent(t);(0,L.S)(a,"quotes.csv"),O(!1)}},skip:!0}),2),nq=nb[0],nI=nb[1].loading,n$=void 0===nI||nI,nx=function(){ny(),A.close()},nZ=function(n){n.stopPropagation(),nq(),O(!0)},nS=function(n){var e=n.e,t=n.row;e.stopPropagation(),A.show({content:(0,u.jsx)(J.m,{onSuccess:nx,quotationId:t.quotationsId}),title:"Quotation",width:"50%"})},nj={content:"Edit",context:"secondary",icon:["fas","edit"],onClick:function(n,e){n.stopPropagation(),m().push("/dashboard/issues/manage?id=".concat(e.number,"&quoted=1"))},tooltip:"Edit"},nA={context:"info",icon:["fas","receipt"],onClick:function(n,e){return nS({e:n,row:e})},tooltip:"Fill quotation"},nk={context:"secondary",icon:["fas","receipt"],onClick:function(n,e){return m().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"info"},nC=[{sortable:!0,text:"ID",sortName:"id",formatter:function(n){var e=n.row;return(0,u.jsx)(T.D,{id:e.id,number:e.number,numberPrefix:B,numberSuffix:H,status:e.status,openCanvas:!0,type:e.type,isQuote:e.quoted})}},{text:"Creator"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(n){var e=n.row;return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(nn,{children:e.type})})},text:"Type",sortName:"type"},{formatter:function(n){var e=n.row;return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(nn,{children:e.description})})},text:"Description"},{sortable:!0,hidden:!G("admin"),formatter:(0,g.Z)("/dashboard/users/view","managerId","manager"),sortName:'{"Manager": {"nameFirst": "ORDER"}}',text:"Assigned to"},{sortable:!0,hidden:!G(["admin","customer"]),formatter:(0,g.Z)("/dashboard/properties/view","propertyId","location"),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:G(["admin","customer"]),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin"),formatter:(0,g.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer",sortName:'{"Customer": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:(0,g.Z)("/dashboard/suppliers/view","supplierId","acceptSupplier"),text:"Accepted Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:function(n){var e,t=n.row;return n.data,(0,u.jsx)(u.Fragment,{children:(null==t?void 0:null===(e=t.offeredSupplier)||void 0===e?void 0:e.length)>0?(0,u.jsx)(u.Fragment,{children:((null==t?void 0:t.offeredSupplier)||[]).map(function(n){var e;return(0,u.jsx)(K,{onClick:function(e){var t;return nw(e,null==n?void 0:null===(t=n.supplier)||void 0===t?void 0:t.id)},children:null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name})})}):"-"})},text:"Offered Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{hidden:!G("admin"),text:"Quotations"},{hidden:!G("admin")&&!G("supplier"),text:"Received"},{hidden:!G("admin"),text:"Quotations Range (if multiple)",formatter:function(n){var e=n.row.range;return e?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(ne,{children:["high: ",(0,y.Z)(e.high)]}),(0,u.jsxs)(ne,{children:["low:\xa0 ",(0,y.Z)(e.low)]})]}):"N/A"}},{sortable:!0,text:"Quote Due",sortName:"quoteDue",formatter:function(n){var e=n.row,t=(0,b.Z)(new Date),a="Quote"===e.type,r=e.status.includes("quoteSent");return a&&e.due<t&&!r?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(z.Z,{color:"error"})," ",e.due]}):e.due}},{text:"Scheduled",sortable:!0,sortName:"scheduledAt"},{text:"Created",sortable:!0,sortName:"createdAt"},{formatter:function(n){var e=n.row;return(null==e?void 0:e.offeredSupplier.length)>0&&(null==e?void 0:e.offeredSupplier.every(function(n){return"quotationRejected"===n.status}))?"Rejected":e.statusText},text:"Status",sortable:!0,sortName:"status"},{hidden:!0},{hidden:!0},{formatter:q.Z,formatterData:function(n){var e=[];return G("admin")&&e.push(nj),G("admin")&&e.push(nk),(G("admin")||G("supplier"))&&"quoteOffered"===n.status&&e.push(nA),e},text:"Actions"}],nw=function(n,e){n.stopPropagation(),m().push("/dashboard/suppliers/view?id=".concat(e))},nD=function(n){m().push("/dashboard/issues/view?id=".concat(n.number))},nN=function(n){n.stopPropagation(),m().push("/dashboard/issues/manage?quoted=1")},nR=function(n){var e=null;if(n.length>1){var t,a,r=n.map(function(n){var e;return null===(e=n.lineItems)||void 0===e?void 0:e.reduce(function(n,e){return n+(e.total||0)*e.qty},0)});e={high:(t=Math).max.apply(t,(0,s.Z)(r||[])),low:(a=Math).min.apply(a,(0,s.Z)(r||[]))}}return e},nT=function(n,e){return n.map(function(n){var t,a,r,i,o,u,d,l,c,m,p,f,v,h,_,g=(0,s.Z)(N.iz).find(function(e){return e.value===n.status})||{text:"Accepted"},y=g.text,q=g.supplierText,I=g.customerText,$=((0,s.Z)(R.x).find(function(e){return e.value===n.type})||{text:"Quote"}).text,x=n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast):"Unassigned",Z=n.scheduledAt?(0,b.Z)(n.scheduledAt,!0):"-",S=(null==n?void 0:null===(t=n.quotations)||void 0===t?void 0:t.length)>0?n.quotations:[];return{id:n.id,creator:(null===(a=null==n?void 0:n.timings[0])||void 0===a?void 0:null===(r=a.user)||void 0===r?void 0:r.fullName)||"-",description:(null==n?void 0:n.description)?null==n?void 0:n.description:"-",number:n.number,type:$,status:n.status,propertyId:null===(i=n.location)||void 0===i?void 0:i.id,managerId:null===(o=n.manager)||void 0===o?void 0:o.id,customerId:null===(u=n.customer)||void 0===u?void 0:u.id,supplierId:n.supplier?n.supplier.id:"",siteVisitStart:n.siteVisitStart,siteVisitEnd:n.siteVisitEnd,siteVisitWeekends:n.siteVisitWeekends,service:(null===(d=n.service)||void 0===d?void 0:d.name)||"-",manager:x,location:(null===(l=n.location)||void 0===l?void 0:l.name)||"-",property:(null===(c=n.location)||void 0===c?void 0:c.name)||"-",customer:(null===(m=n.customer)||void 0===m?void 0:m.name)||"-",acceptSupplier:n.supplier?n.supplier.name:"-",offeredSupplier:(null==n?void 0:null===(p=n.quotations)||void 0===p?void 0:p.length)>0?(_=n.quotations,e?_.map(function(n){var e;return null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name}).join(" / "):_):[],quotations:"".concat((null===(f=n.quotations)||void 0===f?void 0:f.length)||0,"/").concat(n.quoteNumber),received:"".concat(null===(v=n.quotations||[])||void 0===v?void 0:v.reduce(function(n,e){return"supplierQuoteComplete"===e.status?n+1:n},0),"/").concat((null===(h=n.quotations)||void 0===h?void 0:h.length)||0),range:nR(n.quotations),due:(0,b.Z)(n.quoteDue),scheduleDate:Z,date:(0,b.Z)(n.createdAt),statusText:function(){if(S.every(function(n){return"quotationRejected"===n.status}))return"Quotation Rejected";if(G("admin"));else if(G("supplier"))return q||"Accepted";else if(G("customer"))return I||"Accepted";return y}(),quoted:n.quoted||!1,quotationsId:n.quotations[0]&&n.quotations[0].id,actions:""}})},nF=function(){return(0,u.jsxs)(I.Z,{children:[(0,u.jsx)($.Z,{marginRight:"xs",children:!(0,E.s)()&&(0,u.jsx)(x.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:n$,onClick:nZ,children:(0,u.jsx)(Z.Z,{context:"white",icon:"file-csv",size:"lg"})})}),G("admin")&&(0,u.jsx)(x.Z,{context:"secondary",content:"Add Quote",onClick:nN,size:"sm"})]})};return(0,u.jsx)(S.Z,{toolbar:(0,u.jsx)(nF,{}),open:!0,title:"Quotes",children:(0,u.jsx)(D.t,{columns:nC,loading:ng,meta:n_,ref:nr,refetch:ny,rowClick:nD,rows:nT(nh)})})},K=B.ZP.button.withConfig({displayName:"table__LinkWrapper",componentId:"sc-fdeb0f25-0"})(H()),nn=B.ZP.div.withConfig({displayName:"table__StyledLink",componentId:"sc-fdeb0f25-1"})(X()),ne=B.ZP.div.withConfig({displayName:"table__DivWrapper",componentId:"sc-fdeb0f25-2"})(G());Y.propTypes={filters:l.object},Y.defaultProps={filters:{customerId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"quotes_table"}}},42608:function(n,e,t){var a=t(7297),r=t(75063),i=t(45815),o=t(85488),s=t(66312),u=t(75327);function d(){var n=(0,a.Z)(["\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $number: String\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $status: [String!]\n    $yearStart: timestamptz\n    $type: String\n  ) {\n    quotes: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n        locationId: $locationId\n        managerId: $managerId\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ",'\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      job: Job {\n        type\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ',"\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return d=function(){return n},n}var l=function(n){var e=n.tagsWhere;return(0,r.Ps)(d(),e,e,i.z,s.WW,o.aL,o.wd,u.Px)};e.Z=l}}]);