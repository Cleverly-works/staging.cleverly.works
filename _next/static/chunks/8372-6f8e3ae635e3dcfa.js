"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8372],{28591:function(e,n,i){i.d(n,{i:function(){return I}});var t=i(47568),o=i(26042),a=i(69396),r=i(828),l=i(29815),s=i(97582),d=i(85893),u=i(67294),c=i(6388),m=i(50319),f=i(38216),p=i(42283),v=i(15861),h=i(23776),x=i(50135),b=i(93946),g=i(11994),y=i(5616),S=i(90629),Z=i(22961),j=i(72450),w=i(93739),k=i(74231),F=i(2845),I=function(e){var n,i,I,D,_,q=e.control,E=e.errors,M=e.register,N=e.setValue,z=e.entity,A=e.entityId,P=e.hasSelect,T=void 0===P||P,O=e.hasForm,R=e.hasPreview,L=void 0!==R&&R,W=e.isSubmit,H=void 0!==W&&W,Q=e.linkedTo,V=e.isDisabled,B=e.showScoreAndLabels,G=e.doValidation,U=void 0!==G&&G,$=e.handleValidation,X=e.onTotalScoreAndLabelChange,J=void 0===X?function(){}:X,Y=(0,u.useState)([]),K=Y[0],ee=Y[1],en=(0,u.useState)(),ei=en[0],et=en[1],eo=(0,u.useState)(!1),ea=eo[0],er=eo[1],el=(0,u.useState)(!1),es=el[0],ed=el[1],eu=(0,F.x)().user,ec=(0,u.useState)({}),em=ec[0],ef=ec[1],ep=(0,u.useState)(null),ev=ep[0],eh=ep[1],ex=(0,u.useState)(null),eb=ex[0],eg=ex[1],ey=(0,u.useState)(0),eS=ey[0],eZ=ey[1],ej=(0,u.useState)(""),ew=ej[0],ek=ej[1],eF=(0,u.useState)(0)[1],eI=function(e){eZ(e);var n=eq(e,e_);J(e,n)},eC=function(e){eF(e)},eD=(0,c.aM)(f.n).data,e_=(null==eD?void 0:eD.Form.map(function(e){return e.settings}).flat())||[],eq=function(e){var n=null==e_?void 0:e_.find(function(n){return e>=(null==n?void 0:n.min)&&e<=(null==n?void 0:n.max)});return n?n.label:null},eE=(0,c.aM)(f.Q2,{variables:{entity:em.entity,entityId:em.entityId},skip:!em.entity||!em.entityId}),eM=eE.data,eN=eE.refetch,ez=(0,r.Z)((0,m.D)(f.Vw),1)[0],eA=(0,r.Z)((0,m.D)(f.FE),1)[0],eP=(0,r.Z)((0,m.D)(f._q),1)[0],eT={formId:null==ei?void 0:ei.value,formFields:null==ei?void 0:ei.formFields,submissionData:eb},eO=function(e){var n,i=null==ei?void 0:null===(n=ei.formFields)||void 0===n?void 0:n.reduce(function(e,n){if(n.required)switch(n.type){case"defaultText":case"text":case"input":case"longText":case"textArea":e[n.stateName]=k.Z_().trim().required("".concat(n.label," is required"));break;case"numberInput":case"currency":case"slider":e[n.stateName]=k.Rx().required("".concat(n.label," is required")).nullable();break;case"select":case"signerInitials":case"radio":e[n.stateName]=k.Z_().required("".concat(n.label," is required"));break;case"multiSelect":e[n.stateName]=k.IX().of(k.Z_().required("Select a value")).min(1,"".concat(n.label," requires at least one selection")).required("".concat(n.label," is required"));break;case"checkbox":e[n.stateName]=k.IX().min(1,"".concat(n.label," requires at least one selection")).required("".concat(n.label," is required"));break;case"datepicker":e[n.stateName]=k.hT().required("".concat(n.label," is required"));break;case"time":e[n.stateName]=k.Z_().required("".concat(n.label," is required")).matches(/^\d{2}:\d{2}$/,"Time must be in HH:MM format");break;case"timeRange":e[n.stateName]=k.Ry().shape({startTime:k.Z_().required("Start time is required").matches(/^\d{2}:\d{2}$/,"Must be in HH:MM format"),endTime:k.Z_().required("End time is required").matches(/^\d{2}:\d{2}$/,"Must be in HH:MM format")}).required("".concat(n.label," is required"));break;case"signature":e[n.stateName]=k.Z_().required("Signature is required").nullable()}return e},{});return k.Ry().shape(i).validate(e,{abortEarly:!1})},eR=(I=(0,t.Z)(function(){return(0,s.__generator)(this,function(e){switch(e.label){case 0:if(!A||!z)return[2];return[4,ez({variables:{formId:ei.value,userId:eu.id,submissionData:eb,formFields:ei.formFields,entity:z,entityId:A}})];case 1:return e.sent(),[2]}})}),function(){return I.apply(this,arguments)}),eL=(D=(0,t.Z)(function(){var e;return(0,s.__generator)(this,function(n){switch(n.label){case 0:return[4,eA({variables:{id:null===(e=null==eM?void 0:eM.FormSubmissions[0])||void 0===e?void 0:e.id,changes:eT}})];case 1:return n.sent(),[2]}})}),function(){return D.apply(this,arguments)}),eW=(_=(0,t.Z)(function(){var e,n;return(0,s.__generator)(this,function(i){switch(i.label){case 0:if((null===(e=null==eM?void 0:eM.FormSubmissions[0])||void 0===e?void 0:e.entityId)!==A)return[2];return[4,eP({variables:{id:null===(n=null==eM?void 0:eM.FormSubmissions[0])||void 0===n?void 0:n.id}})];case 1:return i.sent(),[2]}})}),function(){return _.apply(this,arguments)}),eH=function(){(null==ei?void 0:ei.name)==="None"?ed(!0):(null==ei?void 0:ei.id)&&(er(!ea),ed(!1))},eQ=function(e){e&&(N("formSubmission",e),ed(!1))},eV=function(e){eg(e)};return(0,u.useEffect)(function(){(null==Q?void 0:Q.entity)&&(null==Q?void 0:Q.entityId)&&null===ev&&eh(Q)},[Q,ev]),(0,u.useEffect)(function(){eN()},[em.entityId,em.entity]),(0,u.useEffect)(function(){z&&null!=z&&""!==z&&A&&null!=A&&""!==z&&ef({entity:z,entityId:A})},[]),(0,u.useEffect)(function(){(null==Q?void 0:Q.entityId)!==(null==ev?void 0:ev.entityId)&&(null===ev&&A||ef(Q),eh(Q))},[null==Q?void 0:Q.entityId]),(0,u.useEffect)(function(){var e;if(null==eD?void 0:null===(e=eD.Form)||void 0===e?void 0:e.length){var n,i=(0,l.Z)(eD.Form).map(function(e){return(0,a.Z)((0,o.Z)({},e),{value:e.id})}).sort(function(e,n){return e.id-n.id});if(!(null===(n=null==eM?void 0:eM.FormSubmissions[0])||void 0===n?void 0:n.id)){var t=i.find(function(e){return 1===e.id});et((0,a.Z)((0,o.Z)({},t),{value:null==t?void 0:t.id}))}ee(i)}},[eD]),(0,u.useEffect)(function(){var e;(null===(e=null==eM?void 0:eM.FormSubmissions[0])||void 0===e?void 0:e.id)&&(et({id:null==eM?void 0:eM.FormSubmissions[0].id,name:null==eM?void 0:eM.FormSubmissions[0].form.name,value:null==eM?void 0:eM.FormSubmissions[0].formId,formFields:null==eM?void 0:eM.FormSubmissions[0].formFields,submissionData:null==eM?void 0:eM.FormSubmissions[0].submissionData}),eg(null==eM?void 0:eM.FormSubmissions[0].submissionData))},[null===(n=null==eM?void 0:eM.FormSubmissions[0])||void 0===n?void 0:n.id]),(0,u.useEffect)(function(){if((null==K?void 0:K.length)&&!(null==eM?void 0:eM.FormSubmissions[0])){var e=K.find(function(e){return 1===e.id});et((0,a.Z)((0,o.Z)({},e),{value:null==e?void 0:e.id}))}},[K,null==eM?void 0:eM.FormSubmissions[0]]),(0,u.useEffect)(function(){eQ(ei)},[ei]),(0,u.useEffect)(function(){if(H&&ei){if((null==ei?void 0:ei.id)===1)eW();else{var e,n,i;(null===(e=null==eM?void 0:eM.FormSubmissions[0])||void 0===e?void 0:e.id)&&(null===(n=null==eM?void 0:eM.FormSubmissions[0])||void 0===n?void 0:n.entityId)===A&&(null===(i=null==eM?void 0:eM.FormSubmissions[0])||void 0===i?void 0:i.entity)===z?eL():eR()}}},[H]),(0,u.useEffect)(function(){U&&eb&&eO(eb).then(function(){$(!0),ek("")}).catch(function(e){$(!1),ek(e.inner.map(function(e){return e.message}).join(", "))})},[U,eb]),(0,d.jsxs)(d.Fragment,{children:[U&&ew&&(0,d.jsx)(v.Z,{fontSize:"14px",color:"error",children:ew}),K.length&&(0,d.jsx)(p.Qr,(0,a.Z)((0,o.Z)({},{errors:E,register:M,control:q}),{name:"formSubmission",render:function(e){return(0,d.jsxs)("div",{style:C.autocompleteWrapper,children:[(0,d.jsx)(h.Z,(0,a.Z)((0,o.Z)({},e),{disablePortal:!0,options:K,disabled:V,value:ei,getOptionLabel:function(e){return e.name},sx:(0,a.Z)((0,o.Z)({},C.autocomplete),{visibility:!T&&"hidden",height:!T&&0,margin:!T&&0}),onChange:function(e,n){var i=n||(0,o.Z)({},K.find(function(e){return 1===e.id}));et(i),eQ(i)},renderInput:function(e){return(0,d.jsx)(x.Z,(0,a.Z)((0,o.Z)({},e),{label:"Select Form",variant:"outlined",inputProps:(0,o.Z)({},e.inputProps)}))}})),L&&(0,d.jsx)(b.Z,{color:(null==ei?void 0:ei.value)&&(null==ei?void 0:ei.value)!==1?"primary":"disabled",onClick:eH,sx:{marginLeft:"10px"},children:(0,d.jsx)(Z.Z,{sx:{fontSize:20}})}),es&&(0,d.jsx)("div",{className:"eyeNotification",style:C.eyeNotification,children:(0,d.jsxs)(v.Z,{fontSize:"12px",color:"error",children:["No form will be created inside the job","."]})})]})}})),ei&&(null==ei?void 0:ei.id)!==1&&void 0!==O&&O&&(0,d.jsx)(w.L,{entityId:null===(i=null==eM?void 0:eM.FormSubmissions[0])||void 0===i?void 0:i.id,refetch:eN,scheme:ei.formFields,submissionData:ei.submissionData,isOffCanvas:!0,liftingSubmissions:eV,calculatedTotalScore:eI,scoreLabels:e_,blockStyle:C.blockStyle,onFileCountChange:eC}),(void 0===B||B)&&eS>0&&(0,d.jsxs)(v.Z,{variant:"h6",sx:{padding:"10px",borderTop:1,fontFamily:"Nunito-Regular",fontSize:"16px"},children:["Total Score: ",eS,eq(eS,e_)&&" (".concat(eq(eS,e_),")")]}),ei&&(0,d.jsx)(g.Z,{open:ea,onClose:eH,style:{zIndex:"9999"},slotProps:{backdrop:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)"}}},children:(0,d.jsx)(y.Z,{sx:C.modalContainerStyle,children:(0,d.jsxs)(S.Z,{sx:C.modalContentStyle,children:[(0,d.jsxs)(y.Z,{sx:C.stickyHeaderStyle,marginBottom:1,children:[(0,d.jsx)(v.Z,{variant:"h6",sx:{fontFamily:"Nunito-Regular",fontSize:"16px",paddingLeft:"10px"},children:"Form preview"}),(0,d.jsx)(b.Z,{color:"secondary",onClick:eH,sx:{marginLeft:"10px"},children:(0,d.jsx)(j.Z,{sx:{fontSize:20}})})]}),(0,d.jsx)("div",{style:C.previewScheme,children:(0,d.jsx)(w.L,{scheme:null==ei?void 0:ei.formFields,submissionData:null==ei?void 0:ei.submissionData,formSchemeOnEdit:null,formSchemeOnCopy:null,formSchemeOnDelete:null,blockStyle:C.blockStyle})})]})})})]})},C={autocomplete:{marginBottom:"1rem",marginTop:"1rem",flex:1},autocompleteWrapper:{display:"flex",alignItems:"center",position:"relative",width:"100%"},iconPreview:{height:"minContent"},blockStyle:{border:"none",backgroundColor:"#FFFFFF",highlighted:""},previewScheme:{pointerEvents:"none"},modalContainerStyle:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",zIndex:"9999"},eyeNotification:{position:"absolute",bottom:"-40px",right:"0",backgroundColor:"#fff",padding:"4px",zIndex:2,border:"2px solid #f5f5f5",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",width:"auto",maxWidth:"300px",minWidth:"250px",wordWrap:"break-word"},modalContentStyle:{width:"650px",height:"600px",padding:"10px",overflowY:"auto",borderRadius:"12px",backgroundColor:"#FFFFFF"},stickyHeaderStyle:{position:"sticky",top:0,height:"44px",backgroundColor:"#F5F5F5",borderRadius:"12px",zIndex:1,fontFamily:"Nunito-SemiBold",border:1,padding:"15px",display:"flex",alignItems:"center",justifyContent:"space-between"}}},13262:function(e,n,i){i.d(n,{f:function(){return I}});var t=i(26042),o=i(69396),a=i(29815),r=i(85893),l=i(67294),s=i(45697),d=i.n(s),u=i(15861),c=i(93946),m=i(51233),f=i(21023),p=i(96540),v=i(79665),h=i(50135),x=i(11057),b=i(90948),g=i(42283),y=i(41733),S=i(40656),Z=i(74231),j=Z.Ry().shape({caption:Z.Z_()}),w=(0,b.ZP)(u.Z)({backgroundColor:S.Q.COLOUR.secondary,color:S.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),k=(0,b.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),F=function(e){var n,i=e.noDelete,a=e.onDelete,s=e.isAdded,d=e.media,p=e.caption,b=e.onSave,Z=(0,l.useState)(null),F=Z[0],I=Z[1],C=(0,l.useState)(""),D=C[0],_=C[1],q=(0,l.useState)(s),E=q[0],M=q[1],N=(0,g.cI)({resolver:(0,v.S)(j)}),z=N.register,A=N.errors,P=N.handleSubmit,T=N.reset,O=function(e){e.stopPropagation(),I(null),T()},R=function(e){e.stopPropagation(),M(!1),a()},L=function(e){F&&(b((0,o.Z)((0,t.Z)({},e),{media:F,type:D})),M(!1))},W=(0,l.useCallback)(function(e){return function(n){n.stopPropagation();var i=n.target.files[0];_(e),I(i)}},[I]);return(0,r.jsx)("form",{children:E?(0,r.jsx)(m.Z,{children:(0,r.jsxs)(m.Z,{rowGap:2,children:[(0,r.jsx)(h.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:z,error:A.name,helperText:null===(n=A.name)||void 0===n?void 0:n.message}),F?(0,r.jsxs)(m.Z,{rowGap:3,children:[(0,r.jsxs)(m.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(u.Z,{sx:{color:S.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:F.name}),(0,r.jsx)(f.Z,{title:"Delete",placement:"top-start",children:(0,r.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:O,children:(0,r.jsx)(y.Z,{})})})]}),(0,r.jsxs)(m.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,r.jsx)(x.Z,{variant:"contained",color:"danger",size:"small",onClick:R,children:"Cancel"}),(0,r.jsx)(x.Z,{variant:"contained",size:"small",onClick:P(L),children:"Save"})]})]}):(0,r.jsxs)(m.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,r.jsxs)(w,{component:"label",children:["Add image\xa0",(0,r.jsx)(k,{onChange:W("image"),type:"file",accept:"image/*, .heic"})]}),(0,r.jsxs)(w,{component:"label",children:["Add document\xa0",(0,r.jsx)(k,{onChange:W("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,r.jsxs)(m.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,r.jsx)(u.Z,{sx:{color:S.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:p||(null==d?void 0:d.name)||"No caption"}),!i&&(0,r.jsx)(f.Z,{title:"Delete",placement:"top-start",children:(0,r.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:a,children:(0,r.jsx)(y.Z,{sx:{fontSize:"16px"}})})})]})})};F.propTypes={noDelete:d().func,onDelete:d().func,isAdded:d().bool,media:d().object,onSave:d().func};var I=function(e){var n=e.values,i=e.setValue,s=e.name,d=e.title,v=e.titleSx,h=e.onDeleteExistingMedia,x=(0,l.useState)([]),b=x[0],g=x[1];(0,l.useEffect)(function(){Array.isArray(n)&&g(n)},[n]);var y=function(e){e.stopPropagation(),g(function(e){return(0,a.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},S=function(e,n){var t=(0,a.Z)(b);t.splice(e,1,n),i(s,t)};return(0,r.jsxs)(m.Z,{children:[(0,r.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(u.Z,{sx:v,children:d?d+":":""}),(0,r.jsx)(f.Z,{title:"Add new attachment",placement:"top-start",children:(0,r.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:y,children:(0,r.jsx)(p.Z,{})})})]}),(0,r.jsx)(m.Z,{pl:2,spacing:.8,children:(null==b?void 0:b.length)?b.map(function(e,n){var a;return(0,r.jsx)(F,(0,o.Z)((0,t.Z)({index:n},e),{onDelete:function(){h&&b[n].mediaId&&h(b[n].mediaId);var e=b.filter(function(e,i){return i!==n});i(s,e),g(e)},onSave:function(e){return S(n,e)}}),e.caption+n)}):(0,r.jsx)(u.Z,{typography:"subtitle2",children:"No data"})})]})};I.propTypes={values:d().array,setValue:d().func,name:d().string,title:d().string,titleSx:d().object,onDeleteExistingMedia:d().func},I.defaultProps={name:"attachments",title:"Attachments",titleSx:{}}},60185:function(e,n,i){i.d(n,{z:function(){return m}});var t=i(47568),o=i(828),a=i(29815),r=i(97582),l=i(6388),s=i(50319),d=i(52824),u=i(24043),c=i(67294),m=function(e,n,i,m){var f,p,v,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",x=(0,c.useState)(!1),b=x[0],g=x[1],y=(0,l.aM)(d.O,{variables:{entity:e,entityId:m,category:h,adminId:n},skip:!m}),S=y.data,Z=(void 0===S?{items:[]}:S).items,j=y.loading,w=(0,o.Z)((0,s.D)(u.CI),2),k=w[0],F=w[1].loading,I=(0,o.Z)((0,s.D)(u.xM,{refetchQueries:["MEDIAS"]}),1)[0],C=function(e){k({variables:{mediaId:e}})},D=function(){var e="cleverly-staging-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},_=(f=(0,t.Z)(function(t,o){var a,l;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,,4,5]),g(!0),!o)return[3,3];return[4,E(o)];case 1:return a=r.sent(),l={adminId:n,caption:o.caption,expiryAt:null,extension:o.media.name.split(".").pop(),userId:i,filename:a.key,type:o.type,Media_Entities:{data:[{entity:e,entityId:t}]}},[4,I({variables:{objects:l}})];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:return g(!1),[7];case 5:return[2]}})}),function(e,n){return f.apply(this,arguments)}),q=(p=(0,t.Z)(function(){var t,o,l,s,d,u,c,m,f,p,v,h,x,b,y,S,Z,j,w=arguments;return(0,r.__generator)(this,function(r){switch(r.label){case 0:t=w.length>0&&void 0!==w[0]?w[0]:[],o=w.length>1&&void 0!==w[1]?w[1]:"media",r.label=1;case 1:r.trys.push([1,,10,11]),g(!0),l=null,s=!0,d=!1,u=void 0,r.label=2;case 2:r.trys.push([2,7,8,9]),c=t[Symbol.iterator](),r.label=3;case 3:if(s=(m=c.next()).done)return[3,6];if((f=m.value).mediaId)return[3,5];return[4,E(f)];case 4:v=r.sent(),h=null,x=null,"image"===f.type?(b=v.key,h=(y=v.data.find(function(e){return"large"===e.name}))?y.relativePath:b,x={original:{relativePath:b},thumbnails:v.data||null}):h=v.key,l={Media_Entity:{data:(0,a.Z)(null!==(S=null==l?void 0:null===(p=l.Media_Entity)||void 0===p?void 0:p.data)&&void 0!==S?S:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(Z=null==f?void 0:f.caption)&&void 0!==Z?Z:null,expiryAt:null,extension:f.media.name.split(".").pop(),userId:i,category:o,filename:h,type:f.type,meta:x}}}])}},r.label=5;case 5:return s=!0,[3,3];case 6:return[3,9];case 7:return j=r.sent(),d=!0,u=j,[3,9];case 8:try{s||null==c.return||c.return()}finally{if(d)throw u}return[7];case 9:return[2,l];case 10:return g(!1),[7];case 11:return[2]}})}),function(){return p.apply(this,arguments)}),E=(v=(0,t.Z)(function(e){var n,i,t,o,a;return(0,r.__generator)(this,function(a){switch(a.label){case 0:switch(n="cleverly-staging-media",i="https://aws-staging.cleverly.works/aws/s3/upload",(t=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":o="https://aws-staging.cleverly.works/image/process",t.append("sizes",D());break;case"document":case"audio":t.append("bucket",n),t.append("folder","".concat(e.type,"s")),o=i}return[4,window.fetch(o,{method:"POST",body:t})];case 1:return[2,a.sent().json()]}})}),function(e){return v.apply(this,arguments)});return{uploadMedia:_,uploadMediaToS3:E,createMediaInput:q,deleteMediaByEntity:C,loadingAddMedia:b,loadingDeleteMedia:F,preloadedMediaLoading:j,preloadedMedia:(null==Z?void 0:Z.length)?Z:[]}}}}]);