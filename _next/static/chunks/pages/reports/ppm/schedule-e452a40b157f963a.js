(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7945],{94360:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/ppm/schedule",function(){return t(58792)}])},59002:function(e,n,t){"use strict";t.d(n,{K:function(){return r}});var r=function(e){var n,t,r,a,o,i,u=null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:n.frequency;return{isAnyTime:(null==e?void 0:null===(t=e.repeat)||void 0===t?void 0:null===(r=t[u.toLocaleLowerCase()])||void 0===r?void 0:r.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(a=e.repeat)||void 0===a?void 0:null===(o=a[u.toLocaleLowerCase()])||void 0===o?void 0:o.excludingWeekends}}},20823:function(e,n,t){"use strict";t.d(n,{p:function(){return s}});var r=t(29815),a=t(30381),o=t.n(a),i=t(81836),u=t(67574),s=function(e,n,t){var a=i.ZP.fromString(e),s=a.origOptions,l=s.freq,c=s.until,d=s.dtstart,v=o()(d),m=a.all();t&&(v.day()===u.p3.Saturday||v.day()===u.p3.Sunday)&&v.add(v.day()===u.p3.Saturday?2:1,"day");var y=1===o()(d).date(),p=v.isSame(d,"month");if(l===i.Di.MONTHLY&&n&&!y&&p){var h=c?(0,r.Z)(m):m.slice(0,-1);return h.unshift(v),h}return l===i.Di.YEARLY&&n?m.map(function(e,n){var r=o()(e);return n>0&&r.startOf("month"),t&&(r.day()===u.p3.Saturday||r.day()===u.p3.Sunday)&&r.add(r.day()===u.p3.Saturday?2:1,"day"),r}):m}},22595:function(e,n,t){"use strict";t.d(n,{E:function(){return r}});var r=function(e,n){if(Array.isArray(n)){var t,r=null;return n.forEach(function(n){var t,a=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});r=(null==a?void 0:a.createdAt)||r}),r}var a=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==a?void 0:a.createdAt)||null}},12547:function(e,n,t){"use strict";t.d(n,{r:function(){return d}});var r=t(26042),a=t(69396),o=t(85893),i=t(45697),u=t.n(i),s=t(41664),l=t.n(s),c=t(23795),d=function(e){var n=e.children,t=e.href,i=e.noWrap,u=e.target,s=e.sx,d=void 0===s?{}:s;return i?(0,o.jsx)(o.Fragment,{children:n}):t?(0,o.jsx)(l(),{href:t,target:u,passHref:!0,children:(0,o.jsx)(c.Z,(0,a.Z)((0,r.Z)({sx:d},e),{children:n}))}):(0,o.jsx)(c.Z,(0,a.Z)((0,r.Z)({sx:d},e),{children:n}))};d.defaultProps={onClick:function(e){e.stopPropagation()}},d.propTypes={onClick:u().func,href:u().string,noWrap:u().bool,color:u().string}},83075:function(e,n,t){"use strict";t.d(n,{BH:function(){return b},CH:function(){return I},U$:function(){return f},WJ:function(){return S},k3:function(){return x},tf:function(){return g}});var r,a=t(47568),o=t(29815),i=t(97582),u=t(81836),s=t(10928),l=t.n(s),c=t(22595),d=t(30381),v=t.n(d),m=t(67574),y=t(20823),p=t(59002),h=t(25410),f=(r=(0,a.Z)(function(e){var n,t,r,a,u,s,l,c,d,f,b,g,x,I,S,j,_,q,Z,w,C,T,D,k,A,F;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(n=e.addJobFunc,t=e.location,r=e.row,a=e.adminId,S=(I=(0,p.K)(null==r?void 0:r.rruleMeta)).isAnyTime,j=I.excludingWeekends,_=[],_=Array.isArray(r.dates)?r.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,y.p)(r.frequency,S,j),q=r.costCustomer,Z=r.costSupplier,w=(null==t?void 0:null===(u=t.user)||void 0===u?void 0:u.id)||null,C=r.supplier.value,T=null==r?void 0:null===(s=r.rruleMeta)||void 0===s?void 0:null===(l=s.repeat)||void 0===l?void 0:l.frequency,D=null==r?void 0:null===(c=r.rruleMeta)||void 0===c?void 0:null===(d=c.repeat)||void 0===d?void 0:null===(f=d[T.toLocaleLowerCase()])||void 0===f?void 0:f.hourStart,k=null==r?void 0:null===(b=r.rruleMeta)||void 0===b?void 0:null===(g=b.repeat)||void 0===g?void 0:null===(x=g[T.toLocaleLowerCase()])||void 0===x?void 0:x.hourEnd,A=[],_.forEach(function(e){var n,i,u,s,l,c,d,y={access:t.access,adminId:a,amount:q,assetCategoryId:null===(n=r.assetCategory)||void 0===n?void 0:n.value,costCategoryId:r.costCategory.value,customerId:t.customer[0].account.id,customerUserId:w,description:r.description,jobScheduleId:r.id,locationId:t.id,sublocationId:null===(i=r.sublocation)||void 0===i?void 0:i.value,managerId:t.customer[0].account.managerId,pricing:"fixed",serviceId:r.service.value,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:Z,timing:"at",timingStart:e,timingEnd:v()(e).endOf(m._f[T]),title:r.title,type:"ppm",reference:r.reference,reportPassFail:r.reportPassFail,reportPassFailTitle:r.reportPassFailTitle,requireReportRecommendations:r.requireReportRecommendations,anyTimeOption:S,hourStart:D?v()(D).format("HH:mm:ssZ"):null,hourEnd:k?v()(k).format("HH:mm:ssZ"):null,meta:{customerSignature:r.customerSignature,supplierSignature:r.supplierSignature},JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:C}]},Taxonomy:{data:[{entity:"Job",taxonomyId:r.shortDescription.value}].concat((0,o.Z)(r.tags?(0,h.O)(r.tags):[]))}};(null==r?void 0:null===(u=r.rruleMeta)||void 0===u?void 0:null===(s=u.repeat)||void 0===s?void 0:null===(l=s[T.toLocaleLowerCase()])||void 0===l?void 0:l.excludingWeekends)&&(y.timingEnd.day()===m.p3.Saturday||y.timingEnd.day()===m.p3.Sunday)&&y.timingEnd.subtract(m.Fs[y.timingEnd.day()],"day"),r.hasCompliance&&(null===(c=r.complianceSelect)||void 0===c?void 0:c.value)&&(y.Compliances={data:{complianceId:r.complianceSelect.value,entity:"Job",status:"active"}}),r.estimatedDuration&&r.estimatedDurationUnit&&(y.estimatedDuration=r.estimatedDuration,y.estimatedDurationUnit=r.estimatedDurationUnit),(null===(d=r.assetSelected)||void 0===d?void 0:d.length)>0&&(y.Assets={data:r.assetSelected.map(function(e){return{status:"active",assetId:e.value}})}),A.push(y)}),!((null==A?void 0:A.length)>0))return[3,2];return[4,n({variables:{adminId:a,objects:A}})];case 1:i.sent(),i.label=2;case 2:return[2]}})}),function(e){return r.apply(this,arguments)}),b=function(e){var n=e.scheduledJobs,t={},r={};return n.forEach(function(e){if(e.jobs&&e.jobs.length>0){var n=e.jobs.find(function(e){return new Date(e.timingStart)>new Date});!((null==n?void 0:n.timingStart)<(null==t?void 0:t.timingStart))&&(null==t?void 0:t.timingStart)||(t=n)}var a=u.Ci.fromString(e.frequency).all(),o=l()(a);(!r.date||o<(null==r?void 0:r.date))&&(r.date=o,r.name=e.meta.serviceName)}),{nextExpire:r,nextJob:t}},g=function(e){var n=e.frequency,t=e.cost;return u.Ci.fromString(n).all().length*t},x=function(e){var n,t=e.jobScheduleId,r=e.jobs;return r&&(n=r.filter(function(e){return e.jobScheduleId===t&&(0,c.E)(e,["reportSent","closed"])}).length),n||0},I=function(e,n){var t=v()(e.timingStart);return t.isSameOrAfter(n.startDate)&&t.isSameOrBefore(n.endDate)},S=function(e){var n=e.assetSelected,t=void 0===n?[]:n,r=(e.compliance,e.service),a=void 0===r?[]:r,o=e.assetCategory,i=e.dateFilter,u={status:{_neq:"canceled"}};return(null==i?void 0:i.startDate)&&(null==i?void 0:i.endDate)&&(u.timingStart={_gte:i.startDate,_lte:i.endDate}),(null==t?void 0:t.length)>0&&(u.Assets={id:{_in:t.map(function(e){return e.value})}}),(null==a?void 0:a.length)>0&&(u.Service={id:{_in:a.map(function(e){return null==e?void 0:e.value})}}),(null==o?void 0:o.value)&&(u.AssetCategory={id:{_eq:null==o?void 0:o.value}}),u}},10546:function(e,n,t){"use strict";t.d(n,{B6:function(){return f},Ms:function(){return y},RV:function(){return p},YW:function(){return h},mJ:function(){return b}});var r=t(7297),a=t(75063);function o(){var e=(0,r.Z)(["\n  query GetAssetParents($ids: [Int!]!) {\n    asset: Asset(where: { id: { _in: $ids } }) {\n      id\n      name\n      parent: ParentAsset {\n        id\n        name\n        parent: ParentAsset {\n          id\n          name\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function i(){var e=(0,r.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule(where: { id: { _eq: $id } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return i=function(){return e},e}function u(){var e=(0,r.Z)(['\n  query GetJobSchedule($orderBy: JobSchedule_order_by!, $locationId: Int) {\n    JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: [$orderBy]) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      contract: JobScheduleContract {\n        name\n        invoiceDate\n        startDate\n        contractLength\n        contractValue\n        status\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings(order_by: { createdAt: desc }) {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return u=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetJobSchedule($id: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $id) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,r.Z)(['\n  query GetJobCompliance($locationId: Int!, $where: Job_bool_exp!) {\n    jobSchedule: JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: { id: asc }) {\n      frequency\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      sublocation: Sublocation {\n        id\n        name\n      }\n      serviceName: meta(path: "$.serviceName")\n      costCustomer: meta(path: "$.costCustomer")\n      costSupplier: meta(path: "$.costSupplier")\n      frequency\n      jobs: Jobs(where: $where) {\n        id\n        rag\n        timingStart\n      }\n      totalJobs: Jobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n  }\n']);return l=function(){return e},e}function c(){var e=(0,r.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return c=function(){return e},e}function d(){var e=(0,r.Z)(["\n  query GetStatusLog($entity: String!, $entityId: Int!) {\n    statusLog: StatusLog(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      id\n      createdAt\n      notes\n      status\n    }\n  }\n"]);return d=function(){return e},e}function v(){var e=(0,r.Z)(["\n  mutation AddJob($objects: [Job_insert_input!]!) {\n    insert_Job(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return v=function(){return e},e}function m(){var e=(0,r.Z)(["\n  mutation MyMutation($objects: [CreateJobInput]!, $adminId: Int!) {\n    createJob(adminId: $adminId, objects: $objects) {\n      data\n    }\n  }\n"]);return m=function(){return e},e}(0,a.Ps)(o());var y=(0,a.Ps)(i()),p=(0,a.Ps)(u());(0,a.Ps)(s());var h=(0,a.Ps)(l()),f=(0,a.Ps)(c());(0,a.Ps)(d()),(0,a.Ps)(v());var b=(0,a.Ps)(m())},67230:function(e,n,t){"use strict";t.d(n,{K:function(){return P}});var r=t(26042),a=t(69396),o=t(828),i=t(7297),u=t(85893),s=t(67294),l=t(45697),c=t(16391),d=t(73359),v=t(10546),m=t(52019),y=t(16551),p=t(97303),h=t(77439),f=t(11585),b=t(11717),g=t(51466),x=t(40826),I=t(11082),S=t(42283),j=t(76600),_=t(90951),q=t(66812),Z=t(18586),w=function(e){var n,t,o=e.defaultValues,i=e.setScheduleFilters,s=e.toggleShow,l=(0,Z.q)(),c=null==l?void 0:null===(n=l.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,d=(0,S.cI)({defaultValues:o}),v=d.control,m=d.errors,y=d.handleSubmit,p=d.register,h=(0,d.watch)("assetCategory",null==o?void 0:o.assetCategory),f={control:v,errors:m,register:p},b=function(e){i(function(){return(0,r.Z)({},e)}),s()};return(0,u.jsxs)(j.Z,{id:"offCanvasForm",handleSubmit:y(b),children:[(0,u.jsx)(_.Z,(0,a.Z)((0,r.Z)({},f),{name:"compliance",data:[{id:"yes",label:"Yes",value:!0},{id:"no",label:"No",value:!1}],legend:"Compliance"})),c&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(q.P,(0,a.Z)((0,r.Z)({},f),{label:"Asset category",locationId:location.id,name:"assetCategory",type:"assetCategory"})),h&&(0,u.jsx)(q.P,(0,a.Z)((0,r.Z)({},f),{label:"Assets",locationId:location.id,name:"assetSelected",type:"asset",isMulti:!0,assetCategoryId:(null==h?void 0:h.value)||null}))]}),(0,u.jsx)(q.P,(0,a.Z)((0,r.Z)({},f),{errors:(0,r.Z)({},m),isMulti:!0,label:"Service",name:"service",type:"service"}))]})};w.propTypes={defaultValues:l.object};var C=t(83075),T=t(10367),D=t(64872),k=t(83985);function A(){var e=(0,i.Z)(["\n  width: 100%;\n  text-align: left;\n  display: flex;\n  column-gap: 10px;\n"]);return A=function(){return e},e}function F(){var e=(0,i.Z)(["\n  width: 50%;\n"]);return F=function(){return e},e}var P=function(e){var n=e.clickable,t=e.handleHistory,i=e.locationId,l=(e.showDetails,e.refetchSchedule),S=e.setRefetchSchedule,j=(e.setR,e.customerDetails),_=e.supplierDetails,q=(0,c.useMainContext)(),Z=q.setJobScheduleForToolbar,T=q.scheduleFilters,A=q.setScheduleFilters,F=(0,D.a)(),P=(0,s.useContext)(m.Z).hasRole,M=function(e,n,r){var a=e.e,o=e.row;a.stopPropagation();var i=T.mode;"string"!=typeof(null==o?void 0:o.id)&&t(o,i,r)},L=(0,o.Z)((0,d.t)(v.YW),2),W=L[0],E=L[1],O=E.data,R=(void 0===O?{jobSchedule:[]}:O).jobSchedule,H=void 0===R?[]:R,N=E.refetch;(0,s.useEffect)(function(){Z(H)},[H,Z]),(0,s.useEffect)(function(){T&&W({variables:{locationId:i,where:(0,C.WJ)((0,r.Z)({},T))}})},[W,i,T]),(0,s.useEffect)(function(){l&&(A(!1),S(!1),N())},[N,l,S,A]);var z=function(e){e.stopPropagation(),F.show({content:(0,u.jsx)(w,{defaultValues:T,toggleShow:F.close,setScheduleFilters:A}),title:"Filter"})},G=function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,u.jsxs)(y.Z,{children:[(0,u.jsx)(p.Z,{border:!1,passHref:!0,to:"/reports/ppm/schedule?locationId=".concat(i),children:(0,u.jsx)(h.Z,(0,a.Z)((0,r.Z)({},e),{startIcon:"file-pdf"}))}),(0,u.jsx)(h.Z,(0,a.Z)((0,r.Z)({},e),{onClick:z,startIcon:"filter"}))]})};return(0,u.jsx)(f.Z,{fitParentHeight:!0,open:!0,title:"Schedule",toolbar:(0,u.jsx)(G,{}),children:(0,u.jsx)(b.Z,{dataSource:H,events:"jobs",eventTimeSplitting:"timingStart",flag:"rag",handleClick:n?M:null,handleFetchData:function(e,n){var t=e.startDate,o=e.endDate;A(function(e){return(0,a.Z)((0,r.Z)({},e),{dateFilter:{startDate:t,endDate:o},mode:n})})},hiddenColumn:["frequency","id","title","description","sublocation","costCustomer","costSupplier","serviceName","jobs"],initialMode:"year",onTitleFormatter:function(e){var n=e.row;return(0,u.jsxs)(J,{children:[(0,u.jsxs)($,{children:[(0,u.jsxs)(g.Z,{size:"sm",children:[n.compliance&&(0,u.jsx)(x.Z,{context:"info",icon:"clipboard-check"}),n.serviceName]}),n.costCustomer&&P("customer")&&(0,u.jsx)(g.Z,{size:"xs",children:(0,I.Z)(n.costCustomer)}),n.costSupplier&&P("supplier")&&(0,u.jsx)(g.Z,{size:"xs",children:(0,I.Z)(n.costSupplier)}),n.costCustomer&&P("admin")&&n.costCustomer&&j&&(0,u.jsxs)(g.Z,{size:"xs",children:["Customer: ",(0,I.Z)(n.costCustomer)]}),n.costSupplier&&P("admin")&&_&&n.costSupplier&&(0,u.jsxs)(g.Z,{size:"xs",children:["Supplier: ",(0,I.Z)(n.costSupplier)]})]}),(0,u.jsxs)($,{children:[(0,u.jsx)(g.Z,{size:"sm",children:n.title}),(0,u.jsx)(k.O,{maxLength:40,children:n.description}),n.sublocation&&(0,u.jsxs)(g.Z,{size:"xs",children:["Sublocation: ",n.sublocation.name]})]})]})},title:"serviceName"})})};P.propTypes={clickable:l.bool,handleHistory:l.func,locationId:l.number,showDetails:l.bool},P.defaultProps={clickable:!0,showDetails:!0};var J=T.ZP.div.withConfig({displayName:"schedule__StyledContainer",componentId:"sc-a1ebbf5c-0"})(A()),$=T.ZP.div.withConfig({displayName:"schedule__StyledItem",componentId:"sc-a1ebbf5c-1"})(F())},66812:function(e,n,t){"use strict";t.d(n,{P:function(){return _}});var r=t(47568),a=t(26042),o=t(99534),i=t(7297),u=t(97582),s=t(85893),l=t(67294),c=t(45697),d=t(10367),v=t(66252),m=t(4972),y=t(78289),p=t(52019),h=t(49501),f=t(9270),b=t(62140),g=t(84043),x=t(77439);function I(){var e=(0,i.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return I=function(){return e},e}var S=function(e,n){var t,r,a,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(t){e[t]!==n[t]&&(o=!1)}),o},j=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,a=e.entity,o=e.entityId,i=(e.hasRole,e.id),u=e.locationId,s=e.serviceId,l=e.taxonomyGroupType,c=e.customerId,d=e.customerRole,v=e.type,y=e.userId,p=e.invoiceThreshold,h=e.quoteThreshold,f=v;switch(d&&(f="".concat(v,"_").concat(d)),f){case"address":return{query:m.cz,variables:{entity:a,entityId:o}};case"asset":return{query:m.UH,variables:{categoryId:r,locationId:u}};case"assetBookable":return{query:m.UH,variables:{categoryId:r,locationId:u,bookable:"yes"}};case"assetCategory":return{query:m.nD,variables:{id:i}};case"assetSublocation":return{query:m.UH,variables:{category:"sublocation",adminId:n,locationId:u}};case"compliance":return{query:m.kU,variables:{locationId:u}};case"coverage":return{query:m.j$};case"customer":return{query:m.SW};case"job":return{query:m.Qn,variables:{locationId:u}};case"manager":return{query:m.he,variables:{accountId:n,userId:y}};case"thresholdManagers":return{query:m.Ak,variables:{accountId:n,userId:y,invoiceThreshold:p,quoteThreshold:h}};case"product":return{query:m.UH,variables:{category:"product",locationId:u}};case"property":return{query:m._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:m._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:c}}},User_Account_Locations:{Account_User:{userId:{_eq:c},accountId:{_eq:n}}}}}}};case"sensor":return{query:m.UH,variables:{category:"sensor",locationId:u}};case"service":return{query:m.kx};case"sla":return{query:m.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:m.zR,variables:{locationId:u}};case"supplier":var b={type:{_eq:"supplier"}};return t&&(b.PostcodeAreas={PostcodeArea:{area:{_eq:t}},entity:{_eq:"Account"},status:{_eq:"active"}}),s&&(b.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:s}},t&&(b.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:t}}})),{query:m.by,variables:{where:b}};case"user":return{query:m.yR,variables:{accountId:n}};case"usersForBookings":return{query:m.yR,variables:{accountId:y}};case"tenant":return{query:m.RJ};case"taxonomyGroup":return{query:m.Cj,variables:{type:l}};case"expenseCategory":return{query:m.Ve};default:return{query:m.qd}}},_=(0,l.memo)(function(e){var n,t=e.AddForm,i=e.accountId,c=e.area,d=e.assetCategoryId,m=e.control,I=e.entity,S=e.entityId,_=e.errors,Z=e.id,w=e.isClearable,C=e.isDisabled,T=e.label,D=e.locationId,k=e.name,A=e.serviceId,F=e.taxonomyGroupType,P=e.customerId,J=e.customerRole,$=e.type,M=e.userId,L=e.invoiceThreshold,W=e.quoteThreshold,E=(0,o.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),O=(0,v.x)(),R=(0,l.useState)(!1),H=R[0],N=R[1],z=(0,l.useState)(),G=z[0],U=z[1],B=(0,l.useState)(!1),Y=B[0],V=B[1],K=(0,l.useContext)(y.Z),X=(0,l.useContext)(p.Z).hasRole,Q=(0,l.useState)(!1),ee=Q[0],en=Q[1];(0,l.useEffect)(function(){return en(!1),V(!1),function(){}},[i,d,I,S,D,A,$,P,J,M]);var et=(n=(0,r.Z)(function(){var e,n,t,r,o,s,l;return(0,u.__generator)(this,function(o){switch(o.label){case 0:if(Y)return en(!0),[2,null];return N(!0),n=(e=j({accountId:i,area:c,assetCategoryId:d,entity:I,entityId:S,hasRole:X,id:Z,locationId:D,serviceId:A,taxonomyGroupType:F,customerId:P,customerRole:J,type:$,userId:M,invoiceThreshold:L,quoteThreshold:W})).query,r=void 0===(t=e.variables)?{}:t,[4,O.query({query:n,variables:(0,a.Z)({},r)})];case 1:return U((void 0===(s=o.sent().data)?{items:[]}:s).items),N(!1),V(!0),en(!0),[2]}})}),function(){return n.apply(this,arguments)}),er=function(){K.show({content:(0,s.jsx)("div",{children:(0,s.jsx)(t,{})}),title:"Add form"})};return(0,s.jsx)(h.Z,{id:k,label:T,children:(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(b.Z,{md:t?11:12,children:(0,s.jsx)(g.Z,(0,a.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:m,errors:_,isDisabled:C,isClearable:w,isLoading:H,menuIsOpen:ee,options:G,onFocus:et,onBlur:function(){en(!1)},name:k,searchable:!0},E),E.defaultValue)}),t&&(0,s.jsx)(b.Z,{md:1,children:(0,s.jsx)(q,{children:(0,s.jsx)(x.Z,{content:null,startIcon:"plus",size:"sm",onClick:er})})})]})})},S),q=d.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-fdff7245-0"})(I());_.propTypes={AddForm:c.object,area:c.string,accountId:c.number,assetCategoryId:c.number,control:c.object.isRequired,errors:c.object.isRequired,entity:c.string,entityId:c.number,id:c.number,isClearable:c.bool,label:c.string.isRequired,locationId:c.number,name:c.string.isRequired,serviceId:c.number,taxonomyGroupType:(0,c.oneOf)(["expenseCategory","costCategory","jobTags"]),type:c.string},_.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},25410:function(e,n,t){"use strict";t.d(n,{O:function(){return r}});var r=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})}},83985:function(e,n,t){"use strict";t.d(n,{O:function(){return v}});var r=t(26042),a=t(69396),o=t(99534),i=t(85893),u=t(67294),s=t(12547),l=t(45697),c=t.n(l),d=t(15861),v=function(e){var n=e.maxLength,t=e.children,l=e.href,c=e.fontSize,v=(0,o.Z)(e,["maxLength","children","href","fontSize"]),m=(0,u.useState)(!1),y=m[0],p=m[1],h=function(e){e.stopPropagation(),p(!y)},f=(null==t?void 0:t.length)>n?"".concat(t.slice(0,n),"..."):t,b=y?t:f,g=l?(0,i.jsx)(s.r,{color:"secondary",href:l,children:b}):b;return(0,i.jsxs)(d.Z,(0,a.Z)((0,r.Z)({fontSize:c},v),{children:[g,!y&&(null==t?void 0:t.length)>n&&(0,i.jsx)(d.Z,{underline:"none",fontSize:c,sx:{cursor:"pointer",display:"inline-block",fontWeight:600,color:"rgba(0, 0, 0, 0.5)"},onClick:h,children:"more"}),y&&t.length>n&&(0,i.jsx)(d.Z,{underline:"none",fontSize:c,sx:{cursor:"pointer",display:"inline-block",fontWeight:600,color:"rgba(0, 0, 0, 0.5)"},onClick:h,children:" | less"})]}))};v.defaultProps={maxLength:100,children:""},v.propTypes={maxLength:c().number,children:c().node}},67574:function(e,n,t){"use strict";t.d(n,{$9:function(){return d},$i:function(){return f},CM:function(){return a},Fs:function(){return x},HG:function(){return v},Ib:function(){return r},Ic:function(){return y},MF:function(){return o},_f:function(){return s},c7:function(){return p},e6:function(){return c},jT:function(){return l},p3:function(){return g},pH:function(){return m},qG:function(){return h},um:function(){return u},ut:function(){return b},y7:function(){return i}});var r=[{id:"anyTimeOption",label:"any time",value:"anyTimeOption"}],a=[{id:"anyTimeOption",label:"any time (during month)",value:"anyTimeOption"}],o=[{id:"excludingWeekends",label:"excluding weekends",value:!0}],i=[{text:"Yearly",value:"Yearly"},{text:"Monthly",value:"Monthly"},{text:"Weekly",value:"Weekly"},{text:"Daily",value:"Daily"},{text:"Hourly",value:"Hourly"}],u=[{label:"Yearly",value:"Yearly"},{label:"Monthly",value:"Monthly"},{label:"Weekly",value:"Weekly"},{label:"Daily",value:"Daily"},{label:"Hourly",value:"Hourly"}],s={Yearly:"month",Monthly:"month",Weekly:"isoWeek",Daily:"day"},l=[{id:"on",label:"on",value:"on"}],c=[{id:"onThe",label:"on the",value:"on the"}],d=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],v=[{label:"First",value:"First"},{label:"Second",value:"Second"},{label:"Third",value:"Third"},{label:"Fourth",value:"Fourth"},{label:"Last",value:"Last"}],m=[{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Day",value:"Day"},{text:"Weekday",value:"Weekday"},{text:"Weekend day",value:"Weekend day"}],y=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Day",value:"Day"},{label:"Weekday",value:"Weekday"},{label:"Weekend day",value:"Weekend day"}],p=[{id:"on",label:"on day",value:"on"}],h=[{id:"onThe",label:"on the",value:"on the"}],f=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],b=[{text:"After",value:"After"},{text:"On date",value:"On date"}],g={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},x={0:2,6:1}},58792:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return J}});var r=t(85893),a=t(7297),o=t(10367);function i(){var e=(0,a.Z)(["\n  background: white;\n  width: 21cm;\n  min-height: 29.7cm;\n  display: block;\n  margin: 0 auto;\n  margin-bottom: 0.5cm;\n  padding: 0.5cm;\n  box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);\n  font-family: 'lato';\n  font-size: 10pt;\n  color: black;\n"]);return i=function(){return e},e}var u=function(e){var n=e.children;return(0,r.jsx)(s,{id:"printContainer",children:n})},s=o.ZP.div.withConfig({displayName:"page__StyledContainer",componentId:"sc-1510e77b-0"})(i()),l=t(47568),c=t(97582),d=t(67294),v=t(13777),m=t(16551),y=t(77439),p=t(2845),h=function(e){var n,t=e.location,a=e.jobScheduleForToolBar,o=e.customerDetails,i=e.supplierDetails,u=e.endDate,s=(0,p.x)().user,h=(0,d.useState)(!1),f=h[0],b=h[1],g=function(){window.history.back()},x=(n=(0,l.Z)(function(){var e;return(0,c.__generator)(this,function(n){switch(n.label){case 0:return b(!0),e={location:t.name,ppmDate:new Date,jobSchedule:a,customerDetails:o,supplierDetails:i,adminId:s.accountId,year:u},[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){var n=window.open("/download","_blank");b(!1),n.location.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key))}).catch(function(e){(0,v.Tb)({message:e,section:"fetch"})})];case 1:return n.sent(),[2]}})}),function(){return n.apply(this,arguments)});return(0,r.jsxs)(m.Z,{align:"center",children:[(0,r.jsx)(y.Z,{context:"secondary",content:"".concat(f?"Generating PDF":"Download"),disabled:f,"data-cy":"downloadPDF",onClick:x}),(0,r.jsx)(y.Z,{context:"secondary",content:"Back","data-cy":"backButton",onClick:g})]})},f=t(9270),b=t(62140),g=t(51466),x=t(6388),I=t(75063);function S(){var e=(0,a.Z)(['\n  query GetLogo($adminId: Int!) {\n    account: Account_by_pk(id: $adminId) {\n      id\n      media: Media(\n        where: { entity: { _eq: "Account" }, Medium: { category: { _eq: "invoiceLogo" } } }\n        limit: 1\n        order_by: { createdAt: desc }\n      ) {\n        id\n        item: Medium {\n          id\n          filename\n        }\n      }\n    }\n  }\n']);return S=function(){return e},e}var j=(0,I.Ps)(S()),_=t(34953),q=function(){var e,n,t,a=(0,p.x)(),o=a.hasRole,i=a.user,u=(0,x.aM)(j,{variables:{adminId:o("admin")?i.adminId:i.accountId}}).data,s=(void 0===u?{account:[]}:u).account;return(null==s?void 0:s.media)&&(null==s?void 0:null===(e=s.media)||void 0===e?void 0:e.length)!==0?(0,r.jsx)(_.Z,{alt:"logo",src:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(null===(n=null==s?void 0:s.media[0])||void 0===n?void 0:null===(t=n.item)||void 0===t?void 0:t.filename),onError:function(e){return e.target.src="/static/logo/cleverly-full-logo-black.png"},width:100}):null},Z=function(e){var n=e.lines,t=e.reportName,a=(e.showDivider,e.supplier);return(0,r.jsxs)(f.Z,{className:"reportHeader",children:[(0,r.jsx)(b.Z,{md:9,children:(0,r.jsx)(q,{})}),(0,r.jsxs)(b.Z,{md:3,children:[(0,r.jsx)(g.Z,{context:"black",weight:"bold",children:t}),a&&(0,r.jsx)(g.Z,{context:"black",weight:"bold",children:"Supplier: ".concat(a)}),null==n?void 0:n.map(function(e,n){return(0,r.jsx)(g.Z,{context:"black",size:"sm",children:e})})]})]})};function w(){var e=(0,a.Z)(["\n  query GetLocationDetails($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      name\n    }\n  }\n"]);return w=function(){return e},e}var C=(0,I.Ps)(w()),T=t(11163),D=t(16391),k=t(67230),A=t(26186),F=function(e){var n=e.location,t=[];return t.push("Location: ".concat(null==n?void 0:n.name)),t.push("Date:  ".concat((0,A.Z)(new Date))),t},P=function(){var e=(0,T.useRouter)().query,n=(0,D.useMainContext)(),t=n.customerDetails,a=n.supplierDetails,o=n.jobScheduleForToolBar,i=n.scheduleFilters,s=(0,x.aM)(C,{variables:{id:e.locationId}}).data,l=(void 0===s?{}:s).location;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h,{location:l,jobScheduleForToolBar:o,customerDetails:t,supplierDetails:a,endDate:i.dateFilter.endDate}),(0,r.jsxs)(u,{children:[(0,r.jsx)(Z,{lines:F({location:l}),reportName:"PPM Schedule",showDivider:!0}),(0,r.jsx)("div",{style:{zoom:"75%"},children:(0,r.jsx)(k.K,{clickable:!1,locationId:e.locationId,showDetails:!1,customerDetails:t,supplierDetails:a})})]})]})},J=function(){return(0,r.jsx)(P,{})}}},function(e){e.O(0,[3662,9809,2283,212,1838,1417,1564,3054,8500,4043,6075,1836,108,403,4972,9774,2888,179],function(){return e(e.s=94360)}),_N_E=e.O()}]);