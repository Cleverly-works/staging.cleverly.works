(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{48045:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/users",function(){return e(80803)}])},46929:function(n,t,e){"use strict";e.d(t,{r:function(){return a}});var r=e(85893),i=e(45697),o=e(95103),a=function(n){var t=n.errors,e=n.name,i=n.onChange,a=n.options,s=n.register;return(0,r.jsx)(o.Z,{errors:t,name:e,onChange:i,options:a,register:s})};a.propTypes={errors:i.object.isRequired,name:i.string,onChange:i.func,options:i.array.isRequired,register:i.func.isRequired},a.defaultProps={name:"status"}},35418:function(n,t,e){"use strict";e.d(t,{G:function(){return P}});var r=e(26042),i=e(69396),o=e(7297),a=e(85893),s=e(67294),c=e(45697),u=e(6388),d=e(52824),l=e(10367),f=e(78289),m=e(41564),p=e(34953),h=e(62466),g=e(68956),y=e(73373),v=e(11585),_=e(28733),I=e(55377),x=e(16551),Z=e(77439),b=e(74297),$=e(23892),w=e(39087),A=e(76256),j=e(75795),U=e(91272),C=e(20705),q=e(2845);function S(){var n=(0,o.Z)(["\n  width: 24px;\n"]);return S=function(){return n},n}function k(){var n=(0,o.Z)(["\n  border: 1px solid #eee;\n"]);return k=function(){return n},n}var P=function(n){var t=n.carousel,e=n.category,o=n.children,c=n.data,l=(n.details,n.entity),S=n.entityId,k=n.filters,P=(n.limit,n.listView),E=n.mediaMeta,L=n.onMediaAdd,M=n.onMediaRemove,z=(n.pagination,n.showActionButtons),N=n.showEntityColumn,R=n.showItemActions,D=n.summary,O=n.type,V=(0,C.x)({filters:k}),G=V.initialData,B=V.ref,H=(0,q.x)(),X=H.hasRole,J=H.user,W=(0,s.useContext)(f.Z),Q=(0,u.aM)(d.t,{variables:(0,i.Z)((0,r.Z)({},G),{entity:l,entityId:S,category:e,adminId:J.adminId,meta:E})}),K=Q.data,Y=void 0===K?{items:[],meta:{aggregate:{totalCount:0}}}:K,nn=Y.items,nt=Y.meta,ne=Q.loading,nr=Q.refetch,ni=function(n){W.close(),c.length||nr(),L&&L(n)},no=function(n){W.close(),c.length||nr(),M&&M(n)},na=function(n){n.stopPropagation(),W.show({content:(0,a.jsx)(A.z,{accept:"image/*",adminId:J.adminId,category:e,entity:l,entityId:S,expiryShow:!1,mediaMeta:E,multiple:!0,onSuccess:ni,type:"image"}),title:"Upload Photos"})},ns=function(n){n.stopPropagation(),W.show({content:(0,a.jsx)(A.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:J.adminId,category:e,entity:l,entityId:S,expiryShow:!1,mediaMeta:E,onSuccess:ni,type:"document"}),title:"Upload Documents"})},nc=function(n){W.show({content:(0,a.jsx)($.d,{mediaId:n.data.id,onSuccess:no}),submit:!1,title:"Delete Media"})},nu=function(n){W.show({content:(0,a.jsx)(w.z,{media:n.data,toggleShow:W.close}),submit:!1,title:"Media Details",width:"50%"})},nd=[{context:"primary",icon:["fas","info-circle"],onClick:function(n,t){return nu(t)},tooltip:"Details"}];X("admin")&&nd.push({context:"danger",icon:["fas","trash"],onClick:function(n,t){return nc(t)},tooltip:"Delete"});var nl=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!N,text:"Entity"},{formatter:function(n){var t,e=n.row;return(0,a.jsx)(F,{children:(null==e?void 0:null===(t=e.authority)||void 0===t?void 0:t.adminOnly)&&(0,a.jsx)(m.Z,{content:"Admin user only",children:(0,a.jsx)(p.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,h.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!P,text:"Thumbnails"},{hidden:!R,formatter:g.Z,formatterData:nd,text:"Actions"}],nf=function(n,t){n.preventDefault(),window.open("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(t))},nm=[],np=nn.map(function(n){var t=n.entity,e=n.entityId,r=n.id,i=n.item,o=i.caption,s=i.filename,c=i.meta,u=i.name,d=i.type,l=i.user;return{data:i,id:r,userId:null==l?void 0:l.id,file:function(){return(0,a.jsx)(y.Z,{onClick:function(n){return nf(n,s)},children:o||u||s})},entity:t&&"".concat(t,"#").concat(e),authority:c,uploaded:"".concat(null==l?void 0:l.nameFirst," ").concat(null==l?void 0:l.nameLast),thumbnails:(0,j.S)(d,c),actions:""}}),nh=(nn.forEach(function(n){var t=n.item,e=t.caption,r=t.filename;"image"===t.type&&nm.push({caption:e,filename:r})}),nm),ng=nh.length;return(0,a.jsxs)(v.Z,{fitParentHeight:!0,open:!0,title:D,children:[o,t&&ng>0&&(0,a.jsx)(T,{children:(0,a.jsx)(_.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:nh.map(function(n){var t=n.caption,e=n.filename;return{node:(0,a.jsx)(p.Z,{alt:t,src:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e)}),text:" "}})})}),(0,a.jsx)(U.t,{columns:nl,loading:ne,fullHeight:!0,paginationSize:!1,meta:nt,ref:B,refetch:nr,rows:np}),z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{size:"sm"}),(0,a.jsxs)(x.Z,{align:"flex-end",children:[(!O||"document"===O)&&!X("supplier")&&(0,a.jsx)(Z.Z,{content:"Add Document",context:"secondary",onClick:ns,size:"sm"}),(!O||"image"===O||"avatar"===O)&&!X("supplier")&&(0,a.jsx)(Z.Z,{content:"Add ".concat((0,b.Z)(O||"Image")),context:"secondary",onClick:na,size:"sm"})]})]})]})},F=l.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-9d92024f-0"})(S()),T=l.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-9d92024f-1"})(k());P.propTypes={carousel:c.bool,category:c.string,children:c.node,data:c.array,details:c.bool,entity:c.string,entityId:c.number,filters:c.object,limit:c.number,listView:c.bool,mediaMeta:c.object,onMediaAdd:c.func,onMediaRemove:c.func,pagination:c.object,showActionButtons:c.bool,showEntityColumn:c.bool,showItemActions:c.bool,summary:c.string,type:c.string},P.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},91272:function(n,t,e){"use strict";e.d(t,{t:function(){return u}});var r=e(85893),i=e(67294),o=e(45697),a=e(11163),s=e(46003),c=e(8500),u=(0,i.forwardRef)(function(n,t){var e=n.columns,o=n.history,u=n.initialSort,d=n.loading,l=n.meta,f=n.paginationSize,m=n.refetch,p=n.submissionsRefetch,h=n.rowClick,g=n.rows,y=n.xeroPageSize,v=(0,a.useRouter)(),_=v.query,I=void 0===_?{}:_,x=(0,i.useState)(parseInt(null==I?void 0:I.page,10)||1),Z=x[0],b=x[1],$=(0,i.useState)(y||s.C1.paginationSize),w=$[0],A=$[1];u||(u={item:"createdAt",order:"desc"});var j=(0,i.useState)({item:u.item,order:u.order}),U=j[0],C=j[1],q=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=v.query,e=void 0===t?{}:t;if(n>1?e.page=n:delete e.page,!(Object.keys(e).length>0))return{};var r=Object.keys(e).map(function(t){return"page"===t?"".concat(t,"=").concat(n):"".concat(t,"=").concat(e[t])}).join("&");return"?".concat(r)},S=function(){C({item:u.item,order:u.order}),b(1);var n=q();v.push(n),A(y||s.C1.paginationSize)};(0,i.useImperativeHandle)(t,function(){return{currentPage:Z,pageSize:w,sort:U,resetPagination:function(){S()}}});var k=function(n){var t=q(n);o&&v.push(t),b(n),!o&&m&&m()&&p&&p()},P=function(n){n!==s.C1.paginationSize&&(A(n),m&&m()&&p&&p())},F=function(n){var t;C({item:n.item,order:n.order}),m&&m()&&p&&p()};return(0,r.jsx)(c.Z,{columns:e,loading:d,paginationSize:f,pagination:l&&!0,paginationProps:l&&{currentPage:Z,onPageChange:k,onPageSizeChange:P,pageCount:Math.ceil(l.aggregate.totalCount/w),perPage:w},rowClick:h,rows:g,sort:U,setSort:F})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,submissionsRefetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},8299:function(n,t,e){"use strict";e.d(t,{P:function(){return T}});var r=e(47568),i=e(26042),o=e(828),a=e(29815),s=e(97582),c=e(85893),u=e(67294),d=e(45697),l=e(11163),f=e.n(l),m=e(66252),p=e(6388),h=e(50319),g=e(75327),y=e(78289),v=e(73987),_=e(62466),I=e(68956),x=e(26186),Z=e(16551),b=e(77439),$=e(11585),w=e(55843),A=e(15214),j=e(91272),U=e(35418),C=e(20705),q=e(24237),S=e(63626),k=e(14651),P=e(20932),F=e(92148),T=function(n){var t,e=n.accountType,d=n.filters,l=(0,m.x)(),T=(0,C.x)({filters:d}),E=T.initialData,L=T.ref,M=(0,u.useContext)(y.Z),z=(0,u.useContext)(v.Z).user,N=null,R=(0,p.aM)(g.fo,{variables:E}),D=R.data,O=void 0===D?{users:[],meta:{aggregate:{totalCount:0}}}:D,V=O.users,G=O.meta,B=R.loading,H=R.refetch,X=(0,o.Z)((0,h.D)(g.I4,{onCompleted:function(n){M.close(),H()}}),2),J=X[0],W=X[1].error,Q=(0,o.Z)((0,h.D)(g.AX,{onCompleted:function(n){M.close(),H()}}),2),K=Q[0],Y=Q[1].error,nn=(0,o.Z)((0,h.D)(g.tW,{onCompleted:function(n){H()}}),2),nt=nn[0],ne=nn[1].error;W&&W.graphQLErrors.forEach(function(n){var t;N=(null===(t=n.extensions)||void 0===t?void 0:t.code)==="constraint-violation"?"Error: a user with this e-mail address already exists":"Error creating user"}),Y&&Y.graphQLErrors.forEach(function(n){var t;N=(null===(t=n.extensions)||void 0===t?void 0:t.code)==="constraint-violation"?"Error, a user with this e-mail address already exists":"Error updating user"}),ne&&(N="Error getting user`s locations");var nr,ni=(t=(0,r.Z)(function(n,t){var e,r,o,a,c;return(0,s.__generator)(this,function(o){switch(o.label){case 0:return[4,(0,P.E)(l,n.email,!0)];case 1:if(e=o.sent(),r=(0,S.te)(n,t,e),!n.id)return[3,2];return K({variables:(0,i.Z)({},r)}),n.location&&nt({variables:(0,i.Z)({},(0,S.qF)(n))}),[3,4];case 2:return[4,J({variables:{objects:r}})];case 3:c=o.sent().data.insert_Account_User.returning,n.location&&nt({variables:(0,i.Z)({},(0,S.qF)({location:n.location,accountUserId:c[0].id}))}),o.label=4;case 4:return[2]}})}),function(n,e){return t.apply(this,arguments)}),no=function(n,t){n.stopPropagation(),M.show({content:(0,c.jsx)(q.H,{userId:null==t?void 0:t.id,accountId:null==t?void 0:t.accountId,accountType:e,submit:ni,submitError:N}),title:"Edit user",width:"50%"})},na=function(n){n.stopPropagation(),M.show({content:(0,c.jsx)(q.H,{accountId:d.accountId,accountType:e,submit:ni,submitError:N}),title:"Add user",width:"50%"})},ns=function(n,t){n.stopPropagation(),M.show({content:(0,c.jsx)(U.G,{category:"avatar",entity:"User",entityId:t.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})},nc=[{hidden:!0},{text:"Name"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:d.accountId,formatter:(0,_.Z)("","accountId","account","url"),text:"Account"},{text:"Email Address"},{text:"Contact User",formatter:function(n){var t=n.row;if(n.data,t.accountUser.isContact)return(0,c.jsx)(k.Z,{color:"error"})}},{text:"Phone"},{text:"Position"},{hidden:!0},{hidden:!d.accountId,text:"Role"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(n){var t=n.row,r=n.data;if(("supplier"===e||"customer"===e)&&(z.email===t.email||(0,a.Z)(F.td).concat((0,a.Z)(F.Sf),(0,a.Z)(F.n),(0,a.Z)(F.nx)).includes(z.role))||(0,a.Z)(F.td).concat((0,a.Z)(F.Sf),(0,a.Z)(F.n),(0,a.Z)(F.nx)).includes(z.role))return(0,c.jsx)(I.Z,{row:t,data:r})},formatterData:[{context:"secondary",icon:["fas","edit"],onClick:no,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:ns,tooltip:"Avatar"}],text:"Actions"}],nu=function(n){f().push("".concat("/dashboard/users/","view?id=").concat(n.id))},nd=function(){return(0,c.jsx)(Z.Z,{children:(0,c.jsx)(b.Z,{context:"secondary",content:"Edit",onClick:na,size:"sm",children:"Create User"})})};return(0,c.jsxs)($.Z,{toolbar:d.accountId&&(0,a.Z)(F.td).concat((0,a.Z)(F.Sf),(0,a.Z)(F.n),(0,a.Z)(F.nx)).includes(z.role)&&(0,c.jsx)(nd,{}),open:!0,title:"Users",children:[(0,c.jsx)(j.t,{columns:nc,loading:B,meta:G,ref:L,refetch:H,rowClick:nu,rows:(nr=[],V.forEach(function(n){var t=null;t=d.accountId?n.accounts.find(function(n){var t;return(null===(t=n.account)||void 0===t?void 0:t.id)===parseInt(d.accountId)}):n.accounts.find(function(n){return null!==n.account});var e={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:t&&t.account.id,type:t&&t.account.type,email:n.email,account:t?"".concat(t.account.name," (").concat(t.account.type,")"):"-",phone:n.phone,position:(null==t?void 0:t.position)?t.position:"N/A",accountUser:t,role:null==t?void 0:t.role,status:t?t.status:n.status,createdAt:(0,x.Z)(n.createdAt),url:t&&!["admin","tenant"].includes(t.account.type.toLowerCase())?"/dashboard/".concat(null==t?void 0:t.account.type.toLowerCase(),"s/view"):"",invoiceThreshold:n.invoiceThreshold,quoteThreshold:n.quoteThreshold,meta:n.meta,actions:""};nr.push(e)}),nr)}),N&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w.Z,{}),(0,c.jsx)(A.Z,{content:N,context:"warning"})]})]})};T.propTypes={accountType:d.string,filters:d.object}},75327:function(n,t,e){"use strict";e.d(t,{$E:function(){return E},AX:function(){return $},I4:function(){return b},JA:function(){return A},MT:function(){return S},Px:function(){return U},WF:function(){return j},ZA:function(){return z},a8:function(){return C},fA:function(){return T},fo:function(){return w},ge:function(){return M},iM:function(){return F},nE:function(){return k},nh:function(){return P},r1:function(){return q},tW:function(){return N},uz:function(){return L}});var r=e(7297),i=e(75063);function o(){var n=(0,r.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return o=function(){return n},n}function a(){var n=(0,r.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return a=function(){return n},n}function s(){var n=(0,r.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,r.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return c=function(){return n},n}function u(){var n=(0,r.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]);return u=function(){return n},n}function d(){var n=(0,r.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,r.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]);return l=function(){return n},n}function f(){var n=(0,r.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]);return f=function(){return n},n}function m(){var n=(0,r.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]);return m=function(){return n},n}function p(){var n=(0,r.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]);return p=function(){return n},n}function h(){var n=(0,r.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]);return h=function(){return n},n}function g(){var n=(0,r.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]);return g=function(){return n},n}function y(){var n=(0,r.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return y=function(){return n},n}function v(){var n=(0,r.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]);return v=function(){return n},n}function _(){var n=(0,r.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]);return _=function(){return n},n}function I(){var n=(0,r.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']);return I=function(){return n},n}function x(){var n=(0,r.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return x=function(){return n},n}function Z(){var n=(0,r.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"]);return Z=function(){return n},n}var b=(0,i.Ps)(o()),$=(0,i.Ps)(a()),w=(0,i.Ps)(s()),A=(0,i.Ps)(c()),j=(0,i.Ps)(u()),U=(0,i.Ps)(d()),C=(0,i.Ps)(l()),q=(0,i.Ps)(f()),S=(0,i.Ps)(m()),k=(0,i.Ps)(p()),P=(0,i.Ps)(h()),F=(0,i.Ps)(g()),T=(0,i.Ps)(y()),E=(0,i.Ps)(v()),L=(0,i.Ps)(_()),M=(0,i.Ps)(I()),z=(0,i.Ps)(x()),N=(0,i.Ps)(Z())},59938:function(n,t,e){"use strict";e.d(t,{X:function(){return p}});var r=e(14924),i=e(82670),o=e(828),a=e(7297),s=e(67294),c=e(6388),u=e(50319),d=e(75063),l=e(18586);function f(){var n=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return f=function(){return n},n}function m(){var n=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return m=function(){return n},n}function p(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,l.q)().user,d=(0,s.useState)(function(){try{switch(e){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(n))||t}}catch(r){return t}}),f=d[0],m=d[1],p=function(t){try{var o=(0,i.Z)(t,Function)?t(f):t;switch(m(o),e){case"network":y({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,r.Z)({},n,o)}});break;case"sessionStorage":window.sessionStorage.setItem(n,JSON.stringify(o))}}catch(s){}};(0,c.aM)(h,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==e,onCompleted:function(e){var r=e.accountUser;r&&m(r.filters[n]||t)}});var y=(0,o.Z)((0,u.D)(g),1)[0];return[f,p]}var h=(0,d.Ps)(f()),g=(0,d.Ps)(m())},21789:function(n,t,e){"use strict";e.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},55862:function(n,t,e){"use strict";e.d(t,{J:function(){return Z}});var r=e(26042),i=e(69396),o=e(99534),a=e(828),s=e(85893),c=e(11163),u=e(67294),d=e(45697),l=e(9270),f=e(62140),m=e(42283),p=e(76600),h=e(11585),g=e(49501),y=e(75903),v=e(77439),_=e(25742),I=e(59938),x=function(n){var t=n.initialValues,e=n.renderFilters,o=n.setFilters,c=n.lastQuery,d=n.filters,x=(0,a.Z)((0,I.X)("form_data_".concat(t.filterType),t),2),Z=x[0],b=x[1],$=(0,m.cI)({defaultValues:Z||t}),w=$.control,A=$.errors,j=$.handleSubmit,U=$.register,C=$.reset,q=$.watch,S=$.setValue,k=q(),P=(0,i.Z)((0,r.Z)({},k),{filterType:t.filterType});(0,u.useEffect)(function(){C(P)},[C]),(0,u.useEffect)(function(){b(P)},[d]);var F=function(n){var e=n.query;if(e!==c){var i={q:"%".concat(e,"%")||0},a=/^\d+$/.test(e);"id"in t&&(i.id=a?Number(e):null),"meta"in t&&(i.meta=a?{invoiceNumbers:[e]}:null),"jobNumber"in t&&(i.jobNumber=a?String(e):null,i.invoiceNumber=a?Number(e):null),o(function(n){return(0,r.Z)({},n,i)})}},T=function(n){Object.keys(t).map(function(n){return S(n,null)}),o(t),C(t),F("")};return(0,s.jsx)(p.Z,{handleSubmit:j(F),children:(0,s.jsxs)(h.Z,{title:"Filters",children:[(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(f.Z,{sm:12,lg:12,children:(0,s.jsx)(g.Z,{label:"",children:(0,s.jsx)(y.Z,{errors:A,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:U,type:"search"})})}),(0,s.jsx)(f.Z,{sm:12,lg:12,children:e({control:w,errors:A,initialValues:t,register:U,setFilters:o,watch:q,setValue:S,reset:C})})]}),(0,s.jsx)(_.H,{content:"Search",context:"secondary",handleClick:F,type:"submit",children:(0,s.jsx)(v.Z,{content:"Clear",context:"danger",onClick:T,size:"sm"})})]})})};x.propTypes={initialValues:d.object,renderFilters:d.func.isRequired,setFilters:d.func.isRequired};var Z=function(n){var t=n.FiltersComp,e=n.initialFilters,d=n.TableComp,m=(0,o.Z)(n,["FiltersComp","initialFilters","TableComp"]),p=(0,a.Z)((0,I.X)("form_data_".concat(e.filterType),e),2),h=p[0],g=p[1],y=(0,u.useState)(h||e),v=y[0],_=y[1],Z=(0,c.useRouter)().query.show;return(0,u.useEffect)(function(){g(v)},[v,g]),(0,s.jsx)(l.Z,{children:(0,s.jsxs)(f.Z,{sm:12,lg:12,children:[(0,s.jsx)(x,{initialValues:e,renderFilters:function(n){return(0,s.jsx)(t,(0,i.Z)((0,r.Z)({},n,m),{show:Z}))},setFilters:_,filters:v}),(0,s.jsx)(d,(0,r.Z)({filters:v,initialFilters:e},m))]})})};Z.propTypes={FiltersComp:d.func,initialFilters:d.object.isRequired,TableComp:d.func}},80803:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return v}});var r=e(85893),i=e(19076),o=e(55862),a=e(8299),s=e(26042),c=e(69396),u=e(45697),d=e(9270),l=e(62140),f=e(46929),m=e(20402),p=e(21789),h=function(n){var t=n.errors,e=n.register,i=n.setFilters,o={errors:t,register:e};return(0,r.jsxs)(d.Z,{children:[(0,r.jsx)(l.Z,{md:6,children:(0,r.jsx)(f.r,(0,c.Z)((0,s.Z)({},o),{onChange:function(n){return i(function(t){return(0,c.Z)((0,s.Z)({},t),{status:n.target.value||null})})},options:p.bg}))}),(0,r.jsx)(l.Z,{md:6,children:(0,r.jsx)(f.r,(0,c.Z)((0,s.Z)({},o),{name:"accountType",onChange:function(n){return i(function(t){return(0,c.Z)((0,s.Z)({},t),{accountType:n.target.value||null})})},options:m.l}))})]})};h.propTypes={errors:u.object.isRequired,register:u.func.isRequired,setFilters:u.func.isRequired};var g={accountType:null,q:null,status:"active",filterType:"users_table"},y=function(){return(0,r.jsx)(o.J,{FiltersComp:h,initialFilters:g,TableComp:a.P})},v=function(){return(0,r.jsx)(i.Z,{pageHeading:{heading:"Users"},View:(0,r.jsx)(y,{})})}}},function(n){n.O(0,[3662,2283,212,8890,619,2583,4135,6043,1838,1417,3776,1564,3054,2329,8500,778,1023,1870,2797,1047,3058,5497,8980,6733,5463,9774,2888,179],function(){return n(n.s=48045)}),_N_E=n.O()}]);