(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3241],{11502:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties/map",function(){return t(10971)}])},51809:function(n,e,t){"use strict";t.d(e,{$A:function(){return f},$E:function(){return g},A1:function(){return y},Un:function(){return m},yf:function(){return _},zg:function(){return h}});var r=t(7297),o=t(75063);function i(){var n=(0,r.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return i=function(){return n},n}function s(){var n=(0,r.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return s=function(){return n},n}function a(){var n=(0,r.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return a=function(){return n},n}function c(){var n=(0,r.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,r.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,r.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return l=function(){return n},n}function u(){var n=(0,r.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return u=function(){return n},n}function p(){var n=(0,r.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return p=function(){return n},n}(0,o.Ps)(i());var m=(0,o.Ps)(s()),y=(0,o.Ps)(a()),f=(0,o.Ps)(c()),g=(0,o.Ps)(d()),h=(0,o.Ps)(l());(0,o.Ps)(u());var _=(0,o.Ps)(p())},10971:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return U}});var r=t(85893),o=t(6388),i=t(51809),s=t(19076),a=t(11585),c=t(26042),d=t(7297),l=t(67294),u=t(45697),p=t(10367),m=t(42283),y=t(46003),f=[{elementType:"geometry",stylers:[{color:"#75cccf"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#004e49"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#75cccf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#F6F6F4"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#ECEEED"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#a8e3e6"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#ECEEED"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#E8EDEB"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#CAD2D3"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#CAD2D3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#"}]}],g=t(63118),h=t(78289),_=t(8357),x=t(66776),T=t(85113),b=t(22713),v=t(75820),k=function(n){var e=n.address,t=n.children,o=n.onClick,i=e.bookings.length>0?"pink":"blue";return(0,r.jsx)(v.Z,{icon:"http://maps.google.com/mapfiles/ms/icons/".concat(i,"-dot.png"),onClick:o,position:e,children:t})};k.propTypes={address:u.object.isRequired,children:u.node.isRequired,onClick:u.func.isRequired};var j=t(11163),C=t.n(j),w=t(11082),A=t(74297),I=t(55583),$=t(40826);function L(){var n=(0,d.Z)(["\n  align-items: center;\n  display: flex;\n"]);return L=function(){return n},n}function Z(){var n=(0,d.Z)(["\n  cursor: ",";\n  font-size: 0.9rem;\n  margin-left: 5px;\n  text-decoration: ",";\n"]);return Z=function(){return n},n}var E=function(n){var e=n.address,t=n.onCloseClick,o=e.addressLine1,i=e.bookings,s=e.city,a=e.id,c=e.postCode,d=(0,w.Z)(i.reduce(function(n,e){return n+e.amount},0)),l=function(){C().push("/dashboard/properties/view?id=".concat(a,"&tab=details"))};return(0,r.jsx)(I.Z,{onCloseClick:t,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)($.Z,{context:"female",size:"lg",icon:"map-marker-alt"}),(0,r.jsxs)(P,{onClick:l,link:!0,children:[o,","," "+s,(0,r.jsx)("br",{}),c]})]}),(0,r.jsx)("br",{}),(0,r.jsxs)(N,{children:[(0,r.jsx)($.Z,{context:"female",size:"lg",icon:"calendar-alt"}),(0,r.jsxs)(P,{children:["Bookings: ",i.length,(0,r.jsx)("ul",{style:{margin:0,paddingLeft:"20px"},children:i.map(function(n,e){var t;return(0,r.jsxs)("li",{children:["No: ",n.id," - ",(t=n.status,(0,A.Z)(t.replace(/([A-Z]+)/g," $1").replace(/([A-Z][a-z])/g," $1")))]},e)})})]})]}),(0,r.jsx)("br",{}),(0,r.jsxs)(N,{children:[(0,r.jsx)($.Z,{context:"female",size:"lg",icon:"shopping-cart"}),(0,r.jsxs)(P,{children:["Spend: ",d]})]})]})})},N=p.ZP.div.withConfig({displayName:"markerTooltip__TooltipRow",componentId:"sc-3b7219a9-0"})(L()),P=p.ZP.div.withConfig({displayName:"markerTooltip__TooltipColumn",componentId:"sc-3b7219a9-1"})(Z(),function(n){return n.link?"pointer":"auto"},function(n){return n.link?"underline":"none currentcolor solid"});function q(){var n=(0,d.Z)(["\n  padding: 10px;\n  margin: 30px 10px 10px 10px;\n  text-align: center;\n  img {\n    max-width: 24px;\n  }\n  img:last-child {\n    margin-left: 20px;\n  }\n"]);return q=function(){return n},n}E.propTypes={address:u.object.isRequired,onCloseClick:u.func.isRequired};var F=(0,l.memo)(function(n){var e=n.addresses;e=e.map(function(n){var e=(0,T.WE)(n,"registered"),t=(null==e?void 0:e.address)||null,r=(0,T.Of)(t);return(0,c.Z)({},t,n,r)}).filter(function(n){return n.lat&&n.lng});var t=(0,g.Z)(e),o=e.reduce(function(n,e){var t=e.id;return n[t]=!!n[t],n},{}),i=(0,m.cI)(o),s=i.change,a=i.form,d=function(n,e){var t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];Object.keys(a).forEach(function(n){n===e&&(a[n]=t)}),s({target:{id:e,value:t}})},u=(0,l.useContext)(h.Z),p=function(n){if(n.length>0){var e=n.length-1;u.show({title:"Job details",content:(0,r.jsx)(b.g,{jobId:n[e].id,toggleShow:u.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["Number of properties: ",e.length," properties"]}),(0,r.jsx)(_.Z,{apiKey:y.ie.map,defaultCenter:t,containerHeight:"600px",zoom:11,defaultOptions:{styles:f},children:(0,r.jsx)(x.Z,{averageCenter:!0,enableRetinaIcons:!0,gridSize:60,children:e.length>0&&e.forEach(function(n,e){var t=n.addressLine1,o=n.bookings,i=n.city,s=n.id,c=n.lat,l=n.lng,u=n.postCode;if(c&&l){var m=o.length;return(0,r.jsx)(k,{address:{bookings:o,lat:c,lng:l},onClick:function(n){return m>0?p(o):d(n,s)},children:a[s]&&(0,r.jsx)(E,{address:{addressLine1:t,bookings:o,city:i,id:s,postCode:u},onCloseClick:function(n){return d(n,s,!1)}})},e)}})})}),(0,r.jsxs)(M,{children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),"Uploaded Address"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("img",{src:"http://maps.google.com/mapfiles/ms/icons/pink-dot.png"}),"Job Booked"]})]})]})},function(n,e){if(n.addresses.length===e.addresses.length)return!0}),M=p.ZP.div.withConfig({displayName:"map__Description",componentId:"sc-65b56675-0"})(q());F.propTypes={addresses:u.object.isRequired};var U=function(){var n=(0,o.aM)(i.Un).data,e=(void 0===n?{properties:[]}:n).properties;return(0,r.jsx)(s.Z,{pageHeading:{heading:"Map"},children:(0,r.jsx)(a.Z,{open:!0,title:"Map",children:(0,r.jsx)(F,{addresses:e})})})}}},function(n){n.O(0,[2283,212,8890,619,2583,4135,8579,4244,3911,1564,3054,4046,6370,4669,8344,9774,2888,179],function(){return n(n.s=11502)}),_N_E=n.O()}]);