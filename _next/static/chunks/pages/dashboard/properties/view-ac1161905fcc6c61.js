(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8521],{36381:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties/view",function(){return t(85117)}])},85117:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return n3}});var o=t(85893),i=t(26042),a=t(69396),s=t(67294),l=t(6388),d=t(52210),r=t(11163),c=t.n(r),u=t(9270),m=t(62140),v=t(17974),x=t(8059),h=t(6924),p=t(93243),f=t(28184),b=t(67259),j=t(55862),g=t(47568),Z=t(97582),I=t(18586),y=t(78289),k=t(52019),C=t(73987),_=t(1306),w=t(85113),S=t(30016),T=t(71225),$=t(7297),A=t(45697),E=t(10367),q=t(11585),L=t(51466),F=t(30430);function M(){var n=(0,$.Z)(["\n  cursor: pointer;\n  text-decoration: none;\n"]);return M=function(){return n},n}var B=function(n){var e=n.compliances,t=n.id,i=function(n){n.stopPropagation(),c().push("/dashboard/properties/view?id=".concat(t,"&tab=compliance"))},a=e.length;if(a<=0)return(0,o.jsx)(q.Z,{open:!0,title:"Compliance Score",children:(0,o.jsx)(N,{onClick:i,children:(0,o.jsx)(L.Z,{content:"No compliance records, please add."})})});var s=(0,F.JB)(e),l=(0,F.CV)(e),d=(0,F.kW)(l);return(0,o.jsxs)(q.Z,{open:!0,title:"Compliance Score",children:[a<=0&&(0,o.jsx)(L.Z,{content:"No compliance records, please add."}),(0,o.jsx)(N,{onClick:i,children:(0,o.jsx)(L.Z,{content:l&&"Score ".concat(l," %"),context:d})}),(0,o.jsx)(L.Z,{content:"".concat(a," compliance item").concat(1!==a?"s":"")}),s>0&&(0,o.jsx)(L.Z,{context:"danger",content:"".concat(s," expired")})]})},N=E.ZP.a.withConfig({displayName:"rating__StyledLink",componentId:"sc-97ffeb70-0"})(M());B.propTypes={compliances:A.array.isRequired,id:A.number.isRequired};var R=t(76225),O=t(35418),P=t(4380),D=t(25993),U=t(41890),W=t(30381),H=t.n(W),z=t(36641),V=function(n){var e,t,i,a,s,l,d=n.property,r=n.offCanvas,u=n.refetch,m="/dashboard/properties/",v=(0,w.WE)(d,"registered"),x=(0,w.WE)(d,"invoice"),h=function(n){n&&u()};return[{id:1,label:"Create location",date:d.createdAt,content:[{id:1,active:d.createdAt&&d.name,data:"Name: ".concat(d.name)},{id:2,active:d.createdAt,data:"Access: ".concat(d.access)}]},{id:2,label:"Complete profile",info:"",date:(null==v?void 0:v.createdAt)||null,actions:[{id:1,active:!0,content:"Main address",context:"secondary",handleClick:function(){var n;r.show({content:(0,o.jsx)(z.H,{addressId:(null==v?void 0:null===(n=v.address)||void 0===n?void 0:n.id)||null,entity:"Location",entityId:d.id,id:(null==v?void 0:v.id)||null,onSubmit:h,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!0,content:"Invoice address",context:"secondary",handleClick:function(){var n;r.show({content:(0,o.jsx)(z.H,{addressId:(null==x?void 0:null===(n=x.address)||void 0===n?void 0:n.id)||null,entity:"Location",entityId:d.id,id:(null==x?void 0:x.id)||null,onSubmit:h,type:"invoice"}),submit:!1,title:"Manage addresses"})},type:"button"}]},{id:3,label:"Add assets",info:"",date:(null===(e=d.assets)||void 0===e?void 0:e.length)?d.assets[0].createdAt:null,content:[{id:1,active:(null===(t=d.assets)||void 0===t?void 0:t.length)>0,data:"".concat(null===(i=d.assets)||void 0===i?void 0:i.length," assets added")}],actions:[{id:1,active:!0,content:"Submit sublocations",context:"secondary",handleClick:function(){c().push("".concat(m,"view?id=").concat(d.id,"&tab=assets"))},type:"button"},{id:2,active:!0,content:"Submit products",context:"secondary",handleClick:function(){c().push("".concat(m,"view?id=").concat(d.id,"&tab=assets"))},type:"button"},{id:3,active:!0,content:"Submit sensors",context:"secondary",handleClick:function(){c().push("".concat(m,"view?id=").concat(d.id,"&tab=assets"))},type:"button"}]},{id:6,label:"Start issuing work orders",info:"submit work orders",date:(null===(a=d.bookings)||void 0===a?void 0:a.length)?d.bookings[0].createdAt:null,content:[{id:1,active:(null===(s=d.assets)||void 0===s?void 0:s.length)>0,data:"".concat(null===(l=d.assets)||void 0===l?void 0:l.length," jobs created")}]}]},Q=function(n,e,t){var o=V({property:n,offCanvas:e,refetch:t});return o.forEach(function(n){n.date&&(n.date=H()(n.date).format("D MMM YYYY HH:mm"))}),o},J=t(64872),X=function(n){var e=n.location,t=n.refetch,i=(0,J.a)();return(0,o.jsx)(q.Z,{open:!0,title:"Profile",children:(0,o.jsx)(U.Z,{items:Q(e,i,t),summary:[]},"stepper-".concat(e.id))})},Y=t(98571),G=t(41255),K=t(46003),nn=function(n){var e,t,i,a,l,d,c,v,x,h,p=n.location,f=n.refetch,b=(0,I.q)(),j=(0,s.useContext)(y.Z),$=(0,s.useContext)(k.Z).hasRole,A=(0,s.useContext)(C.Z).user,E=(0,r.useRouter)().query,q=(0,s.useState)([]),L=q[0],F=q[1],M=(0,s.useState)(!1),N=M[0],U=M[1],W=(0,G.RM)(A.accountId),H="".concat(K.C1.issueReportUrl,"?locationId=").concat(p.id,"&locationName=").concat(p.name,"&customerId=").concat(null===(e=p.customer[0])||void 0===e?void 0:e.account.id),z=(0,G.BR)({adminId:A.id,xeroClientId:null==E?void 0:E.clientId},[b.admin]),V=z.onCallAuthorize,Q=z.onGetXeroContacts;(0,s.useEffect)(function(){var n,e=(n=(0,g.Z)(function(n){var e,t;return(0,Z.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Q(n)];case 1:return t=e.sent().map(function(n){return{label:"".concat(n.name," - ").concat(n.contactID),value:n.contactID}}),U(!1),F(t),[3,3];case 2:return e.sent(),U(!0),[3,3];case 3:return[2]}})}),function(e){return n.apply(this,arguments)});(null==W?void 0:W.companyId)&&e(W.companyId)},[null==W?void 0:W.companyId]);var J,nn=p.createdAt,ne=p.compliances,nt=p.customer,no=p.id,ni=p.supplier,na=p.user,ns=(0,w.WE)(p,"registered"),nl=(0,w.WE)(p,"invoice"),nd=function(){V(window.location.href)},nr=function(n){var e,t,i,a;n.stopPropagation(),j.show({content:(0,o.jsx)(D.V,{data:p,refetch:f,xeroContactId:null===(e=p.customer)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:null===(i=t.account)||void 0===i?void 0:null===(a=i.meta)||void 0===a?void 0:a.xeroContactId,displayXeroContacts:!!(null==W?void 0:W.clientId),xeroContacts:L,displaySignin:N,handleXeroAuthorize:nd,onClose:j.close}),title:"Edit property"})};return(0,o.jsxs)(u.Z,{children:[(0,o.jsxs)(m.Z,{md:4,children:[(0,o.jsx)(P.g,{avatar:(0,T.Q)(null===(t=p.customer[0].account)||void 0===t?void 0:t.media),entity:{id:p.id,description:p.customer[0].account.name,name:p.name||"Not Specified"},entityName:"Location",icons:[{icon:"edit",onClick:nr}]}),(0,o.jsx)(R.J,{data:{accountName:nt.length&&nt[0].account.name||ni.length&&ni[0].account.name,country:null==ns?void 0:null===(i=ns.address)||void 0===i?void 0:null===(a=i.country)||void 0===a?void 0:a.name,createdAt:nn,fullName:null==na?void 0:na.fullName,position:null==na?void 0:na.position,phone:null==na?void 0:na.phone,permitsRequired:null==p?void 0:p.permitsRequired,xeroContactId:null===(l=p.customer)||void 0===l?void 0:null===(d=l[0])||void 0===d?void 0:null===(c=d.account)||void 0===c?void 0:null===(v=c.meta)||void 0===v?void 0:v.xeroContactId}}),ns&&(0,o.jsx)(_.f,{address:ns.address,entity:"Location",entityId:p.id,id:ns.id,refetch:f,showMap:!0,title:"Address",type:"registered"}),nl&&(0,o.jsx)(_.f,{address:nl.address,entity:"Location",entityId:p.id,id:nl.id,refetch:f,title:"Invoice Address",type:"invoice"}),$("admin")&&(0,o.jsx)(S.E,{entity:"Location",entityId:p.id,open:!0,title:"Notes"})]}),(0,o.jsx)(m.Z,{md:4,children:(0,o.jsx)(X,{refetch:f,location:p})}),(0,o.jsxs)(m.Z,{md:4,children:[(0,o.jsx)(O.G,{details:!0,entity:"Location",entityId:no}),(0,o.jsx)(B,{compliances:ne,id:no}),(null==b?void 0:null===(x=b.admin)||void 0===x?void 0:null===(h=x.modules)||void 0===h?void 0:h.nonLoggedUser)&&(0,o.jsx)(Y.UH,{id:"location-qr-".concat(p.id),value:H,isExpandedByDefault:!0})]})]})},ne=t(55185),nt=function(n){var e,t,i,a,s,l=n.location;return(0,o.jsx)(ne.b,{type:"customer",accountId:null===(e=l.customer[0])||void 0===e?void 0:null===(t=e.account)||void 0===t?void 0:t.id,locationId:l.id,meta:null!==(s=null===(i=null==l?void 0:l.customer[0])||void 0===i?void 0:null===(a=i.account)||void 0===a?void 0:a.meta)&&void 0!==s?s:{}})},no=t(14924),ni=t(828),na=t(50319),ns=t(75063);function nl(){var n=(0,$.Z)(['\n  query GetTenantBookings(\n    $limit: Int\n    $locationId: Int\n    $offset: Int\n    $orderBy: TenantBooking_order_by!\n    $q: Int\n    $userId: Int\n  ) {\n    tenantBookings: TenantBooking(\n      limit: $limit\n      offset: $offset\n      where: { id: { _eq: $q }, locationId: { _eq: $locationId }, userId: { _eq: $userId } }\n      order_by: [$orderBy]\n    ) {\n      id\n      bookingStart\n      bookingEnd\n      notes\n      status\n      createdAt\n      location: Location {\n        id\n        name\n        customer: Account_Locations {\n          id\n          account: Account {\n            id\n            name\n            admin: Admins {\n              id: adminId\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n            contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n              id\n              user: User {\n                id\n                fullName\n              }\n            }\n          }\n        }\n      }\n      user: User {\n        id\n        fullName\n        email\n        phone\n        accountUsers: Account_Users(where: { Account: { type: { _eq: "tenant" } } }) {\n          id\n          accountId\n          modules\n        }\n      }\n    }\n    meta: TenantBooking_aggregate(\n      where: { id: { _eq: $q }, locationId: { _eq: $locationId }, userId: { _eq: $userId } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return nl=function(){return n},n}var nd=(0,ns.Ps)(nl());function nr(){var n=(0,$.Z)(["\n  mutation AddTenantBooking(\n    $nameFirst: String\n    $nameLast: String\n    $email: String\n    $phone: String\n    $bookingStart: timestamptz\n    $bookingEnd: timestamptz\n    $notes: String\n    $status: String\n    $locationId: Int!\n    $userId: Int\n    $modules: jsonb\n  ) {\n    createTenant(\n      nameFirst: $nameFirst\n      nameLast: $nameLast\n      email: $email\n      phone: $phone\n      bookingStart: $bookingStart\n      bookingEnd: $bookingEnd\n      notes: $notes\n      status: $status\n      locationId: $locationId\n      userId: $userId\n      modules: $modules\n    ) {\n      data\n      success\n    }\n  }\n"]);return nr=function(){return n},n}function nc(){var n=(0,$.Z)(['\n  mutation UpdateTenantBooking(\n    $id: Int!\n    $changes: TenantBooking_set_input\n    $userId: Int!\n    $accountUser: Account_User_set_input\n  ) {\n    update_TenantBooking_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    update_Account_User(\n      where: { userId: { _eq: $userId }, Account: { type: { _eq: "tenant" } } }\n      _set: $accountUser\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n']);return nc=function(){return n},n}function nu(){var n=(0,$.Z)(["\n  mutation DeleteTenantBooking($id: Int!) {\n    delete_TenantBooking_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return nu=function(){return n},n}var nm=(0,ns.Ps)(nr()),nv=(0,ns.Ps)(nc());(0,ns.Ps)(nu());var nx=t(68956),nh=t(26186),np=t(77439),nf=t(91272),nb=t(42283),nj=t(79665),ng=t(76600),nZ=t(49501),nI=t(55563),ny=t(6710),nk=t(95103),nC=t(21300),n_=t(66812),nw=t(74231),nS=(0,nw.Ry)().shape({bookingStart:(0,nw.hT)(),bookingEnd:(0,nw.hT)().nullable(),notes:(0,nw.Z_)(),status:(0,nw.Z_)().oneOf(["active","inactive"]).required()}),nT=t(21789),n$=t(50480),nA=t(69368),nE=t(15861),nq=t(5616),nL=t(51233),nF=function(n){var e=n.name,t=n.control,i=n.permissions,a=n.styles;return(0,o.jsxs)(nq.Z,{sx:a,children:[(0,o.jsx)(nE.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,o.jsx)(nL.Z,{spacing:1,direction:"row",children:i.map(function(n){return(0,o.jsx)(nb.Qr,{name:"".concat(e?e+".":"").concat(n.name),control:t,render:function(e){var t=e.value,i=e.onChange;return(0,o.jsx)(n$.Z,{color:"dark.main",control:(0,o.jsx)(nA.Z,{color:"secondary",checked:t,onChange:function(n){return i(n.target.checked)}}),label:n.label})}})})})]})};nF.defaultProps={permissions:[]},nF.propTypes={name:A.string,control:A.object.isRequired,permissions:A.object,styles:A.object};var nM=[{label:"Job reports",name:"jobReports"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}],nB=function(n){var e,t,l,d=n.defaultValues,r=n.submit,c=(0,s.useState)(!1),v=c[0],x=c[1],h=(0,nb.cI)({defaultValues:d&&d,resolver:(0,nj.S)(nS)}),p=h.control,f=h.errors,b=h.handleSubmit,j=h.register,g=h.watch,Z={control:p,errors:f,register:j},I=g("tenantSelected");return(0,o.jsxs)(ng.Z,{id:"offCanvasForm",handleSubmit:b(r),children:[(0,o.jsx)(q.Z,{open:!0,title:"Tenant information",children:v?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(u.Z,{children:[(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(nZ.Z,{label:"First name",children:(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"nameFirst"}))})}),(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(nZ.Z,{label:"Last name",children:(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"nameLast"}))})}),(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(nZ.Z,{label:"Email",children:(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"email",type:"email"}))})}),(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(nZ.Z,{label:"Mobile",children:(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"phone"}))})})]}),(0,o.jsx)(np.Z,{content:"Cancel",context:"secondary",onClick:function(){return x(!1)},size:"sm"})]}):(null==d?void 0:d.id)?(0,o.jsxs)("div",{children:[null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.fullName," ",(0,o.jsx)("br",{}),null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.email," ",(0,o.jsx)("br",{}),null==d?void 0:null===(l=d.user)||void 0===l?void 0:l.phone," ",(0,o.jsx)("br",{})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n_.P,(0,a.Z)((0,i.Z)({},Z),{errors:(0,i.Z)({},f),label:"Tenant",name:"tenantSelected",type:"tenant"})),I&&(0,o.jsxs)("div",{children:[I.label," ",(0,o.jsx)("br",{}),I.email," ",(0,o.jsx)("br",{}),I.phone," ",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),"or"," ",(0,o.jsx)(np.Z,{content:"Add new tenant",context:"secondary",onClick:function(){return x(!0)},size:"sm"})]})}),(0,o.jsxs)(q.Z,{open:!0,title:"Booking information",children:[(0,o.jsxs)(u.Z,{children:[(0,o.jsxs)(m.Z,{md:6,children:[(0,o.jsx)(nZ.Z,{label:"Booked from"}),(0,o.jsx)(nC.M,(0,a.Z)((0,i.Z)({},Z),{name:"bookingStart",placeholderText:"Click to select date"}))]}),(0,o.jsxs)(m.Z,{md:6,children:[(0,o.jsx)(nZ.Z,{label:"Booked to"}),(0,o.jsx)(nC.M,(0,a.Z)((0,i.Z)({},Z),{name:"bookingEnd",placeholderText:"Click to select date"}))]})]}),(0,o.jsx)(nZ.Z,{label:"Notes",children:(0,o.jsx)(ny.Z,(0,a.Z)((0,i.Z)({},Z),{name:"notes",rows:3}))}),(0,o.jsx)(nZ.Z,{label:"Status",children:(0,o.jsx)(nk.Z,(0,a.Z)((0,i.Z)({},Z),{name:"status",options:nT.bg}))})]}),(0,o.jsx)(nF,{name:"modules",control:p,permissions:nM,styles:{mb:2}}),(null==d?void 0:d.id)&&(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"id",type:"hidden"})),(null==d?void 0:d.userId)&&(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"userId",type:"hidden"})),(null==d?void 0:d.locationId)&&(0,o.jsx)(nI.Z,(0,a.Z)((0,i.Z)({},Z),{name:"locationId",type:"hidden"}))]})};nB.propTypes={defaultValues:A.object,submit:A.func.isRequired};var nN=function(n,e){var t,o,i={id:(null==n?void 0:n.id)||null,bookingStart:(null==n?void 0:n.bookingStart)?new Date(n.bookingStart):null,bookingEnd:(null==n?void 0:n.bookingEnd)?new Date(n.bookingEnd):null,notes:(null==n?void 0:n.notes)||"",locationId:e,status:(null==n?void 0:n.status)||"active"};return(null==n?void 0:n.id)&&(null==n?void 0:n.user)?(i.user={id:n.user.id,fullName:n.user.fullName,email:n.user.email,phone:n.user.phone},i.userId=n.user.id,i.modules=(null===(t=n.user.accountUsers)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:o.modules)||{}):(i.email="",i.nameFirst="",i.nameLast="",i.phone=""),i},nR=function(n){var e,t,d,r=n.filters,c=(0,s.useRef)(),u=(0,s.useContext)(y.Z),m=r.locationId,v=(0,l.aM)(nd,{variables:(0,a.Z)((0,i.Z)({},r),{limit:K.C1.paginationSize,offset:((null===(e=c.current)||void 0===e?void 0:e.currentPage)-1||0)*K.C1.paginationSize,orderBy:(0,no.Z)({},null===(t=c.current)||void 0===t?void 0:t.sort.item,null===(d=c.current)||void 0===d?void 0:d.sort.order)})}),x=v.data,h=void 0===x?{tenantBookings:[],meta:{aggregate:{totalCount:0}}}:x,p=h.tenantBookings,f=h.meta,b=v.loading,j=v.refetch,g=(0,ni.Z)((0,na.D)(nm,{onCompleted:function(n){u.close(),j()}}),1)[0],Z=(0,ni.Z)((0,na.D)(nv,{onCompleted:function(n){u.close(),j()}}),1)[0],I=function(n){n.id?Z({variables:{id:n.id,changes:{bookingStart:n.bookingStart,bookingEnd:n.bookingEnd,notes:n.notes,status:n.status},userId:n.userId,accountUser:{modules:n.modules}}}):g({variables:{nameFirst:n.nameFirst,nameLast:n.nameLast,email:n.email,phone:n.phone,bookingStart:n.bookingStart,bookingEnd:n.bookingEnd,notes:n.notes,status:n.status,locationId:n.locationId,userId:n.userId,modules:n.modules}})},k=function(n,e){n.stopPropagation();var t=nN(p.find(function(n){return n.id===(null==e?void 0:e.id)}),m);u.show({title:e?"Edit tenant":"Add tenant",content:(0,o.jsx)(nB,{defaultValues:t,submit:I})})},C=[{text:"ID"},{text:"Tenant"},{text:"Email Address"},{text:"Booked from"},{text:"Booked to"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{formatter:nx.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:k,tooltip:"Edit"}],text:"Actions"},{hidden:!0}];return(0,o.jsx)(q.Z,{fitParentHeight:!0,open:!0,title:"Tenant bookings",toolbar:m&&(0,o.jsx)(np.Z,{content:"Add tenant",context:"secondary",onClick:k,size:"sm"}),children:(0,o.jsx)(nf.t,{columns:C,loading:b,meta:f,ref:c,refetch:j,rows:p.map(function(n){var e=null==n?void 0:n.user;return{id:n.id,name:null==e?void 0:e.fullName,email:null==e?void 0:e.email,bookingStart:n.bookingStart,bookingEnd:n.bookingEnd?n.bookingEnd:"-",status:"active"===n.status?"Active":"Inactive",createdAt:(0,nh.Z)(n.createdAt),actions:"",locationId:n.locationId}})})})};nR.propTypes={filters:A.object};var nO=t(2845),nP=t(66264),nD=t(98456),nU=t(61730),nW=t(10925),nH=t(23377),nz=t(23914),nV=t(4790),nQ=t(97824),nJ=t(10545),nX=t(93203),nY=function(n){var e,t,g,Z,y,k,C,_,w,S,T=n.propertyId,$=(0,nU.Z)("(max-width:600px)"),A=(0,nO.x)().hasRole,E=(0,r.useRouter)().query,q=(0,I.q)(),L=q.admin,F=q.hasUserModule,M=(0,s.useMemo)(function(){return E.tab||"details"},[E.tab]),B=null==L?void 0:null===(e=L.modules)||void 0===e?void 0:e.assets,N=A("admin"),R=A("tenant"),O=A("customer"),P=A("customer_user"),D=F("ppmSchedules"),U=F("finances"),W=F("quotes"),H=(0,s.useState)(M),z=H[0],V=H[1],Q=(0,s.useState)("slas-work-order"),J=Q[0],X=Q[1],Y=function(n,e){V(e)},G=function(n,e){X(e)},K=(0,l.aM)(d.tl,{variables:{id:T}}),ne=K.loading,no=K.data,ni=(void 0===no?{location:{}}:no).location,na=K.refetch;if(ne)return(0,o.jsx)(nL.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(nD.Z,{color:"secondary"})});if(!ni)return c().push("/404"),!1;var ns=(0,a.Z)((0,i.Z)({marginTop:$?"20px":0,maxWidth:$?"100%":"calc(100vw - 330px)",height:$?"180px!important":"auto","& .MuiTabs-scroller":{height:$?"180px!important":"auto",overflowY:$?"hidden":"auto"}},$&&{"& .MuiTabs-flexContainer>.MuiButtonBase-root":{marginBottom:"10px"}}),{"& .MuiTabs-flexContainer":$&&{flexWrap:"wrap"},"& .MuiTabs-flexContainer>.MuiTab-root:first-child":(0,i.Z)({},!$&&{borderTopLeftRadius:0,borderBottomLeftRadius:0})});return(0,o.jsxs)(nq.Z,{sx:{width:"100%",height:"100%"},children:[(0,o.jsxs)(nL.Z,{direction:$?"column":"row",children:[(0,o.jsx)(nJ.c,{withoutRightBorderRadius:!$,fullWidth:$,locationId:ni.id,locationName:ni.name}),(0,o.jsxs)(nz.m,{value:z,onChange:Y,changeQuery:!0,sx:ns,children:[(0,o.jsx)(nV.O,{value:"details",label:"Details",sx:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}),!(!U&&(R||P))&&(0,o.jsx)(nV.O,{value:"finances",label:"Finances"}),(0,o.jsx)(nV.O,{value:"sublocations",label:"Sublocations"}),B&&(0,o.jsx)(nV.O,{value:"assets",label:"Assets"}),(0,o.jsx)(nV.O,{value:"slas",label:"SLAs"}),(0,o.jsx)(nV.O,{value:"services",label:"Services"}),(0,o.jsx)(nV.O,{value:"work-orders",label:"Work Orders"}),!(!W&&P)&&(0,o.jsx)(nV.O,{value:"quotes",label:"Quotes"}),(0,o.jsx)(nV.O,{value:"compliance",label:"Compliance"}),(0,o.jsx)(nV.O,{value:"tenants",label:"Tenants"}),!(!D&&P)&&(0,o.jsx)(nV.O,{value:"planned-maintenance",label:"Planned Maintenance"})]})]}),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"details"},nG),{children:(0,o.jsx)(nn,{location:ni,refetch:na})})),!(!U&&(R||P))&&(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"finances"},nG),{children:(0,o.jsx)(nt,{location:ni})})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"sublocations"},nG),{children:(0,o.jsx)(nP.E,{editable:!R&&!O,location:ni,customer:null===(t=ni.customer[0])||void 0===t?void 0:t.account})})),B&&(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"assets"},nG),{children:(0,o.jsx)(v.E,{editable:N,hideLocationInfo:!0,hideCustomerInfo:!0,showHeader:!1,initialFilters:{locationId:ni.id,filterType:"location_assets"},createFormDefaultValues:{customer:{label:null===(g=ni.customer[0])||void 0===g?void 0:null===(Z=g.account)||void 0===Z?void 0:Z.name,value:null===(y=ni.customer[0])||void 0===y?void 0:null===(k=y.account)||void 0===k?void 0:k.id},location:{label:ni.name,value:ni.id}}})})),(0,o.jsxs)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"slas"},nG),{children:[(0,o.jsxs)(nz.m,{value:J,onChange:G,children:[(0,o.jsx)(nV.O,{value:"slas-work-order",label:"Details"}),(0,o.jsx)(nV.O,{value:"slas-quote",label:"Finances"})]}),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:J,index:"slas-work-order"},nG),{children:(0,o.jsx)(nW.H,{title:"Work Order SLAs",subtype:"reactive",isEntity:!0,isLocation:!0,customerId:null===(C=ni.customer[0])||void 0===C?void 0:null===(_=C.account)||void 0===_?void 0:_.id,entity:"Location",entityId:ni.id,containerHeight:"calc(100vh - 180px)"})})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:J,index:"slas-quote"},nG),{children:(0,o.jsx)(nW.H,{title:"Quote SLAs",subtype:"quote",isEntity:!0,isLocation:!0,customerId:null===(w=ni.customer[0])||void 0===w?void 0:null===(S=w.account)||void 0===S?void 0:S.id,entity:"Location",entityId:ni.id,containerHeight:"calc(100vh - 180px)"})}))]})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"services"},nG),{children:(0,o.jsx)(nH.J,{entity:"Location",entityId:ni.id})})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"work-orders"},nG),{children:(0,o.jsx)(b.A,{columnVisibilityModel:{customerNet:!P||U,amountOutstanding:!P||U},filtersVisibilityModel:{customer:!1,user:A("customer"),supplier:A("admin"),location:!1,manager:!1,customerManager:!1,accountManager:!1},entityRelationToFetch:{locationId:ni.id},initialFilters:{startDate:null,endDate:null,status:null,locationId:null,supplierId:null,filterType:"locations_work_orders_tab"}})})),!(!W&&P)&&(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"quotes"},nG),{children:(0,o.jsx)(j.J,{FiltersComp:h.r,initialFilters:{customerId:null,supplierId:null,status:null,id:null,locationId:ni.id,filterType:"location_quotes"},TableComp:p.v})})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"compliance"},nG),{children:(0,o.jsxs)(u.Z,{children:[(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(x.M,{data:ni.compliances,entity:"Location",entityId:ni.id,refetch:na,showOverallRating:!0})}),(0,o.jsx)(m.Z,{md:6,children:(0,o.jsx)(f.F,{compliance:!0,locationId:ni.id,showFilters:!1})})]})})),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"tenants"},nG),{children:(0,o.jsx)(nR,{filters:{locationId:ni.id}})})),!(!D&&P)&&(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:z,index:"planned-maintenance"},nG),{label:"Planned Maintenance",children:(0,o.jsx)(nX.A,{locationId:ni.id,locationName:ni.name,calendarInitialFilters:{filterType:"location_".concat(ni.id),locationId:ni.id},hideCalendarFilters:["location"],tableInitialFilters:{filterType:"location_".concat(ni.id),locationId:ni.id},hideTableFilters:["location"],itemsInitialFilters:{locationId:ni.id,filterType:"location_".concat(ni.id)},hideItemsFilters:["location"]})}))]})},nG={sx:{height:"calc(100% - 32px)"},boxSx:{height:"100%"}},nK=function(n){var e=n.propertyId,t=(0,nU.Z)("(max-width:600px)"),u=(0,r.useRouter)().query,m=(0,s.useMemo)(function(){return u.tab||"planned-maintenance"},[u.tab]),v=(0,s.useState)(m),x=v[0],h=v[1],p=function(n,e){h(e)},f=(0,l.aM)(d.SC,{variables:{id:e}}),b=f.loading,j=f.data,g=(void 0===j?{location:{}}:j).location;if(b)return(0,o.jsx)(nL.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(nD.Z,{color:"secondary"})});if(!g)return c().push("/404"),!1;var Z={maxWidth:t?"100%":"calc(100vw - 330px)","& .MuiTabs-flexContainer>.MuiTab-root:first-child":(0,i.Z)({},!t&&{borderTopLeftRadius:0,borderBottomLeftRadius:0})};return(0,o.jsxs)(nq.Z,{sx:{width:"100%",height:"100%"},children:[(0,o.jsxs)(nL.Z,{direction:t?"column":"row",children:[(0,o.jsx)(nJ.c,{withoutRightBorderRadius:!t,fullWidth:t,locationId:g.id,locationName:g.name}),(0,o.jsx)(nz.m,{value:x,onChange:p,changeQuery:!0,sx:Z,children:(0,o.jsx)(nV.O,{value:"planned-maintenance",label:"Planned Maintenance"})})]}),(0,o.jsx)(nQ.x,(0,a.Z)((0,i.Z)({value:x,index:"planned-maintenance"},n0),{label:"Planned Maintenance",children:(0,o.jsx)(nX.A,{locationId:g.id,locationName:g.name,calendarInitialFilters:{filterType:"location_".concat(g.id),locationId:g.id},hideCalendarFilters:["location"],tableInitialFilters:{filterType:"location_".concat(g.id),locationId:g.id},hideTableFilters:["location"],itemsInitialFilters:{locationId:g.id,filterType:"location_".concat(g.id)},hideItemsFilters:["location"]})}))]})},n0={sx:{height:"calc(100% - 32px)"},boxSx:{height:"100%"}},n1=t(58849),n6=function(){var n=(0,nO.x)().user,e=(0,r.useRouter)().query;return e.id?"supplier"===n.accountType?(0,o.jsx)(nK,{propertyId:e.id}):(0,o.jsx)(nY,{propertyId:e.id}):c().push("/404")},n3=n6;n6.getLayout=function(n){return(0,o.jsx)(n1.Z,{children:n})}}},function(n){n.O(0,[3662,630,367,6898,9809,2283,212,8890,619,2583,4135,8579,6043,1838,4244,3911,1417,3776,1564,3054,2329,8500,778,4046,7454,1870,2797,1047,4043,8062,3058,6313,597,3754,1050,4030,4061,4191,1121,5447,1836,9528,7490,4296,9271,8849,8344,6733,7554,6096,7305,1514,2982,8372,5185,5469,6625,5656,1105,1,3203,397,7641,6148,9774,2888,179],function(){return n(n.s=36381)}),_N_E=n.O()}]);