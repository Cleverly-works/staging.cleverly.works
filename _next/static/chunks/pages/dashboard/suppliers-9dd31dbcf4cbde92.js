(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{89177:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/suppliers",function(){return t(54795)}])},5336:function(n,e,t){"use strict";t.d(e,{C:function(){return w}});var i=t(85893),r=t(67294),o=t(45697),a=t.n(o),s=t(93946),u=t(25464),c=t(18972),l=t(57976),d=t(73890),p=t(69008),m=t(41687),g=t(60888),v=t(40535),f=t(63441),h=t(41733),x=t(77957),b=t(2548),y=t(24519),Z=t(2391),_=t(69308),S=t(79369),j=t(22961),I=t(28201),C=t(51233),$=t(15861),A={add:(0,i.jsx)(m.Z,{}),archive:(0,i.jsx)(d.Z,{}),avatar:(0,i.jsx)(I.Z,{}),check:(0,i.jsx)(g.Z,{}),delete:(0,i.jsx)(h.Z,{}),description:(0,i.jsx)(v.Z,{}),download:(0,i.jsx)(f.Z,{}),info:(0,i.jsx)(b.Z,{}),edit:(0,i.jsx)(x.Z,{}),location:(0,i.jsx)(_.Z,{}),unarchive:(0,i.jsx)(p.Z,{}),uploadFile:(0,i.jsx)(y.Z,{}),receipt:(0,i.jsx)(Z.Z,{}),visibility:(0,i.jsx)(j.Z,{})},q={default:(0,i.jsx)(l.Z,{}),defaultHoriz:(0,i.jsx)(S.Z,{}),description:(0,i.jsx)(v.Z,{})},w=function(n){var e=n.actionsData,t=n.icon,o=n.row,a=n.disabled,l=(0,r.useState)(null),d=l[0],p=l[1],m=function(n){n.stopPropagation(),p(n.currentTarget)},g=function(){p(null)};return(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:a,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:m,children:q[t]}),(0,i.jsx)(u.Z,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:g,PaperProps:{sx:{borderRadius:2}},children:e(o).map(function(n,e){return(0,i.jsx)(c.Z,{disabled:n.disabled,onClick:function(e){n.onClick(e),g()},sx:{pl:3,pr:4},children:(0,i.jsxs)(C.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==A?void 0:A[n.icon])||null,(0,i.jsx)($.Z,{children:n.tooltip})]})},e)})})]})};w.propTypes={actionsData:a().func.isRequired,icon:a().oneOf(["default","description"]),row:a().any.isRequired,disabled:a().bool},w.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},48580:function(n,e,t){"use strict";t.d(e,{q:function(){return g}});var i=t(26042),r=t(69396),o=t(99534),a=t(85893),s=t(87918),u=t(98456),c=t(23776),l=t(50135),d=t(67294),p=t(45697),m=t.n(p),g=function(n){var e=n.loading,t=n.setSearch,p=n.textFieldProps,m=(0,o.Z)(n,["loading","setSearch","textFieldProps"]),g=(0,d.useState)(""),v=g[0],f=g[1];return(0,d.useEffect)(function(){var n=setTimeout(function(){t(v)},500);return function(){return clearTimeout(n)}},[v,t]),(0,a.jsx)(c.Z,(0,r.Z)((0,i.Z)({isOptionEqualToValue:function(n,e){return n.value===e.value}},m),{loading:e,onInputChange:function(n,e){f(e)},getOptionLabel:function(n){return n.label},renderTags:function(n,e){return n.map(function(n,t){return(0,a.jsx)(s.Z,(0,i.Z)({size:"small",label:n.label},e({index:t})))})},renderInput:function(n){return(0,a.jsx)(l.Z,(0,r.Z)((0,i.Z)({},n,p),{InputProps:(0,r.Z)((0,i.Z)({},n.InputProps,p.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(u.Z,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})})}))}}))};g.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},g.propTypes={multiple:m().bool,limitTags:m().number,filterSelectedOptions:m().bool,color:m().string,loading:m().bool,value:m().oneOf([m().array,m().object]),onChange:m().func,options:m().arrayOf(m().shape({value:m().any.isRequired,label:m().string.isRequired})).isRequired,onOpen:m().func,setSearch:m().func,textFieldProps:m().shape({label:m().string,variant:m().oneOf(["standard"]),color:m().string,error:m().bool,helperText:m().string})}},70692:function(n,e,t){"use strict";t.d(e,{N:function(){return s}});var i=t(85893),r=t(45697),o=t(58594),a=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],s=function(n){var e=n.data,t=n.errors,r=n.name,s=n.onChange,u=n.register;return(0,i.jsx)(o.Z,{errors:t,data:e||a,legend:"",name:r,onChange:s,register:u})};s.propTypes={data:r.object,errors:r.object.isRequired,name:r.string,onChange:r.func,register:r.func.isRequired},s.defaultProps={name:"assignedToMe"}},12547:function(n,e,t){"use strict";t.d(e,{r:function(){return d}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t.n(a),u=t(41664),c=t.n(u),l=t(23795),d=function(n){var e=n.children,t=n.href,a=n.noWrap,s=n.target,u=n.sx,d=void 0===u?{}:u;return a?(0,o.jsx)(o.Fragment,{children:e}):t?(0,o.jsx)(c(),{href:t,target:s,passHref:!0,children:(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({sx:d},n),{children:e}))}):(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({sx:d},n),{children:e}))};d.defaultProps={onClick:function(n){n.stopPropagation()}},d.propTypes={onClick:s().func,href:s().string,noWrap:s().bool,color:s().string}},93884:function(n,e,t){"use strict";t.d(e,{C:function(){return m}});var i=t(26042),r=t(69396),o=t(85893);t(67294);var a=t(45697),s=t(90948),u=t(15861),c=t(51233),l=t(11057),d=t(61730),p=(0,s.ZP)("img")({width:"300px",height:"250px"}),m=function(n){var e=n.imageSrc,t=n.sx,a=n.imageSx,s=n.title,m=n.titleSx,g=n.subtitleFirstLine,v=n.subtitleFirstLineSx,f=n.subtitleSecondLine,h=n.subtitleSecondLineSx,x=n.buttonText,b=n.onAction,y=(0,d.Z)("(max-width: 400px)");return(0,o.jsxs)(c.Z,{sx:(0,r.Z)((0,i.Z)({},t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,o.jsx)(p,{src:e,sx:(0,r.Z)((0,i.Z)({},a),{width:y?"250px":"300px"})}),(0,o.jsx)(u.Z,{typography:"h5",sx:(0,i.Z)({},m),children:s}),(0,o.jsxs)(c.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,o.jsx)(u.Z,{sx:(0,i.Z)({},v),children:g}),(0,o.jsx)(u.Z,{sx:(0,i.Z)({},h),children:f})]}),x&&b&&(0,o.jsx)(l.Z,{variant:"contained",color:"secondary",onClick:b,children:x})]})};m.propTypes={imageSrc:a.string,title:a.string,subtitleFirstLine:a.string,subtitleSecondLine:a.string,onAction:a.func,sx:a.object,imageSx:a.object,titleSx:a.object,subtitleFirstLineSx:a.object,subtitleSecondLineSx:a.object},m.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},94922:function(n,e,t){"use strict";t.d(e,{C:function(){return r},w:function(){return o}});var i=t(26042),r=function(n){return n=(0,i.Z)({},n.supplierDetails,n)},o=function(n,e){var t=n.assignedUser,i=n.coverage,r=n.service,o=n.status,a=n.q,s={type:{_eq:"supplier"}};return t&&(s.managerId={_eq:e.id}),r&&(s.Services={Service:{id:{_eq:r.value}}}),i&&(s.PostcodeAreas={postcodeAreaId:{_eq:i.value}}),o&&(s.status={_eq:o.value}),a&&(s.name={_ilike:a}),s}},14067:function(n,e,t){"use strict";t.d(e,{D7:function(){return y},KQ:function(){return b},R7:function(){return x},j$:function(){return _},kx:function(){return S},l1:function(){return h},lk:function(){return Z},ys:function(){return f}});var i=t(7297),r=t(75063);function o(){var n=(0,i.Z)(['\n  query GetSuppliers(\n    $limit: Int\n    $offset: Int\n    $orderBy: Account_order_by!\n    $where: Account_bool_exp\n  ) {\n    suppliers: Account(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      id\n      createdAt\n      name\n      status\n      companyNumber\n      vatId\n      website\n      jobs: SupplierJobs_aggregate {\n        aggregate {\n          count\n          max {\n            scheduledAt\n          }\n          sum {\n            amount\n          }\n        }\n      }\n      jobList: SupplierJobs(order_by: { createdAt: desc }) {\n        id\n      }\n      services: Services(where: { entity: { _eq: "Account" } }) {\n        id\n        service: Service {\n          id\n          name\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return o=function(){return n},n}function a(){var n=(0,i.Z)(['\n  query GetSupplier($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      companyNumber\n      createdAt\n      name\n      status\n      type\n      updatedAt\n      website\n      clientType\n      managerId\n      vatId\n      meta\n      statusLogs: StatusLog(where: { entity: { _eq: "Account" } }) {\n        id\n        status\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n\n      details: SupplierDetail {\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n        accountId\n      }\n\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n        }\n      }\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n\n      compliances: Compliances(where: { entity: { _eq: "Account" } }, order_by: { expiryAt: asc }) {\n        id\n        createdAt\n        entity\n        entityId\n        expiryAt\n        regNum\n        insuranceAmount\n        meta\n      }\n      coverage: PostcodeAreas(where: { entity: { _eq: "Account" }, status: { _eq: "active" } }) {\n        id\n        status\n        createdAt\n        area: PostcodeArea {\n          id\n          name\n          area\n        }\n      }\n      services: Services {\n        serviceId\n        createdAt\n      }\n      references: References {\n        id\n        createdAt\n      }\n    }\n  }\n']);return a=function(){return n},n}function s(){var n=(0,i.Z)(["\n  query GetSupplierManage($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      status\n      meta\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n      supplierDetails: SupplierDetail {\n        id\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n      }\n    }\n  }\n"]);return s=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation AddSupplier($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return n},n}function c(){var n=(0,i.Z)(["\n  mutation AddSupplierDetail($objects: [SupplierDetail_insert_input!]!) {\n    insert_SupplierDetail(objects: $objects) {\n      returning {\n        id\n        accountId\n      }\n    }\n  }\n"]);return c=function(){return n},n}function l(){var n=(0,i.Z)(["\n  mutation AddSupplierOffer($objects: [SupplierOffer_insert_input!]!) {\n    insert_SupplierOffer(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return l=function(){return n},n}function d(){var n=(0,i.Z)(["\n  mutation UpdateSupplier(\n    $supplierId: Int!\n    $supplier: Account_set_input\n    $supplierDetails: SupplierDetail_set_input\n  ) {\n    update_SupplierDetail(where: { accountId: { _eq: $supplierId } }, _set: $supplierDetails) {\n      returning {\n        id\n      }\n    }\n\n    update_Account_by_pk(pk_columns: { id: $supplierId }, _set: $supplier) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function p(){var n=(0,i.Z)(['\n  query GetPostCodeAreas(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $supplierId: Int\n    $status: String = "active"\n  ) {\n    coverage: PostcodeArea_Entity(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n      order_by: { PostcodeArea: { name: asc } }\n      limit: $limit\n      offset: $offset\n    ) {\n      id\n      status\n      createdAt\n      area: PostcodeArea {\n        id\n        name\n        area\n      }\n    }\n    meta: PostcodeArea_Entity_aggregate(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return p=function(){return n},n}function m(){var n=(0,i.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]);return m=function(){return n},n}function g(){var n=(0,i.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return g=function(){return n},n}function v(){var n=(0,i.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n\n      slaId\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return v=function(){return n},n}var f=(0,r.Ps)(o()),h=(0,r.Ps)(a()),x=(0,r.Ps)(s()),b=(0,r.Ps)(u());(0,r.Ps)(c()),(0,r.Ps)(l());var y=(0,r.Ps)(d()),Z=(0,r.Ps)(p()),_=(0,r.Ps)(m()),S=(0,r.Ps)(g());(0,r.Ps)(v())},15033:function(n,e,t){"use strict";t.d(e,{i:function(){return I}});var i=t(14924),r=t(26042),o=t(69396),a=t(85893),s=t(67294),u=t(11163),c=t(45697),l=t.n(c),d=t(61870),p=t(5616),m=t(51233),g=t(15861),v=t(90948),f=t(41796),h=t(29217),x=t(45111),b=t(46003),y=t(70872),Z=t(58886),_=t(61730),S=function(n){var e=n.currentPage,t=n.totalCount,i=n.pageSize,o=n.onPageChange,s=(0,_.Z)("(max-width:400px)"),u=(0,_.Z)("(max-width:500px)");return(0,a.jsx)(j,{mb:2,page:e,count:Math.ceil(t/i),onChange:function(n,e){return o(e)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===e,hideNextButton:e===Math.ceil(t/i),siblingCount:u?0:1,renderItem:function(n){return(0,a.jsx)(Z.Z,(0,r.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},n))}})};S.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},S.propTypes={currentPage:l().number,totalCount:l().number,pageSize:l().number,onPageChange:l().func};var j=(0,v.ZP)(y.Z)(function(n){var e,t=n.hidePrevButton,o=n.hideNextButton,a=n.theme;return e={},(0,i.Z)(e,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,i.Z)(e,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,i.Z)(e,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,i.Z)(e,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,i.Z)(e,"& button.Mui-selected",(0,r.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},t?{borderRadius:"5px 0 0 5px"}:{})),e}),I=(0,s.forwardRef)(function(n,e){var t=n.columns,i=n.history,o=n.initialSort,c=n.meta,l=n.refetch,d=n.paginationSize,p=n.containerHeight,v=n.noResultsMessage,f=n.autoHeight,y=(0,u.useRouter)(),Z=y.query,_=void 0===Z?{}:Z,j=(0,s.useState)(parseInt(null==_?void 0:_.page,10)||1),I=j[0],A=j[1],q=(0,s.useState)(d||b.C1.paginationSize),w=q[0],P=q[1];o||(o={item:"createdAt",order:"desc"});var k=(0,s.useState)({item:o.item,order:o.order}),D=k[0],M=k[1],F=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=y.query,t=void 0===e?{}:e;if(n>1?t.page=n:delete t.page,!(Object.keys(t).length>0))return{};var i=Object.keys(t).map(function(e){return"page"===e?"".concat(e,"=").concat(n):"".concat(e,"=").concat(t[e])}).join("&");return"?".concat(i)},N=function(){M({item:o.item,order:o.order}),A(1);var n=F();y.push(n),P(d||b.C1.paginationSize)};(0,s.useImperativeHandle)(e,function(){return{currentPage:I,pageSize:w,sort:D,resetPagination:function(){N()}}});var T=function(n){var e=F(n);i&&y.push(e),A(n),!i&&l&&l()},L=function(n){n&&n.field&&n.sort?(M({item:t.find(function(e){return e.field===n.field}).sortName||n.field||n.item||o.item,order:n.sort||n.order||o.order}),l&&l()):(M({item:o.item,order:o.order}),l&&l())};return(0,a.jsxs)(C,{containerHeight:p,children:[(0,a.jsx)($,(0,r.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:f,sortingMode:"server",onSortModelChange:function(n){return L(n[0])},columns:t,pageSize:w,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(h.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(x.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(m.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(h.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(x.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(g.Z,{children:v})})},noRowsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(g.Z,{children:v})})}}},n)),c&&Math.ceil(c.aggregate.totalCount/w)>1&&(0,a.jsx)(S,{currentPage:I,totalCount:c.aggregate.totalCount,pageSize:w,onPageChange:T})]})});I.propTypes={history:l().bool,initialSort:l().object,loading:l().bool,meta:l().object,refetch:l().func,paginationSize:l().number,noResultsMessage:l().string,columns:l().array.isRequired,rows:l().array.isRequired,autoHeight:l().bool},I.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var C=(0,v.ZP)(p.Z)(function(n){return{height:n.containerHeight,display:"flex",flexDirection:"column"}}),$=(0,v.ZP)(d.s)(function(n){var e,t=n.theme,a=n.hideHeader,s=(n.rows,n.loading,n.rowHeight),u=n.isPdf;return e={"--DataGrid-overlayHeight":"40px"},(0,i.Z)(e,"&.MuiDataGrid-root",(0,r.Z)({color:t.palette.black.main,border:"none"},u&&{"@media print":{display:"block"}})),(0,i.Z)(e,"& .MuiDataGrid-main",(0,r.Z)({},u&&{"@media print":{overflow:"visible !important"}})),(0,i.Z)(e,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,r.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,i.Z)(e,"& .MuiDataGrid-virtualScroller",(0,r.Z)({},a&&{marginTop:"0 !important"},u&&{"@media print":{overflow:"visible !important"}})),(0,i.Z)(e,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,i.Z)(e,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,i.Z)(e,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,i.Z)(e,"& .MuiDataGrid-virtualScrollerContent",(0,r.Z)({},u&&{height:"initial !important",minHeight:"initial !important"})),(0,i.Z)(e,"& .MuiDataGrid-virtualScrollerRenderZone",(0,r.Z)({},u&&{position:"relative"})),(0,i.Z)(e,"& .MuiDataGrid-overlayWrapper",(0,i.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,i.Z)(e,"& .MuiDataGrid-row",(0,r.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,i.Z)(e,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,r.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,i.Z)(e,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,f.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,f.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),e})},20705:function(n,e,t){"use strict";t.d(e,{x:function(){return l}});var i=t(14924),r=t(26042),o=t(69396),a=t(67294),s=t(96486),u=t(46003),c=function(n){try{return JSON.parse(n)}catch(e){return!1}},l=function(n){var e,t,l,d,p,m,g,v,f,h,x,b=n.filters,y=n.newFilters,Z=n.initialSort,_=(0,a.useRef)(),S=(0,a.useState)({}),j=S[0],I=S[1],C=(0,a.useState)({}),$=C[0],A=C[1],q=Z||{item:"createdAt",order:"desc"},w=(0,i.Z)({},(null===(e=_.current)||void 0===e?void 0:e.sort.item)||q.item,q.inneritem?(0,i.Z)({},q.inneritem,(null===(t=_.current)||void 0===t?void 0:t.sort.order)||q.order):(null===(l=_.current)||void 0===l?void 0:l.sort.order)||q.order);return(0,a.useEffect)(function(){var n=!(0,s.isEqual)(j,b),e=!(0,s.isEqual)($,y);if(n&&(I(b),null==_||null===(i=_.current)||void 0===i||i.resetPagination()),e&&(A(y),null==_||null===(r=_.current)||void 0===r||r.resetPagination()),(null==_?void 0:null===(t=_.current)||void 0===t?void 0:t.setSort)&&!(n||e)){var t,i,r,o,a,u,c,l,d,p,m,g=(null===(o=_.current)||void 0===o?void 0:null===(a=o.sort)||void 0===a?void 0:a.item)&&(null===(u=_.current)||void 0===u?void 0:null===(c=u.sort)||void 0===c?void 0:c.order)?{item:null===(l=_.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(p=_.current)||void 0===p?void 0:null===(m=p.sort)||void 0===m?void 0:m.order}:w;_.current.setSort(g)}},[b,y]),{initialData:(0,o.Z)((0,r.Z)({},b),{newFilters:(null==y?void 0:y.length)>0?y:void 0,limit:(null===(d=_.current)||void 0===d?void 0:d.pageSize)==="Infinity"?null:parseInt(null===(p=_.current)||void 0===p?void 0:p.pageSize,10)||u.C1.paginationSize,offset:((null===(m=_.current)||void 0===m?void 0:m.currentPage)-1||0)*((null===(g=_.current)||void 0===g?void 0:g.pageSize)||u.C1.paginationSize),orderBy:c(null===(v=_.current)||void 0===v?void 0:null===(f=v.sort)||void 0===f?void 0:null===(h=f.item)||void 0===h?void 0:h.replace(/ORDER/i,null===(x=_.current)||void 0===x?void 0:x.sort.order))||w}),initialSort:Z,ref:_}}},9492:function(n,e,t){"use strict";t.d(e,{S:function(){return i}});var i=function(n,e){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=e,t.href=n,t.click(),document.body.removeChild(t)):location.replace(n)}},59938:function(n,e,t){"use strict";t.d(e,{X:function(){return g}});var i=t(14924),r=t(82670),o=t(828),a=t(7297),s=t(67294),u=t(6388),c=t(50319),l=t(75063),d=t(18586);function p(){var n=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return p=function(){return n},n}function m(){var n=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return m=function(){return n},n}function g(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,d.q)().user,l=(0,s.useState)(function(){try{switch(t){case"network":case"state":return e;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(n))||e}}catch(i){return e}}),p=l[0],m=l[1],g=function(e){try{var o=(0,r.Z)(e,Function)?e(p):e;switch(m(o),t){case"network":h({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,i.Z)({},n,o)}});break;case"sessionStorage":window.sessionStorage.setItem(n,JSON.stringify(o))}}catch(s){}};(0,u.aM)(v,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==t,onCompleted:function(t){var i=t.accountUser;i&&m(i.filters[n]||e)}});var h=(0,o.Z)((0,c.D)(f),1)[0];return[p,g]}var v=(0,l.Ps)(p()),f=(0,l.Ps)(m())},54795:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return V}});var i=t(85893),r=t(11163),o=t.n(r),a=t(58849),s=t(26042),u=t(69396),c=t(828),l=t(67294),d=t(45697),p=t.n(d),m=t(30381),g=t.n(m),v=t(6388),f=t(73359),h=t(14067),x=t(57460),b=t.n(x),y=t(51233),Z=t(90629),_=t(11057),S=t(15861),j=t(98456),I=t(93884),C=t(15033),$=t(81261),A=t(85113),q=t(20705),w=t(63139),P=t(9492),k=t(2845),D=t(5336),M=t(42283),F=t(70692),N=t(11994),T=t(90948),L=t(50135),U=t(61730),R=t(48580),O=t(59938),G=function(n){var e=n.initialFilters,t=n.filters,r=n.setFilters,o=n.open,a=n.onClose,d=(0,U.Z)("(max-width: 400px)"),p=(0,l.useState)(),m=p[0],g=p[1],v=(0,l.useState)(),x=v[0],b=v[1],S=(0,c.Z)((0,O.X)("form_data_".concat(e.filterType),e),2),j=S[0],I=S[1],C=(0,M.cI)({defaultValues:j}),$=C.control,A=C.handleSubmit,q=C.register,w=C.reset,P=C.errors,k=function(){r(e),w(),a(),I((0,u.Z)((0,s.Z)({},e),{filterType:e.filterType}))},D=(0,c.Z)((0,f.t)(h.j$,{variables:{where:{name:{_ilike:""!==m?"%".concat(m,"%"):null}}}}),2),N=D[0],T=D[1],G=T.loading,H=T.data,z=(void 0===H?{items:[]}:H).items,B=(0,c.Z)((0,f.t)(h.kx,{variables:{where:{name:{_ilike:""!==x?"%".concat(x,"%"):null}}}}),2),W=B[0],J=B[1],Y=J.loading,V=J.data,Q=(void 0===V?{items:[]}:V).items,X=function(n){var i=(0,u.Z)((0,s.Z)({},t,n),{q:n.q});r((0,u.Z)((0,s.Z)({},i),{q:n.q?"%".concat(n.q,"%"):null})),I((0,u.Z)((0,s.Z)({},i),{filterType:e.filterType})),w(),a()};return(0,i.jsx)(E,{open:o,onClose:a,children:(0,i.jsx)(Z.Z,{sx:{minWidth:d?"300px":"400px",padding:"20px 40px"},children:(0,i.jsxs)("form",{onSubmit:A(X),children:[(0,i.jsxs)(y.Z,{spacing:4,children:[(0,i.jsx)(L.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:q}),(0,i.jsx)(M.Qr,{name:"coverage",control:$,render:function(n){var e,t=n.value,r=n.onChange;return(0,i.jsx)(R.q,{limitTags:6,color:"secondary",value:t,onChange:function(n,e){return r(e)},loading:G,onOpen:function(){return N()},options:z,setSearch:g,textFieldProps:{label:"Select coverage",variant:"standard",color:"secondary",error:P.coverage,helperText:null===(e=P.coverage)||void 0===e?void 0:e.message}})}}),(0,i.jsx)(M.Qr,{name:"service",control:$,render:function(n){var e,t=n.value,r=n.onChange;return(0,i.jsx)(R.q,{limitTags:6,color:"secondary",value:t,onChange:function(n,e){return r(e)},loading:Y,onOpen:function(){return W()},options:Q,setSearch:b,textFieldProps:{label:"Select service",variant:"standard",color:"secondary",error:P.service,helperText:null===(e=P.service)||void 0===e?void 0:e.message}})}}),(0,i.jsx)(M.Qr,{name:"status",control:$,render:function(n){var e,t=n.value,r=n.onChange;return(0,i.jsx)(R.q,{limitTags:6,color:"secondary",value:t,onChange:function(n,e){return r(e)},options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],textFieldProps:{label:"Select status",variant:"standard",color:"secondary",error:P.status,helperText:null===(e=P.status)||void 0===e?void 0:e.message}})}}),(0,i.jsx)(F.N,(0,u.Z)((0,s.Z)({},{control:$,errors:P,register:q}),{name:"assignedUser",onChange:function(n){return r(function(e){return(0,u.Z)((0,s.Z)({},e),{assignedUser:n.target.checked})})}}))]}),(0,i.jsxs)(y.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:{margin:"20px 0"},children:[(0,i.jsx)(_.Z,{variant:"contained",color:"danger",onClick:function(){return k()},children:"Cancel"}),(0,i.jsx)(_.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},E=(0,T.ZP)(N.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}});G.propTypes={initialFilters:p().object,filters:p().object,setFilters:p().func,open:p().bool,onClose:p().func};var H=t(94922),z=t(12547),B="/dashboard/suppliers/",W=function(n){var e,t,r=n.initialFilters,a=(0,k.x)().user,d=(0,w.s)(),p=(0,l.useState)((0,s.Z)({},r)),m=p[0],x=p[1],M=(0,q.x)({filters:m}),F=M.initialData,N=M.ref,T=(0,l.useState)(!1),L=T[0],U=T[1],R=(0,l.useState)(!1),O=R[0],E=R[1],W=(0,v.aM)(h.ys,{variables:(0,s.Z)({where:(0,H.w)(F,a)},F)}),J=W.data,Y=void 0===J?{suppliers:[],meta:{aggregate:{totalCount:0}}}:J,V=Y.suppliers,Q=Y.meta,X=W.loading,K=W.refetch,nn=(0,c.Z)((0,f.t)(h.ys,{fetchPolicy:"no-cache",variables:(0,u.Z)((0,s.Z)({where:(0,H.w)(F,a)},F),{limit:(null==Q?void 0:null===(e=Q.aggregate)||void 0===e?void 0:e.totalCount)||150}),onCompleted:function(n){try{var e=b().unparse(ni(n.suppliers)),t="data:application/octet-stream,"+encodeURIComponent(e);(0,P.S)(t,"suppliers.csv")}finally{E(!1)}}}),1)[0],ne=function(n){n.stopPropagation(),E(!0),nn()},nt=function(n){return[{context:"secondary",icon:"edit",onClick:function(e){return ns(e)(n)},tooltip:"Edit"}]},ni=function(n){return n.map(function(n){var e,t,i,r,o,a,s,u,c,l,d,p,m;return{name:n.name,companyNumber:n.companyNumber,vatId:n.vatId,website:n.website,status:n.status,createdAt:g()(n.createdAt).format("YYYY-MM-DD"),jobsCount:null===(e=n.jobs)||void 0===e?void 0:null===(t=e.aggregate)||void 0===t?void 0:t.count,email:(null===(i=n.contactUsers)||void 0===i?void 0:i.length)?null===(r=n.contactUsers[0].user)||void 0===r?void 0:r.email:"",phoneNumber:(null===(o=n.contactUsers)||void 0===o?void 0:o.length)?null===(a=n.contactUsers[0].user)||void 0===a?void 0:a.phone:"",contactName:(null===(s=n.contactUsers)||void 0===s?void 0:s.length)?null===(u=n.contactUsers[0].user)||void 0===u?void 0:u.fullName:"",lastJob:(null===(c=n.jobList)||void 0===c?void 0:c.length)?n.jobList[0].id:"",earnings:null===(l=n.jobs)||void 0===l?void 0:null===(d=l.aggregate)||void 0===d?void 0:null===(p=d.sum)||void 0===p?void 0:p.amount,services:null===(m=n.services)||void 0===m?void 0:m.map(function(n){var e;return null===(e=n.service)||void 0===e?void 0:e.name}).join(", ")}})},nr=(0,l.useCallback)(function(){return V.map(function(n){var e,t,i,r,o,a,s,u,c,l,d,p,m=(0,A.WE)(n,"registered"),v=null==m?void 0:null===(e=m.address)||void 0===e?void 0:e.city,f=(null===(t=n.jobs)||void 0===t?void 0:null===(i=t.aggregate)||void 0===i?void 0:null===(r=i.max)||void 0===r?void 0:r.scheduledAt)&&g()(null===(o=n.jobs)||void 0===o?void 0:null===(a=o.aggregate)||void 0===a?void 0:null===(s=a.max)||void 0===s?void 0:s.scheduledAt).format("YYYY-MM-DD");return{id:n.id,managerId:null==n?void 0:null===(u=n.manager)||void 0===u?void 0:u.id,name:n.name,jobsCount:null===(c=n.jobs)||void 0===c?void 0:null===(l=c.aggregate)||void 0===l?void 0:l.count,lastJob:f,contactName:(null===(d=n.contactUsers)||void 0===d?void 0:d.length)?"".concat(n.contactUsers[0].user.nameFirst," ").concat(n.contactUsers[0].user.nameLast):"Unassigned",contactId:(null===(p=n.contactUsers)||void 0===p?void 0:p.length)&&n.contactUsers[0].user.id,city:v||"",createdAt:g()(n.createdAt).format("YYYY-MM-DD"),status:n.status.charAt(0).toUpperCase()+n.status.slice(1,n.status.length),actions:""}})},[V]),no=(0,l.useMemo)(function(){var n={};return!nr().length&&(null==F?void 0:F.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No suppliers",subtitleFirstLine:"You currently have no suppliers set up in the system",subtitleSecondLine:"Click\xa0create supplier\xa0to get started building.",buttonText:"Create supplier",onAction:na}},[null==F?void 0:F.q,nr]),na=function(){o().push("".concat(B,"create"))},ns=function(n){return n.stopPropagation(),function(n){o().push("".concat(B,"edit?id=").concat(n.id))}},nu=function(n){o().push("".concat(B,"view?id=").concat(n.id))};return(0,i.jsxs)(i.Fragment,{children:[L&&(0,i.jsx)(G,{initialFilters:r,open:L,filters:m,setFilters:x,onClose:function(){return U(!1)}}),(0,i.jsxs)(y.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,i.jsxs)(y.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,i.jsx)(_.Z,{variant:"contained",startIcon:(0,i.jsx)($.Z,{}),onClick:function(){return U(!0)},children:"Filters"}),(0,i.jsxs)(y.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(_.Z,{variant:"contained",color:"secondary",onClick:na,children:"Create supplier"}),!d&&(0,i.jsx)(_.Z,{startIcon:!O&&(0,i.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:O,variant:"contained",color:"success",onClick:ne,children:O?(0,i.jsx)(j.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,i.jsxs)(Z.Z,{sx:{padding:"16px 0px",height:"calc(100% - 52px)"},children:[(0,i.jsx)(S.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Suppliers"}),(null===(t=nr())||void 0===t?void 0:t.length)?(0,i.jsx)(C.i,{ref:N,loading:X,columns:[{field:"name",headerName:"Name",minWidth:130,flex:1},{field:"jobsCount",headerName:"Number of jobs",minWidth:130,flex:1,sortName:'{"SupplierJobs_aggregate": {"count": "ORDER"}}'},{field:"lastJob",headerName:"Last job",minWidth:130,flex:1,sortName:'{"SupplierJobs_aggregate": {"max": {"scheduledAt": "ORDER"}}}'},{field:"contactName",headerName:"Contact",minWidth:130,flex:1,sortable:!1,renderCell:function(n){var e=n.row,t=e.contactName,r=e.contactId;return(0,i.jsx)(z.r,{color:"secondary",href:"/dashboard/users/view?id=".concat(r),children:t})}},{field:"city",headerName:"City",minWidth:130,flex:1,sortable:!1},{field:"createdAt",headerName:"Created",minWidth:130,flex:1},{field:"status",headerName:"Status",minWidth:130,flex:1,sortable:!1},{field:"actions",headerName:"Actions",minWidth:130,flex:1,sortable:!1,renderCell:function(n){var e=n.row;return(0,i.jsx)(D.C,{actionsData:nt,row:e})}}],rows:nr(),columnVisibilityModel:{},meta:Q,refetch:K,autoHeight:!1,containerHeight:"calc(100% - 52px)",onRowClick:nu}):!X&&(0,i.jsx)(I.C,(0,s.Z)({imageSrc:"/static/icons/no_locations_found.svg"},no))]})]})]})};W.propTypes={filters:d.object};var J={assignedUser:!1,coverageId:null,q:null,status:{label:"Active",value:"active"},serviceId:null,filterType:"suppliers_table"},Y=function(){return(0,k.x)().user?(0,i.jsx)(a.Z,{children:(0,i.jsx)(W,{initialFilters:J})}):(o().push("/account/sign-in"),null)};Y.getLayout=function(n){return n};var V=Y}},function(n){n.O(0,[3662,2283,212,8890,2583,4135,8579,6043,4244,3776,2329,778,1023,7454,1870,5497,3002,8849,9774,2888,179],function(){return n(n.s=89177)}),_N_E=n.O()}]);