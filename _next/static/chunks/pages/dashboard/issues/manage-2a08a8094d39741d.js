(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503],{96540:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),a=n(85893);t.Z=(0,i.default)((0,a.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},40055:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),a=n(85893);t.Z=(0,i.default)((0,a.jsx)("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"}),"Done")},34193:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),a=n(85893);t.Z=(0,i.default)((0,a.jsx)("path",{d:"m12 5.69 5 4.5V18h-2v-6H9v6H7v-7.81zM12 3 2 12h3v8h6v-6h2v6h6v-8h3z"}),"HomeOutlined")},11961:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),a=n(85893);t.Z=(0,i.default)([(0,a.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42M13 20.01 4 11V4h7v-.01l9 9z"},"0"),(0,a.jsx)("circle",{cx:"6.5",cy:"6.5",r:"1.5"},"1")],"LocalOfferOutlined")},69308:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),a=n(85893);t.Z=(0,i.default)((0,a.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn")},58951:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var r=n(63366),i=n(87462),a=n(67294),o=n(63961),s=n(58510),l=n(90948),u=n(14136),c=n(71657),d=n(15861),m=n(1977),p=n(8027);function v(e){return(0,p.ZP)("MuiDialogContentText",e)}(0,m.Z)("MuiDialogContentText",["root"]);var f=n(85893);let g=["children","className"],Z=e=>{let{classes:t}=e,n=(0,s.Z)({root:["root"]},v,t);return(0,i.Z)({},t,n)},h=(0,l.ZP)(d.Z,{shouldForwardProp:e=>(0,u.Z)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),y=a.forwardRef(function(e,t){let n=(0,c.Z)({props:e,name:"MuiDialogContentText"}),{className:a}=n,s=(0,r.Z)(n,g),l=Z(s);return(0,f.jsx)(h,(0,i.Z)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:s,className:(0,o.Z)(l.root,a)},n,{classes:l}))});var b=y},37645:function(e,t,n){"use strict";var r=n(87462),i=n(63366),a=n(67294),o=n(63961),s=n(58510),l=n(15861),u=n(90948),c=n(71657),d=n(4472),m=n(34182),p=n(85893);let v=["className","id"],f=e=>{let{classes:t}=e;return(0,s.Z)({root:["root"]},d.a,t)},g=(0,u.ZP)(l.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),Z=a.forwardRef(function(e,t){let n=(0,c.Z)({props:e,name:"MuiDialogTitle"}),{className:s,id:l}=n,u=(0,i.Z)(n,v),d=f(n),{titleId:Z=l}=a.useContext(m.Z);return(0,p.jsx)(g,(0,r.Z)({component:"h2",className:(0,o.Z)(d.root,s),ownerState:n,ref:t,variant:"h6",id:null!=l?l:Z},u))});t.Z=Z},98619:function(e,t,n){"use strict";var r=n(63366),i=n(87462),a=n(67294),o=n(63961),s=n(58510),l=n(2101),u=n(90948),c=n(14136),d=n(71657),m=n(49990),p=n(58974),v=n(51705),f=n(59773),g=n(68686),Z=n(85893);let h=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],y=(e,t)=>{let{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters]},b=e=>{let{alignItems:t,classes:n,dense:r,disabled:a,disableGutters:o,divider:l,selected:u}=e,c=(0,s.Z)({root:["root",r&&"dense",!o&&"gutters",l&&"divider",a&&"disabled","flex-start"===t&&"alignItemsFlexStart",u&&"selected"]},g.t,n);return(0,i.Z)({},n,c)},x=(0,u.ZP)(m.Z,{shouldForwardProp:e=>(0,c.Z)(e)||"classes"===e,name:"MuiListItemButton",slot:"Root",overridesResolver:y})(({theme:e,ownerState:t})=>(0,i.Z)({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${g.Z.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,l.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${g.Z.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,l.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${g.Z.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,l.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,l.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${g.Z.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${g.Z.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity}},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},"flex-start"===t.alignItems&&{alignItems:"flex-start"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.dense&&{paddingTop:4,paddingBottom:4})),j=a.forwardRef(function(e,t){let n=(0,d.Z)({props:e,name:"MuiListItemButton"}),{alignItems:s="center",autoFocus:l=!1,component:u="div",children:c,dense:m=!1,disableGutters:g=!1,divider:y=!1,focusVisibleClassName:j,selected:S=!1,className:I}=n,w=(0,r.Z)(n,h),q=a.useContext(f.Z),C=a.useMemo(()=>({dense:m||q.dense||!1,alignItems:s,disableGutters:g}),[s,q.dense,m,g]),D=a.useRef(null);(0,p.Z)(()=>{l&&D.current&&D.current.focus()},[l]);let T=(0,i.Z)({},n,{alignItems:s,dense:C.dense,disableGutters:g,divider:y,selected:S}),E=b(T),P=(0,v.Z)(D,t);return(0,Z.jsx)(f.Z.Provider,{value:C,children:(0,Z.jsx)(x,(0,i.Z)({ref:P,href:w.href||w.to,component:(w.href||w.to)&&"div"===u?"button":u,focusVisibleClassName:(0,o.Z)(E.focusVisible,j),ownerState:T,className:(0,o.Z)(E.root,I)},w,{classes:E,children:c}))})});t.Z=j},68686:function(e,t,n){"use strict";n.d(t,{t:function(){return a}});var r=n(1977),i=n(8027);function a(e){return(0,i.ZP)("MuiListItemButton",e)}let o=(0,r.Z)("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);t.Z=o},58594:function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var r,i,a,o,s,l=n(51174),u=n(18391),c=n(66080),d=n(67294),m=n(45697),p=n(10367),v=n(64522),f=["disabled"],g=(0,d.forwardRef)(function(e,t){var n=e.disabled,r=(0,c.Z)(e,f);return d.createElement(Z,(0,u.Z)({disabled:n,ref:t,type:"checkbox"},r))}),Z=p.ZP.input(r||(r=(0,l.Z)(["\n  cursor: pointer;\n  margin-right: 0.5rem;\n"])));g.propTypes={disabled:m.bool},g.defaultProps={stacked:!1};var h=n(92415),y=["data","errors","legend","stacked"],b=["disabled","label"],x=function(e){var t=e.data,n=e.errors,r=e.legend,i=e.stacked,a=(0,c.Z)(e,y);return d.createElement(j,{error:n[a.name]},r&&d.createElement("legend",null,r),t.map(function(e){var t=e.disabled,r=e.label,o=(0,c.Z)(e,b);return d.createElement(S,{htmlFor:o.id,key:o.id,stacked:i},d.createElement(v.Z,(0,u.Z)({component:g,disabled:t,errors:n[a.name],showError:!1},o,a)),r)}))};x.displayName="Checkbox";var j=p.ZP.fieldset(i||(i=(0,l.Z)(["\n  border-radius: 0.25rem;\n  color: ",";\n  ","\n"])),function(e){return e.theme.COLOUR.dark},function(e){return e.error&&(0,p.iv)(a||(a=(0,l.Z)(["\n      ","\n      padding: 0.5rem;\n    "])),function(e){return(0,h.Z)(e)})}),S=p.ZP.label(o||(o=(0,l.Z)(["\n  cursor: pointer;\n  margin-right: 1.25rem;\n  position: relative;\n  ","\n"])),function(e){return e.stacked&&(0,p.iv)(s||(s=(0,l.Z)(["\n      display: block;\n      margin: 0.5rem 0;\n    "])))});x.propTypes={data:m.array.isRequired,errors:m.object,legend:m.string,stacked:m.bool},x.defaultProps={data:[],errors:{},stacked:!1};var I=x},90951:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var r,i,a,o,s,l,u,c=n(51174),d=n(18391),m=n(66080),p=n(67294),v=n(45697),f=n(10367),g=n(64522),Z=["disabled"],h=(0,p.forwardRef)(function(e,t){var n=e.disabled,r=(0,m.Z)(e,Z);return p.createElement(y,(0,d.Z)({disabled:n,type:"radio",ref:t},r))}),y=f.ZP.input(r||(r=(0,c.Z)(["\n  cursor: pointer;\n  margin-right: 0.5rem;\n"])));h.propTypes={disabled:v.bool},h.defaultProps={stacked:!1};var b=n(92415),x=["data","errors","legend","stacked"],j=["disabled","label"],S=function(e){var t=e.data,n=e.errors,r=e.legend,i=e.stacked,a=(0,m.Z)(e,x);return p.createElement(I,{error:n[a.name]},r&&p.createElement(w,{error:n[a.name]},r),t.map(function(e){var t=e.disabled,r=e.label,o=(0,m.Z)(e,j);return p.createElement(q,{htmlFor:o.id,key:o.id,stacked:i},p.createElement(g.Z,(0,d.Z)({component:h,disabled:t,errors:n[a.name],showError:!1},o,a)),r)}))};S.displayName="RadioField";var I=f.ZP.fieldset(i||(i=(0,c.Z)(["\n  border-radius: 0.25rem;\n  color: ",";\n  ","\n"])),function(e){return e.theme.COLOUR.dark},function(e){return e.error&&(0,f.iv)(a||(a=(0,c.Z)(["\n      ","\n      padding: 0.5rem;\n    "])),function(e){return(0,b.Z)(e)})}),w=f.ZP.legend(o||(o=(0,c.Z)(["\n  ","\n"])),function(e){return e.error&&(0,f.iv)(s||(s=(0,c.Z)(["\n      padding: 0 0.5rem;\n    "])))}),q=f.ZP.label(l||(l=(0,c.Z)(["\n  cursor: pointer;\n  margin-right: 1.25rem;\n  position: relative;\n  ","\n"])),function(e){return e.stacked&&(0,f.iv)(u||(u=(0,c.Z)(["\n      display: block;\n      margin: 0.5rem 0;\n    "])))});S.propTypes={data:v.array.isRequired,legend:v.string,stacked:v.bool},S.defaultProps={data:[],stacked:!1};var C=S},6054:function(e,t,n){"use strict";var r=n(67294),i=function(e){var t=(0,r.useRef)();return(0,r.useEffect)(function(){t.current=e}),t.current};t.Z=i},19076:function(e,t,n){"use strict";var r=n(21614),i=n(67294),a=n(45697),o=n(15214),s=n(76312),l=n(17813),u=n(18645),c=n(55843),d=n(28368);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v=function(e){var t=e.children,n=e.meta,r=e.pageHeading,a=e.resultAlert,d=e.View,m=a.context,v=a.message,f=p(p({},{description:"Admin",path:"/",title:"Admin"}),n);return i.createElement(i.Suspense,{fallback:i.createElement(u.Z,{indicator:i.createElement(s.Z,null)})},i.createElement(l.Z,{fluid:!0,meta:f,pageHeading:r},d||t,v&&i.createElement(i.Fragment,null,i.createElement(c.Z,null),i.createElement(o.Z,{content:v,context:m}))))};v.displayName="Dashboard",v.propTypes={children:a.node,meta:(0,a.shape)({description:a.string,path:a.string,title:a.string}),pageHeading:(0,a.shape)({center:a.bool,context:(0,a.oneOf)(Object.values(d.Z)),divider:a.bool,heading:a.any.isRequired,help:a.bool,helpContent:a.any,strapline:a.string}),resultAlert:(0,a.shape)({context:a.string,message:a.string}),View:a.node},v.defaultProps={resultAlert:{context:"success",message:""}},t.Z=v},17813:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r,i=n(51174),a=n(67294),o=n(45697),s=n(10367),l=n(94303),u=n(74147),c=n(9008),d=n.n(c),m=function(e){var t=e.canonical,n=e.brand,r=e.meta,i=r.description,o=r.path,s=r.title;return a.createElement(d(),null,a.createElement("title",null,s," | ",n),a.createElement("meta",{name:"description",content:i,key:"description"}),a.createElement("meta",{rel:"canonical",href:t+o,key:"canonical"}),a.createElement("meta",{property:"og:title",content:s}),a.createElement("meta",{property:"og:description",content:i}),a.createElement("meta",{property:"og:url",content:t+o}),a.createElement("meta",{name:"twitter:url",content:t+o}),a.createElement("meta",{name:"twitter:title",content:s}),a.createElement("meta",{name:"twitter:description",content:i}))};m.displayName="MetaHead",m.propTypes={brand:o.string.isRequired,meta:o.object.isRequired};var p=n(35599),v=n(55843),f=n(28368),g=n(66349),Z=function(e){var t=e.children,n=e.fluid,r=e.meta,i=e.padding,o=e.pageHeading,s=(0,a.useContext)(l.Z).config,c=s.Brand,d=s.Canonical;return a.createElement(h,null,i&&a.createElement(v.Z,{paddingTop:i}),r&&a.createElement(m,{canonical:d,brand:c.name,meta:r}),a.createElement(u.Z,{fluid:n},o&&a.createElement(p.Z,o),t),i&&a.createElement(v.Z,{paddingBottom:i}))};Z.displayName="Page";var h=s.ZP.div(r||(r=(0,i.Z)(["\n  background-color: ",";\n"])),function(e){return e.theme.PAGE.backGroundColour});Z.propTypes={children:o.node.isRequired,fluid:o.bool,meta:(0,o.shape)({description:o.string.isRequired,path:o.string,title:o.string.isRequired}),padding:(0,o.oneOfType)([o.bool,(0,o.oneOf)(Object.values(g.Z))]),pageHeading:(0,o.shape)({center:o.bool,context:(0,o.oneOf)(Object.values(f.Z)),divider:o.bool,heading:o.any.isRequired,help:o.bool,helpContent:o.any,strapline:o.string})},Z.defaultProps={fluid:!1,padding:"md"};var y=Z},35599:function(e,t,n){"use strict";var r,i,a,o,s,l=n(51174),u=n(67294),c=n(45697),d=n(10367),m=n(55377),p=n(33006),v=n(28368),f=function(e){var t=e.center,n=e.children,r=e.context,i=e.divider,a=e.heading,o=e.help,s=e.helpContent,l=e.strapline;return u.createElement(g,{center:t,divider:i},u.createElement(Z,null,u.createElement(y,{content:a,context:r,pageHeading:!0}),l&&u.createElement("div",null,l)),(n||o)&&u.createElement(h,null,n||s),i&&u.createElement(b,{size:"md"}))};f.displayName="PageHeading";var g=d.ZP.header(r||(r=(0,l.Z)(["\n  align-items: center;\n  display: flex;\n  flex-flow: row wrap;\n  justify-content: space-between;\n  margin-bottom: ",";\n  text-align: ",";\n"])),function(e){return!e.divider&&"2rem"},function(e){return e.center&&"center"}),Z=d.ZP.span(i||(i=(0,l.Z)(["\n  flex: 1;\n"]))),h=d.ZP.span(a||(a=(0,l.Z)(["\n  display: flex;\n  flex: 1;\n  justify-content: flex-end;\n"]))),y=(0,d.ZP)(p.Z)(o||(o=(0,l.Z)(["\n  margin-bottom: ",";\n"])),function(e){return e.divider?"0.5rem":"0"}),b=(0,d.ZP)(m.Z)(s||(s=(0,l.Z)(["\n  width: 100%;\n"])));f.propTypes={center:c.bool,children:c.element,context:(0,c.oneOf)(Object.values(v.Z)),divider:c.bool,heading:c.any.isRequired,help:c.bool,helpContent:c.any,strapline:c.string},f.defaultProps={center:!1,context:"primary",divider:!0,help:!1,helpContent:"",strapline:""},t.Z=f},23233:function(e,t){"use strict";t.Z={camelize:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},decamelize:function(e){return e.split(/(?=[A-Z])/).join(" ")}}},83946:function(e,t,n){"use strict";function r(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}n.d(t,{Z:function(){return r}})},11640:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(83946),i=n(19013),a=n(13882);function o(e,t){(0,a.Z)(2,arguments);var n=(0,i.Z)(e),o=(0,r.Z)(t);if(isNaN(o))return new Date(NaN);if(!o)return n;var s=n.getDate(),l=new Date(n.getTime());return(l.setMonth(n.getMonth()+o+1,0),s>=l.getDate())?l:(n.setFullYear(l.getFullYear(),l.getMonth(),s),n)}},83894:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(19013),i=n(13882);function a(e){(0,i.Z)(1,arguments);var t=(0,r.Z)(e);return t.setHours(23,59,59,999),t}},4135:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(19013),i=n(13882);function a(e){(0,i.Z)(1,arguments);var t=(0,r.Z)(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}},67090:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(19013),i=n(83946),a=n(13882);function o(e,t){(0,a.Z)(1,arguments);var n=t||{},o=n.locale,s=o&&o.options&&o.options.weekStartsOn,l=null==s?0:(0,i.Z)(s),u=null==n.weekStartsOn?l:(0,i.Z)(n.weekStartsOn);if(!(u>=0&&u<=6))throw RangeError("weekStartsOn must be between 0 and 6 inclusively");var c=(0,r.Z)(e),d=c.getDay();return c.setDate(c.getDate()+((d<u?-7:0)+6-(d-u))),c.setHours(23,59,59,999),c}},69119:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(19013),i=n(13882);function a(e){(0,i.Z)(1,arguments);var t=(0,r.Z)(e);return t.setHours(0,0,0,0),t}},43703:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(19013),i=n(13882);function a(e){(0,i.Z)(1,arguments);var t=(0,r.Z)(e);return t.setDate(1),t.setHours(0,0,0,0),t}},54559:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(83946),i=n(11640),a=n(13882);function o(e,t){(0,a.Z)(2,arguments);var n=(0,r.Z)(t);return(0,i.Z)(e,-n)}},20633:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/manage",function(){return n(65647)}])},52971:function(e,t,n){"use strict";n.d(t,{V:function(){return w}});var r=n(26042),i=n(69396),a=n(29815),o=n(85893),s=n(45697),l=n.n(s),u=n(93946),c=n(51233),d=n(15861),m=n(21023),p=n(96540),v=n(67294),f=n(12547),g=n(42283),Z=n(79665),h=n(11057),y=n(50135),b=n(77957),x=n(41733),j=n(74231),S=j.Ry({name:j.Z_().required(),url:j.Z_().url().required()}),I=function(e){var t=e.noEdit,n=e.noDelete,a=e.onDelete,s=e.id,l=e.isAdded,d=e.url,p=e.name,j=e.onSave,I=(0,v.useState)(l),w=I[0],q=I[1],C=(0,g.cI)({resolver:(0,Z.S)(S)}),D=C.control,T=C.handleSubmit,E=C.errors,P=function(e){e.stopPropagation(),q(!0)},R=function(e){e.stopPropagation(),q(!1),p&&d||a()},_=function(e){j(e),q(!1)};return(0,o.jsx)("form",{children:w?(0,o.jsxs)(c.Z,{children:[(0,o.jsxs)(c.Z,{spacing:1,children:[(0,o.jsx)(g.Qr,{control:D,name:"name",defaultValue:p,render:function(e){var t;return(0,o.jsx)(y.Z,(0,i.Z)((0,r.Z)({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{error:E.name,helperText:null===(t=E.name)||void 0===t?void 0:t.message}))}}),(0,o.jsx)(g.Qr,{control:D,name:"url",defaultValue:d,render:function(e){var t;return(0,o.jsx)(y.Z,(0,i.Z)((0,r.Z)({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{error:E.url,helperText:null===(t=E.url)||void 0===t?void 0:t.message}))}})]}),(0,o.jsxs)(c.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,o.jsx)(h.Z,{variant:"contained",color:"danger",size:"small",onClick:R,children:"Cancel"}),(0,o.jsx)(h.Z,{variant:"contained",size:"small",onClick:T(_),children:"Save"})]})]}):(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,o.jsx)(f.r,{target:"_blank",variant:"body1",color:"secondary",href:d,sx:{textDecoration:"auto",fontWeight:700},children:p}),!t&&(0,o.jsx)(m.Z,{title:"Edit",placement:"top-start",children:(0,o.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:P,children:(0,o.jsx)(b.Z,{sx:{fontSize:"16px"}})})}),!n&&(0,o.jsx)(m.Z,{title:"Delete",placement:"top-start",children:(0,o.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return a(s)},children:(0,o.jsx)(x.Z,{sx:{fontSize:"16px"}})})})]})})};I.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}},I.propTypes={isAdded:l().bool,noEdit:l().bool,noDelete:l().bool,url:l().string,name:l().string,onSave:l().func,onCancel:l().func,onDelete:l().func};var w=function(e){var t=e.values,n=e.setValue,s=e.name,l=e.title,f=e.displayMode,g=e.noDeleteEdit,Z=e.titleSx,h=(0,v.useState)([]),y=h[0],b=h[1];(0,v.useEffect)(function(){Array.isArray(t)&&b(t)},[t]);var x=function(e){e.stopPropagation(),b(function(e){return(0,a.Z)(e).concat([{name:"",link:"",isAdded:!0}])})},j=function(e,t){var r=(0,a.Z)(y);r.splice(e,1,t),n(s,r)};return(0,o.jsxs)(c.Z,{children:[(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,o.jsxs)(d.Z,{sx:Z,children:[l,":"]}),!f&&(0,o.jsx)(m.Z,{title:"Add new link",placement:"top-start",children:(0,o.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:x,children:(0,o.jsx)(p.Z,{})})})]}),(0,o.jsx)(c.Z,{pl:2,spacing:.8,children:(null==y?void 0:y.length)?y.map(function(e,a){var l;return(0,o.jsx)(I,(0,i.Z)((0,r.Z)({index:a},e),{noEdit:g||f,noDelete:g||f,onDelete:function(){var e=t.filter(function(e,t){return t!==a});n(s,e),b(e)},onSave:function(e){return j(a,e)}}))}):(0,o.jsx)(d.Z,{typography:"subtitle2",children:"No data"})})]})};w.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}},w.propTypes={values:l().arrayOf(l().shape({isAdded:l().bool,noEdit:l().bool,url:l().string,name:l().string})),titleSx:l().object,setValue:l().func,noDeleteEdit:l().bool}},46602:function(e,t,n){"use strict";n.d(t,{k:function(){return b}});var r=n(26042),i=n(69396),a=n(85893),o=n(45697),s=n(42283),l=n(79665),u=n(76600),c=n(9270),d=n(62140),m=n(49501),p=n(55563),v=n(6710),f=n(95103),g=n(74231),Z=(0,g.Ry)().shape({name:(0,g.Z_)(),invoicingEntity:(0,g.Z_)(),addressLine1:(0,g.Z_)().required(),addressLine2:(0,g.Z_)(),addressLine3:(0,g.Z_)(),city:(0,g.Z_)().required(),postCode:(0,g.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,g.Z_)(),countryId:(0,g.Z_)().required()}),h=n(25742),y=n(73760),b=function(e){var t=e.defaultValues,n=(e.onCancel,e.onSubmit),o=e.type,g=(0,s.cI)({defaultValues:(0,r.Z)({},t),resolver:(0,l.S)(Z)}),b=g.control,x=g.errors,j=g.handleSubmit,S={control:b,errors:x,register:g.register};return(0,a.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:j(n),children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(d.Z,{md:12,children:(0,a.jsx)(m.Z,{label:"Address name",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"name"}))})}),"invoice"===o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{md:12,children:(0,a.jsx)(m.Z,{label:"invoicing email",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"invoicingEmail",type:"email"}))})}),(0,a.jsx)(d.Z,{md:12,children:(0,a.jsx)(m.Z,{label:"Invoicing entity",children:(0,a.jsx)(v.Z,(0,i.Z)((0,r.Z)({},S),{name:"invoicingEntity",rows:4}))})})]}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"Address Line 1",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"addressLine1"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"Address Line 2",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"addressLine2"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"Address Line 3",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"addressLine3"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"City",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"city"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"Post Code",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"postCode"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"County",children:(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"county"}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(m.Z,{label:"Country",children:(0,a.jsx)(f.Z,(0,i.Z)((0,r.Z)({},S),{name:"countryId",options:y.O}))})})]}),(0,a.jsx)(c.Z,{justify:"end",children:(0,a.jsx)(d.Z,{md:12,children:(0,a.jsx)(h.H,{content:"Submit",type:"submit"})})}),(null==t?void 0:t.id)&&(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"id",type:"hidden"})),(null==t?void 0:t.meta)&&(0,a.jsx)(p.Z,(0,i.Z)((0,r.Z)({},S),{name:"meta",type:"hidden"}))]})};b.propTypes={defaultValues:o.object,onCancel:o.func.isRequired,onSubmit:o.func.isRequired,type:o.string}},22595:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r=function(e,t){if(Array.isArray(t)){var n,r=null;return t.forEach(function(t){var n,i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});r=(null==i?void 0:i.createdAt)||r}),r}var i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==i?void 0:i.createdAt)||null}},61816:function(e,t,n){"use strict";n.d(t,{n:function(){return v}});var r=n(26042),i=n(69396),a=n(85893),o=n(45697),s=n(11585),l=n(90951),u=n(28497),c=n(15214),d=n(9270),m=n(62140),p=n(44634),v=function(e){var t=e.errors,n=e.register,o=e.pricingWatch,v=e.hasServiceRate,f=e.isPPM,g={register:n,errors:t},Z=p.Hu.filter(function(e){var t=e.value;return!f||"fixed"===t});return(0,a.jsxs)(s.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{data:Z,legend:"Pricing",name:"pricing"})),"time-materials"===o&&(0,a.jsx)(u.Z,(0,i.Z)((0,r.Z)({},g),{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===o&&(0,a.jsxs)(a.Fragment,{children:[v?(0,a.jsx)(c.Z,{content:"This customer has a service rate on their account. The customer amounts will be calculated using the relevant service rates.",context:"info"}):(0,a.jsx)(u.Z,(0,i.Z)((0,r.Z)({},g),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{sm:12,md:6,children:(0,a.jsx)(u.Z,(0,i.Z)((0,r.Z)({},g),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,a.jsx)(m.Z,{sm:12,md:6,children:(0,a.jsx)(u.Z,(0,i.Z)((0,r.Z)({},g),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]})]})};v.propTypes={errors:o.object.isRequired,pricingWatch:o.string,register:o.func.isRequired,hasServiceRate:o.bool,isPPM:o.bool}},64714:function(e,t,n){"use strict";n.d(t,{t:function(){return c}});var r=n(26042),i=n(69396),a=n(85893),o=n(45697),s=n(11585),l=n(66812),u=n(32749),c=function(e){var t=e.control,n=e.errors,o={control:t,errors:n,register:e.register};return(0,a.jsxs)(s.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,a.jsx)(u.l,(0,i.Z)((0,r.Z)({},o),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,a.jsx)(l.P,(0,i.Z)((0,r.Z)({},o),{errors:(0,r.Z)({},n),name:"serviceSelected",label:"Service",type:"service"}))]})};c.propTypes={control:o.object.isRequired,errors:o.object.isRequired,register:o.func.isRequired}},59983:function(e,t,n){"use strict";n.d(t,{X:function(){return C}});var r=n(82670),i=n(26042),a=n(69396),o=n(85893),s=n(67294),l=n(45697),u=n(11585),c=n(49501),d=n(95103),m=n(90951),p=n(9270),v=n(62140),f=n(58594),g=n(21300),Z=n(44634),h=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],y=n(4135),b=n(43703),x=n(11640),j=n(83894),S=n(69119),I=n(67090),w=function(){var e=(0,y.Z)(new Date),t=(0,b.Z)(new Date),n=(0,y.Z)((0,x.Z)(new Date(t),2)),r=(0,j.Z)(new Date),i=(0,S.Z)(new Date),a=(0,I.Z)(new Date);return{monthEnd:e,nextThreeEnd:n,todayEnd:r,todayStart:i,weekEnd:a}},q=Z.KB,C=function(e){var t=e.control,n=e.errors,l=e.hasRole,y=e.query,b=e.register,x=e.setValue,j=e.timingWatch,S=e.watch,I={control:t,errors:n,register:b},C=l("customer")&&!l("admin"),D=S("pricing"),T=S("timingStart"),E=S("timingEnd"),P=S("multipleDays"),R=S("timeSpan"),_=S("timing");(0,s.useEffect)(function(){C&&(q=Z.KB.filter(function(e){return"at"!==e.value}),x("timing","between")),R&&A({time:R,setValue:x})},[R]),(0,s.useEffect)(function(){"at"===_&&x("timeSpan","")},[_]);var A=function(e){var t,n,r=e.time,i=e.setValue,a=w(),o=a.monthEnd,s=a.todayStart,l=a.weekEnd,u=a.todayEnd,c=a.nextThreeEnd;switch(r){case"today":t=s,n=u;break;case"thisWeek":t=s,n=l;break;case"thisMonth":t=s,n=o;break;case"nextThreeMonth":t=s,n=c}i("timing","between"),i("timingStart",t),i("timingEnd",n)},k=function(e){var t=new Date,n=new Date(e);return t.getTime()<n.getTime()},M=function(e){var t=T?new Date(T):new Date,n=new Date(e);return t.getTime()<n.getTime()};return(0,o.jsxs)(u.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null==y?void 0:y.id)&&x&&(0,o.jsx)(c.Z,{label:"Select Time span",children:(0,o.jsx)(d.Z,(0,a.Z)((0,i.Z)({},I),{name:"timeSpan",options:h}))}),(0,o.jsx)(m.Z,(0,a.Z)((0,i.Z)({},I),{data:q,legend:"Timing",name:"timing"})),(0,o.jsxs)(p.Z,{children:[(0,o.jsxs)(v.Z,{md:12,children:[(0,o.jsx)(c.Z,{label:"Start time"}),(0,o.jsx)(g.M,(0,a.Z)((0,i.Z)({},I),{dateFormat:"d MMM yyyy HH:mm",maxDate:E?new Date(E):null,minDate:new Date,filterTime:k,name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==j&&(0,o.jsxs)(v.Z,{md:12,children:[(0,o.jsx)(c.Z,{label:"End time"}),(0,o.jsx)(g.M,(0,a.Z)((0,i.Z)({},I),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:T?new Date(T):new Date,filterTime:M,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),(0,r.Z)(T,Date)&&"fixed"===D&&(0,o.jsx)(f.Z,(0,a.Z)((0,i.Z)({},I),{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),P&&(0,o.jsx)(c.Z,{label:"End Date",children:(0,o.jsx)(g.M,(0,a.Z)((0,i.Z)({},I),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:M,minDate:T?new Date(T):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),l("admin")&&(0,o.jsx)(f.Z,(0,a.Z)((0,i.Z)({},I),{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})};C.propTypes={control:l.object.isRequired,errors:l.object.isRequired,query:l.object.isRequired,register:l.func.isRequired,setValue:l.func,timingWatch:l.string}},25993:function(e,t,n){"use strict";n.d(t,{V:function(){return L}});var r=n(47568),i=n(26042),a=n(69396),o=n(828),s=n(97582),l=n(85893),u=n(67294),c=n(45697),d=n(6388),m=n(50319),p=n(51809),v=n(11163),f=n.n(v),g=n(42283),Z=n(79665),h=n(76600),y=n(15214),b=n(9270),x=n(62140),j=n(49501),S=n(55563),I=n(6710),w=n(95103),q=n(84043),C=n(11057),D=n(69368),T=n(50480),E=n(6054),P=n(66812),R=function(e){var t=e.accountId,n=e.accountName,r=e.canSelectAccount,o=e.control,s=e.errors,c=e.setValue,d=e.watch,m=t?{value:t,label:n}:d("propertyOwner"),p=(0,E.Z)(m),v=function(e){c("contactUser",null)};(0,u.useEffect)(function(){m!==p&&p&&v(m)},[m]);var f={control:o,errors:s};return(0,l.jsxs)(b.Z,{children:[(0,l.jsx)(x.Z,{md:6,children:(0,l.jsx)(P.P,(0,a.Z)((0,i.Z)({},f),{defaultValue:t&&{value:t,label:n},errors:(0,i.Z)({},s),isDisabled:!r,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,l.jsx)(x.Z,{md:6,children:(0,l.jsx)(P.P,(0,a.Z)((0,i.Z)({},f),{accountId:(null==m?void 0:m.value)||null,errors:(0,i.Z)({},s),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};R.propTypes={accountId:c.number,accountName:c.string,canSelectAccount:c.bool.isRequired,control:c.func.isRequired,errors:c.object.isRequired,setValue:c.func.isRequired,watch:c.func.isRequired};var _=n(22595),A=function(e,t){var n=e.propertyOwner,r=e.contactUser;return e.Account_Locations={data:{accountId:n.value}},delete e.propertyOwner,e.contactUserId=(null==r?void 0:r.value)||null,delete e.contactUser,t&&delete e.Account_Locations,e},k=function(e,t,n,r){var i={location:A(e,!0),locationId:t.locationId,accountId:t.accountId,newAccountId:t.newAccountId,hasChanged:t.hasChanged};r({variables:i})},M=n(74231),V=n(46602),O=n(21789),$=n(2845),N=n(64872),F="/dashboard/properties/",L=function(e){var t,n,c,v,E=e.accountId,P=e.accountName,L=e.entity,W=e.data,z=e.refetch,H=e.onAddressCreated,U=e.isPropsComponent,B=e.initialValues,J=e.xeroContactId,Q=e.displayXeroContacts,G=e.xeroContacts,X=e.displaySignin,Y=e.handleXeroAuthorize,K=e.onClose,ee=(0,N.a)(),et=(0,$.x)().hasRole,en=(0,u.useState)(!1),er=en[0],ei=en[1],ea=null==G?void 0:G.find(function(e){return e.value===J}),eo=(0,a.Z)((0,i.Z)({},W?(location.propertyOwner={label:W.customer[0].account.name,value:W.customer[0].account.id},location.contactUser=(null==W?void 0:W.user)&&W.customer[0].account.id&&{label:W.user.fullName,value:W.user.id},location.access=W.access,location.name=W.name,location.status=W.status,location.permitsRequired=W.permitsRequired,location):{},B),{xeroContact:ea})||{},es=(0,g.cI)({defaultValues:eo,resolver:(0,Z.S)((0,M.Ry)().shape({access:(0,M.Z_)().required(),contactUser:(0,M.Ry)().required(),name:(0,M.Z_)().required(),propertyOwner:(0,M.Ry)().required(),status:et("admin")&&(0,M.Z_)().required(),permitsRequired:(0,M.O7)()}))}),el=es.control,eu=es.errors,ec=es.handleSubmit,ed=es.register,em=es.setValue,ep=es.getValues,ev=es.watch,ef=(0,d.aM)(p.yf,{variables:{id:null==W?void 0:W.id},skip:!(null==W?void 0:W.id)}).data,eg=(void 0===ef?{property:{}}:ef).property,eZ=(c=(0,r.Z)(function(e){var t,n,r,a,o,l,u,c,d,m,p;return(0,s.__generator)(this,function(o){switch(o.label){case 0:var s,u;return t=e.addressFormData,n=e.outerFormData,r={Addresses:{data:{Address:{data:(0,i.Z)({},t)},entity:L}}},a=(0,i.Z)({},ep(),r,n),et("customer")&&(a.status="active"),[4,eb({variables:{objects:[A(s=a)]}})];case 1:return p=void 0===(m=(void 0===(c=(void 0===(l=o.sent().data)?{}:l).insert_Location)?{}:c).returning)?{}:m,H&&H(p),ee.close(),[2]}})}),function(e){return c.apply(this,arguments)}),eh=(v=(0,r.Z)(function(e){return(0,s.__generator)(this,function(t){return ee.show({title:"Add new address",content:(0,l.jsx)(V.k,{onCancel:function(){},onSubmit:function(t){eZ({addressFormData:t,outerFormData:e})},type:"text"}),submit:!1}),[2]})}),function(e){return v.apply(this,arguments)}),ey=(0,o.Z)((0,m.D)(p.A1,{onCompleted:function(e){if(!U){var t=e.insert_Location.returning[0].id;ee.close(),z?z():f().push("".concat(F,"view?id=").concat(t))}}}),2),eb=ey[0],ex=ey[1].loading,ej=(0,o.Z)((0,m.D)(p.$A,{onCompleted:function(e){var t=e.update_Location_by_pk.id;ee.close(),z?z():f().push("".concat(F,"view?id=").concat(t))}}),2),eS=ej[0],eI=ej[1].loading,ew=(0,o.Z)((0,m.D)(p.$E),1)[0],eq=function(e){if(ei(!1),W){if("inactive"===e.status&&!(t=eg.jobs).every(function(e){return!!(0,_.E)(e,["completed","closed"])})){ei(!0);return}e.xeroContact&&ew({variables:{id:null===(s=null==W?void 0:W.customer[0])||void 0===s?void 0:s.account.id,changes:{meta:(0,a.Z)((0,i.Z)({},null===(l=null==W?void 0:W.customer[0])||void 0===l?void 0:l.account.meta),{xeroContactId:e.xeroContact.value})}}});var t,n,r,o,s,l,u={locationId:null==W?void 0:W.id,accountId:null===(n=null==W?void 0:W.customer[0])||void 0===n?void 0:n.account.id,newAccountId:null==e?void 0:null===(r=e.propertyOwner)||void 0===r?void 0:r.value,hasChanged:(null===(o=null==W?void 0:W.customer[0])||void 0===o?void 0:o.account.id)!==(null==e?void 0:e.propertyOwner.value)};k((0,a.Z)((0,i.Z)({},e),{xeroContact:void 0}),u,W.id,eS),K()}else eh(e),K()},eC={control:el,errors:eu,register:ed};return(0,l.jsxs)(h.Z,{disabled:ex||eI,id:"offCanvasForm",handleSubmit:ec(eq),children:[er&&(0,l.jsx)(y.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,l.jsx)(b.Z,{children:(0,l.jsx)(x.Z,{md:12,children:(0,l.jsx)(R,(0,a.Z)((0,i.Z)({},eC),{accountId:E,accountName:P,canSelectAccount:!E,setValue:em,watch:ev}))})}),(0,l.jsx)(j.Z,{label:"Name",children:(0,l.jsx)(S.Z,(0,a.Z)((0,i.Z)({},eC),{name:"name"}))}),(0,l.jsx)(j.Z,{label:"Access information",children:(0,l.jsx)(I.Z,(0,a.Z)((0,i.Z)({},eC),{name:"access",rows:4}))}),et("admin")&&(0,l.jsx)(j.Z,{label:"Status",children:(0,l.jsx)(w.Z,(0,a.Z)((0,i.Z)({},eC),{name:"status",options:O.bg}))}),(0,l.jsx)(g.Qr,{name:"permitsRequired",control:el,render:function(e){var t=e.value,n=e.onChange;return(0,l.jsx)(T.Z,{control:(0,l.jsx)(D.Z,{color:"secondary",checked:t||!1,onChange:function(e){return n(e.target.checked)}}),label:"Permits required"})}}),et("admin")&&void 0!==Q&&Q&&(0,l.jsx)(j.Z,{label:"Xero Contact",children:X?(0,l.jsx)(C.Z,{variant:"contained",onClick:function(){Y()},children:"Connect to Xero to select Contact"}):(0,l.jsx)(q.Z,(0,a.Z)((0,i.Z)({options:G},eC),{name:"xeroContact"}))})]})};R.propTypes={accountId:c.number,accountName:c.string,data:c.object,refetch:c.func,offCanvas:c.func}},51809:function(e,t,n){"use strict";n.d(t,{$A:function(){return f},$E:function(){return g},A1:function(){return v},Un:function(){return p},yf:function(){return h},zg:function(){return Z}});var r=n(7297),i=n(75063);function a(){var e=(0,r.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return a=function(){return e},e}function o(){var e=(0,r.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return o=function(){return e},e}function s(){var e=(0,r.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return s=function(){return e},e}function l(){var e=(0,r.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,r.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,r.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,r.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=(0,r.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return m=function(){return e},e}(0,i.Ps)(a());var p=(0,i.Ps)(o()),v=(0,i.Ps)(s()),f=(0,i.Ps)(l()),g=(0,i.Ps)(u()),Z=(0,i.Ps)(c());(0,i.Ps)(d());var h=(0,i.Ps)(m())},35418:function(e,t,n){"use strict";n.d(t,{G:function(){return _}});var r=n(26042),i=n(69396),a=n(7297),o=n(85893),s=n(67294),l=n(45697),u=n(6388),c=n(52824),d=n(10367),m=n(78289),p=n(41564),v=n(34953),f=n(62466),g=n(68956),Z=n(73373),h=n(11585),y=n(28733),b=n(55377),x=n(16551),j=n(77439),S=n(74297),I=n(23892),w=n(39087),q=n(76256),C=n(75795),D=n(91272),T=n(20705),E=n(2845);function P(){var e=(0,a.Z)(["\n  width: 24px;\n"]);return P=function(){return e},e}function R(){var e=(0,a.Z)(["\n  border: 1px solid #eee;\n"]);return R=function(){return e},e}var _=function(e){var t=e.carousel,n=e.category,a=e.children,l=e.data,d=(e.details,e.entity),P=e.entityId,R=e.filters,_=(e.limit,e.listView),M=e.mediaMeta,V=e.onMediaAdd,O=e.onMediaRemove,$=(e.pagination,e.showActionButtons),N=e.showEntityColumn,F=e.showItemActions,L=e.summary,W=e.type,z=(0,T.x)({filters:R}),H=z.initialData,U=z.ref,B=(0,E.x)(),J=B.hasRole,Q=B.user,G=(0,s.useContext)(m.Z),X=(0,u.aM)(c.t,{variables:(0,i.Z)((0,r.Z)({},H),{entity:d,entityId:P,category:n,adminId:Q.adminId,meta:M})}),Y=X.data,K=void 0===Y?{items:[],meta:{aggregate:{totalCount:0}}}:Y,ee=K.items,et=K.meta,en=X.loading,er=X.refetch,ei=function(e){G.close(),l.length||er(),V&&V(e)},ea=function(e){G.close(),l.length||er(),O&&O(e)},eo=function(e){e.stopPropagation(),G.show({content:(0,o.jsx)(q.z,{accept:"image/*",adminId:Q.adminId,category:n,entity:d,entityId:P,expiryShow:!1,mediaMeta:M,multiple:!0,onSuccess:ei,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),G.show({content:(0,o.jsx)(q.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:Q.adminId,category:n,entity:d,entityId:P,expiryShow:!1,mediaMeta:M,onSuccess:ei,type:"document"}),title:"Upload Documents"})},el=function(e){G.show({content:(0,o.jsx)(I.d,{mediaId:e.data.id,onSuccess:ea}),submit:!1,title:"Delete Media"})},eu=function(e){G.show({content:(0,o.jsx)(w.z,{media:e.data,toggleShow:G.close}),submit:!1,title:"Media Details",width:"50%"})},ec=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,t){return eu(t)},tooltip:"Details"}];J("admin")&&ec.push({context:"danger",icon:["fas","trash"],onClick:function(e,t){return el(t)},tooltip:"Delete"});var ed=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!N,text:"Entity"},{formatter:function(e){var t,n=e.row;return(0,o.jsx)(A,{children:(null==n?void 0:null===(t=n.authority)||void 0===t?void 0:t.adminOnly)&&(0,o.jsx)(p.Z,{content:"Admin user only",children:(0,o.jsx)(v.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,f.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!_,text:"Thumbnails"},{hidden:!F,formatter:g.Z,formatterData:ec,text:"Actions"}],em=function(e,t){e.preventDefault(),window.open("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(t))},ep=[],ev=ee.map(function(e){var t=e.entity,n=e.entityId,r=e.id,i=e.item,a=i.caption,s=i.filename,l=i.meta,u=i.name,c=i.type,d=i.user;return{data:i,id:r,userId:null==d?void 0:d.id,file:function(){return(0,o.jsx)(Z.Z,{onClick:function(e){return em(e,s)},children:a||u||s})},entity:t&&"".concat(t,"#").concat(n),authority:l,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:(0,C.S)(c,l),actions:""}}),ef=(ee.forEach(function(e){var t=e.item,n=t.caption,r=t.filename;"image"===t.type&&ep.push({caption:n,filename:r})}),ep),eg=ef.length;return(0,o.jsxs)(h.Z,{fitParentHeight:!0,open:!0,title:L,children:[a,t&&eg>0&&(0,o.jsx)(k,{children:(0,o.jsx)(y.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:ef.map(function(e){var t=e.caption,n=e.filename;return{node:(0,o.jsx)(v.Z,{alt:t,src:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n)}),text:" "}})})}),(0,o.jsx)(D.t,{columns:ed,loading:en,fullHeight:!0,paginationSize:!1,meta:et,ref:U,refetch:er,rows:ev}),$&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(b.Z,{size:"sm"}),(0,o.jsxs)(x.Z,{align:"flex-end",children:[(!W||"document"===W)&&!J("supplier")&&(0,o.jsx)(j.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!W||"image"===W||"avatar"===W)&&!J("supplier")&&(0,o.jsx)(j.Z,{content:"Add ".concat((0,S.Z)(W||"Image")),context:"secondary",onClick:eo,size:"sm"})]})]})]})},A=d.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-9d92024f-0"})(P()),k=d.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-9d92024f-1"})(R());_.propTypes={carousel:l.bool,category:l.string,children:l.node,data:l.array,details:l.bool,entity:l.string,entityId:l.number,filters:l.object,limit:l.number,listView:l.bool,mediaMeta:l.object,onMediaAdd:l.func,onMediaRemove:l.func,pagination:l.object,showActionButtons:l.bool,showEntityColumn:l.bool,showItemActions:l.bool,summary:l.string,type:l.string},_.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},91272:function(e,t,n){"use strict";n.d(t,{t:function(){return u}});var r=n(85893),i=n(67294),a=n(45697),o=n(11163),s=n(46003),l=n(8500),u=(0,i.forwardRef)(function(e,t){var n=e.columns,a=e.history,u=e.initialSort,c=e.loading,d=e.meta,m=e.paginationSize,p=e.refetch,v=e.submissionsRefetch,f=e.rowClick,g=e.rows,Z=e.xeroPageSize,h=(0,o.useRouter)(),y=h.query,b=void 0===y?{}:y,x=(0,i.useState)(parseInt(null==b?void 0:b.page,10)||1),j=x[0],S=x[1],I=(0,i.useState)(Z||s.C1.paginationSize),w=I[0],q=I[1];u||(u={item:"createdAt",order:"desc"});var C=(0,i.useState)({item:u.item,order:u.order}),D=C[0],T=C[1],E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=h.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},P=function(){T({item:u.item,order:u.order}),S(1);var e=E();h.push(e),q(Z||s.C1.paginationSize)};(0,i.useImperativeHandle)(t,function(){return{currentPage:j,pageSize:w,sort:D,resetPagination:function(){P()}}});var R=function(e){var t=E(e);a&&h.push(t),S(e),!a&&p&&p()&&v&&v()},_=function(e){e!==s.C1.paginationSize&&(q(e),p&&p()&&v&&v())},A=function(e){var t;T({item:e.item,order:e.order}),p&&p()&&v&&v()};return(0,r.jsx)(l.Z,{columns:n,loading:c,paginationSize:m,pagination:d&&!0,paginationProps:d&&{currentPage:j,onPageChange:R,onPageSizeChange:_,pageCount:Math.ceil(d.aggregate.totalCount/w),perPage:w},rowClick:f,rows:g,sort:D,setSort:A})});u.propTypes={columns:a.array.isRequired,history:a.bool,initialSort:a.object,loading:a.bool,meta:a.object,refetch:a.func,submissionsRefetch:a.func,rowClick:a.func,rows:a.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},28864:function(e,t,n){"use strict";n.d(t,{T:function(){return h}});var r=n(85893),i=n(45697),a=n.n(i),o=n(93946),s=n(97212),l=n(98619),u=n(59334),c=n(51233),d=n(50135),m=n(50594),p=n(40055),v=n(5336),f=n(10166),g=n(67294),Z=n(42283),h=function(e){var t=e.tagEntityId,n=e.tagId,i=e.name,a=e.color,u=e.editable,f=e.onDelete,h=e.onColorChange,b=e.onNameChange,x=(0,Z.cI)({defaultValues:{name:i,color:a}}),j=x.register,S=x.handleSubmit,I=(0,g.useState)(null),w=I[0],q=I[1],C=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),f(t)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),q("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),q("changeColor")},tooltip:"Change color"}]},D=function(e){e.stopPropagation(),q(null)},T=function(e){h({tagId:n,color:e.color}),q(null)},E=function(e){b({tagId:n,name:e.name}),q(null)};return(0,r.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!u||!w&&(0,r.jsx)(v.C,{icon:"defaultHoriz",actionsData:C}),children:w?({changeColor:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)("input",{name:"color",ref:j,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(o.Z,{size:"small",color:"danger",onClick:D,children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(o.Z,{size:"small",color:"success",onClick:S(T),children:(0,r.jsx)(p.Z,{})})]})]})},rename:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)(d.Z,{name:"name",inputRef:j,variant:"standard",color:"secondary"}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(o.Z,{size:"small",color:"danger",onClick:D,children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(o.Z,{size:"small",color:"success",onClick:S(E),children:(0,r.jsx)(p.Z,{})})]})]})}})[w]():(0,r.jsx)(l.Z,{children:(0,r.jsx)(y,{primary:i,color:a})})},n)};h.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},h.propTypes={tagEntityId:a().string.isRequired,tagId:a().string.isRequired,name:a().string.isRequired,color:a().string.isRequired,editable:a().bool,onDelete:a().func.isRequired,onColorChange:a().func.isRequired,onNameChange:a().func.isRequired};var y=(0,f.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},11975:function(e,t,n){"use strict";n.d(t,{P:function(){return p}});var r=n(85893),i=n(67294),a=n(45697),o=n.n(a),s=n(15861),l=n(14564),u=n(78462),c=n(51233),d=n(22186),m=n(28864),p=function(e){var t=e.tags,n=(e.title,e.handleDeleteTagEntity),a=(0,i.useState)(null),o=a[0],p=a[1],v=null==t?void 0:t.slice(0,5),f=(null==t?void 0:t.length)-(null==v?void 0:v.length),g=Boolean(o);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{direction:"row",spacing:1,children:v.map(function(e,t){var i;return(0,r.jsx)(d.V,{tagEntityId:e.id||t,name:e.tag.name,color:null===(i=e.tag.meta)||void 0===i?void 0:i.color,onDelete:n})})}),f>0&&(0,r.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){p(e.currentTarget),e.stopPropagation()},children:["+",f]}),(0,r.jsx)(l.ZP,{id:g?"tags-in-table-popover":void 0,open:g,anchorEl:o,onClose:function(){return p(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,r.jsx)(u.Z,{children:null==t?void 0:t.map(function(e){var t;return(0,r.jsx)(m.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,editable:!1},e.tag.id)})})})]})};p.propTypes={tags:o().object,title:o().string},p.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},89256:function(e,t,n){"use strict";n.d(t,{n:function(){return _}});var r=n(47568),i=n(26042),a=n(69396),o=n(828),s=n(29815),l=n(97582),u=n(85893),c=n(45697),d=n.n(c),m=n(96486),p=n(6388),v=n(50319),f=n(11961),g=n(93362),Z=n(23776),h=n(5616),y=n(98456),b=n(93946),x=n(78462),j=n(18972),S=n(14564),I=n(51233),w=n(50135),q=n(67294),C=n(10166),D=n(2845),T=n(28864),E=n(51738),P=n(11975),R=(0,g.D)(),_=function(e){var t=e.entityId,n=e.entity,c=e.values,d=void 0===c?[]:c,g=e.name,S=void 0===g?"tags":g,C=e.setValue,_=(0,D.x)().user,k=(0,q.useState)(null),M=k[0],V=k[1],O=(0,q.useState)(""),$=O[0],N=O[1],F=(0,q.useState)(""),L=F[0],W=F[1],z=(0,q.useState)(""),H=z[0],U=z[1],B=(0,p.aM)(E.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){C(S,e.tags)}}),J=B.data,Q=(void 0===J?{tags:[]}:J).tags,G=B.loading,X=B.refetch,Y=(0,p.aM)(E.gI,{skip:!M,variables:{entityId:t,entity:n,q:""!==H?"%".concat(H,"%"):null}}),K=Y.data,ee=(void 0===K?{tags:[]}:K).tags,et=Y.loading,en=(0,o.Z)((0,v.D)(E.Zm,{refetchQueries:["GetAllTags"]}),2),er=en[0],ei=en[1].loading,ea=(0,o.Z)((0,v.D)(E.LE,{onCompleted:function(){X()}}),2),eo=ea[0],es=ea[1].loading,el=(0,o.Z)((0,v.D)(E.cS,{onCompleted:function(){X()}}),2),eu=el[0],ec=el[1].loading,ed=(0,o.Z)((0,v.D)(E.g$,{refetchQueries:["GetAllTags"]}),2),em=ed[0],ep=ed[1].loading;(0,q.useEffect)(function(){var e=setTimeout(function(){U(L)},500);return function(){return clearTimeout(e)}},[L]);var ev,ef,eg,eZ=function(e){e.stopPropagation(),V(e.currentTarget)},eh=function(){V(null)},ey=(ev=(0,r.Z)(function(e,r){var i,a,o;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof r)return[3,1];return N({label:r}),[3,6];case 1:if(!(r&&r.inputValue&&t))return[3,2];return eo({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:_.adminId}}}]}}),N(null),[3,6];case 2:if(!(r&&r.value&&t))return[3,3];return eo({variables:{objects:[{entity:n,entityId:t,taxonomyId:r.value}]}}),N(null),[3,6];case 3:if(!(r&&r.inputValue))return[3,5];return[4,er({variables:{objects:[{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:_.adminId}]}})];case 4:return o=e.sent().data.insert_Taxonomy,C(S,(0,s.Z)(d).concat([{id:null,tag:{id:o.returning[0].id,name:o.returning[0].name,meta:o.returning[0].meta}}])),N(null),[3,6];case 5:r&&r.value&&(C(S,(0,s.Z)(d).concat([{id:null,tag:{id:r.value,name:r.label,meta:r.meta}}])),N(null)),e.label=6;case 6:return[2]}})}),function(e,t){return ev.apply(this,arguments)}),eb=(0,q.useCallback)(function(e,t){var n=R(e,t),r=t.inputValue,i=e.some(function(e){return r===e.label});return""===r||i||n.push({inputValue:r,label:'Add "'.concat(r,'"')}),n},[]),ex=(0,q.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ej=function(e){t?eu({variables:{tagEntityId:e}}):C(S,d.filter(function(t,n){return n!==e}))},eS=(ef=(0,r.Z)(function(e){var t,n,r,o,s,u;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,em({variables:{tagId:t=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=n.sent().data.update_Taxonomy_by_pk,C(S,d.map(function(e){return e.tag.id===t?(0,a.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return ef.apply(this,arguments)}),eI=(eg=(0,r.Z)(function(e){var t,n,r,o,s,u;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return[4,em({variables:{tagId:t=e.tagId,object:{name:n=e.name}}})];case 1:return s=r.sent().data.update_Taxonomy_by_pk,C(n,d.map(function(e){return e.tag.id===t?(0,a.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return eg.apply(this,arguments)}),ew=Boolean(M),eq=(0,q.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eC=(0,q.useMemo)(function(){return m.uniqBy((0,s.Z)(Q).concat((0,s.Z)(d)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[Q,d]);return(0,u.jsxs)(I.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(P.P,{tags:eC,handleDeleteTagEntity:ej}),(0,u.jsx)(A,{id:ew?"tags-popover":void 0,open:ew,anchorEl:M,onClose:eh,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(h.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(Z.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eq),value:$,onChange:ey,onInputChange:function(e,t){W(t)},filterOptions:eb,getOptionLabel:ex,renderOption:function(e,t){return(0,u.jsx)(j.Z,(0,a.Z)((0,i.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,u.jsx)(w.Z,(0,a.Z)((0,i.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,a.Z)((0,i.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[et||ei||es?(0,u.jsx)(y.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),G||ec||ep?(0,u.jsx)(I.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(y.Z,{color:"secondary"})}):(0,u.jsx)(x.Z,{children:null==eC?void 0:eC.map(function(e,t){var n;return(0,u.jsx)(T.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:ej,onColorChange:eS,onNameChange:eI})})})]})}),(0,u.jsx)(b.Z,{color:"black",onClick:eZ,children:(0,u.jsx)(f.Z,{sx:{height:"16px",width:"16px"}})})]})};_.defaultProps={entityId:null},_.propTypes={entityId:d().number};var A=(0,C.Z)(S.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},51738:function(e,t,n){"use strict";n.d(t,{Aw:function(){return j},BU:function(){return g},C3:function(){return x},LE:function(){return h},Zm:function(){return f},cS:function(){return y},g$:function(){return b},gI:function(){return v},lx:function(){return Z}});var r=n(7297),i=n(75063);function a(){var e=(0,r.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return a=function(){return e},e}function o(){var e=(0,r.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return o=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,r.Z)(['\n  query GetTagsForSelect($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,r.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}var v=(0,i.Ps)(a()),f=(0,i.Ps)(o()),g=(0,i.Ps)(s()),Z=(0,i.Ps)(l()),h=(0,i.Ps)(u()),y=(0,i.Ps)(c()),b=(0,i.Ps)(d()),x=(0,i.Ps)(m()),j=(0,i.Ps)(p())},14272:function(e,t,n){"use strict";n.d(t,{f:function(){return j}});var r=n(26042),i=n(69396),a=n(85893),o=n(67294),s=n(45697),l=n(58594),u=n(28497),c=n(55563),d=n(90951),m=n(95103),p=n(6710),v=n(78289),f=n(23233),g=n(49501),Z=n(77439),h=n(40826),y=n(21300),b=n(35418),x={checkbox:l.Z,currencyInput:u.Z,datepicker:y.M,input:c.Z,radio:d.Z,select:m.Z,textArea:p.Z,selectRange:m.Z},j=function(e){var t=e.control,n=e.entity,s=e.entityId,l=e.errors,u=e.input,c=e.inputType,d=e.key,m=e.label,p=e.mediaMeta,y=e.name,j=e.options,S=e.register,I=(0,o.useContext)(v.Z),w="select"===u&&j.length>0,q=["checkbox","radio"].includes(u)&&j.length>0,C=(0,i.Z)((0,r.Z)({control:t},q&&{data:j},w&&{options:j.map(function(e){return(0,i.Z)((0,r.Z)({},e),{text:e.label})})},"selectRange"===u&&{range:[10,0]}),{errors:l,key:d,label:f.Z.camelize(m),name:y,register:S,type:q?u:c,minDate:"2020-04-19T08:29:04.839Z"}),D=function(){I.show({content:n&&s&&(0,a.jsx)(b.G,{entity:n,entityId:s,mediaMeta:p,category:"supplierQuestion"}),submit:!1,title:m})},T=x[u];return(0,a.jsx)(a.Fragment,{children:"currencyInput"===u?(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(T,(0,i.Z)((0,r.Z)({},C),{label:""}))}):(0,a.jsx)(a.Fragment,{children:"media"===u?(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(Z.Z,{context:"info",content:(0,a.jsx)(h.Z,{icon:"file-upload"}),onClick:D,size:"sm"})}):(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(T,(0,r.Z)({},C))})})})};j.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},j.defaultProps={input:"input",options:[],inputType:"text",label:"label"}},87556:function(e,t,n){"use strict";n.d(t,{D:function(){return y}});var r=n(26042),i=n(69396),a=n(85893),o=n(67294),s=n(45697),l=n(42283),u=n(79665),c=n(76600),d=n(9270),m=n(62140),p=n(16551),v=n(77439),f=n(14272),g=n(74231),Z=function(e,t){var n=t.object,i=t.string,a={};return null==e||e.forEach(function(e){var t;(null===(t=e.meta)||void 0===t?void 0:t.required)&&(a[e.name]=i().required())}),n().shape((0,r.Z)({},a))},h=function(e){var t=e.map(function(e){return(0,i.Z)((0,r.Z)({},e),{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),n=(0,g.Ry)().shape({}),a=Z(t,{object:g.Ry,string:g.Z_});return n.concat(a)},y=function(e){var t,n=e.entity,s=e.entityId,g=e.onSuccess,Z=e.questions,y=e.hasChangeStatus,b=(0,l.cI)({defaultValues:(t={},Z.forEach(function(e){var n=e.comments,r=e.taxonomyId,i=e.name;t["".concat(i,"/id=").concat(r)]=n}),t),resolver:(0,u.S)(h(Z))}),x=b.control,j=b.errors,S=b.handleSubmit,I={control:x,errors:j,register:b.register},w=function(e,t){var r=Object.keys(e).map(function(t){return{taxonomyId:parseInt(t.split("/id=")[1]),name:t.split("/id=")[0],comments:String(e[t]),entity:n,entityId:s}});g&&g(r,t)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{id:y?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:S(function(e){return w(e,"supplierQuestionsSubmitted")}),children:(0,a.jsxs)(d.Z,{children:[Z.map(function(e){var t,l,u,c;return(0,a.jsx)(m.Z,{md:12,children:(0,o.createElement)(f.f,(0,i.Z)((0,r.Z)({},I),{input:null===(t=e.meta)||void 0===t?void 0:t.input,inputType:null===(l=e.meta)||void 0===l?void 0:l.inputType,key:e.taxonomyId,label:null===(u=e.meta)||void 0===u?void 0:u.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(c=e.meta)||void 0===c?void 0:c.options,entity:n,entityId:s,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),y&&(0,a.jsx)(m.Z,{md:12,children:(0,a.jsxs)(p.Z,{align:"flex-end",children:[(0,a.jsx)(v.Z,{content:"Save",context:"success",onClick:S(function(e){return w(e,"supplierQuestionsDraft")}),size:"sm"}),(0,a.jsx)(v.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};y.propTypes={entity:s.string.isRequired,entityId:s.number,onSuccess:s.func,hasChangeStatus:s.bool,questions:s.array.isRequired},y.defaultProps={hasChangeStatus:!1}},73760:function(e,t,n){"use strict";n.d(t,{O:function(){return r},v:function(){return i}});var r=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],i=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},44634:function(e,t,n){"use strict";n.d(t,{Hu:function(){return r},KB:function(){return i},M2:function(){return a}});var r=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],i=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],a=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]},96216:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});var r=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},21789:function(e,t,n){"use strict";n.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},65647:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eH}});var r=n(26042),i=n(85893),a=n(11163),o=n.n(a),s=n(19076),l=n(47568),u=n(69396),c=n(828),d=n(97582),m=n(67294),p=n(66252),v=n(50319),f=n(73359),g=n(913),Z=n(38216),h=n(24043),y=n(22595),b=n(45697),x=n.n(b),j=n(42283),S=n(79665),I=n(6054),w=n(76600),q=n(9270),C=n(62140),D=n(77439),T=n(6388),E=n(85488),P=n(83863),R=n(54559),_=n(78289),A=n(26186),k=n(11585),M=n(91272),V=n(22713),O=n(20705),$=n(18586),N=(0,P.Z)((0,R.Z)(new Date,12)),F=(0,m.memo)(function(e){var t,n,a=e.jobId,o=e.locationId,s=e.serviceId,l=(0,O.x)({filters:{}}),c=l.initialData,d=l.ref,p=(0,m.useContext)(_.Z),v=(0,$.q)(),f=null===(t=v.admin.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,g=null===(n=v.admin.jobSetting)||void 0===n?void 0:n.jobNumberSuffix,Z=(0,T.aM)(E.sW,{variables:(0,u.Z)((0,r.Z)({jobId:a,locationId:o},c),{serviceId:s,startDate:N})}),h=Z.data,y=void 0===h?{jobs:[],meta:{aggregate:{totalCount:0}}}:h,b=y.jobs,x=y.meta,j=Z.loading,S=Z.refetch,I=function(e){p.show({content:(0,i.jsx)(V.g,{jobId:e.id,toggleShow:p.close,numberPrefix:f,numberSuffix:g}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,i.jsx)(k.Z,{title:"Job History",children:(0,i.jsx)(M.t,{columns:[{hidden:!0,text:"Id"},{text:"Title"},{text:"Service"},{text:"Date"}],history:!1,loading:j,meta:x,ref:d,refetch:S,rowClick:I,rows:b.map(function(e){var t;return{id:e.id,title:e.title,service:null===(t=e.service)||void 0===t?void 0:t.name,createdDate:(0,A.Z)(e.createdAt)}})})})},function(e,t){var n=!0;return(t.locationId!==e.locationId||t.serviceId!==e.serviceId)&&(n=!1),n});F.propTypes={jobId:b.number,locationId:b.number.isRequired,serviceId:b.number};var L=n(29815),W=n(49501),z=n(95103),H=n(66812),U=n(96216),B=n(92148),J=(0,m.memo)(function(e){var t=e.control,n=e.customerSelectedWatch,a=e.errors,o=e.hasRole,s={control:t,errors:a,register:e.register};return(0,i.jsxs)(k.Z,{dataSet:{"data-cy":"customer"},open:!0,title:"Customer",children:[(0,i.jsx)(H.P,(0,u.Z)((0,r.Z)({},s),{errors:(0,r.Z)({},a),label:"Customer",name:"customerSelected",type:"customer"})),n&&(0,i.jsx)(H.P,(0,u.Z)((0,r.Z)({},s),{isDisabled:!o((0,L.Z)(B.td).concat((0,L.Z)(B.Sf),(0,L.Z)(B.n))),accountId:(null==n?void 0:n.value)||null,errors:(0,r.Z)({},a),label:"Contact User",name:"customerUserSelected",type:"user"})),o("admin")&&(0,i.jsx)(W.Z,{label:"Source",children:(0,i.jsx)(z.Z,(0,u.Z)((0,r.Z)({},s),{name:"source",options:U.Y}))})]})},function(e,t){var n,r;return e.customerSelectedWatch===t.customerSelectedWatch&&!(null===(n=t.errors.customerSelected)||void 0===n?void 0:n.message)&&!(null===(r=t.errors.customerUserSelected)||void 0===r?void 0:r.message)});J.propTypes={control:b.object.isRequired,customerSelectedWatch:b.object,errors:b.object.isRequired,register:b.func.isRequired};var Q=n(6710),G=n(90951),X=n(15214),Y=n(55563),K=n(32749),ee=n(87556),et=n(43006),en=n(2845),er=n(89256),ei=n(28591),ea=function(e){var t,n=e.control,a=e.currentAnswers,o=e.errors,s=e.getValues,l=e.isQuote,c=e.isPPM,d=e.jobId,p=e.isSubmit,v=(e.locationSelectedWatch,e.prevTaxonomy),f=e.register,g=e.taxonomyWatch,Z=e.watch,h=e.dataSlas,y=e.tagsWatch,b=e.setValue,x=(0,en.x)().hasRole,j=(0,m.useContext)(_.Z),S=(0,m.useState)(a),I=S[0],w=S[1],D=Z("slaId"),T=s("taxonomyId_ShortDesc");(0,m.useEffect)(function(){g!==v&&g&&M(null==g?void 0:g.childs)},[g]);var E=(0,et.GU)(l?"quote":"reactive",h),P=null===(t=null==E?void 0:E.find(function(e){return e.id===Number(D)}))||void 0===t?void 0:t.notes,R={errors:o,register:f,control:n},A=function(e){w(e),j.close()},M=function(e){e&&e.length>0?j.show({content:(0,i.jsx)(ee.D,{onSuccess:A,entity:"Job",entityId:d,questions:e}),title:"Please answer the following questions"}):w([])};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(k.Z,{dataSet:{"data-cy":"details"},open:!0,title:"Description",children:[(0,i.jsx)(K.l,(0,u.Z)((0,r.Z)({},R),{label:l?"Quote Headline":"Short job description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,i.jsx)(ei.i,{isSubmit:p,control:n,errors:o,register:f,setValue:b,entity:c?"Ppm":"Job",entityId:d,hasPreview:!0,linkedTo:{entity:"Taxonomy",entityId:null==T?void 0:T.value}}),(0,i.jsx)(W.Z,{label:"Work Description",children:(0,i.jsx)(Q.Z,(0,u.Z)((0,r.Z)({},R),{name:"description",rows:3}))}),!c&&(0,i.jsx)(G.Z,(0,u.Z)((0,r.Z)({},R),{data:E,legend:"Priority",name:"slaId"})),D&&(0,i.jsx)(X.Z,{content:P||"-",context:"light"}),!l&&(0,i.jsxs)(q.Z,{children:[(0,i.jsx)(C.Z,{md:6,children:(0,i.jsx)(W.Z,{label:"Estimated duration",children:(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,i.jsx)(C.Z,{md:6,children:(0,i.jsx)(W.Z,{label:"Unit",children:(0,i.jsx)(z.Z,(0,u.Z)((0,r.Z)({},R),{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,i.jsx)(W.Z,{label:"".concat(x("customer")?"Your reference":"Customer reference"),children:(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"reference"}))}),x("admin")&&(0,i.jsx)(er.n,{entityId:d,values:y,setValue:b,entity:"Job"}),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"questions",type:"hidden",defaultValue:JSON.stringify(I)})),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"reportPassFail",type:"hidden"})),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"reportPassFailTitle",type:"hidden"})),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"requireReportRecommendations",type:"hidden"})),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"customerSignature",type:"hidden"})),(0,i.jsx)(Y.Z,(0,u.Z)((0,r.Z)({},R),{name:"supplierSignature",type:"hidden"}))]})})};ea.propTypes={control:b.object.isRequired,currentAnswers:b.array.isRequired,errors:b.object.isRequired,isQuote:b.bool,isPPM:b.bool,jobId:b.number,locationSelectedWatch:b.object,prevTaxonomy:b.string,register:b.func.isRequired,taxonomyWatch:b.object.isRequired,watch:b.func.isRequired,slaData:b.array},ea.defaultProps={isQuote:!1};var eo=n(7297),es=n(25993),el=n(4972),eu=n(10367);function ec(){var e=(0,eo.Z)(["\n  && > div:first-of-type {\n    ","\n  }\n  && {\n    margin-bottom: 1rem;\n  }\n"]);return ec=function(){return e},e}var ed=["manager","owner"],em=function(e){var t,n,a=e.assetCategoryWatch,o=e.control,s=e.customerSelectedWatch,l=e.customerUserSelectedWatch,d=e.errors,m=e.locationSelectedWatch,p=e.register,v=e.setValue,f=(0,$.q)(),g=null==f?void 0:null===(t=f.admin)||void 0===t?void 0:null===(n=t.modules)||void 0===n?void 0:n.assets,Z=(0,T.aM)(el.kB,{variables:{accountId:null==s?void 0:s.value,userId:null==l?void 0:l.value}}).data,h=(void 0===Z?{accountUsers:[]}:Z).accountUsers,y=function(e){var t=(0,c.Z)(e,1)[0];v("locationSelected",{value:t.id,label:t.name})},b={isClearable:!1,control:o,errors:d,register:p};return(0,i.jsxs)(k.Z,{dataSet:{"data-cy":"location"},open:!0,title:"Location",children:[(0,i.jsx)(H.P,(0,u.Z)((0,r.Z)({},b),{accountId:null==s?void 0:s.value,errors:(0,r.Z)({},d),name:"locationSelected",label:"Property",type:"property",customerRole:h.some(function(e){return ed.includes(e.role)})?null:"user",customerId:null==l?void 0:l.value,AddForm:function(){return(0,i.jsx)(es.V,{initialValues:{propertyOwner:(0,r.Z)({},s)},isPropsComponent:!0,entity:"Location",onAddressCreated:y})}})),m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H.P,(0,u.Z)((0,r.Z)({},b),{isClearable:!0,label:"Sublocation",locationId:m.value,name:"sublocationSelected",type:"sublocation"})),(0,i.jsx)(W.Z,{label:"Access information",children:(0,i.jsx)(Q.Z,(0,u.Z)((0,r.Z)({},b),{name:"access",rows:2}))}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H.P,(0,u.Z)((0,r.Z)({},b),{isClearable:!0,label:"Asset Category",locationId:m.value,id:null==a?void 0:a.value,name:"assetCategorySelected",type:"assetCategory"})),(0,i.jsx)(ep,(0,u.Z)((0,r.Z)({},b),{isClearable:!0,isDisabled:!a,label:"Assets",locationId:m.value,assetCategoryId:(null==a?void 0:a.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]})]})]})};em.propTypes={control:b.object.isRequired,customerSelectedWatch:b.object,errors:b.object.isRequired,locationSelectedWatch:b.object,register:b.func.isRequired};var ep=(0,eu.ZP)(H.P).withConfig({displayName:"location__StyledSelect",componentId:"sc-71770ac9-0"})(ec(),function(e){return e.isDisabled?"background-color: #cecece !important;":""}),ev=(0,m.memo)(function(e){var t=e.control,n=e.errors,a=e.user;return(0,i.jsx)(k.Z,{dataSet:{"data-cy":"manager"},open:!0,title:"Admin User",children:(0,i.jsx)(H.P,{control:t,accountId:a.accountId,errors:(0,r.Z)({},n),isClearable:!1,label:"Assigned to",name:"managerSelected",type:"user"})})},function(e,t){return!0});ev.propTypes={control:b.object.isRequired,errors:b.object.isRequired,user:b.object.isRequired};var ef=n(58594),eg=["1w","1m","3m","6m","12m"].map(function(e){return{id:e,label:e,value:e}}),eZ=[1,2,3,4].map(function(e){return{id:"week"+e,label:e,value:"week"+e}}),eh=function(e){var t,n=e.control,a={control:n,errors:e.errors,register:(e.locationId,e.register)};return(0,i.jsxs)(k.Z,{dataSet:{"data-cy":"ppm"},open:!0,title:"PPM",children:[(0,i.jsx)(ef.Z,(0,u.Z)((0,r.Z)({},a),{data:eg,legend:"Frequency",name:"frequency",stacked:!1})),(0,i.jsx)(W.Z,{label:"Frequency Description",children:(0,i.jsx)(Q.Z,(0,u.Z)((0,r.Z)({},a),{name:"frequencyDesc",rows:2}))}),(0,i.jsx)(ef.Z,(0,u.Z)((0,r.Z)({},a),{data:eZ,legend:"Week",name:"week",stacked:!1}))]})};eh.propTypes={control:b.object.isRequired,errors:b.object.isRequired,locationId:b.number,register:b.func.isRequired};var ey=n(61816),eb=n(21300),ex=n(46901),ej=n(30381),eS=n.n(ej),eI=function(e){var t=e.control,n=e.errors,a=e.register,o=e.siteVisitWatch,s=e.watch,l=e.quoteReturnedTimingEndSupplier,c=e.quoteReturnedTimingEndCustomer,d={control:t,errors:n,register:a},p=s("siteVisitStart"),v=s("siteVisitEnd"),f=s("siteVisitWeekends"),g=s("quoteDue"),Z=s("quoteDueSupplier"),h=function(e){var t=new Date,n=new Date(e);return n.getHours()>=8&&17>n.getHours()&&t.getTime()<n.getTime()},y=function(e){var t=p?new Date(p):new Date,n=new Date(e);return n.getHours()>=8&&17>n.getHours()&&t.getTime()<n.getTime()},b=function(e){var t=e.getDay();return 0!==t&&6!==t},x=(0,m.useMemo)(function(){return eS()(g).isAfter(c,"day")||eS()(Z).isAfter(l,"day")},[g,Z,c,l]);return(0,i.jsxs)(k.Z,{dataSet:{"data-cy":"quote"},open:!0,title:"Quote information",children:[(0,i.jsx)(W.Z,{label:"Number of Quotes",children:(0,i.jsx)(z.Z,(0,u.Z)((0,r.Z)({},d),{name:"quoteNumber",placeholder:"Select number of quotes",range:[4,1]}))}),x&&(0,i.jsx)(ex.Z,{color:"info",variant:"filled",sx:{mb:1},children:"Please note, the selected quote return date is later than that required by the relevant SLA. This will trigger a SLA breach."}),(0,i.jsx)(W.Z,{label:"Quote due by Customer",children:(0,i.jsx)(eb.M,(0,u.Z)((0,r.Z)({},d),{name:"quoteDue",placeholder:"Click to select Quote Due Date"}))}),(0,i.jsx)(W.Z,{label:"Quote due from Supplier",children:(0,i.jsx)(eb.M,(0,u.Z)((0,r.Z)({},d),{name:"quoteDueSupplier",placeholder:"Click to select Quote Due Date"}))}),(0,i.jsx)(ef.Z,(0,u.Z)((0,r.Z)({},d),{data:[{id:"siteVisitReq",label:"Site visit required",value:!0}],name:"siteVisitReq"})),o&&(0,i.jsxs)(q.Z,{children:[(0,i.jsx)(C.Z,{md:12,children:(0,i.jsx)(ef.Z,(0,u.Z)((0,r.Z)({},d),{data:[{id:"siteVisitWeekends",label:"Include Weekends",value:!0}],name:"siteVisitWeekends"}))}),(0,i.jsxs)(C.Z,{md:12,children:[(0,i.jsx)(W.Z,{label:"Start time"}),(0,i.jsx)(eb.M,(0,u.Z)((0,r.Z)({},d),{dateFormat:"d MMM yyyy HH:mm",minDate:new Date,maxDate:v?new Date(v):null,filterTime:h,filterDate:!f&&b,name:"siteVisitStart",showTimeSelect:!0,todayButton:!1}))]}),p&&(0,i.jsxs)(C.Z,{md:12,children:[(0,i.jsx)(W.Z,{label:"End time"}),(0,i.jsx)(eb.M,(0,u.Z)((0,r.Z)({},d),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:p?new Date(p):new Date,filterTime:y,filterDate:!f&&b,name:"siteVisitEnd",showTimeSelect:!0,todayButton:!1}))]})]})]})};eI.propTypes={control:b.object.isRequired,errors:b.object.isRequired,register:b.func.isRequired};var ew=n(74231);(0,ew.Ry)().shape({title:(0,ew.Z_)().required(),description:(0,ew.Z_)().required(),access:(0,ew.Z_)(),serviceSelected:(0,ew.Ry)().required(),timingEnd:(0,ew.hT)().required(),timingStart:(0,ew.hT)().required()});var eq=n(64714),eC=n(59983),eD=n(50135),eT=n(51233),eE=n(48580),eP=function(e){var t=e.register,n=e.control,r=(0,c.Z)((0,f.t)(g.dL),2),a=r[0],o=r[1],s=o.loading,l=o.data,u=(void 0===l?{issueTypes:[]}:l).issueTypes;return(0,i.jsx)(k.Z,{title:"Issue reported",open:!0,children:(0,i.jsxs)(eT.Z,{spacing:3,children:[(0,i.jsx)(j.Qr,{name:"issueType",control:n,render:function(e){var t=e.value,n=e.onChange;return(0,i.jsx)(eE.q,{value:t,disableClearable:!0,loading:s,onOpen:a,textFieldProps:{color:"secondary",variant:"standard",label:"Select issue type"},sx:{width:"200px"},onChange:function(e,t){return n(t)},options:u})}}),(0,i.jsx)(eD.Z,{multiline:!0,name:"issueReportedDescription",inputRef:t})]})})},eR=n(52971),e_=n(13262),eA=function(e){var t=e.setValue,n=e.permitsLinks,r=e.attachmentsPermits,a=e.showWarning,o=e.onDeleteExistingMedia;return(0,i.jsxs)(eT.Z,{sx:ek.container,children:[a&&(0,i.jsx)(ex.Z,{variant:"filled",severity:"error",children:"Warning: This site requires a permit for attendance"}),(0,i.jsx)(eR.V,{name:"permitsLinks",setValue:t,values:n,title:"Permits links"}),(0,i.jsx)(e_.f,{setValue:t,values:r,onDeleteExistingMedia:o,name:"permitsAttachments",title:"Permits attachments"})]})};eA.propTypes={setValue:x().func,permitsLinks:x().array,attachmentsPermits:x().array,showWarning:x().bool},eA.defaultProps={showWarning:!0};var ek={container:{width:"100%"}},eM=n(53485),eV=function(e){var t,n,a,o=e.defaultValues,s=e.preloadedMedia,l=e.deleteMediaByEntity,c=e.job,d=e.onSubmit,p=e.query;e.delayEntityId;var v=(0,en.x)(),f=v.hasRole,Z=v.user,h=(0,j.cI)({defaultValues:o,resolver:(0,S.S)((t=p,n=f,a=o.type,(0,ew.Ry)().shape({managerSelected:n("admin")&&(0,ew.Ry)().required(),customerSelected:(0,ew.Ry)().nullable().required(),customerUserSelected:(0,ew.Ry)().required(),source:n("admin")&&(0,ew.Z_)().oneOf(["call","email","portal","other"]).required(),slaId:"ppm"!==a&&(0,ew.Rx)().required(),description:(0,ew.Z_)().required(),taxonomyId_ShortDesc:(0,ew.Ry)().required(),reference:(0,ew.Z_)(),locationSelected:(0,ew.Ry)().required(),access:(0,ew.Z_)().required(),pricing:!t.quoted&&(0,ew.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:!t.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),amount:!t.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierLabourAmount:!t.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMaterialsAmount:!t.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),quoteNumber:t.quoted&&(0,ew.Z_)().required(),quoteDue:t.quoted&&(0,ew.hT)().required(),quoteDueSupplier:t.quoted&&(0,ew.hT)().required(),siteVisitStart:t.quoted&&(0,ew.hT)().when("siteVisitReq",{is:"true",then:(0,ew.hT)().required()}),siteVisitEnd:t.quoted&&(0,ew.hT)().when("siteVisitReq",{is:"true",then:(0,ew.hT)().required()}),siteVisitWeekends:t.quoted&&(0,ew.Z_)(),costCategorySelected:n(["admin","customer"])&&!t.quoted&&(0,ew.Ry)().required(),serviceSelected:n(["admin","customer"])&&!t.quoted&&(0,ew.Ry)().required(),timing:!t.quoted&&(0,ew.Z_)().required().oneOf(["at","between"]),timingStart:!t.quoted&&(0,ew.hT)().required(),timingEnd:!t.quoted&&(0,ew.hT)().when("timing",{is:"between",then:(0,ew.hT)().required()}),allowTimingNormalHours:!t.quoted&&(0,ew.Z_)(),reportPassFail:(0,ew.Xg)(),reportPassFailTitle:(0,ew.Z_)().nullable(),customerSignature:(0,ew.Xg)(),supplierSignature:(0,ew.Xg)(),requireReportRecommendations:(0,ew.Xg)(),estimatedDuration:(0,ew.Rx)().min(0),estimatedDurationUnit:(0,ew.Z_)()})))}),y=h.control,b=h.errors,x=h.formState,E=h.handleSubmit,P=h.register,R=h.setValue,_=h.watch,A=h.getValues,k=(0,m.useState)(),M=k[0],V=k[1],O=(0,m.useState)(),$=O[0],N=O[1],L=(0,m.useState)(!1),W=L[0],z=L[1],H=_("tags",o.tags),U=_("customerSelected",o.customerSelected),B=_("customerUserSelected",o.customerUserSelected),Q=_("locationSelected",o.locationSelected),G=_("pricing",o.pricing),X=_("serviceSelected",o.serviceSelected),Y=_("timing",o.timing),K=_("siteVisitReq",o.siteVisitReq),ee=_("taxonomyId_ShortDesc"),er=_("assetCategorySelected",null==o?void 0:o.assetCategorySelected),ei=_("slaId"),eo=_("permitsLinks"),es=_("permitsAttachments"),el=(0,I.Z)(U),eu=(0,I.Z)(B),ec=(0,I.Z)(Q),ed=(0,I.Z)(ee),ep=(0,T.aM)(g.Ab,{skip:!(null==U?void 0:U.value)||!(null==Q?void 0:Q.value),variables:{customerId:null==U?void 0:U.value,locationId:null==Q?void 0:Q.value}}).data;(0,m.useEffect)(function(){if(void 0!==ec&&Q!==ec?[{name:"access",value:(null==Q?void 0:Q.access)||""},{name:"coordinates",value:null}].forEach(function(e){var t;return R(e.name,e.value)}):U!==el&&el?[{name:"coordinates",value:null},{name:"customerUserSelected",value:null},{name:"locationSelected",value:null}].forEach(function(e){var t;return R(e.name,e.value)}):G&&!p.parentId&&!p.id&&[{name:"customerSpendThreshold",value:null==U?void 0:U.spendThreshold},{name:"amount",value:null==ee?void 0:null===(c=ee.meta)||void 0===c?void 0:null===(d=c.template)||void 0===d?void 0:d.amount},{name:"supplierLabourAmount",value:null==ee?void 0:null===(m=ee.meta)||void 0===m?void 0:null===(v=m.template)||void 0===v?void 0:v.supplierLabourAmount},{name:"supplierMaterialsAmount",value:null==ee?void 0:null===(f=ee.meta)||void 0===f?void 0:null===(g=f.template)||void 0===g?void 0:g.supplierMaterialsAmount}].forEach(function(e){var t;return R(e.name,e.value)}),ee!==ed&&!p.id&&!p.parentId){[{name:"title",value:null==ee?void 0:null===(Z=ee.meta)||void 0===Z?void 0:null===(h=Z.template)||void 0===h?void 0:h.title},{name:"description",value:null==ee?void 0:null===(y=ee.meta)||void 0===y?void 0:null===(b=y.template)||void 0===b?void 0:b.description},{name:"tags",value:(null==ee?void 0:null===(x=ee.meta)||void 0===x?void 0:null===(j=x.template)||void 0===j?void 0:j.tags)||[]},{name:"costCategorySelected",value:null==ee?void 0:null===(S=ee.meta)||void 0===S?void 0:null===(I=S.template)||void 0===I?void 0:I.costCategorySelected},{name:"serviceSelected",value:null==ee?void 0:null===(w=ee.meta)||void 0===w?void 0:null===(q=w.template)||void 0===q?void 0:q.serviceSelected},{name:"reportPassFail",value:(null==ee?void 0:null===(C=ee.meta)||void 0===C?void 0:null===(D=C.template)||void 0===D?void 0:D.reportPassFail)||!1},{name:"customerSignature",value:(null==ee?void 0:null===(T=ee.meta)||void 0===T?void 0:null===(E=T.template)||void 0===E?void 0:E.customerSignature)||!1},{name:"supplierSignature",value:(null==ee?void 0:null===(P=ee.meta)||void 0===P?void 0:null===(_=P.template)||void 0===_?void 0:_.customerSignature)||!1},{name:"reportPassFailTitle",value:null==ee?void 0:null===(A=ee.meta)||void 0===A?void 0:null===(k=A.template)||void 0===k?void 0:k.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==ee?void 0:null===(M=ee.meta)||void 0===M?void 0:null===(V=M.template)||void 0===V?void 0:V.requireReportRecommendations)||!1}].forEach(function(e){var t;return R(e.name,e.value)});var e,t,n,r,i,a,o,s,l,u,c,d,m,v,f,g,Z,h,y,b,x,j,S,I,w,q,C,D,T,E,P,_,A,k,M,V,O,$=null==ee?void 0:null===(O=ee.meta)||void 0===O?void 0:O.template;(null==$?void 0:$.amount)||(null==$?void 0:$.supplierLabourAmount)||(null==$?void 0:$.supplierMaterialsAmount)?R("pricing","fixed"):R("pricing",null)}ee!==ed&&[{name:"reportPassFail",value:(null==ee?void 0:null===(e=ee.meta)||void 0===e?void 0:null===(t=e.template)||void 0===t?void 0:t.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==ee?void 0:null===(n=ee.meta)||void 0===n?void 0:null===(r=n.template)||void 0===r?void 0:r.reportPassFailTitle},{name:"customerSignature",value:(null==ee?void 0:null===(i=ee.meta)||void 0===i?void 0:null===(a=i.template)||void 0===a?void 0:a.customerSignature)||!1},{name:"supplierSignature",value:(null==ee?void 0:null===(o=ee.meta)||void 0===o?void 0:null===(s=o.template)||void 0===s?void 0:s.supplierSignature)||!1},{name:"requireReportRecommendations",value:(null==ee?void 0:null===(l=ee.meta)||void 0===l?void 0:null===(u=l.template)||void 0===u?void 0:u.requireReportRecommendations)||!1}].forEach(function(e){var t;return R(e.name,e.value)}),eu&&(null==B?void 0:B.value)!==(null==eu?void 0:eu.value)&&R("locationSelected",null)},[U,null==B?void 0:B.value,Q,el,eu,ec,ed,G,p.id,p.parentId,R,ee]),(0,m.useEffect)(function(){if(ei&&!p.quoted){var e,t,n=(0,et.GU)("reactive",ep),r=null===(e=null==n?void 0:n.find(function(e){return e.id===Number(ei)}))||void 0===e?void 0:e.onSite,i=null===(t=null==n?void 0:n.find(function(e){return e.id===Number(ei)}))||void 0===t?void 0:t.onSiteUnit;if(r&&i){var a=eS()(null==o?void 0:o.createdAt),s=eS()(null==o?void 0:o.createdAt).add(r,i),l=30-a.minute()%30,u=30-s.minute()%30;R("timing","between"),R("timingStart",a.clone().add(l,"minutes").toDate()),R("timingEnd",s.clone().add(u,"minutes").toDate())}}},[ep,null==o?void 0:o.createdAt,p.quoted,R,ei]),(0,m.useEffect)(function(){if(ei&&p.quoted){var e,t,n=(0,et.GU)("quote",ep),r=null===(e=null==n?void 0:n.find(function(e){return e.id===Number(ei)}))||void 0===e?void 0:e.quoteReturned,i=null===(t=null==n?void 0:n.find(function(e){return e.id===Number(ei)}))||void 0===t?void 0:t.quoteReturnedUnit;if(r&&i){var a=eS()(null==o?void 0:o.createdAt).add(r,i),s=30-a.minute()%30,l=a.clone().add(s,"minutes").toDate(),u=a.clone().add(s,"minutes").subtract(1,"day").toDate();R("quoteDue",l),R("quoteDueSupplier",u),N(l),V(u)}}},[ep,null==o?void 0:o.createdAt,p.quoted,R,ei]),(0,m.useEffect)(function(){R("permitsAttachments",s.map(function(e){return{mediaId:e.mediaId,caption:e.media.caption,media:null,type:"",isAdded:!1}}))},[s,R]);var ef={control:y,errors:b,register:P};return(0,i.jsxs)(w.Z,{handleSubmit:E(d),children:[(0,i.jsxs)(q.Z,{children:[(0,i.jsxs)(C.Z,{md:6,children:[f("admin")&&(0,i.jsx)(ev,(0,u.Z)((0,r.Z)({},ef),{user:Z})),(0,i.jsx)(J,(0,u.Z)((0,r.Z)({},ef),{customerSelectedWatch:U,user:Z,hasRole:f})),(null==c?void 0:c.type)!=="quote"&&!p.quoted&&(0,i.jsx)(eP,{register:P,control:y}),Q&&f(["admin","customer","tenant"])&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ea,(0,u.Z)((0,r.Z)({},ef),{dataSlas:ep,currentAnswers:o.questions,jobId:null==c?void 0:c.id,locationSelectedWatch:Q,taxonomyWatch:ee,prevTaxonomy:ed,watch:_,isQuote:p.quoted,isPPM:"ppm"===o.type,tagsWatch:H,setValue:R,getValues:A,isSubmit:W,control:y,errors:b,register:P})),!p.quoted&&f(["admin","customer"])&&(0,i.jsx)(eq.t,(0,r.Z)({},ef)),!p.quoted&&f("admin")&&(0,i.jsx)(ey.n,(0,u.Z)((0,r.Z)({},ef),{pricingWatch:G,hasServiceRate:!!(null==U?void 0:U.serviceRateLabour)||!!(null==U?void 0:U.serviceRateExpenses),serviceSelectedWatch:X,isPPM:(null==c?void 0:c.type)==="ppm"})),!p.quoted&&(0,i.jsx)(eC.X,(0,u.Z)((0,r.Z)({},ef),{hasRole:f,query:p,setValue:R,timingWatch:Y,watch:_}))]})]}),(0,i.jsxs)(C.Z,{md:6,children:[U&&(0,i.jsx)(em,(0,u.Z)((0,r.Z)({},ef),{setValue:R,assetCategoryWatch:er,customerSelectedWatch:U,customerUserSelectedWatch:B,locationSelectedWatch:Q})),(null==Q?void 0:Q.permitsRequired)&&f(["admin","customer"])&&(0,i.jsx)(eM.s,{title:"Location permits",children:(0,i.jsx)(eA,{setValue:R,permitsLinks:eo,attachmentsPermits:es,onDeleteExistingMedia:l})}),Q&&(0,i.jsxs)(i.Fragment,{children:[p.quoted&&(0,i.jsx)(eI,(0,u.Z)((0,r.Z)({},ef),{siteVisitWatch:K,watch:_,quoteReturnedTimingEndSupplier:M,quoteReturnedTimingEndCustomer:$})),p.ppm&&(0,i.jsx)(eh,(0,u.Z)((0,r.Z)({},ef),{locationId:Q.value})),!c&&(0,i.jsx)(F,{locationId:Q.value,serviceId:(null==X?void 0:X.value)||null})]})]})]}),(0,i.jsx)("input",(0,r.Z)({type:"hidden"},P("permitsLinks"))),(0,i.jsx)("input",(0,r.Z)({type:"hidden"},P("permitsAttachments"))),(0,i.jsx)("input",(0,r.Z)({type:"hidden"},P("tags"))),(0,i.jsx)(D.Z,{content:"Submit",disabled:x.isSubmitting,size:"lg",type:"submit",onClick:function(){return z(!0)}})]})};eV.propTypes={defaultValues:b.object.isRequired,job:b.object,onSubmit:b.func.isRequired,query:b.object.isRequired};var eO=n(9928),e$=n(39641),eN=n(84808),eF=n(98456),eL=n(60185),eW=n(16391),ez=function(e){var t=(0,m.useState)(!1),n=t[0],a=t[1],s=(0,en.x)(),b=s.hasRole,x=s.user,j=(0,p.x)(),S=(0,e$.D)(),I=(0,eW.useMainContext)(),w=I.predefinedAssetForWorkOrder,q=I.setPredefinedAssetForWorkOrder,C=(0,m.useState)(!0),D=C[0],T=C[1],E="/dashboard/issues/",P=(0,c.Z)((0,v.D)(Z.Vw),1)[0],R=e.accountId||0,_=e.locationId||0,A=e.parentId||0,k=e.assetId||0,M=e.recall||null;b("customer")&&(R=x.accountId);var V,O,$,N=(0,c.Z)((0,f.t)(g.E6,{skip:!e.id,variables:{adminId:x.adminId,number:"".concat(e.id)},onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),F=N[0],L=N[1],W=L.loading,z=L.data,H=(void 0===z?{job:null}:z).job,U=H&&H[0],B=(0,eL.z)("Job",x.adminId,x.id,null==U?void 0:U.id,"supportingDocuments"),J=B.createMediaInput,Q=B.preloadedMedia,G=B.deleteMediaByEntity,X=B.loadingDeleteMedia,Y=(0,c.Z)((0,f.t)(g.TY,{onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})},variables:{accountId:R,locationId:_,parentId:A,assetId:k,includeAccount:!!R,includeLocation:!!_,includeParentJob:!!A,includeAsset:!!k}}),2),K=Y[0],ee=Y[1],er=ee.loading,ei=ee.data,ea=(0,c.Z)((0,v.D)(h.xM,{onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eo=ea[0],es=ea[1].loading,el=(0,c.Z)((0,v.D)(h.tv,{onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eu=el[0],ec=el[1].loading,ed=(0,c.Z)((0,v.D)(g.mJ,{onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(V=(0,l.Z)(function(t){var n,r,i,s,u,c;return(0,d.__generator)(this,function(s){switch(s.label){case 0:return r=(n=t.createJob.data.insert_Job.returning[0]).id,i=n.number,[4,(0,eO.F)(j,r)];case 1:if(s.sent(),!(A&&"true"===M))return[3,4];return[4,ef({variables:{objects:[{notes:"Marked as dispute because of creating a recall job",status:"inDispute",jobId:e.parentId,userId:x.id}]}})];case 2:var c;return s.sent(),[4,eo({variables:{objects:{caption:"report for recall job",expiryAt:null,extension:null==(u=e.report)?void 0:u.split(".").pop(),userId:x.id,filename:u,type:"document"}}}).then((c=(0,l.Z)(function(e){var t,n,i;return(0,d.__generator)(this,function(t){switch(t.label){case 0:return[4,eu({variables:{objects:i={mediaId:e.data.insert_Media.returning[0].id,entity:"Job",entityId:r}}})];case 1:return t.sent(),[2]}})}),function(e){return c.apply(this,arguments)}))];case 3:s.sent(),s.label=4;case 4:return a(!0),o().push("".concat(E,"view?id=").concat(i)),[2]}})}),function(e){return V.apply(this,arguments)})}),2),em=ed[0],ep=ed[1].loading,ev=(0,c.Z)((0,v.D)(g.r2,{onError:function(e){S.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),ef=ev[0],eg=ev[1].loading,eZ=(0,c.Z)((0,v.D)(g.uA,{onCompleted:(O=(0,l.Z)(function(e){var t;return(0,d.__generator)(this,function(n){switch(n.label){case 0:return[4,(0,eO.F)(j,U.id)];case 1:return n.sent(),t=e.update_Job_by_pk.number,o().push("".concat(E,"view?id=").concat(t)),[2]}})}),function(e){return O.apply(this,arguments)})}),2),eh=eZ[0],ey=eZ[1].loading;(0,m.useEffect)(function(){e.id?F():R||_||A?K():T(!1)},[]),(0,m.useEffect)(function(){!W&&U?T(!1):!er&&ei&&T(!1)},[W,er]);var eb=($=(0,l.Z)(function(t){var n,i,a,o,s,l,c,m,p,v,f,g,Z,h,y,j,S,I,w,q,C;return(0,d.__generator)(this,function(d){switch(d.label){case 0:return n=(0,et.eD)(t,null==U?void 0:U.id),[4,J(t.permitsAttachments,"supportingDocuments")];case 1:return i=d.sent(),a=t.formSubmission,delete t.permitsAttachments,delete t.formSubmission,[4,(0,et.lV)({query:e,data:(0,r.Z)({},(0,u.Z)((0,r.Z)({},t),{meta:null!==(o=null==U?void 0:U.meta)&&void 0!==o?o:{}}),i||{}),hasRole:b,user:x,type:ex.type})];case 2:if(s=d.sent(),!(!e.id||e.parentId))return[3,6];return[4,em({variables:{adminId:x.adminId,objects:[s]}})];case 3:if(!(null===(v=null==(f=d.sent())?void 0:null===(l=f.data)||void 0===l?void 0:null===(c=l.createJob)||void 0===c?void 0:null===(m=c.data)||void 0===m?void 0:null===(p=m.insert_Job)||void 0===p?void 0:p.returning[0])||void 0===v?void 0:v.id))return[3,5];return[4,P({variables:{formId:a.value,userId:x.id,submissionData:a.submissionData,formFields:a.formFields,entity:"Job",entityId:null===(j=null==f?void 0:null===(g=f.data)||void 0===g?void 0:null===(Z=g.createJob)||void 0===Z?void 0:null===(h=Z.data)||void 0===h?void 0:null===(y=h.insert_Job)||void 0===y?void 0:y.returning[0])||void 0===j?void 0:j.id}})];case 4:d.sent(),d.label=5;case 5:return[3,8];case 6:return w=[],q=ex.assetSelected.map(function(e){return e.assetId}),(null===(S=s.Assets)||void 0===S?void 0:null===(I=S.data)||void 0===I?void 0:I.length)>0&&(w=s.Assets.data.map(function(e){return(0,u.Z)((0,r.Z)({},e),{entityId:U.id})}),delete s.Assets),C=(0,et.A5)(U.id,s),delete s.Taxonomy,[4,eh({variables:{jobId:U.id,changes:s,compliances:[],deletedAssetIds:q,assets:w,questions:n,media:C,hasQuestions:(null==n?void 0:n.length)>0}})];case 7:d.sent(),d.label=8;case 8:return[2]}})}),function(e){return $.apply(this,arguments)});if((0,m.useEffect)(function(){return function(){q(null)}},[q]),U&&((0,y.E)(U,"accepted")&&!b("admin")||(0,y.E)(U,"inProgress")))return(0,i.jsx)("p",{children:"Work order can't be edited after started by supplier"});var ex={};return w?ex=(0,et.Pu)(w,b,x):D||(ex=e.id?U?(0,et.I2)(U):null:(0,et.$z)(ei,b,x,M)),(0,i.jsxs)(i.Fragment,{children:[(D||W||X||er||es||ec||ep||eg||ey)&&(0,i.jsx)(eN.Z,{open:!0,sx:{zIndex:1e5},children:(0,i.jsx)(eF.Z,{color:"secondary"})}),!D&&ex&&(0,i.jsx)(eV,{defaultValues:ex,job:e.id?U:null,onSubmit:eb,isSubmit:n,preloadedMedia:Q,deleteMediaByEntity:G,query:e})]})},eH=function(){var e=(0,a.useRouter)().query,t=e.id?"Edit":"Create",n="Work Order";return n=e.quoted?"Quote":n,n=e.ppm?"PPM":n,(0,i.jsx)(s.Z,{pageHeading:{heading:"".concat(t," ").concat(n)},View:(0,i.jsx)(ez,(0,r.Z)({},e))})}},40872:function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(){return r.apply(this,arguments)}n.d(t,{Z:function(){return i}})}},function(e){e.O(0,[3662,630,2283,212,8890,619,2583,4135,8579,6043,1838,4244,3911,1417,3776,1564,3054,2329,8500,778,4046,1023,1870,2797,1047,4043,3058,6313,597,1050,4030,4191,8344,6733,7554,1514,8372,8287,9774,2888,179],function(){return e(e.s=20633)}),_N_E=e.O()}]);