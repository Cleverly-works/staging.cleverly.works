(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3259],{92448:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/calendar",function(){return n(74613)}])},28184:function(e,t,n){"use strict";n.d(t,{F:function(){return N}});var r=n(47568),s=n(26042),i=n(69396),o=n(99534),a=n(29815),u=n(97582),c=n(85893),d=n(67294),l=n(45697),p=n(11163),y=n(66252),m=n(28852),h=n(78289),v=n(11585),f=n(9270),g=n(62140),b=n(81680),I=n(11383),x=n(2845),q=n(18586),_=n(22713),j=n(22244),Z=n(7297),w=n(10367);function C(){var e=(0,Z.Z)(["\n  ul {\n    list-style: none;\n    float: left;\n    padding-top: 15px;\n  }\n  ul li {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    float: left;\n    width: 120px;\n    font-size: 90%;\n    list-style: none;\n  }\n  li span {\n    display: block;\n    float: left;\n    height: 12px;\n    width: 12px;\n    margin-right: 5px;\n  }\n"]);return C=function(){return e},e}var S=function(e){var t=e.status;return(0,c.jsx)(A,{children:(0,c.jsx)("ul",{children:t.map(function(e,t){return(0,c.jsxs)("li",{children:[(0,c.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(t))})})})},A=w.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-19e2194e-0"})(C()),T=n(62047),k=n(55843),V=n(51466),P=n(58594),R=n(66812),F=n(42283),E=n(92148);function L(){var e=(0,Z.Z)(["\n  align-items: center;\n  display: flex;\n"]);return L=function(){return e},e}var G=function(e){var t=e.setTypes,n=e.setFilters,r=e.setSiteVisit,o=e.types,u=(0,x.x)().hasRole,l=(0,F.cI)({defaultValues:D}),p=l.control,y=l.errors,m=l.register,h=(0,l.watch)("userId");(0,d.useEffect)(function(){n(function(e){return(0,i.Z)((0,s.Z)({},e),{userId:(null==h?void 0:h.value)||null})})},[h]);var v=function(e,n){n?t((0,a.Z)(o).concat([e])):t(o.filter(function(t){return t!==e}))},b=function(e){r(e.target.checked)};return(0,c.jsxs)(f.Z,{children:[(0,c.jsxs)(z,{md:3,children:[(0,c.jsx)(T.Z,{onToggle:function(e){return v("reactive",e)},size:"sm",toggled:o.includes("reactive")}),(0,c.jsx)(k.Z,{marginLeft:"sm"}),(0,c.jsx)(V.Z,{size:"sm",children:"Reactive"})]}),(0,c.jsxs)(z,{md:3,children:[(0,c.jsx)(T.Z,{onToggle:function(e){return v("ppm",e)},size:"sm",toggled:o.includes("ppm")}),(0,c.jsx)(k.Z,{marginLeft:"sm"}),(0,c.jsx)(V.Z,{size:"sm",children:"PPM"})]}),(0,c.jsxs)(z,{md:3,children:[(0,c.jsx)(T.Z,{onToggle:function(e){return v("quote",e)},size:"sm",toggled:o.includes("quote")}),(0,c.jsx)(k.Z,{marginLeft:"sm"}),(0,c.jsx)(V.Z,{size:"sm",children:"Quote"})]}),(0,c.jsxs)(z,{md:3,children:[(0,c.jsx)(T.Z,{onToggle:function(e){return v("cppm",e)},size:"sm",toggled:o.includes("cppm")}),(0,c.jsx)(k.Z,{marginLeft:"sm"}),(0,c.jsx)(V.Z,{size:"sm",children:"Compliance"})]}),(0,c.jsxs)(f.Z,{style:{width:"100%",margin:0},children:[u(E.n)&&(0,c.jsx)(g.Z,{md:6,children:(0,c.jsx)(R.P,(0,i.Z)((0,s.Z)({},{control:p,errors:y,register:m}),{errors:(0,s.Z)({},y),label:"",name:"userId",placeholder:"Select user",type:"user"}))}),(0,c.jsx)(g.Z,{md:6,style:{display:"flex",alignItems:"center"},children:(0,c.jsx)(P.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:b})})]})]})},z=(0,w.ZP)(g.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-d03bcdda-0"})(L());G.propTypes={setTypes:l.func,setSiteVisit:l.func,types:l.array};var D={userId:null},N=function(e){var t,n,l,Z,w=e.defaultFilters,C=e.defaultView,A=e.locationId,T=e.showCompliance,k=e.showFilters,V=e.showSiteVisits,P=e.supplierId,R=(0,p.useRouter)().query,F=(0,d.useContext)(h.Z),E=(0,q.q)(),L=null===(t=E.admin)||void 0===t?void 0:null===(n=t.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,z=null===(l=E.admin)||void 0===l?void 0:null===(Z=l.jobSetting)||void 0===Z?void 0:Z.jobNumberSuffix,D=(0,x.x)().user,N=(0,y.x)(),U=!1,W=!1;switch(D.accountType){case"supplier":W=!0;break;case"customer":U=!0}var O,H=(0,d.useState)(R.type?["".concat(R.type)]:w),J=H[0],Q=H[1],B=(0,d.useState)(V),M=B[0],$=B[1],X=(0,d.useState)(null),K=X[0],Y=X[1],ee="scheduled"===R.type?"PPM":"Bookings";(0,d.useEffect)(function(){return R.type?["".concat(R.type)]:W?Q(["ppm"]):Q(w)},[w]);var et=(O=(0,r.Z)(function(e,t){var n,r,c,d,l;return(0,u.__generator)(this,function(r){switch(r.label){case 0:return n={type:{_in:J},_or:[{_and:[{timingStart:{_gte:e.start}},{timingStart:{_lte:e.end}}]},{_and:[{scheduledAt:{_gte:e.start}},{scheduledAt:{_lte:e.end}}]},{_and:[{siteVisitStart:{_gte:e.start}},{siteVisitStart:{_lte:e.end}}]}]},W&&(n.supplierId={_eq:D.accountId}),P&&(n.supplierId={_eq:P}),U&&(n.customerId={_eq:D.accountId}),A&&(n.locationId={_eq:A}),(T||A)&&(n.Compliances={complianceId:{_is_null:!1}}),K&&(n.customerUserId={_eq:null==K?void 0:K.userId}),M&&(n.siteVisitStart={_is_null:!1}),[4,N.query({query:m.f,variables:{where:n}})];case 1:return d=(void 0===(c=r.sent().data)?{events:[]}:c).events,l=[],d.map(function(e){var t,n=e.supplierQuotes,r=(0,o.Z)(e,["supplierQuotes"]),u=(null===(t=null==r?void 0:r.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||r.title;return l=(0,a.Z)(l).concat([(0,i.Z)((0,s.Z)({},e),{title:u})]),n.length>0&&n.map(function(e){return l=(0,a.Z)(l).concat([(0,i.Z)((0,s.Z)({},r),{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(u," ").concat(e.quoteNumber),siteVisit:!0})])}),l}),t(l.map(function(e){var t=(0,s.Z)({},e);return t.start=t.scheduledAt||t.start,t.end=t.scheduledAt||t.end||t.start,t.color=t.siteVisit?"rgb(182, 79, 200)":(0,I.t)(t.status),t})),[2]}})}),function(e,t){return O.apply(this,arguments)}),en=function(e){F.show({content:(0,c.jsx)(_.g,{jobId:parseInt(e.event.id),toggleShow:F.close,numberPrefix:L,numberSuffix:z}),title:"Job details",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,c.jsxs)(v.Z,{fitParentHeight:!0,open:!0,title:ee,children:[k&&(0,c.jsx)(G,{setTypes:Q,setFilters:Y,setSiteVisit:$,types:J}),(0,c.jsx)(b.A,{eventClick:en,events:et,initialView:"day"===R.show?"timeGridDay":C}),(0,c.jsx)(f.Z,{children:(0,c.jsx)(g.Z,{md:12,children:(0,c.jsx)(S,{status:j.yW})})})]})};N.propTypes={showCompliance:l.bool,showSiteVisits:l.bool,locationId:l.number,showFilters:l.bool},N.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},81680:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var r=n(85893),s=n(45697),i=n(13625),o=function(e){var t=e.dateClick,n=e.events,s=e.eventClick,o=e.eventContent,a=(e.hasLoading,e.height),u=e.initialView;return(0,r.jsx)(i.Z,{dateClick:t,eventClick:s,eventContent:o,events:n,hasLoading:!0,height:a,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:u})};o.propTypes={dateClick:s.func,events:s.func,eventClick:s.func,eventContent:s.func,hasLoading:s.bool,height:s.number,initialView:(0,s.oneOf)(["listWeek","timeGridWeek","timeGridDay"])},o.defaultProps={initialView:"listWeek",hasLoading:!0,height:550}},28852:function(e,t,n){"use strict";n.d(t,{f:function(){return a}});var r=n(7297),s=n(75063),i=n(66312);function o(){var e=(0,r.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      type\n      description\n      end: timingEnd\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      quoteDue\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n              code\n            }\n          }\n        }\n      }\n      supplier: Supplier {\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return o=function(){return e},e}var a=(0,s.Ps)(o(),i.WW,i.MR)},66812:function(e,t,n){"use strict";n.d(t,{P:function(){return j}});var r=n(47568),s=n(26042),i=n(99534),o=n(7297),a=n(97582),u=n(85893),c=n(67294),d=n(45697),l=n(10367),p=n(66252),y=n(4972),m=n(78289),h=n(52019),v=n(49501),f=n(9270),g=n(62140),b=n(84043),I=n(77439);function x(){var e=(0,o.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return x=function(){return e},e}var q=function(e,t){var n,r,s,i=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(r=t.errors[t.name])||void 0===r?void 0:r.message)&&(i=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(n){e[n]!==t[n]&&(i=!1)}),i},_=function(e){var t=e.accountId,n=e.area,r=e.assetCategoryId,s=e.entity,i=e.entityId,o=(e.hasRole,e.id),a=e.locationId,u=e.serviceId,c=e.taxonomyGroupType,d=e.customerId,l=e.customerRole,p=e.type,m=e.userId,h=e.invoiceThreshold,v=e.quoteThreshold,f=p;switch(l&&(f="".concat(p,"_").concat(l)),f){case"address":return{query:y.cz,variables:{entity:s,entityId:i}};case"asset":return{query:y.UH,variables:{categoryId:r,locationId:a}};case"assetBookable":return{query:y.UH,variables:{categoryId:r,locationId:a,bookable:"yes"}};case"assetCategory":return{query:y.nD,variables:{id:o}};case"assetSublocation":return{query:y.UH,variables:{category:"sublocation",adminId:t,locationId:a}};case"compliance":return{query:y.kU,variables:{locationId:a}};case"coverage":return{query:y.j$};case"customer":return{query:y.SW};case"job":return{query:y.Qn,variables:{locationId:a}};case"manager":return{query:y.he,variables:{accountId:t,userId:m}};case"thresholdManagers":return{query:y.Ak,variables:{accountId:t,userId:m,invoiceThreshold:h,quoteThreshold:v}};case"product":return{query:y.UH,variables:{category:"product",locationId:a}};case"property":return{query:y._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t}}}}};case"property_user":return{query:y._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:t}}}}}}};case"sensor":return{query:y.UH,variables:{category:"sensor",locationId:a}};case"service":return{query:y.kx};case"sla":return{query:y.t1,variables:{type:"priority",adminId:t}};case"sublocation":return{query:y.zR,variables:{locationId:a}};case"supplier":var g={type:{_eq:"supplier"}};return n&&(g.PostcodeAreas={PostcodeArea:{area:{_eq:n}},entity:{_eq:"Account"},status:{_eq:"active"}}),u&&(g.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:u}},n&&(g.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:n}}})),{query:y.by,variables:{where:g}};case"user":return{query:y.yR,variables:{accountId:t}};case"usersForBookings":return{query:y.yR,variables:{accountId:m}};case"tenant":return{query:y.RJ};case"taxonomyGroup":return{query:y.Cj,variables:{type:c}};case"expenseCategory":return{query:y.Ve};default:return{query:y.qd}}},j=(0,c.memo)(function(e){var t,n=e.AddForm,o=e.accountId,d=e.area,l=e.assetCategoryId,y=e.control,x=e.entity,q=e.entityId,j=e.errors,w=e.id,C=e.isClearable,S=e.isDisabled,A=e.label,T=e.locationId,k=e.name,V=e.serviceId,P=e.taxonomyGroupType,R=e.customerId,F=e.customerRole,E=e.type,L=e.userId,G=e.invoiceThreshold,z=e.quoteThreshold,D=(0,i.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),N=(0,p.x)(),U=(0,c.useState)(!1),W=U[0],O=U[1],H=(0,c.useState)(),J=H[0],Q=H[1],B=(0,c.useState)(!1),M=B[0],$=B[1],X=(0,c.useContext)(m.Z),K=(0,c.useContext)(h.Z).hasRole,Y=(0,c.useState)(!1),ee=Y[0],et=Y[1];(0,c.useEffect)(function(){return et(!1),$(!1),function(){}},[o,l,x,q,T,V,E,R,F,L]);var en=(t=(0,r.Z)(function(){var e,t,n,r,i,u,c;return(0,a.__generator)(this,function(i){switch(i.label){case 0:if(M)return et(!0),[2,null];return O(!0),t=(e=_({accountId:o,area:d,assetCategoryId:l,entity:x,entityId:q,hasRole:K,id:w,locationId:T,serviceId:V,taxonomyGroupType:P,customerId:R,customerRole:F,type:E,userId:L,invoiceThreshold:G,quoteThreshold:z})).query,r=void 0===(n=e.variables)?{}:n,[4,N.query({query:t,variables:(0,s.Z)({},r)})];case 1:return Q((void 0===(u=i.sent().data)?{items:[]}:u).items),O(!1),$(!0),et(!0),[2]}})}),function(){return t.apply(this,arguments)}),er=function(){X.show({content:(0,u.jsx)("div",{children:(0,u.jsx)(n,{})}),title:"Add form"})};return(0,u.jsx)(v.Z,{id:k,label:A,children:(0,u.jsxs)(f.Z,{children:[(0,u.jsx)(g.Z,{md:n?11:12,children:(0,u.jsx)(b.Z,(0,s.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:y,errors:j,isDisabled:S,isClearable:C,isLoading:W,menuIsOpen:ee,options:J,onFocus:en,onBlur:function(){et(!1)},name:k,searchable:!0},D),D.defaultValue)}),n&&(0,u.jsx)(g.Z,{md:1,children:(0,u.jsx)(Z,{children:(0,u.jsx)(I.Z,{content:null,startIcon:"plus",size:"sm",onClick:er})})})]})})},q),Z=l.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-fdff7245-0"})(x());j.propTypes={AddForm:d.object,area:d.string,accountId:d.number,assetCategoryId:d.number,control:d.object.isRequired,errors:d.object.isRequired,entity:d.string,entityId:d.number,id:d.number,isClearable:d.bool,label:d.string.isRequired,locationId:d.number,name:d.string.isRequired,serviceId:d.number,taxonomyGroupType:(0,d.oneOf)(["expenseCategory","costCategory","jobTags"]),type:d.string},j.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},74613:function(e,t,n){"use strict";n.r(t);var r=n(85893),s=n(11163),i=n(19076),o=n(28184),a=function(){var e=(0,s.useRouter)().query,t=e.type?["".concat(e.type)]:["reactive","quote","cppm"];return(0,r.jsx)(i.Z,{pageHeading:{heading:"Calendar"},children:(0,r.jsx)(o.F,{defaultFilters:t})})};t.default=a}},function(e){e.O(0,[2283,212,8890,619,2583,4135,8579,4244,3911,1417,1564,3054,4046,4043,9050,8344,4972,9774,2888,179],function(){return e(e.s=92448)}),_N_E=e.O()}]);