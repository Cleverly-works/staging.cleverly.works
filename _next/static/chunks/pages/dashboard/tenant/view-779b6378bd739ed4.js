(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5355],{24903:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/tenant/view",function(){return t(51819)}])},5336:function(e,n,t){"use strict";t.d(n,{C:function(){return T}});var a=t(85893),i=t(67294),o=t(45697),r=t.n(o),s=t(93946),u=t(25464),l=t(18972),d=t(57976),c=t(73890),m=t(69008),p=t(41687),v=t(60888),h=t(40535),y=t(63441),f=t(41733),b=t(77957),g=t(2548),x=t(24519),Z=t(2391),j=t(69308),I=t(79369),S=t(22961),w=t(28201),C=t(51233),_=t(15861),k={add:(0,a.jsx)(p.Z,{}),archive:(0,a.jsx)(c.Z,{}),avatar:(0,a.jsx)(w.Z,{}),check:(0,a.jsx)(v.Z,{}),delete:(0,a.jsx)(f.Z,{}),description:(0,a.jsx)(h.Z,{}),download:(0,a.jsx)(y.Z,{}),info:(0,a.jsx)(g.Z,{}),edit:(0,a.jsx)(b.Z,{}),location:(0,a.jsx)(j.Z,{}),unarchive:(0,a.jsx)(m.Z,{}),uploadFile:(0,a.jsx)(x.Z,{}),receipt:(0,a.jsx)(Z.Z,{}),visibility:(0,a.jsx)(S.Z,{})},D={default:(0,a.jsx)(d.Z,{}),defaultHoriz:(0,a.jsx)(I.Z,{}),description:(0,a.jsx)(h.Z,{})},T=function(e){var n=e.actionsData,t=e.icon,o=e.row,r=e.disabled,d=(0,i.useState)(null),c=d[0],m=d[1],p=function(e){e.stopPropagation(),m(e.currentTarget)},v=function(){m(null)};return(0,a.jsxs)("div",{children:[(0,a.jsx)(s.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:r,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:p,children:D[t]}),(0,a.jsx)(u.Z,{id:"simple-menu",anchorEl:c,keepMounted:!0,open:Boolean(c),onClose:v,PaperProps:{sx:{borderRadius:2}},children:n(o).map(function(e,n){return(0,a.jsx)(l.Z,{disabled:e.disabled,onClick:function(n){e.onClick(n),v()},sx:{pl:3,pr:4},children:(0,a.jsxs)(C.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==k?void 0:k[e.icon])||null,(0,a.jsx)(_.Z,{children:e.tooltip})]})},n)})})]})};T.propTypes={actionsData:r().func.isRequired,icon:r().oneOf(["default","description"]),row:r().any.isRequired,disabled:r().bool},T.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},44123:function(e,n,t){"use strict";t.d(n,{z:function(){return et}});var a=t(47568),i=t(26042),o=t(69396),r=t(828),s=t(97582),u=t(85893),l=t(67294),d=t(45697),c=t(66252),m=t(6388),p=t(50319),v=t(7297),h=t(75063);function y(){var e=(0,v.Z)(["\n  mutation InsertExpense($objects: [Expense_insert_input!]!) {\n    insert_Expense(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return y=function(){return e},e}function f(){var e=(0,v.Z)(["\n  mutation UpdateExpense($id: Int!, $changes: Expense_set_input) {\n    update_Expense_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return f=function(){return e},e}function b(){var e=(0,v.Z)(["\n  mutation UpdateExpense($parentId: Int!, $changes: Expense_set_input) {\n    parentExspense: update_Expense(where: { id: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    childExpenses: update_Expense(where: { parentId: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return b=function(){return e},e}function g(){var e=(0,v.Z)(['\n  query GetExpenses($entity: String, $entityId: Int, $jobId: Int) {\n    expenses: Expense(\n      where: { jobId: { _eq: $jobId }, entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n    ) {\n      id\n      categoryId\n      description\n      amount\n      unit\n      markup\n      vat\n      paid\n      jobId\n      total\n      entity\n      entityId\n      occurredAt\n      recurring\n      category: Category {\n        name\n      }\n      media: Media(where: { entity: { _eq: "Expense" } }) {\n        id\n      }\n    }\n  }\n']);return g=function(){return e},e}function x(){var e=(0,v.Z)(["\n  mutation DeleteExpense($id: Int!) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return x=function(){return e},e}var Z=(0,h.Ps)(y()),j=(0,h.Ps)(f()),I=(0,h.Ps)(b()),S=(0,h.Ps)(g()),w=(0,h.Ps)(x()),C=t(52019),_=t(11082),k=t(68956),D=t(16551),T=t(77439),A=t(33006),$=t(9270),q=t(62140),P=t(86036),E=t(8500),R=t(11585),M=t(22595),J=t(35418),O=t(42283),F=t(79665),L=t(76600),N=t(90951),H=t(28497),W=t(49501),V=t(55563),U=t(32979),z=t(6710),G=t(66812),B=t(74231),Y=(0,B.Ry)().shape({amount:(0,B.Rx)().required(),unit:(0,B.Rx)().required(),categoryId:(0,B.Ry)().required(),description:(0,B.Z_)().required(),markup:(0,B.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),paid:(0,B.Z_)().oneOf(["admin","supplier"]).required(),vatMarkup:(0,B.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable()}),K=function(e){e.categories,e.currency;var n=e.defaultValues,t=e.submit,a=e.serviceRateExpenses,r=e.showRecurring;(null==n?void 0:n.vat)&&(null==n?void 0:n.vat)!=="20"&&(n.vatMarkup=n.vat,n.vat="custom");var s=(0,O.cI)({defaultValues:(0,i.Z)({vat:"20"},n),resolver:(0,F.S)(Y)}),l=s.control,d=s.errors,c=s.handleSubmit,m=s.register,p=(0,s.watch)("vat"),v={control:l,errors:d,register:m};return(0,u.jsxs)(L.Z,{id:"offCanvasForm",handleSubmit:c(t),children:[(0,u.jsx)(N.Z,(0,o.Z)((0,i.Z)({},v),{name:"paid",data:[{id:"admin",label:"Admin",value:"admin"},{id:"supplier",label:"Supplier",value:"supplier"}],legend:"Paid by"})),(0,u.jsx)(H.Z,(0,o.Z)((0,i.Z)({},v),{name:"amount",label:"Unit Cost",vat:"Ex VAT"})),(0,u.jsx)(W.Z,{label:"Units",children:(0,u.jsx)(V.Z,(0,o.Z)((0,i.Z)({},v),{name:"unit"}))}),(0,u.jsx)(N.Z,(0,o.Z)((0,i.Z)({},v),{name:"vat",data:[{id:"default",label:"Default (20%)",value:20},{id:"custom",label:"Custom",value:"custom"}],legend:"VAT"})),"custom"===p&&(0,u.jsx)(U.Z,(0,o.Z)((0,i.Z)({},v),{label:"Custom VAT",name:"vatMarkup"})),a?(0,u.jsx)(V.Z,(0,o.Z)((0,i.Z)({},v),{name:"markup",type:"hidden"})):(0,u.jsx)(U.Z,(0,o.Z)((0,i.Z)({},v),{label:"Markup ".concat(a?"(Service Rate Expenses and Materials : ".concat(a,"%)"):""),name:"markup"})),(0,u.jsx)(G.P,(0,o.Z)((0,i.Z)({},v),{errors:(0,i.Z)({},d),label:"Category",name:"categoryId",type:"expenseCategory"})),(0,u.jsx)(W.Z,{label:"Description",children:(0,u.jsx)(z.Z,(0,o.Z)((0,i.Z)({},v),{name:"description",rows:2}))}),r&&(0,u.jsx)(N.Z,(0,o.Z)((0,i.Z)({},v),{name:"recurring",data:[{id:"recurring",label:"Recurring",value:"recurring"},{id:"nextInvoice",label:"Only for next invoice",value:"nextInvoice"}]})),n.id&&(0,u.jsx)(V.Z,(0,o.Z)((0,i.Z)({},v),{name:"id",type:"hidden"}))]})};K.propTypes={currency:d.string,defaultValues:d.object,serviceRateExpenses:d.number,submit:d.func.isRequired},K.defaultProps={currency:"GBP",serviceRateExpenses:0,showRecurring:!1};var Q=t(46169),X=t(8732),ee=t(9928),en=t(64872),et=function(e){var n,t,d,v,h,y,f=e.currency,b=e.enableUpdate,g=e.entity,x=e.entityId,O=e.job,F=e.jobs,L=e.refetchParent,N=e.tab,H=e.withDetails,W=e.showRecurring,V=(0,c.x)(),U=(0,l.useContext)(C.Z).hasRole,z=(0,en.a)(),G=(0,M.E)(O,"invoiceSent"),B=(0,M.E)(O,"closed"),Y=U("customer")&&!G,et=!O||!B&&(U(["admin"])&&!(0,M.E)(O,["validated","unvalidated"])||U(["admin","supplier"])&&!(0,M.E)(O,"reportSent")||b),ea=(0,X.B)("serviceRateExpenses",null==O?void 0:O.financeLogs,null==O?void 0:null===(n=O.customer)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(d=t.finance)||void 0===d?void 0:d.serviceRateExpenses)||0,ei=N||(!U("admin")&&U("supplier")?"supplier":"admin"),eo=(0,m.aM)(S,{variables:{entity:g,entityId:x,jobId:null==O?void 0:O.id},skip:Y}),er=eo.data,es=(void 0===er?{expenses:[]}:er).expenses,eu=eo.loading,el=eo.refetch,ed=(0,Q.E)(es,0,ei),ec=ed.preparedExpenses,em=ed.totalExpenses,ep=ed.totalExpensesExVAT,ev=(0,r.Z)((0,p.D)(w,{onCompleted:function(){O&&(0,ee.F)(V,O.id),"JobSchedule"===g&&x&&(0,ee.j)({client:V,scheduleId:x}),"Location"===g&&x&&(0,ee.j)({client:V,locationId:x}),L?L():el()}}),1)[0],eh=(0,r.Z)((0,p.D)(Z,{onCompleted:function(){O&&(0,ee.F)(V,O.id),"JobSchedule"===g&&x&&(0,ee.j)({client:V,scheduleId:x}),"Location"===g&&x&&(0,ee.j)({client:V,locationId:x}),z.close(),L?L():el()}}),1)[0],ey=(0,r.Z)((0,p.D)(j,{onCompleted:function(){O&&(0,ee.F)(V,O.id),"JobSchedule"===g&&x&&(0,ee.j)({client:V,scheduleId:x}),"Location"===g&&x&&(0,ee.j)({client:V,locationId:x}),z.close(),L?L():el()}}),1)[0],ef=(0,r.Z)((0,p.D)(I,{onCompleted:function(){O&&(0,ee.F)(V,O.id),"JobSchedule"===g&&x&&(0,ee.j)({client:V,scheduleId:x}),"Location"===g&&x&&(0,ee.j)({client:V,locationId:x}),z.close(),L?L():el()}}),1)[0],eb=(v=(0,a.Z)(function(e){var n,t;return(0,s.__generator)(this,function(a){switch(a.label){case 0:if(!e.id)return[3,2];return delete(n=(0,i.Z)({},e)).id,[4,ef({variables:{parentId:e.id,changes:n}})];case 1:return a.sent(),[3,4];case 2:return t=(0,o.Z)((0,i.Z)({},e),{entity:g,entityId:x,Expenses:{data:F.map(function(n){return(0,o.Z)((0,i.Z)({},e),{jobId:n.id})})}}),[4,eh({variables:{objects:t}})];case 3:a.sent(),a.label=4;case 4:return[2]}})}),function(e){return v.apply(this,arguments)}),eg=(h=(0,a.Z)(function(e){var n,t;return(0,s.__generator)(this,function(a){switch(a.label){case 0:if("custom"===e.vat&&(e.vat=e.vatMarkup),t=(n=e.unit*e.amount)*(e.markup/100)+n,e.total=t*(e.vat/100)+t,delete e.vatMarkup,e.categoryId=e.categoryId.value,"JobSchedule"!==g)return[3,2];return[4,eb(e)];case 1:case 3:return a.sent(),[3,6];case 2:if(!e.id)return[3,4];return[4,ey({variables:{id:e.id,changes:e}})];case 4:return[4,eh({variables:{objects:(0,o.Z)((0,i.Z)({},e),{jobId:null==O?void 0:O.id})}})];case 5:a.sent(),a.label=6;case 6:return[2]}})}),function(e){return h.apply(this,arguments)}),ex=function(e){var n=e.item?(0,i.Z)({},null==e?void 0:e.item):{markup:ea};(null==n?void 0:n.vat)&&(n.vat=String(n.vat)),z.show({content:(0,u.jsx)(K,{currency:f,defaultValues:n,entityId:x,submit:eg,serviceRateExpenses:ea,showRecurring:W}),title:"Expenses"})},eZ=function(e,n){e.preventDefault(),e.stopPropagation(),ev({variables:{id:n.item.id}})},ej=function(e){z.show({content:(0,u.jsx)(J.G,{entity:"Expenses",entityId:e.item.id}),submit:!1,title:"Media"})},eI=[{text:"Description"},{formatter:function(e){var n=e.row;return(0,_.Z)(n.total,f)},text:"Total"},{text:"Paid By"},{formatter:k.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return ex(n)},tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],numberOverlay:"mediaCount",onClick:function(e,n){return ej(n)},tooltip:"Media"},{context:"danger",icon:["fas","trash"],onClick:function(e,n){return eZ(e,n)},tooltip:"Delete"}],hidden:!et,text:"Actions"},{hidden:!0},{hidden:!0}],eS=function(){return(0,u.jsx)(D.Z,{children:(0,u.jsx)(T.Z,{context:"secondary",content:"Add",onClick:ex,size:"sm"})})},ew=function(){return(0,u.jsxs)(u.Fragment,{children:[!H&&(0,u.jsx)(A.Z,{content:"Expenses",tag:"h3"}),(0,u.jsxs)($.Z,{children:[(0,u.jsx)(q.Z,{md:6,children:(0,u.jsx)(P.Z,{content:"Total",text:(0,_.Z)(ep,f)})}),(0,u.jsx)(q.Z,{md:6,children:(0,u.jsx)(P.Z,{content:"VAT Total",text:(0,_.Z)(em,f)})})]}),(0,u.jsx)(E.Z,{columns:eI,loading:eu,rows:null==ec?void 0:ec.map(function(e){var n,t;return{description:e.description,total:e.total,paid:e.paid.charAt(0).toUpperCase()+e.paid.slice(1),actions:"",item:(0,i.Z)({},e,{occurredAt:new Date(e.occurredAt)},{categoryId:{label:null===(n=e.category)||void 0===n?void 0:n.name,value:e.categoryId}}),mediaCount:null===(t=e.media)||void 0===t?void 0:t.length}})}),et&&!H&&(0,u.jsx)(D.Z,{align:"flex-end",children:(0,u.jsx)(T.Z,{context:"secondary",content:"Add",onClick:ex,size:"sm"})})]})};return H?(0,u.jsx)(R.Z,{toolbar:et&&(0,u.jsx)(eS,{}),open:!0,title:"Expenses",children:ew()}):ew()};et.propTypes={currency:d.string,enableUpdate:d.bool,entity:d.string,entityId:d.number,job:d.object,jobs:(0,d.arrayOf)(d.object),refetchParent:d.func,tab:d.string,withDetails:d.bool},et.defaultProps={currency:"GBP",enableUpdate:!1,withDetails:!0,showRecurring:!1}},46169:function(e,n,t){"use strict";t.d(n,{E:function(){return o}});var a=t(26042),i=t(69396),o=function(e,n,t){var o=0,r=0,s=null==e?void 0:e.filter(function(e){return"supplier"===t&&"supplier"===e.paid||"supplier"!==t});return{preparedExpenses:null==s?void 0:s.map(function(e){var s=e.amount;"supplier"!==t&&(s+=e.markup/100*s,s/=1-n/100);var u=s*(e.unit||1),l=u+u*(e.vat/100);return r+=u,o+=l,(0,i.Z)((0,a.Z)({},e),{id:e.id,name:e.description,unitCost:s,price:u,total:l,unit:e.unit||1,vatAmount:u*(e.vat/100),vatRate:e.vat/100,markup:e.markup})}),totalExpenses:o,totalExpensesExVAT:r}}},8732:function(e,n,t){"use strict";t.d(n,{B:function(){return i}});var a=t(29815),i=function(e,n,t){if(!n)return null;var i,o=null===(i=(0,a.Z)(n).sort(function(e,n){return e.createdAt-n.createdAt}).find(function(n){return n.type===e}))||void 0===i?void 0:i.value;return o||0===o?o:t||0}},59002:function(e,n,t){"use strict";t.d(n,{K:function(){return a}});var a=function(e){var n,t,a,i,o,r,s=null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:n.frequency;return{isAnyTime:(null==e?void 0:null===(t=e.repeat)||void 0===t?void 0:null===(a=t[s.toLocaleLowerCase()])||void 0===a?void 0:a.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(i=e.repeat)||void 0===i?void 0:null===(o=i[s.toLocaleLowerCase()])||void 0===o?void 0:o.excludingWeekends}}},20823:function(e,n,t){"use strict";t.d(n,{p:function(){return u}});var a=t(29815),i=t(30381),o=t.n(i),r=t(81836),s=t(67574),u=function(e,n,t){var i=r.ZP.fromString(e),u=i.origOptions,l=u.freq,d=u.until,c=u.dtstart,m=o()(c),p=i.all();t&&(m.day()===s.p3.Saturday||m.day()===s.p3.Sunday)&&m.add(m.day()===s.p3.Saturday?2:1,"day");var v=1===o()(c).date(),h=m.isSame(c,"month");if(l===r.Di.MONTHLY&&n&&!v&&h){var y=d?(0,a.Z)(p):p.slice(0,-1);return y.unshift(m),y}return l===r.Di.YEARLY&&n?p.map(function(e,n){var a=o()(e);return n>0&&a.startOf("month"),t&&(a.day()===s.p3.Saturday||a.day()===s.p3.Sunday)&&a.add(a.day()===s.p3.Saturday?2:1,"day"),a}):p}},6538:function(e,n,t){"use strict";t.d(n,{e:function(){return o}});var a=t(29815),i=t(22244),o=function(e,n){var t=(0,a.Z)(null==e?void 0:e.timings).sort(function(e,n){return n.id-e.id});return Array.isArray(n)?t.find(function(e){var t=e.status;return i.yW.find(function(e){return e.value===t&&!n.includes(t)})}):t.find(function(e){var t=e.status;return i.yW.find(function(e){return e.value===t&&t!==n})})}},22595:function(e,n,t){"use strict";t.d(n,{E:function(){return a}});var a=function(e,n){if(Array.isArray(n)){var t,a=null;return n.forEach(function(n){var t,i=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});a=(null==i?void 0:i.createdAt)||a}),a}var i=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==i?void 0:i.createdAt)||null}},51809:function(e,n,t){"use strict";t.d(n,{$A:function(){return h},$E:function(){return y},A1:function(){return v},Un:function(){return p},yf:function(){return b},zg:function(){return f}});var a=t(7297),i=t(75063);function o(){var e=(0,a.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function r(){var e=(0,a.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return r=function(){return e},e}function s(){var e=(0,a.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,a.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,a.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=(0,a.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,a.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,a.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return m=function(){return e},e}(0,i.Ps)(o());var p=(0,i.Ps)(r()),v=(0,i.Ps)(s()),h=(0,i.Ps)(u()),y=(0,i.Ps)(l()),f=(0,i.Ps)(d());(0,i.Ps)(c());var b=(0,i.Ps)(m())},86267:function(e,n,t){"use strict";t.d(n,{G:function(){return O}});var a=t(26042),i=t(69396),o=t(85893),r=t(45697),s=t.n(r),u=t(6388),l=t(52824),d=t(15033),c=t(23892),m=t(39087),p=t(76256),v=t(40826),h=function(e,n){var t=function(){return(0,o.jsx)(v.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},a=function(){return(0,o.jsx)(v.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},i=function(){return(0,o.jsx)(v.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?(null==n?void 0:n.thumbnails)&&(null==n?void 0:n.thumbnails.length)?t:a:i},y=t(20705),f=t(2845),b=t(86532),g=t(22797),x=t(38895),Z=t(5616),j=t(11057),I=t(51233),S=t(21023),w=t(15861),C=t(14924),_=t(70872),k=t(58886),D=t(90948),T=t(67294),A=t(77314),$=(0,t(42850).bH)(A.ZP),q=function(e){var n=e.images,t=e.showPagination,i=e.height,r=(0,T.useState)(0),s=r[0],u=r[1],l=function(e){u(e)};return(0,o.jsxs)(I.Z,{width:"100%",alignItems:"center",children:[(0,o.jsx)($,{index:s,onChangeIndex:l,enableMouseEvents:!0,interval:1e4,children:n.map(function(e){return(0,o.jsx)(Z.Z,{component:"img",sx:{height:i,display:"block",overflow:"hidden",width:"100%",objectFit:"cover"},src:e.filename,alt:e.caption},e.caption)})}),t&&n.length>1&&(0,o.jsx)(P,{page:s+1,count:n.length,onChange:function(e,n){return l(n-1)},variant:"outlined",shape:"rounded",renderItem:function(e){return(0,o.jsx)(k.Z,(0,a.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})]})};q.defaultProps={images:[],showPagination:!0},q.propTypes={height:s().oneOfType([s().string,s().number]),images:s().arrayOf(s().shape({caption:s().string,filename:s().string.isRequired}).isRequired).isRequired,showPagination:s().bool};var P=(0,D.ZP)(_.Z)(function(e){e.hidePrevButton,e.hideNextButton;var n,t=e.theme;return n={},(0,C.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,C.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,C.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,C.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,C.Z)(n,"& button.Mui-selected",{color:t.palette.white.main,backgroundColor:t.palette.secondary.main}),n}),E=t(27434),R=t(5336),M=t(12547),J=t(64872),O=function(e){var n=e.carousel,t=e.category,r=e.data,s=e.entity,v=e.entityId,C=e.filters,_=e.listView,k=e.mediaMeta,D=e.onMediaAdd,T=e.onMediaRemove,A=e.showActionButtons,$=e.showEntityColumn,P=e.showItemActions,O=e.title,F=e.type,L=e.expanded,N=e.onChangeExpanded,H=e.hideExpandIcon,W=e.mediaFormProps,V=e.offCanvasProps,U=e.onlySingleMedia,z=e.elevation,G=e.accordionSx,B=e.refetch,Y=(0,y.x)({filters:C}),K=Y.initialData,Q=Y.ref,X=(0,f.x)(),ee=X.hasRole,en=X.user,et=(0,J.a)(),ea=(0,u.aM)(l.t,{variables:(0,i.Z)((0,a.Z)({},K),{entity:s,entityId:v,category:t,adminId:en.adminId,meta:k})}),ei=ea.data,eo=void 0===ei?{items:[],meta:{aggregate:{totalCount:0}}}:ei,er=eo.items,es=eo.meta,eu=ea.loading,el=ea.refetch,ed=function(e){et.close(),r.length||el();var n=e.map(function(e){return(0,i.Z)((0,a.Z)({},e),{link:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.filename)})});D&&D(n),B&&B()},ec=function(e){et.close(),r.length||el(),T&&T(e),B&&B()},em=function(e){e.stopPropagation(),et.show((0,a.Z)({content:(0,o.jsx)(p.z,(0,a.Z)({accept:"image/*",adminId:en.adminId,category:t,entity:s,entityId:v,expiryShow:!1,mediaMeta:k,multiple:!0,onSuccess:ed,type:"image"},W)),title:"Upload Photos"},V))},ep=function(e){e.stopPropagation(),et.show((0,a.Z)({content:(0,o.jsx)(p.z,(0,a.Z)({accept:".pdf, .doc, .docx, .xlsx",adminId:en.adminId,category:t,entity:s,entityId:v,expiryShow:!1,mediaMeta:k,onSuccess:ed,type:"document"},W)),title:"Upload Documents"},V))},ev=function(e){et.show({content:(0,o.jsx)(c.d,{mediaId:e.data.id,onSuccess:ec}),submit:!1,title:"Delete Media"})},eh=function(e){et.show({content:(0,o.jsx)(m.z,{media:e.data,toggleShow:et.close}),title:"Media Details",width:"50%"})},ey=function(e){return[{context:"primary",icon:"info",onClick:function(n){return eh(e)},tooltip:"Details"},{context:"danger",icon:"delete",onClick:function(n){return ev(e)},tooltip:"Delete"}]},ef=[{field:"file",headerName:"File",flex:1,sortable:!1,renderCell:function(e){var n=e.row,t=e.value;return(0,o.jsx)(M.r,{color:"secondary",onClick:function(e){e.preventDefault(),window.open("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(n.filename))},children:t})}},{field:"visibility",headerName:"Visible to",flex:1,sortable:!1},{hide:!$,field:"entity",headerName:"Entity",flex:1,sortable:!1},{field:"authority",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.value;return(0,o.jsx)(o.Fragment,{children:(null==n?void 0:n.adminOnly)&&(0,o.jsx)(S.Z,{title:"Admin user only",children:(0,o.jsx)(Z.Z,{component:"img",alt:"Admin Only",src:"/messaging/admin-only.svg",sx:{height:"24px"}})})})}},{field:"uploaded",headerName:"Uploaded by",flex:1,sortable:!1},{hide:!_,field:"thumbnails",headerName:"Thumbnails",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}},{hide:!P,field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.row;return ee("admin")?(0,o.jsx)(R.C,{actionsData:ey,row:n}):en.id===n.userId?(0,o.jsx)(R.C,{actionsData:ey,row:n}):null}}],eb=[],eg=er.filter(function(e){var n=e.item;return(null==n?void 0:n.visibility)&&ee(null==n?void 0:n.visibility)}).map(function(e){var n=e.entity,t=e.entityId,a=e.id,i=e.item,o=i.caption,r=i.filename,s=i.meta,u=i.name,l=i.type,d=i.user,c=i.visibility;return{data:i,id:a,userId:null==d?void 0:d.id,filename:r,visibility:c.join(", "),file:o||u||r,entity:n&&"".concat(n,"#").concat(t),authority:s,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:h(l,s),actions:""}}),ex=(er.filter(function(e){var n=e.item;return(null==n?void 0:n.visibility)&&ee(null==n?void 0:n.visibility)}).forEach(function(e){var n=e.item,t=n.caption,a=n.filename;"image"===n.type&&eb.push({caption:t,filename:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(a)})}),eb),eZ=ex.length;return(0,o.jsxs)(b.Z,{elevation:z,expanded:L,onChange:N,sx:G,children:[(0,o.jsx)(x.Z,(0,i.Z)((0,a.Z)({},H?{}:{expandIcon:(0,o.jsx)(E.Z,{})}),{children:(0,o.jsx)(w.Z,{variant:"h6",children:O})})),(0,o.jsxs)(g.Z,{children:[n&&eZ>0&&(0,o.jsx)(q,{height:"200px",images:ex}),(0,o.jsx)(d.i,{columns:ef,rows:eg,loading:eu,meta:es,ref:Q,refetch:el,columnVisibilityModel:{entity:$,thumbnails:_,actions:P}}),A&&!(U&&eg.length>0)&&(0,o.jsxs)(I.Z,{direction:"row",justifyContent:"center",spacing:2,mt:2,children:[(!F||"document"===F)&&(0,o.jsx)(j.Z,{variant:"contained",color:"secondary",onClick:ep,children:"Add Document"}),(!F||"image"===F||"avatar"===F)&&(0,o.jsxs)(j.Z,{variant:"contained",color:"secondary",onClick:em,children:["Add ",F?"".concat(F.charAt(0).toUpperCase()).concat(F.slice(1)):"Image"]})]})]})]})};O.propTypes={carousel:s().bool,category:s().string,data:s().array,entity:s().string,entityId:s().number,filters:s().object,listView:s().bool,mediaMeta:s().object,onMediaAdd:s().func,onMediaRemove:s().func,showActionButtons:s().bool,showEntityColumn:s().bool,showItemActions:s().bool,title:s().string,type:s().string,expanded:s().bool,onChangeExpanded:s().func,hideExpandIcon:s().bool,mediaFormProps:s().object,offCanvasProps:s().object,onlySingleMedia:s().bool,elevation:s().number,accordionSx:s().object,refetch:s().func},O.defaultProps={carousel:!0,data:[],filters:{},listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,title:"Media",type:null,onChangeExpanded:function(){},mediaFormProps:{},offCanvasProps:{},category:"media",onlySingleMedia:!1,elevation:1,accordionSx:{},refetch:function(){}}},26695:function(e,n,t){"use strict";t.d(n,{BH:function(){return w},Dn:function(){return x},UA:function(){return S},Vr:function(){return Z},_0:function(){return j},to:function(){return _},v8:function(){return I},yz:function(){return k},zn:function(){return C}});var a=t(7297),i=t(75063);function o(){var e=(0,a.Z)(["\n  query GetFinance($accountId: Int!) {\n    financial: Account_by_pk(id: $accountId) {\n      name\n      website\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        bank\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n    }\n  }\n"]);return o=function(){return e},e}function r(){var e=(0,a.Z)(["\n  mutation AddPaymentReceipt(\n    $object: AccountEntry_insert_input!\n    $jobIds: [Int]!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n    update_Job(where: { id: { _in: $jobIds } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,a.Z)(["\n  mutation UpdateAccountEntry($id: Int!, $changes: AccountEntry_set_input!) {\n    update_AccountEntry_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      meta\n      outstandingAmount\n      balance\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,a.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,a.Z)(["\n  query GetAccountEntries($where: AccountEntry_bool_exp, $accountId: Int, $locationId: Int) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      where: $where\n      args: { location_id: $locationId }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          sublocation: Sublocation {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n      reconciliations: InvoiceReconciliations_aggregate {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=(0,a.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n        }\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,a.Z)(["\n  query GetAccoutEntrySumByAccounntInJob($jobId: Int!, $accountId: Int!) {\n    accountEntryAggregate: AccountEntry_aggregate(\n      where: { Invoices: { Job: { id: { _eq: $jobId } } }, accountId: { _eq: $accountId } }\n    ) {\n      aggregate {\n        sum {\n          outstandingAmount\n        }\n      }\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,a.Z)(["\n  query GetJobMeta($id: Int!) {\n    job: Job(where: { id: { _eq: $id } }) {\n      id\n      meta\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,a.Z)(["\n  mutation UpdateJob($changes: Job_set_input, $ids: [Int]) {\n    update_Job(where: { id: { _in: $ids } }, _set: $changes) {\n      affected_rows\n    }\n  }\n"]);return p=function(){return e},e}function v(){var e=(0,a.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $insertTiming: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $timing) @include(if: $insertTiming) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return v=function(){return e},e}function h(){var e=(0,a.Z)(['\n  mutation DeletePayment($jobIds: [Int!], $timingStatuses: [String!], $paymentId: Int!) {\n    delete_JobTiming(where: { status: { _in: $timingStatuses }, jobId: { _in: $jobIds } }) {\n      returning {\n        id\n      }\n    }\n\n    delete_AccountEntry(\n      where: { type: { _in: ["paymentReceipt", "creditNote"] }, id: { _eq: $paymentId } }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n']);return h=function(){return e},e}function y(){var e=(0,a.Z)(['\n  query GetRelatedAccountEntries($accountEntryId: Int!) {\n    reconciliations: Reconciliation(\n      where: {\n        creditEntityId: { _eq: $accountEntryId }\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n      }\n    ) {\n      id\n      amount\n      createdAt\n      accountEntryPayment: PaymentEntry {\n        id\n      }\n      accountEntryInvoice: InvoiceEntry {\n        id\n        type\n        invoices: Invoices {\n          id\n          invoiceType\n          invoiceNumber\n          job: Job {\n            id\n            number\n            type\n            status\n            timings: JobTimings(order_by: { createdAt: desc }) {\n              id\n              status\n              createdAt\n            }\n          }\n        }\n      }\n    }\n  }\n']);return y=function(){return e},e}function f(){var e=(0,a.Z)(["\n  query GetRelatedInvoces($accountEntryId: Int!) {\n    invoices: Invoice(where: { accountEntryId: { _eq: $accountEntryId } }) {\n      id\n      invoiceNumber\n      Job {\n        id\n        number\n        type\n        status\n      }\n    }\n  }\n"]);return f=function(){return e},e}function b(){var e=(0,a.Z)(['\n  query GetCalendarJobs($customerId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        customerId: { _eq: $customerId }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return b=function(){return e},e}function g(){var e=(0,a.Z)(["\n  mutation AddCreditNote($object: AccountEntry_insert_input!) {\n    insert_AccountEntry_one(object: $object) {\n      id\n    }\n  }\n"]);return g=function(){return e},e}var x=(0,i.Ps)(o()),Z=(0,i.Ps)(r()),j=(0,i.Ps)(s()),I=(0,i.Ps)(u()),S=(0,i.Ps)(l()),w=(0,i.Ps)(d());(0,i.Ps)(c()),(0,i.Ps)(m()),(0,i.Ps)(p()),(0,i.Ps)(v());var C=(0,i.Ps)(h()),_=(0,i.Ps)(y()),k=(0,i.Ps)(f());(0,i.Ps)(b()),(0,i.Ps)(g())},66321:function(e,n,t){"use strict";t.d(n,{E:function(){return y}});var a=t(26042),i=t(69396),o=t(85893),r=t(45697),s=t.n(r),u=t(94054),l=t(50480),d=t(56815),c=t(40476),m=t(79717),p=t(36872),v=t(51233),h=t(15861),y=function(e){var n=e.label,t=e.options,r=e.error,s=e.helperText,y=e.stackProps,b=e.formControlProps,g=e.labelLeft,x=function(e){var n=e.children;return(0,o.jsx)(o.Fragment,{children:n})};return(0,o.jsxs)(u.Z,(0,i.Z)((0,a.Z)({sx:{m:3},error:r,variant:"standard"},void 0===b?{}:b),{children:[(0,o.jsxs)(v.Z,(0,i.Z)((0,a.Z)({},g&&f),{children:[n&&(0,o.jsx)(c.Z,{id:"radio-group",color:"secondary",children:n}),(0,o.jsx)(m.Z,(0,i.Z)((0,a.Z)({},e),{"aria-labelledby":"radio-group",children:(0,o.jsx)(v.Z,(0,i.Z)((0,a.Z)({},void 0===y?{}:y),{children:t.map(function(e){var n=e.value,t=e.label,a=e.icon,i=e.ParentComponent;return(0,o.jsx)(void 0===i?x:i,{children:(0,o.jsx)(l.Z,{value:n,control:(0,o.jsx)(p.Z,{color:"secondary"}),label:(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:1,children:[a,(0,o.jsx)(h.Z,{children:t})]})})})})}))}))]})),(0,o.jsx)(d.Z,{children:s})]}))};y.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},y.propTypes={label:s().string,options:s().arrayOf(s().shape({label:s().string.isRequired,value:s().any.isRequired,ParentComponent:s().elementType})).isRequired,error:s().bool,helperText:s().string,stackProps:s().object,formControlProps:s().object,labelLeft:s().bool};var f={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},16352:function(e,n,t){"use strict";var a=t(26042),i=t(69396),o=t(828),r=t(85893),s=t(50319),u=t(42283),l=t(51809),d=t(76600),c=t(49501),m=t(28497),p=t(51466),v=function(e){var n=e.defaultValues,t=e.location,v=e.offCanvas,h=e.refetch,y=(0,u.cI)({defaultValues:n}),f=y.errors,b=y.handleSubmit,g=y.register,x=(0,o.Z)((0,s.D)(l.zg,{onCompleted:function(e){h(),v.close()}}),1)[0],Z=function(e){var n,o=e.monthlyAmount,r=t.meta;x({variables:{id:t.id,changes:{meta:(0,i.Z)((0,a.Z)({},void 0===r?{}:r),{monthlyAmount:o})}}})};return(0,r.jsxs)(d.Z,{id:"offCanvasForm",handleSubmit:b(Z),children:[(0,r.jsx)(c.Z,{label:"Monthly amount",children:(0,r.jsx)(m.Z,{errors:f,name:"monthlyAmount",register:g,vat:"Ex VAT"})}),(0,r.jsx)(p.Z,{size:"xs",content:"Updating the monthly billing figure will overide any per item customer billing"})]})};n.Z=v},83075:function(e,n,t){"use strict";t.d(n,{BH:function(){return b},CH:function(){return Z},U$:function(){return f},WJ:function(){return j},k3:function(){return x},tf:function(){return g}});var a,i=t(47568),o=t(29815),r=t(97582),s=t(81836),u=t(10928),l=t.n(u),d=t(22595),c=t(30381),m=t.n(c),p=t(67574),v=t(20823),h=t(59002),y=t(25410),f=(a=(0,i.Z)(function(e){var n,t,a,i,s,u,l,d,c,f,b,g,x,Z,j,I,S,w,C,_,k,D,T,A,$,q;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if(n=e.addJobFunc,t=e.location,a=e.row,i=e.adminId,j=(Z=(0,h.K)(null==a?void 0:a.rruleMeta)).isAnyTime,I=Z.excludingWeekends,S=[],S=Array.isArray(a.dates)?a.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,v.p)(a.frequency,j,I),w=a.costCustomer,C=a.costSupplier,_=(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.id)||null,k=a.supplier.value,D=null==a?void 0:null===(u=a.rruleMeta)||void 0===u?void 0:null===(l=u.repeat)||void 0===l?void 0:l.frequency,T=null==a?void 0:null===(d=a.rruleMeta)||void 0===d?void 0:null===(c=d.repeat)||void 0===c?void 0:null===(f=c[D.toLocaleLowerCase()])||void 0===f?void 0:f.hourStart,A=null==a?void 0:null===(b=a.rruleMeta)||void 0===b?void 0:null===(g=b.repeat)||void 0===g?void 0:null===(x=g[D.toLocaleLowerCase()])||void 0===x?void 0:x.hourEnd,$=[],S.forEach(function(e){var n,r,s,u,l,d,c,v={access:t.access,adminId:i,amount:w,assetCategoryId:null===(n=a.assetCategory)||void 0===n?void 0:n.value,costCategoryId:a.costCategory.value,customerId:t.customer[0].account.id,customerUserId:_,description:a.description,jobScheduleId:a.id,locationId:t.id,sublocationId:null===(r=a.sublocation)||void 0===r?void 0:r.value,managerId:t.customer[0].account.managerId,pricing:"fixed",serviceId:a.service.value,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:C,timing:"at",timingStart:e,timingEnd:m()(e).endOf(p._f[D]),title:a.title,type:"ppm",reference:a.reference,reportPassFail:a.reportPassFail,reportPassFailTitle:a.reportPassFailTitle,requireReportRecommendations:a.requireReportRecommendations,anyTimeOption:j,hourStart:T?m()(T).format("HH:mm:ssZ"):null,hourEnd:A?m()(A).format("HH:mm:ssZ"):null,meta:{customerSignature:a.customerSignature,supplierSignature:a.supplierSignature},JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:k}]},Taxonomy:{data:[{entity:"Job",taxonomyId:a.shortDescription.value}].concat((0,o.Z)(a.tags?(0,y.O)(a.tags):[]))}};(null==a?void 0:null===(s=a.rruleMeta)||void 0===s?void 0:null===(u=s.repeat)||void 0===u?void 0:null===(l=u[D.toLocaleLowerCase()])||void 0===l?void 0:l.excludingWeekends)&&(v.timingEnd.day()===p.p3.Saturday||v.timingEnd.day()===p.p3.Sunday)&&v.timingEnd.subtract(p.Fs[v.timingEnd.day()],"day"),a.hasCompliance&&(null===(d=a.complianceSelect)||void 0===d?void 0:d.value)&&(v.Compliances={data:{complianceId:a.complianceSelect.value,entity:"Job",status:"active"}}),a.estimatedDuration&&a.estimatedDurationUnit&&(v.estimatedDuration=a.estimatedDuration,v.estimatedDurationUnit=a.estimatedDurationUnit),(null===(c=a.assetSelected)||void 0===c?void 0:c.length)>0&&(v.Assets={data:a.assetSelected.map(function(e){return{status:"active",assetId:e.value}})}),$.push(v)}),!((null==$?void 0:$.length)>0))return[3,2];return[4,n({variables:{adminId:i,objects:$}})];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(e){return a.apply(this,arguments)}),b=function(e){var n=e.scheduledJobs,t={},a={};return n.forEach(function(e){if(e.jobs&&e.jobs.length>0){var n=e.jobs.find(function(e){return new Date(e.timingStart)>new Date});!((null==n?void 0:n.timingStart)<(null==t?void 0:t.timingStart))&&(null==t?void 0:t.timingStart)||(t=n)}var i=s.Ci.fromString(e.frequency).all(),o=l()(i);(!a.date||o<(null==a?void 0:a.date))&&(a.date=o,a.name=e.meta.serviceName)}),{nextExpire:a,nextJob:t}},g=function(e){var n=e.frequency,t=e.cost;return s.Ci.fromString(n).all().length*t},x=function(e){var n,t=e.jobScheduleId,a=e.jobs;return a&&(n=a.filter(function(e){return e.jobScheduleId===t&&(0,d.E)(e,["reportSent","closed"])}).length),n||0},Z=function(e,n){var t=m()(e.timingStart);return t.isSameOrAfter(n.startDate)&&t.isSameOrBefore(n.endDate)},j=function(e){var n=e.assetSelected,t=void 0===n?[]:n,a=(e.compliance,e.service),i=void 0===a?[]:a,o=e.assetCategory,r=e.dateFilter,s={status:{_neq:"canceled"}};return(null==r?void 0:r.startDate)&&(null==r?void 0:r.endDate)&&(s.timingStart={_gte:r.startDate,_lte:r.endDate}),(null==t?void 0:t.length)>0&&(s.Assets={id:{_in:t.map(function(e){return e.value})}}),(null==i?void 0:i.length)>0&&(s.Service={id:{_in:i.map(function(e){return null==e?void 0:e.value})}}),(null==o?void 0:o.value)&&(s.AssetCategory={id:{_eq:null==o?void 0:o.value}}),s}},10546:function(e,n,t){"use strict";t.d(n,{B6:function(){return f},Ms:function(){return v},RV:function(){return h},YW:function(){return y},mJ:function(){return b}});var a=t(7297),i=t(75063);function o(){var e=(0,a.Z)(["\n  query GetAssetParents($ids: [Int!]!) {\n    asset: Asset(where: { id: { _in: $ids } }) {\n      id\n      name\n      parent: ParentAsset {\n        id\n        name\n        parent: ParentAsset {\n          id\n          name\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function r(){var e=(0,a.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule(where: { id: { _eq: $id } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,a.Z)(['\n  query GetJobSchedule($orderBy: JobSchedule_order_by!, $locationId: Int) {\n    JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: [$orderBy]) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      contract: JobScheduleContract {\n        name\n        invoiceDate\n        startDate\n        contractLength\n        contractValue\n        status\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings(order_by: { createdAt: desc }) {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return s=function(){return e},e}function u(){var e=(0,a.Z)(['\n  query GetJobSchedule($id: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $id) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        rag\n        title\n        timingStart\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n  }\n']);return u=function(){return e},e}function l(){var e=(0,a.Z)(['\n  query GetJobCompliance($locationId: Int!, $where: Job_bool_exp!) {\n    jobSchedule: JobSchedule(where: { locationId: { _eq: $locationId } }, order_by: { id: asc }) {\n      frequency\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      sublocation: Sublocation {\n        id\n        name\n      }\n      serviceName: meta(path: "$.serviceName")\n      costCustomer: meta(path: "$.costCustomer")\n      costSupplier: meta(path: "$.costSupplier")\n      frequency\n      jobs: Jobs(where: $where) {\n        id\n        rag\n        timingStart\n      }\n      totalJobs: Jobs_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n  }\n']);return l=function(){return e},e}function d(){var e=(0,a.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return d=function(){return e},e}function c(){var e=(0,a.Z)(["\n  query GetStatusLog($entity: String!, $entityId: Int!) {\n    statusLog: StatusLog(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      id\n      createdAt\n      notes\n      status\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,a.Z)(["\n  mutation AddJob($objects: [Job_insert_input!]!) {\n    insert_Job(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,a.Z)(["\n  mutation MyMutation($objects: [CreateJobInput]!, $adminId: Int!) {\n    createJob(adminId: $adminId, objects: $objects) {\n      data\n    }\n  }\n"]);return p=function(){return e},e}(0,i.Ps)(o());var v=(0,i.Ps)(r()),h=(0,i.Ps)(s());(0,i.Ps)(u());var y=(0,i.Ps)(l()),f=(0,i.Ps)(d());(0,i.Ps)(c()),(0,i.Ps)(m());var b=(0,i.Ps)(p())},67230:function(e,n,t){"use strict";t.d(n,{K:function(){return P}});var a=t(26042),i=t(69396),o=t(828),r=t(7297),s=t(85893),u=t(67294),l=t(45697),d=t(16391),c=t(73359),m=t(10546),p=t(52019),v=t(16551),h=t(97303),y=t(77439),f=t(11585),b=t(11717),g=t(51466),x=t(40826),Z=t(11082),j=t(42283),I=t(76600),S=t(90951),w=t(66812),C=t(18586),_=function(e){var n,t,o=e.defaultValues,r=e.setScheduleFilters,u=e.toggleShow,l=(0,C.q)(),d=null==l?void 0:null===(n=l.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,c=(0,j.cI)({defaultValues:o}),m=c.control,p=c.errors,v=c.handleSubmit,h=c.register,y=(0,c.watch)("assetCategory",null==o?void 0:o.assetCategory),f={control:m,errors:p,register:h},b=function(e){r(function(){return(0,a.Z)({},e)}),u()};return(0,s.jsxs)(I.Z,{id:"offCanvasForm",handleSubmit:v(b),children:[(0,s.jsx)(S.Z,(0,i.Z)((0,a.Z)({},f),{name:"compliance",data:[{id:"yes",label:"Yes",value:!0},{id:"no",label:"No",value:!1}],legend:"Compliance"})),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.P,(0,i.Z)((0,a.Z)({},f),{label:"Asset category",locationId:location.id,name:"assetCategory",type:"assetCategory"})),y&&(0,s.jsx)(w.P,(0,i.Z)((0,a.Z)({},f),{label:"Assets",locationId:location.id,name:"assetSelected",type:"asset",isMulti:!0,assetCategoryId:(null==y?void 0:y.value)||null}))]}),(0,s.jsx)(w.P,(0,i.Z)((0,a.Z)({},f),{errors:(0,a.Z)({},p),isMulti:!0,label:"Service",name:"service",type:"service"}))]})};_.propTypes={defaultValues:l.object};var k=t(83075),D=t(10367),T=t(64872),A=t(83985);function $(){var e=(0,r.Z)(["\n  width: 100%;\n  text-align: left;\n  display: flex;\n  column-gap: 10px;\n"]);return $=function(){return e},e}function q(){var e=(0,r.Z)(["\n  width: 50%;\n"]);return q=function(){return e},e}var P=function(e){var n=e.clickable,t=e.handleHistory,r=e.locationId,l=(e.showDetails,e.refetchSchedule),j=e.setRefetchSchedule,I=(e.setR,e.customerDetails),S=e.supplierDetails,w=(0,d.useMainContext)(),C=w.setJobScheduleForToolbar,D=w.scheduleFilters,$=w.setScheduleFilters,q=(0,T.a)(),P=(0,u.useContext)(p.Z).hasRole,M=function(e,n,a){var i=e.e,o=e.row;i.stopPropagation();var r=D.mode;"string"!=typeof(null==o?void 0:o.id)&&t(o,r,a)},J=(0,o.Z)((0,c.t)(m.YW),2),O=J[0],F=J[1],L=F.data,N=(void 0===L?{jobSchedule:[]}:L).jobSchedule,H=void 0===N?[]:N,W=F.refetch;(0,u.useEffect)(function(){C(H)},[H,C]),(0,u.useEffect)(function(){D&&O({variables:{locationId:r,where:(0,k.WJ)((0,a.Z)({},D))}})},[O,r,D]),(0,u.useEffect)(function(){l&&($(!1),j(!1),W())},[W,l,j,$]);var V=function(e){e.stopPropagation(),q.show({content:(0,s.jsx)(_,{defaultValues:D,toggleShow:q.close,setScheduleFilters:$}),title:"Filter"})},U=function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(h.Z,{border:!1,passHref:!0,to:"/reports/ppm/schedule?locationId=".concat(r),children:(0,s.jsx)(y.Z,(0,i.Z)((0,a.Z)({},e),{startIcon:"file-pdf"}))}),(0,s.jsx)(y.Z,(0,i.Z)((0,a.Z)({},e),{onClick:V,startIcon:"filter"}))]})};return(0,s.jsx)(f.Z,{fitParentHeight:!0,open:!0,title:"Schedule",toolbar:(0,s.jsx)(U,{}),children:(0,s.jsx)(b.Z,{dataSource:H,events:"jobs",eventTimeSplitting:"timingStart",flag:"rag",handleClick:n?M:null,handleFetchData:function(e,n){var t=e.startDate,o=e.endDate;$(function(e){return(0,i.Z)((0,a.Z)({},e),{dateFilter:{startDate:t,endDate:o},mode:n})})},hiddenColumn:["frequency","id","title","description","sublocation","costCustomer","costSupplier","serviceName","jobs"],initialMode:"year",onTitleFormatter:function(e){var n=e.row;return(0,s.jsxs)(E,{children:[(0,s.jsxs)(R,{children:[(0,s.jsxs)(g.Z,{size:"sm",children:[n.compliance&&(0,s.jsx)(x.Z,{context:"info",icon:"clipboard-check"}),n.serviceName]}),n.costCustomer&&P("customer")&&(0,s.jsx)(g.Z,{size:"xs",children:(0,Z.Z)(n.costCustomer)}),n.costSupplier&&P("supplier")&&(0,s.jsx)(g.Z,{size:"xs",children:(0,Z.Z)(n.costSupplier)}),n.costCustomer&&P("admin")&&n.costCustomer&&I&&(0,s.jsxs)(g.Z,{size:"xs",children:["Customer: ",(0,Z.Z)(n.costCustomer)]}),n.costSupplier&&P("admin")&&S&&n.costSupplier&&(0,s.jsxs)(g.Z,{size:"xs",children:["Supplier: ",(0,Z.Z)(n.costSupplier)]})]}),(0,s.jsxs)(R,{children:[(0,s.jsx)(g.Z,{size:"sm",children:n.title}),(0,s.jsx)(A.O,{maxLength:40,children:n.description}),n.sublocation&&(0,s.jsxs)(g.Z,{size:"xs",children:["Sublocation: ",n.sublocation.name]})]})]})},title:"serviceName"})})};P.propTypes={clickable:l.bool,handleHistory:l.func,locationId:l.number,showDetails:l.bool},P.defaultProps={clickable:!0,showDetails:!0};var E=D.ZP.div.withConfig({displayName:"schedule__StyledContainer",componentId:"sc-a1ebbf5c-0"})($()),R=D.ZP.div.withConfig({displayName:"schedule__StyledItem",componentId:"sc-a1ebbf5c-1"})(q())},40234:function(e,n,t){"use strict";t.d(n,{I:function(){return i}});var a=t(77349),i=function(e){var n,t,i,o,r,s,u,l,d,c=e.job,m=e.type,p=e.invoiceDate,v=parseInt(null===(n=c.admin)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(i=t.finance)||void 0===i?void 0:i.invoiceDueDate)||30;return"customer"===m&&(v=parseInt(null===(o=c.customer)||void 0===o?void 0:null===(r=o.meta)||void 0===r?void 0:null===(s=r.finance)||void 0===s?void 0:s.invoiceDueDate)||parseInt(null===(u=c.admin)||void 0===u?void 0:null===(l=u.meta)||void 0===l?void 0:null===(d=l.finance)||void 0===d?void 0:d.invoiceDueDate)||30),(0,a.Z)(new Date(p),v)}},56063:function(e,n,t){"use strict";t.d(n,{$:function(){return u}});var a,i=t(47568),o=t(97582),r=t(63139),s=t(13777),u=(a=(0,i.Z)(function(e){var n;return(0,o.__generator)(this,function(t){switch(t.label){case 0:return(0,r.a)()||(n=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){var t,a,i;null==n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),(null==window?void 0:null===(a=window.Capacitor)||void 0===a?void 0:null===(i=a.Plugins)||void 0===i?void 0:i.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,s.Tb)({message:e,section:"fetch"})})];case 1:return t.sent(),[2]}})}),function(e){return a.apply(this,arguments)})},15033:function(e,n,t){"use strict";t.d(n,{i:function(){return w}});var a=t(14924),i=t(26042),o=t(69396),r=t(85893),s=t(67294),u=t(11163),l=t(45697),d=t.n(l),c=t(61870),m=t(5616),p=t(51233),v=t(15861),h=t(90948),y=t(41796),f=t(29217),b=t(45111),g=t(46003),x=t(70872),Z=t(58886),j=t(61730),I=function(e){var n=e.currentPage,t=e.totalCount,a=e.pageSize,o=e.onPageChange,s=(0,j.Z)("(max-width:400px)"),u=(0,j.Z)("(max-width:500px)");return(0,r.jsx)(S,{mb:2,page:n,count:Math.ceil(t/a),onChange:function(e,n){return o(n)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===n,hideNextButton:n===Math.ceil(t/a),siblingCount:u?0:1,renderItem:function(e){return(0,r.jsx)(Z.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};I.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},I.propTypes={currentPage:d().number,totalCount:d().number,pageSize:d().number,onPageChange:d().func};var S=(0,h.ZP)(x.Z)(function(e){var n,t=e.hidePrevButton,o=e.hideNextButton,r=e.theme;return n={},(0,a.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,a.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,a.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,a.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,a.Z)(n,"& button.Mui-selected",(0,i.Z)({color:r.palette.white.main,backgroundColor:r.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},t?{borderRadius:"5px 0 0 5px"}:{})),n}),w=(0,s.forwardRef)(function(e,n){var t=e.columns,a=e.history,o=e.initialSort,l=e.meta,d=e.refetch,c=e.paginationSize,m=e.containerHeight,h=e.noResultsMessage,y=e.autoHeight,x=(0,u.useRouter)(),Z=x.query,j=void 0===Z?{}:Z,S=(0,s.useState)(parseInt(null==j?void 0:j.page,10)||1),w=S[0],k=S[1],D=(0,s.useState)(c||g.C1.paginationSize),T=D[0],A=D[1];o||(o={item:"createdAt",order:"desc"});var $=(0,s.useState)({item:o.item,order:o.order}),q=$[0],P=$[1],E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=x.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var a=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(a)},R=function(){P({item:o.item,order:o.order}),k(1);var e=E();x.push(e),A(c||g.C1.paginationSize)};(0,s.useImperativeHandle)(n,function(){return{currentPage:w,pageSize:T,sort:q,resetPagination:function(){R()}}});var M=function(e){var n=E(e);a&&x.push(n),k(e),!a&&d&&d()},J=function(e){e&&e.field&&e.sort?(P({item:t.find(function(n){return n.field===e.field}).sortName||e.field||e.item||o.item,order:e.sort||e.order||o.order}),d&&d()):(P({item:o.item,order:o.order}),d&&d())};return(0,r.jsxs)(C,{containerHeight:m,children:[(0,r.jsx)(_,(0,i.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:y,sortingMode:"server",onSortModelChange:function(e){return J(e[0])},columns:t,pageSize:T,slots:{columnSortedAscendingIcon:function(){return(0,r.jsx)(f.Z,{})},columnSortedDescendingIcon:function(){return(0,r.jsx)(b.Z,{})},columnUnsortedIcon:function(){return(0,r.jsxs)(p.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,r.jsx)(f.Z,{sx:{marginBottom:"-15px"}}),(0,r.jsx)(b.Z,{})]})},noResultsOverlay:function(){return(0,r.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,r.jsx)(v.Z,{children:h})})},noRowsOverlay:function(){return(0,r.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,r.jsx)(v.Z,{children:h})})}}},e)),l&&Math.ceil(l.aggregate.totalCount/T)>1&&(0,r.jsx)(I,{currentPage:w,totalCount:l.aggregate.totalCount,pageSize:T,onPageChange:M})]})});w.propTypes={history:d().bool,initialSort:d().object,loading:d().bool,meta:d().object,refetch:d().func,paginationSize:d().number,noResultsMessage:d().string,columns:d().array.isRequired,rows:d().array.isRequired,autoHeight:d().bool},w.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var C=(0,h.ZP)(m.Z)(function(e){return{height:e.containerHeight,display:"flex",flexDirection:"column"}}),_=(0,h.ZP)(c.s)(function(e){var n,t=e.theme,r=e.hideHeader,s=(e.rows,e.loading,e.rowHeight),u=e.isPdf;return n={"--DataGrid-overlayHeight":"40px"},(0,a.Z)(n,"&.MuiDataGrid-root",(0,i.Z)({color:t.palette.black.main,border:"none"},u&&{"@media print":{display:"block"}})),(0,a.Z)(n,"& .MuiDataGrid-main",(0,i.Z)({},u&&{"@media print":{overflow:"visible !important"}})),(0,a.Z)(n,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,i.Z)({},r&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,a.Z)(n,"& .MuiDataGrid-virtualScroller",(0,i.Z)({},r&&{marginTop:"0 !important"},u&&{"@media print":{overflow:"visible !important"}})),(0,a.Z)(n,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,a.Z)(n,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,a.Z)(n,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,a.Z)(n,"& .MuiDataGrid-virtualScrollerContent",(0,i.Z)({},u&&{height:"initial !important",minHeight:"initial !important"})),(0,a.Z)(n,"& .MuiDataGrid-virtualScrollerRenderZone",(0,i.Z)({},u&&{position:"relative"})),(0,a.Z)(n,"& .MuiDataGrid-overlayWrapper",(0,a.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,a.Z)(n,"& .MuiDataGrid-row",(0,i.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,a.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,i.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,a.Z)(n,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),n})},89256:function(e,n,t){"use strict";t.d(n,{n:function(){return q}});var a=t(47568),i=t(26042),o=t(69396),r=t(828),s=t(29815),u=t(97582),l=t(85893),d=t(45697),c=t.n(d),m=t(96486),p=t(6388),v=t(50319),h=t(11961),y=t(93362),f=t(23776),b=t(5616),g=t(98456),x=t(93946),Z=t(78462),j=t(18972),I=t(14564),S=t(51233),w=t(50135),C=t(67294),_=t(10166),k=t(2845),D=t(28864),T=t(51738),A=t(11975),$=(0,y.D)(),q=function(e){var n=e.entityId,t=e.entity,d=e.values,c=void 0===d?[]:d,y=e.name,I=void 0===y?"tags":y,_=e.setValue,q=(0,k.x)().user,E=(0,C.useState)(null),R=E[0],M=E[1],J=(0,C.useState)(""),O=J[0],F=J[1],L=(0,C.useState)(""),N=L[0],H=L[1],W=(0,C.useState)(""),V=W[0],U=W[1],z=(0,p.aM)(T.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){_(I,e.tags)}}),G=z.data,B=(void 0===G?{tags:[]}:G).tags,Y=z.loading,K=z.refetch,Q=(0,p.aM)(T.gI,{skip:!R,variables:{entityId:n,entity:t,q:""!==V?"%".concat(V,"%"):null}}),X=Q.data,ee=(void 0===X?{tags:[]}:X).tags,en=Q.loading,et=(0,r.Z)((0,v.D)(T.Zm,{refetchQueries:["GetAllTags"]}),2),ea=et[0],ei=et[1].loading,eo=(0,r.Z)((0,v.D)(T.LE,{onCompleted:function(){K()}}),2),er=eo[0],es=eo[1].loading,eu=(0,r.Z)((0,v.D)(T.cS,{onCompleted:function(){K()}}),2),el=eu[0],ed=eu[1].loading,ec=(0,r.Z)((0,v.D)(T.g$,{refetchQueries:["GetAllTags"]}),2),em=ec[0],ep=ec[1].loading;(0,C.useEffect)(function(){var e=setTimeout(function(){U(N)},500);return function(){return clearTimeout(e)}},[N]);var ev,eh,ey,ef=function(e){e.stopPropagation(),M(e.currentTarget)},eb=function(){M(null)},eg=(ev=(0,a.Z)(function(e,a){var i,o,r;return(0,u.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof a)return[3,1];return F({label:a}),[3,6];case 1:if(!(a&&a.inputValue&&n))return[3,2];return er({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:a.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:q.adminId}}}]}}),F(null),[3,6];case 2:if(!(a&&a.value&&n))return[3,3];return er({variables:{objects:[{entity:t,entityId:n,taxonomyId:a.value}]}}),F(null),[3,6];case 3:if(!(a&&a.inputValue))return[3,5];return[4,ea({variables:{objects:[{type:"tags",status:"active",name:a.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:q.adminId}]}})];case 4:return r=e.sent().data.insert_Taxonomy,_(I,(0,s.Z)(c).concat([{id:null,tag:{id:r.returning[0].id,name:r.returning[0].name,meta:r.returning[0].meta}}])),F(null),[3,6];case 5:a&&a.value&&(_(I,(0,s.Z)(c).concat([{id:null,tag:{id:a.value,name:a.label,meta:a.meta}}])),F(null)),e.label=6;case 6:return[2]}})}),function(e,n){return ev.apply(this,arguments)}),ex=(0,C.useCallback)(function(e,n){var t=$(e,n),a=n.inputValue,i=e.some(function(e){return a===e.label});return""===a||i||t.push({inputValue:a,label:'Add "'.concat(a,'"')}),t},[]),eZ=(0,C.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ej=function(e){n?el({variables:{tagEntityId:e}}):_(I,c.filter(function(n,t){return t!==e}))},eI=(eh=(0,a.Z)(function(e){var n,t,a,r,s,l;return(0,u.__generator)(this,function(t){switch(t.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=t.sent().data.update_Taxonomy_by_pk,_(I,c.map(function(e){return e.tag.id===n?(0,o.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return eh.apply(this,arguments)}),eS=(ey=(0,a.Z)(function(e){var n,t,a,r,s,l;return(0,u.__generator)(this,function(a){switch(a.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return s=a.sent().data.update_Taxonomy_by_pk,_(t,c.map(function(e){return e.tag.id===n?(0,o.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return ey.apply(this,arguments)}),ew=Boolean(R),eC=(0,C.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),e_=(0,C.useMemo)(function(){return m.uniqBy((0,s.Z)(B).concat((0,s.Z)(c)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[B,c]);return(0,l.jsxs)(S.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(A.P,{tags:e_,handleDeleteTagEntity:ej}),(0,l.jsx)(P,{id:ew?"tags-popover":void 0,open:ew,anchorEl:R,onClose:eb,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,l.jsxs)(b.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,l.jsx)(f.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eC),value:O,onChange:eg,onInputChange:function(e,n){H(n)},filterOptions:ex,getOptionLabel:eZ,renderOption:function(e,n){return(0,l.jsx)(j.Z,(0,o.Z)((0,i.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,l.jsx)(w.Z,(0,o.Z)((0,i.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,o.Z)((0,i.Z)({},e.InputProps),{endAdornment:(0,l.jsxs)(l.Fragment,{children:[en||ei||es?(0,l.jsx)(g.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),Y||ed||ep?(0,l.jsx)(S.Z,{width:"100%",alignItems:"center",p:4,children:(0,l.jsx)(g.Z,{color:"secondary"})}):(0,l.jsx)(Z.Z,{children:null==e_?void 0:e_.map(function(e,n){var t;return(0,l.jsx)(D.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:ej,onColorChange:eI,onNameChange:eS})})})]})}),(0,l.jsx)(x.Z,{color:"black",onClick:ef,children:(0,l.jsx)(h.Z,{sx:{height:"16px",width:"16px"}})})]})};q.defaultProps={entityId:null},q.propTypes={entityId:c().number};var P=(0,_.Z)(I.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},25410:function(e,n,t){"use strict";t.d(n,{O:function(){return a}});var a=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})}},42575:function(e,n,t){"use strict";t.d(n,{Im:function(){return m},RQ:function(){return h},X4:function(){return f},fC:function(){return y},mW:function(){return p},ze:function(){return v}});var a=t(7297),i=t(75063);function o(){var e=(0,a.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n']);return o=function(){return e},e}function r(){var e=(0,a.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,a.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,a.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,a.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=(0,a.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,a.Z)(["\n  query GetSlasForTemplate($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    slas: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      id\n      label: name\n      subtype\n      notes\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n    }\n  }\n"]);return c=function(){return e},e}var m=(0,i.Ps)(o());(0,i.Ps)(r());var p=(0,i.Ps)(s()),v=(0,i.Ps)(u()),h=(0,i.Ps)(l()),y=(0,i.Ps)(d()),f=(0,i.Ps)(c())},32749:function(e,n,t){"use strict";t.d(n,{l:function(){return v}});var a=t(26042),i=t(69396),o=t(99534),r=t(85893),s=t(67294),u=t(45697),l=t(6388),d=t(42575),c=t(49501),m=t(84043),p=function(e,n){var t,a,i,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(a=n.errors[n.name])||void 0===a?void 0:a.message)&&(o=!1),["name","type"].forEach(function(t){e[t]!==n[t]&&(o=!1)}),o},v=(0,s.memo)(function(e){var n,t,s,u=e.control,p=e.errors,v=e.label,h=e.name,y=e.register,f=e.type,b=e.filters,g=(0,o.Z)(e,["control","errors","label","name","register","type","filters"]),x=(s=(void 0===(t=(0,l.aM)(d.Im,{variables:(0,i.Z)((0,a.Z)({isGroup:"assetCategory"===f},b),{orderBy:{name:"asc"},type:f})}).data)?{taxonomy:[]}:t).taxonomy,"assetCategory"===f?s.map(function(e){return{label:e.name,options:e.options,childs:e.childs,meta:e.meta}}):s.map(function(e){return{label:e.name,value:e.id,childs:e.childs,meta:e.meta}}));return(0,r.jsx)(c.Z,{id:h,label:v,children:(0,r.jsx)(m.Z,(0,a.Z)((0,i.Z)((0,a.Z)({},{control:u,errors:p,register:y}),{cacheOptions:!0,isClearable:!0,options:x,name:h}),g))})},p);v.propTypes={control:u.object.isRequired,errors:u.object.isRequired,label:u.string.isRequired,filters:u.object,type:(0,u.oneOf)(["assetCategory","expenseCategory","jobTags","costCategory","clientType","tags"])},v.defaultProps={filters:{}}},97871:function(e,n,t){"use strict";t.d(n,{a:function(){return a},e:function(){return i}});var a=[{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"4",value:"4"},{text:"5",value:"5"},{text:"6",value:"6"},{text:"7",value:"7"},{text:"8",value:"8"},{text:"9",value:"9"},{text:"10",value:"10"},{text:"11",value:"11"},{text:"12",value:"12"},{text:"13",value:"13"},{text:"14",value:"14"},{text:"15",value:"15"},{text:"16",value:"16"},{text:"17",value:"17"},{text:"18",value:"18"},{text:"19",value:"19"},{text:"20",value:"20"},{text:"21",value:"21"},{text:"22",value:"22"},{text:"23",value:"23"},{text:"24",value:"24"},{text:"25",value:"25"},{text:"26",value:"26"},{text:"27",value:"27"},{text:"28",value:"28"},{text:"29",value:"29"},{text:"30",value:"30"},{text:"31",value:"31"}],i=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"},{label:"8",value:"8"},{label:"9",value:"9"},{label:"10",value:"10"},{label:"11",value:"11"},{label:"12",value:"12"},{label:"13",value:"13"},{label:"14",value:"14"},{label:"15",value:"15"},{label:"16",value:"16"},{label:"17",value:"17"},{label:"18",value:"18"},{label:"19",value:"19"},{label:"20",value:"20"},{label:"21",value:"21"},{label:"22",value:"22"},{label:"23",value:"23"},{label:"24",value:"24"},{label:"25",value:"25"},{label:"26",value:"26"},{label:"27",value:"27"},{label:"28",value:"28"},{label:"29",value:"29"},{label:"30",value:"30"},{label:"31",value:"31"}]},67574:function(e,n,t){"use strict";t.d(n,{$9:function(){return c},$i:function(){return f},CM:function(){return i},Fs:function(){return x},HG:function(){return m},Ib:function(){return a},Ic:function(){return v},MF:function(){return o},_f:function(){return u},c7:function(){return h},e6:function(){return d},jT:function(){return l},p3:function(){return g},pH:function(){return p},qG:function(){return y},um:function(){return s},ut:function(){return b},y7:function(){return r}});var a=[{id:"anyTimeOption",label:"any time",value:"anyTimeOption"}],i=[{id:"anyTimeOption",label:"any time (during month)",value:"anyTimeOption"}],o=[{id:"excludingWeekends",label:"excluding weekends",value:!0}],r=[{text:"Yearly",value:"Yearly"},{text:"Monthly",value:"Monthly"},{text:"Weekly",value:"Weekly"},{text:"Daily",value:"Daily"},{text:"Hourly",value:"Hourly"}],s=[{label:"Yearly",value:"Yearly"},{label:"Monthly",value:"Monthly"},{label:"Weekly",value:"Weekly"},{label:"Daily",value:"Daily"},{label:"Hourly",value:"Hourly"}],u={Yearly:"month",Monthly:"month",Weekly:"isoWeek",Daily:"day"},l=[{id:"on",label:"on",value:"on"}],d=[{id:"onThe",label:"on the",value:"on the"}],c=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],m=[{label:"First",value:"First"},{label:"Second",value:"Second"},{label:"Third",value:"Third"},{label:"Fourth",value:"Fourth"},{label:"Last",value:"Last"}],p=[{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Day",value:"Day"},{text:"Weekday",value:"Weekday"},{text:"Weekend day",value:"Weekend day"}],v=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Day",value:"Day"},{label:"Weekday",value:"Weekday"},{label:"Weekend day",value:"Weekend day"}],h=[{id:"on",label:"on day",value:"on"}],y=[{id:"onThe",label:"on the",value:"on the"}],f=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],b=[{text:"After",value:"After"},{text:"On date",value:"On date"}],g={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},x={0:2,6:1}},98552:function(e,n,t){"use strict";t.d(n,{SR:function(){return r},Tq:function(){return s},YK:function(){return o},cJ:function(){return i},pX:function(){return a}});var a=["customerVat","supplier"],i=["ProformaInvoiceCustomer","ProformaInvoiceSupplier"],o=["customerPpmInvoice","supplierPpmInvoice"],r={customer:["customerVat","ProformaInvoiceCustomer","customerPpmInvoice"],supplier:["supplier","ProformaInvoiceSupplier","supplierPpmInvoice"]},s={customerVat:"Customer VAT Invoice",supplier:"Supplier Invoice",ProformaInvoiceCustomer:"Customer ad-hoc Invoice",ProformaInvoiceSupplier:"Supplier ad-hoc Invoice",customerPpmInvoice:"PPM Customer Invoice",supplierPpmInvoice:"PPM Supplier Invoice"}},89331:function(e,n,t){"use strict";t.d(n,{e7:function(){return a},lb:function(){return i},uJ:function(){return o}});var a=[{text:"Month",value:""},{text:"Jan",value:"Jan"},{text:"Feb",value:"Feb"},{text:"Mar",value:"Mar"},{text:"Apr",value:"Apr"},{text:"May",value:"May"},{text:"Jun",value:"Jun"},{text:"Jul",value:"Jul"},{text:"Aug",value:"Aug"},{text:"Sep",value:"Sep"},{text:"Oct",value:"Oct"},{text:"Nov",value:"Nov"},{text:"Dec",value:"Dec"}],i=[{label:"Jan",value:"Jan"},{label:"Feb",value:"Feb"},{label:"Mar",value:"Mar"},{label:"Apr",value:"Apr"},{label:"May",value:"May"},{label:"Jun",value:"Jun"},{label:"Jul",value:"Jul"},{label:"Aug",value:"Aug"},{label:"Sep",value:"Sep"},{label:"Oct",value:"Oct"},{label:"Nov",value:"Nov"},{label:"Dec",value:"Dec"}],o=[{label:"January",value:"january"},{label:"February",value:"february"},{label:"March",value:"march"},{label:"April",value:"april"},{label:"May",value:"may"},{label:"June",value:"june"},{label:"July",value:"july"},{label:"August",value:"august"},{label:"September",value:"september"},{label:"October",value:"october"},{label:"November",value:"november"},{label:"December",value:"december"}]},51819:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ae}});var a=t(85893),i=t(11163),o=t.n(i),r=t(67294),s=t(6388),u=t(41085),l=t(9270),d=t(62140),c=t(45697),m=t.n(c),p=t(11585),v=t(8500),h=t(71225),y=t(30016),f=t(4380),b=t(1306),g=t(76225),x=t(85113),Z=t(2845),j=function(e){var n,t,i,o,r,s,u,c,m,j,I=e.tenant,S=e.refetch,w=e.location,C=(0,Z.x)().hasRole,_=(0,x.WE)(w,"registered"),k=w.createdAt;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.Z,{children:(0,a.jsxs)(d.Z,{md:4,children:[(0,a.jsx)(f.g,{avatar:(0,h.Q)(null===(n=w.customer[0].account)||void 0===n?void 0:n.media),entity:{id:w.id,description:w.customer[0].account.name,name:I.fullName||"Not Specified"},entityName:"Tenant"}),(0,a.jsx)(g.J,{data:{accountName:null,country:null==_?void 0:null===(t=_.address)||void 0===t?void 0:null===(i=t.country)||void 0===i?void 0:i.name,createdAt:k,fullName:null==I?void 0:I.fullName,position:null==I?void 0:I.position,phone:null==I?void 0:I.phone,xeroContactId:null===(o=w.customer)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(s=r.account)||void 0===s?void 0:null===(u=s.meta)||void 0===u?void 0:u.xeroContactId}}),(0,a.jsx)(p.Z,{title:"Contact",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(v.Z,{rows:[{key:"Name",value:"".concat(I.nameFirst," ").concat(I.nameLast)},{key:"Phone",value:I.phone},{key:"Email",value:I.email}]}),(0,a.jsx)("br",{})]})}),I&&(0,a.jsx)(b.f,{address:null===(m=null===(c=null==I?void 0:I.booking[0])||void 0===c?void 0:c.location.addresses[0])||void 0===m?void 0:m.address,entity:"Account",entityId:null==I?void 0:I.id,id:null==I?void 0:I.id,refetch:S,title:"Registered Address",type:"registered"}),C("admin")&&(0,a.jsx)(y.E,{entity:"Account",entityId:I.id,open:!0,title:"Notes"})]})})})};j.propTypes={tenant:c.object.isRequired};var I=t(7297),S=t(75063);function w(){var e=(0,I.Z)(['\n  query GetTenant($id: Int!) {\n    tenant: User_by_pk(id: $id) {\n      email\n      fullName\n      id\n      phone\n      invoiceThreshold\n      meta\n      nameFirst\n      nameLast\n      booking: TenantBookings {\n        id\n        location: Location {\n          name\n          id\n          addresses: Addresses {\n            address: Address {\n              geo\n              id\n              invoicingEntity\n              name\n              county\n              addressLine1\n              addressLine2\n              addressLine3\n              postCode\n              city\n            }\n          }\n          customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n            account: Account {\n              id\n              companyNumber\n              createdAt\n              name\n              status\n              type\n              updatedAt\n              website\n              clientType\n              managerId\n              vatId\n              meta\n              media: Media {\n                id\n                medium: Medium {\n                  id\n                  category\n                  filename\n                  meta\n                  type\n                }\n              }\n              manager: Manager {\n                id\n                fullName\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n']);return w=function(){return e},e}var C=(0,S.Ps)(w()),_=t(8059),k=t(28184),D=t(66264),T=t(10925),A=t(17974),$=t(10367),q=t(86036),P=t(97303),E=t(26186),R=t(77439),M=t(11082),J=t(24588),O=t(26042),F=t(69396),L=t(16391),N=t(10546),H=t(16551),W=t(41564),V=t(51466),U=t(68956),z=t(15214),G=t(11587),B=t(91272),Y=t(44123),K=t(81680),Q=t(11383),X=t(22713),ee=t(64872),en=function(e){var n,t,i,o,r=e.jobs,s=e.jobSchedule,u=(0,ee.a)(),l=(i=s.map(function(e){return e.id}),(o=r.filter(function(e){return i.includes(e.jobScheduleId)})).map(function(e){var n;return{id:e.id,color:(0,Q.t)(e.status),start:e.timingStart,end:e.timingEnd||e.timingStart,title:(null===(n=e.shortJobDesc[0])||void 0===n?void 0:n.taxonomy.name)||e.title,description:e.description,status:e.status}})),d=function(e){u.show({content:(0,a.jsx)(X.g,{jobId:parseInt(e.event.id),toggleShow:u.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,a.jsx)(K.A,{eventClick:d,events:l,hasLoading:!0})};en.propTypes={jobs:c.array.isRequired,jobSchedule:c.array.isRequired};var et=t(47568),ea=t(828),ei=t(97582),eo=t(30381),er=t.n(eo),es=t(83704),eu=t.n(es),el=t(50319);function ed(){var e=(0,I.Z)(["\n  mutation AddJobSchedule($objects: [JobSchedule_insert_input!]!) {\n    insert_JobSchedule(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return ed=function(){return e},e}function ec(){var e=(0,I.Z)(["\n  mutation UpdateJobSchedule($id: Int!, $object: JobSchedule_set_input!) {\n    update_JobSchedule(where: { id: { _eq: $id } }, _set: $object) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return ec=function(){return e},e}function em(){var e=(0,I.Z)(['\n  mutation UpdateJobSchedule(\n    $adminId: Int!\n    $changes: JobSchedule_set_input\n    $currentJobId: Int!\n    $frequencyChanged: Boolean!\n    $hasCreateJobs: Boolean!\n    $id: Int!\n    $job: Job_set_input\n    $jobs: [CreateJobInput]!\n    $today: timestamptz\n    $updateAllJobs: Boolean!\n    $updateCurrentJob: Boolean!\n  ) {\n    update_JobSchedule_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    update_Job(_set: $job, where: { jobScheduleId: { _eq: $id }, timingStart: { _gte: $today } })\n      @include(if: $updateAllJobs) {\n      affected_rows\n    }\n    update_Job_by_pk(pk_columns: { id: $currentJobId }, _set: $job)\n      @include(if: $updateCurrentJob) {\n      id\n    }\n    cancel: update_Job(\n      _set: { status: "canceled" }\n      where: { jobScheduleId: { _eq: $id }, _not: { JobTimings: { status: { _eq: "completed" } } } }\n    ) @include(if: $frequencyChanged) {\n      affected_rows\n    }\n    createJob(adminId: $adminId, objects: $jobs) @include(if: $hasCreateJobs) {\n      data\n    }\n  }\n']);return em=function(){return e},e}function ep(){var e=(0,I.Z)(["\n  mutation UpdateJobSchedule(\n    $id: Int!\n    $changes: JobScheduleContract_set_input\n    $statusLog: [StatusLog_insert_input!]!\n  ) {\n    update_JobScheduleContract_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_StatusLog(objects: $statusLog) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return ep=function(){return e},e}var ev=(0,S.Ps)(ed()),eh=(0,S.Ps)(ec()),ey=(0,S.Ps)(em());(0,S.Ps)(ep());var ef=t(42283),eb=t(79665),eg=t(6054),ex=t(57282),eZ=t(76600),ej=t(49501),eI=t(6710),eS=t(55563),ew=t(95103),eC=t(58594),e_=t(28497),ek=t(84808),eD=t(98456),eT=t(69368),eA=t(21023),e$=t(36968),eq=t.n(e$),eP=t(67574),eE=t(81836),eR=function(e){var n=e.onDate.date;return er().isMoment(er()(n))||(n=new Date().setMilliseconds(0)),{dtstart:er()(n).toDate()}},eM=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],eJ=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n.bymonth=eM.indexOf(e.month)+1,n},eO=function(e){var n,t=e.mode,a=e.on,i=e.onThe;switch(e.excludingWeekends,t){case"on":return(0,O.Z)({freq:eE.Ci.YEARLY},(n=a,{bymonth:eM.indexOf(n.month)+1,bymonthday:n.day}));case"anyTimeOption":return{freq:eE.Ci.YEARLY};default:return(0,O.Z)({freq:eE.Ci.YEARLY},eJ(i))}},eF=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n},eL=function(e){var n,t=e.mode,a=e.interval,i=e.on,o=e.onThe,r=e.excludingWeekends;switch(t){case"on":return(0,O.Z)({freq:eE.Ci.MONTHLY,interval:a},(n=i,{bymonthday:n.day}));case"anyTimeOption":return(0,O.Z)({freq:eE.Ci.MONTHLY,interval:a},r&&{byweekday:[eE.Ci.MO,eE.Ci.TU,eE.Ci.WE,eE.Ci.TH,eE.Ci.FR],bysetpos:[1]},!r&&{bymonthday:[1]});default:return(0,O.Z)({freq:eE.Ci.MONTHLY,interval:a},eF(o))}},eN=t(29815),eH=t(52628),eW=t.n(eH),eV=function(e){var n=e.mode,t=e.interval,a=e.days,i=e.excludingWeekends;return"anyTimeOption"===n?(0,O.Z)({freq:eE.Ci.WEEKLY,interval:t,bysetpos:[1]},i&&{byweekday:[eE.Ci.MO,eE.Ci.TU,eE.Ci.WE,eE.Ci.TH,eE.Ci.FR]},!i&&{byweekday:[eE.Ci.MO,eE.Ci.TU,eE.Ci.WE,eE.Ci.TH,eE.Ci.FR,eE.Ci.SA,eE.Ci.SU]}):(0,O.Z)({freq:eE.Ci.WEEKLY,interval:t,byweekday:eW()(a).reduce(function(e,n,t){return n?(0,eN.Z)(e).concat([t]):e},[])},i&&{byweekday:[eE.Ci.MO,eE.Ci.TU,eE.Ci.WE,eE.Ci.TH,eE.Ci.FR],bysetpos:[1]})},eU=function(e){var n=e.interval;return e.excludingWeekends,{freq:eE.Ci.DAILY,interval:n}},ez=function(e){var n=e.interval,t=e.excludingWeekends;return(0,O.Z)({freq:eE.Ci.HOURLY,interval:n},t&&{byweekday:[eE.Ci.MO,eE.Ci.TU,eE.Ci.WE,eE.Ci.TH,eE.Ci.FR],bysetpos:[1]})},eG=function(e){var n=e.frequency,t=e.yearly,a=e.monthly,i=e.weekly,o=e.daily,r=e.hourly;switch(n){case"Yearly":return eO(t);case"Monthly":return eL(a);case"Weekly":return eV(i);case"Daily":return eU(o);case"Hourly":return ez(r);default:return{}}},eB=function(e){var n=e.mode,t=e.after,a=e.onDate.date,i={};return"After"===n&&(i.count=t),"On date"===n&&(i.until=er()(a).toDate()),i},eY=function(e){var n=e.hideStart,t=e.weekStartsOnSunday,a={};return n&&(a.dtstart=null),t&&(a.wkst=eE.Ci.SU),a},eK=function(e){var n=e.start,t=e.repeat,a=e.end,i=e.options,o=(0,O.Z)({},eR(n),eG(t),eB(a),eY(i)),r=new eE.Ci(o);return{rruleString:r.toString(),rruleText:r.toText()}},eQ=function(e,n){switch(n.freq){case 0:return"Yearly";case 1:return"Monthly";case 2:return"Weekly";case 3:return"Daily";case 4:return"Hourly";default:return e.repeat.frequency}},eX=function(e,n,t){var a,i;return(null==t?void 0:null===(a=t.repeat)||void 0===a?void 0:null===(i=a.yearly)||void 0===i?void 0:i.mode)?t.repeat.yearly.mode:0===n.freq&&n.bymonth?n.bymonthday?"on":"on the":e.repeat.yearly.mode},e0=function(e,n){var t;return 0===n.freq&&n.byweekday?"number"==typeof n.bymonth?eM[n.bymonth-1]:(null===(t=n.bymonth)||void 0===t?void 0:t[0])?eM[n.bymonth[0]-1]:void 0:e.repeat.yearly.onThe.month},e1=function(e,n){if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.day;var t=n.byweekday.map(function(e){return e.weekday}).join(",");switch(t){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.yearly.onThe.day}},e2=function(e,n){if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.which;var t="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(t){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.yearly.onThe.which}},e3=function(e,n,t){var a,i;return(null==t?void 0:null===(a=t.repeat)||void 0===a?void 0:null===(i=a.monthly)||void 0===i?void 0:i.mode)?t.repeat.monthly.mode:1!==n.freq?e.repeat.monthly.mode:n.bymonthday?"on":"on the"},e6=function(e,n){if(1!==n.freq||!n.byweekday)return e.repeat.monthly.onThe.day;var t=n.byweekday.map(function(e){return e.weekday}).join(",");switch(t){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.monthly.onThe.day}},e5=function(e,n){if(1!==n.freq||!n.bysetpos)return e.repeat.monthly.onThe.which;var t="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(t){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.monthly.onThe.which}},e4=function(e,n){var t=[];return 2!==n.freq?e.repeat.weekly.days:(n.byweekday&&(t=n.byweekday.map(function(e){return e.weekday})),{mon:t.includes(0),tue:t.includes(1),wed:t.includes(2),thu:t.includes(3),fri:t.includes(4),sat:t.includes(5),sun:t.includes(6)})},e8=function(e,n){return n.wkst?6===n.wkst:e.options.weekStartsOnSunday},e7=function(e,n,t){if(!n)return e;try{var a,i,o,r,s,u,l,d,c,m,p,v,h,y,f,b,g,x,Z,j,I,S,w,C,_,k,D,T,A,$,q,P,E,R,M,J,L,N,H,W,V,U,z,G,B,Y,K,Q,X,ee,en,et,ea,ei,eo,es,eu,el,ed,ec,em,ep,ev,eh,ey,ef,eb,eg=(0,eE.SA)(n).origOptions;a=(0,F.Z)((0,O.Z)({},e),{start:(0,F.Z)((0,O.Z)({},e.start),{onDate:{date:er()((Y=e,K=eg,K.dtstart?K.dtstart:Y.start.onDate.date)),options:(0,F.Z)((0,O.Z)({},e.start.onDate.options),{weekStartsOnSunday:e8(e,eg)})}}),repeat:(0,F.Z)((0,O.Z)({},e.repeat),{frequency:eQ(e,eg),yearly:(0,F.Z)((0,O.Z)({},e.repeat.yearly),{mode:eX(e,eg,t),excludingWeekends:null==t?void 0:null===(i=t.repeat)||void 0===i?void 0:null===(o=i.yearly)||void 0===o?void 0:o.excludingWeekends,hourStart:(null==t?void 0:null===(r=t.repeat)||void 0===r?void 0:null===(s=r.yearly)||void 0===s?void 0:s.hourStart)?new Date(null==t?void 0:null===(u=t.repeat)||void 0===u?void 0:null===(l=u.yearly)||void 0===l?void 0:l.hourStart):null,hourEnd:(null==t?void 0:null===(d=t.repeat)||void 0===d?void 0:null===(c=d.yearly)||void 0===c?void 0:c.hourEnd)?new Date(null==t?void 0:null===(m=t.repeat)||void 0===m?void 0:null===(p=m.yearly)||void 0===p?void 0:p.hourEnd):null,on:{month:(Q=e,X=eg,0===X.freq&&X.bymonthday?"number"==typeof X.bymonth?eM[X.bymonth-1]:eM[X.bymonth[0]-1]:Q.repeat.yearly.on.month),day:(ee=e,en=eg,0===en.freq&&en.bymonthday?"number"==typeof en.bymonthday?en.bymonthday:en.bymonthday[0]:ee.repeat.yearly.on.day)},onThe:{month:e0(e,eg),day:e1(e,eg),which:e2(e,eg)}}),monthly:(0,F.Z)((0,O.Z)({},e.repeat.monthly),{mode:e3(e,eg,t),excludingWeekends:null==t?void 0:null===(v=t.repeat)||void 0===v?void 0:null===(h=v.monthly)||void 0===h?void 0:h.excludingWeekends,hourStart:(null==t?void 0:null===(y=t.repeat)||void 0===y?void 0:null===(f=y.monthly)||void 0===f?void 0:f.hourStart)?new Date(null==t?void 0:null===(b=t.repeat)||void 0===b?void 0:null===(g=b.monthly)||void 0===g?void 0:g.hourStart):null,hourEnd:(null==t?void 0:null===(x=t.repeat)||void 0===x?void 0:null===(Z=x.monthly)||void 0===Z?void 0:Z.hourEnd)?new Date(null==t?void 0:null===(j=t.repeat)||void 0===j?void 0:null===(I=j.monthly)||void 0===I?void 0:I.hourEnd):null,interval:(et=e,ea=eg,1!==ea.freq?et.repeat.monthly.interval:ea.interval),on:{day:(ei=e,eo=eg,1===eo.freq&&eo.bymonthday?"number"==typeof eo.bymonthday?eo.bymonthday:eo.bymonthday[0]:ei.repeat.monthly.on.day)},onThe:{day:e6(e,eg),which:e5(e,eg)}}),weekly:{mode:null==t?void 0:null===(S=t.repeat)||void 0===S?void 0:null===(w=S.weekly)||void 0===w?void 0:w.mode,excludingWeekends:null==t?void 0:null===(C=t.repeat)||void 0===C?void 0:null===(_=C.weekly)||void 0===_?void 0:_.excludingWeekends,hourStart:(null==t?void 0:null===(k=t.repeat)||void 0===k?void 0:null===(D=k.weekly)||void 0===D?void 0:D.hourStart)?new Date(null==t?void 0:null===(T=t.repeat)||void 0===T?void 0:null===(A=T.weekly)||void 0===A?void 0:A.hourStart):null,hourEnd:(null==t?void 0:null===($=t.repeat)||void 0===$?void 0:null===(q=$.weekly)||void 0===q?void 0:q.hourEnd)?new Date(null==t?void 0:null===(P=t.repeat)||void 0===P?void 0:null===(E=P.weekly)||void 0===E?void 0:E.hourEnd):null,interval:(es=e,eu=eg,2!==eu.freq?es.repeat.weekly.interval:eu.interval),days:e4(e,eg),options:{weekStartsOnSunday:e8(e,eg)}},daily:{mode:null==t?void 0:null===(R=t.repeat)||void 0===R?void 0:null===(M=R.daily)||void 0===M?void 0:M.mode,interval:(el=e,ed=eg,3!==ed.freq?el.repeat.daily.interval:ed.interval),excludingWeekends:null==t?void 0:null===(J=t.repeat)||void 0===J?void 0:null===(L=J.daily)||void 0===L?void 0:L.excludingWeekends,hourStart:(null==t?void 0:null===(N=t.repeat)||void 0===N?void 0:null===(H=N.daily)||void 0===H?void 0:H.hourStart)?new Date(null==t?void 0:null===(W=t.repeat)||void 0===W?void 0:null===(V=W.daily)||void 0===V?void 0:V.hourStart):null,hourEnd:(null==t?void 0:null===(U=t.repeat)||void 0===U?void 0:null===(z=U.daily)||void 0===z?void 0:z.hourEnd)?new Date(null==t?void 0:null===(G=t.repeat)||void 0===G?void 0:null===(B=G.daily)||void 0===B?void 0:B.hourEnd):null},hourly:{interval:(ec=e,em=eg,4!==em.freq?ec.repeat.daily.interval:em.interval)}}),end:(0,F.Z)((0,O.Z)({},e.end),{mode:(ep=e,ev=eg,ev.count||0===ev.count?"After":ev.until?"On date":"After"),after:(eh=e,ey=eg,ey.count||0===ey.count?ey.count:eh.end.after),onDate:{date:er()((ef=e,eb=eg,eb.until?eb.until:ef.end.onDate.date)),options:(0,F.Z)((0,O.Z)({},e.end.onDate.options),{weekStartsOnSunday:e8(e,eg)})}}),options:(0,F.Z)((0,O.Z)({},e.options),{weekStartsOnSunday:e8(e,eg)}),error:null})}catch(ex){return(0,F.Z)((0,O.Z)({},e),{error:{value:n,message:ex}})}return a},e9=t(41609),ne=t.n(e9),nn=t(73955),nt=t.n(nn),na=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,a=ne()(t)?nt()("rrule-"):t,i={start:{onDate:{date:er()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:n}}},repeat:{frequency:e.repeat?e.repeat[0]:"Yearly",yearly:{mode:e.yearly||"on",on:{month:"Jan",day:1},onThe:{month:"Jan",day:"Monday",which:"First"},options:{modes:e.yearly}},monthly:{mode:e.monthly||"on",interval:1,on:{day:1},onThe:{day:"Monday",which:"First"},options:{modes:e.monthly}},weekly:{interval:1,days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},options:{weekStartsOnSunday:e.weekStartsOnSunday}},daily:{interval:1},hourly:{interval:1},options:{frequency:e.repeat}},end:{mode:e.end?e.end[0]:"After",after:1,onDate:{date:er()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:n}},options:{modes:e.end}},options:{hideStart:void 0===e.hideStart||e.hideStart,hideEnd:e.hideEnd,hideError:e.hideError,weekStartsOnSunday:e.weekStartsOnSunday},error:null};return{id:a,data:i,rrule:eK(i)}},ni=function(e,n){var t=[];for(var a in e)!0===e[a]&&t.push(a);return n.filter(function(e){return t.includes(e.value)})},no=t(21300),nr=t(313),ns=t(96843),nu=t(89345),nl=t(7654),nd=t.n(nl),nc=function(e){return function(n){var t=+n.target.value;!nd()(t)&&!(t>=1e3)&&e({target:{value:t,name:n.target.name}})}},nm=function(e){var n=e.data,t=e.defaultOptions,i=e.handleChange,o=e.mainDefaultOptions,s=e.setValue,u=e.setValueParent,l=e.watch,d=l("end.onDate.date"),c=l("start.onDate.date");return(0,r.useEffect)(function(){((0,ns.Z)(d,c)||(0,nr.Z)(d,c))&&"On date"===n.end.mode?u("formErrors",""):u("formErrors","No Error")},[d,c,n.end.mode]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(ej.Z,{label:"End on",children:[(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},t),{name:"end.mode",options:eP.ut,onChange:i})),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},o),{name:"formErrors",type:"hidden"}))]}),function(){switch(n.end.mode){case"After":return(0,a.jsx)(ej.Z,{label:"Occurrences",children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},t),{name:"end.after",onChange:nc(i)}))});case"On date":var e=(0,ns.Z)(d,c)||(0,nr.Z)(d,c);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},t),{locale:nu.Z,name:"end.onDate.date",placeholder:"End On",shouldCloseOnSelect:!0,onChange:function(e){var n=er()(e).utc(!0).startOf("day").toDate();s("end.onDate.date",new Date(n)),u("end.onDate.date",new Date(n))}})),e&&(0,a.jsx)(V.Z,{context:"danger",content:"End On should be less than start date",size:"sm"})]})}}()]})};nm.propTypes={data:c.object.isRequired,defaultOptions:c.object.isRequired,handleChange:c.func.isRequired};var np=function(e){var n=e.defaultOptions,t=e.handleChange,i=e.setValue,o=(0,e.watch)("repeat.daily.mode"),r=function(e){return function(n){i(e,n),t({target:{name:e,value:n}})}},s=function(e){t({target:{name:e.target.name,value:e.target.checked?"anyTimeOption":null}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{align:"center",children:[(0,a.jsx)(d.Z,{md:2,children:"every"}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.daily.interval",onChange:nc(t)}))}),(0,a.jsx)(d.Z,{md:3,children:"day(s)"})]}),(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},n),{onChange:s,name:"repeat.daily.mode",data:eP.Ib,stacked:!1}))})}),"anyTimeOption"===o&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ej.Z,{label:"Between hours of",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.daily.hourStart",onChange:r("repeat.daily.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.daily.hourEnd",onChange:r("repeat.daily.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})})]})};np.propTypes={defaultOptions:c.object.isRequired,handleChange:c.func.isRequired};var nv=function(e){var n=e.defaultOptions,t=e.handleChange;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(l.Z,{align:"center",children:[(0,a.jsx)(d.Z,{md:2,children:"every"}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.hourly.interval",onChange:nc(t)}))}),(0,a.jsx)(d.Z,{md:3,children:"hour(s)"})]})})};nv.propTypes={defaultOptions:c.object.isRequired,handleChange:c.func.isRequired};var nh=t(90951),ny=t(97871),nf=function(e){var n=e.defaultOptions,t=e.handleChange,i=(e.weeklyDays,e.setValue),o=(0,e.watch)("repeat.monthly.mode"),r=function(e){return function(n){i(e,n),t({target:{name:e,value:n}})}},s=function(e){t({target:{name:e.target.name,value:e.target.checked}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{align:"center",style:{marginBottom:"1rem"},children:[(0,a.jsx)(d.Z,{md:3,children:"every"}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.monthly.interval",onChange:nc(t)}))}),(0,a.jsx)(d.Z,{md:3,children:"month(s)"})]}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{data:eP.c7,name:"repeat.monthly.mode",onChange:t,stacked:!1}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.monthly.on.day",onChange:nc(t),options:ny.a}))})]}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{data:eP.qG,name:"repeat.monthly.mode",onChange:t,stacked:!1}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.monthly.onThe.which",onChange:t,options:eP.$9}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.monthly.onThe.day",onChange:t,options:eP.pH}))})]}),(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{onChange:t,name:"repeat.monthly.mode",data:eP.Ib,stacked:!1}))})}),"anyTimeOption"===o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},n),{data:eP.MF,name:"repeat.monthly.excludingWeekends",onChange:s,stacked:!1}))})}),(0,a.jsx)(ej.Z,{label:"Between hours of",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.monthly.hourStart",onChange:r("repeat.monthly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.monthly.hourEnd",onChange:r("repeat.monthly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})};nf.propTypes={defaultOptions:c.object.isRequired,handleChange:c.func.isRequired};var nb=t(84043);function ng(){var e=(0,I.Z)(["\n  && > div:first-of-type {\n    ","\n  }\n  && {\n    margin-bottom: 1rem;\n  }\n"]);return ng=function(){return e},e}var nx=function(e){var n=e.currentWeeklyDays,t=e.defaultOptions,i=e.handleChange,o=e.setValue,r=(0,e.watch)("repeat.weekly.mode"),s=function(e){Object.keys(n).forEach(function(e){return n[e]=!1}),e.forEach(function(e){n[e.value]=!0}),o("repeat.weekly.days",ni(n,eP.$i)),i({target:{value:n,name:"repeat.weekly.days"}})},u=function(e){return function(n){o(e,n),i({target:{name:e,value:n}})}},c=function(e){i({target:{name:e.target.name,value:e.target.checked?"anyTimeOption":null}})},m=function(e){i({target:{name:e.target.name,value:e.target.checked}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{align:"center",style:{marginBottom:"1rem"},children:[(0,a.jsx)(d.Z,{md:3,children:"every"}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},t),{name:"repeat.weekly.interval",onChange:nc(i)}))}),(0,a.jsx)(d.Z,{md:3,children:"week(s)"})]}),(0,a.jsx)(nZ,(0,F.Z)((0,O.Z)({},t),{isMulti:!0,isDisabled:"anyTimeOption"===r,name:"repeat.weekly.days",onChange:s,options:eP.$i})),(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},t),{onChange:c,name:"repeat.weekly.mode",data:eP.Ib,stacked:!1}))})}),"anyTimeOption"===r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},t),{data:eP.MF,name:"repeat.weekly.excludingWeekends",onChange:m,stacked:!1}))})}),(0,a.jsx)(ej.Z,{label:"Between hours of",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},t),{locale:nu.Z,name:"repeat.weekly.hourStart",onChange:u("repeat.weekly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},t),{locale:nu.Z,name:"repeat.weekly.hourEnd",onChange:u("repeat.weekly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})},nZ=(0,$.ZP)(nb.Z).withConfig({displayName:"weekly__Select",componentId:"sc-90903a28-0"})(ng(),function(e){return e.isDisabled?"background-color: #cecece !important;":""});nx.propTypes={currentWeeklyDays:c.object.isRequired,defaultOptions:c.object.isRequired,handleChange:c.func.isRequired,setValue:c.func.isRequired};var nj=t(89331),nI=function(e){var n=e.defaultOptions,t=e.handleChange,i=e.setValue,o=(0,e.watch)("repeat.yearly.mode"),r=function(e){return function(n){i(e,n),t({target:{name:e,value:n}})}},s=function(e){t({target:{name:e.target.name,value:e.target.checked}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{onChange:t,name:"repeat.yearly.mode",data:eP.jT,stacked:!1}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.yearly.on.month",onChange:t,options:nj.e7}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.yearly.on.day",onChange:nc(t),options:ny.a}))})]}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{onChange:t,name:"repeat.yearly.mode",data:eP.e6,stacked:!1}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.yearly.onThe.which",onChange:t,options:eP.$9}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.yearly.onThe.day",onChange:t,options:eP.pH}))}),(0,a.jsx)(d.Z,{md:3,children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},n),{name:"repeat.yearly.onThe.month",onChange:t,options:nj.e7}))})]}),(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},n),{onChange:t,name:"repeat.yearly.mode",data:eP.CM,stacked:!1}))})}),"anyTimeOption"===o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{children:(0,a.jsx)(d.Z,{sm:12,children:(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},n),{data:eP.MF,name:"repeat.yearly.excludingWeekends",onChange:s,stacked:!1}))})}),(0,a.jsx)(ej.Z,{label:"Between hours of",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.yearly.hourStart",onChange:r("repeat.yearly.hourStart"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"Start",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))}),(0,a.jsx)(d.Z,{sm:6,children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},n),{locale:nu.Z,name:"repeat.yearly.hourEnd",onChange:r("repeat.yearly.hourEnd"),showTimeSelect:!0,showTimeSelectOnly:!0,placeholder:"End",timeIntervals:15,timeCaption:"Time",dateFormat:"HH:mm"}))})]})})]})]})};nI.propTypes={defaultOptions:c.object,handleChange:c.func};var nS=function(e){var n=e.data,t=e.defaultOptions,i=e.handleChange,o=e.setValue,r=e.watch;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej.Z,{label:"Repeat",children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},t),{name:"repeat.frequency",options:eP.y7,onChange:i}))}),function(){switch(n.repeat.frequency){case"Yearly":return(0,a.jsx)(nI,{defaultOptions:t,handleChange:i,setValue:o,watch:r});case"Monthly":return(0,a.jsx)(nf,{defaultOptions:t,handleChange:i,setValue:o,watch:r});case"Weekly":return(0,a.jsx)(nx,{currentWeeklyDays:n.repeat.weekly.days,defaultOptions:t,handleChange:i,setValue:o,watch:r});case"Daily":return(0,a.jsx)(np,{defaultOptions:t,handleChange:i,setValue:o,watch:r});case"Hourly":return(0,a.jsx)(nv,{defaultOptions:t,handleChange:i})}}()]})};nS.propTypes={data:c.object.isRequired,defaultOptions:c.object.isRequired,handleChange:c.func.isRequired,setValue:c.func.isRequired};var nw=function(e){var n=e.defaultValues,t=e.defaultOptions,i=e.setValueParent,o=(e.watchParent,e.setRRuleMeta),s=e.rruleMeta,u=na({hideStart:!1},null,null),l=(0,r.useState)(e7(u.data,null==n?void 0:n.frequency,s)),d=l[0],c=l[1],m=(0,ef.cI)({defaultValues:{"start.onDate.date":new Date(d.start.onDate.date),"repeat.frequency":d.repeat.frequency,"repeat.yearly.mode":d.repeat.yearly.mode,"repeat.yearly.excludingWeekends":d.repeat.yearly.excludingWeekends,"repeat.yearly.hourStart":d.repeat.yearly.hourStart,"repeat.yearly.hourEnd":d.repeat.yearly.hourEnd,"repeat.yearly.on.month":d.repeat.yearly.on.month,"repeat.yearly.on.day":d.repeat.yearly.on.day,"repeat.yearly.onThe.which":d.repeat.yearly.onThe.which,"repeat.yearly.onThe.day":d.repeat.yearly.onThe.day,"repeat.yearly.onThe.month":d.repeat.yearly.onThe.month,"repeat.monthly.interval":d.repeat.monthly.interval,"repeat.monthly.mode":d.repeat.monthly.mode,"repeat.monthly.excludingWeekends":d.repeat.monthly.excludingWeekends,"repeat.monthly.hourStart":d.repeat.monthly.hourStart,"repeat.monthly.hourEnd":d.repeat.monthly.hourEnd,"repeat.monthly.on.day":d.repeat.monthly.on.day,"repeat.monthly.onThe.which":d.repeat.monthly.onThe.which,"repeat.monthly.onThe.day":d.repeat.monthly.onThe.day,"repeat.weekly.interval":d.repeat.weekly.interval,"repeat.weekly.mode":d.repeat.weekly.mode,"repeat.weekly.excludingWeekends":d.repeat.weekly.excludingWeekends,"repeat.weekly.hourStart":d.repeat.weekly.hourStart,"repeat.weekly.hourEnd":d.repeat.weekly.hourEnd,"repeat.weekly.days":ni(d.repeat.weekly.days,eP.$i),"repeat.daily.interval":d.repeat.daily.interval,"repeat.daily.mode":d.repeat.daily.mode,"repeat.daily.excludingWeekends":d.repeat.daily.excludingWeekends,"repeat.daily.hourStart":d.repeat.daily.hourStart,"repeat.daily.hourEnd":d.repeat.daily.hourEnd,"repeat.hourly.interval":d.repeat.hourly.interval,"end.mode":d.end.mode,"end.after":d.end.after,"end.onDate.date":new Date(d.end.onDate.date)},resolver:(0,eb.S)()}),p=m.control,v=m.errors,h=m.register,y=m.setValue,f=m.watch,b={control:p,errors:v,register:h,setValue:y,watch:f},g=f("start.onDate.date",new Date(d.start.onDate.date)),x=f("end.onDate.date",new Date(d.end.onDate.date)),Z=(0,eg.Z)(g),j=(0,eg.Z)(x);(0,r.useEffect)(function(){if(g&&g!==Z){var e={target:{value:new Date(g),name:"start.onDate.date"}};I(e)}else if(x&&x!==j){var n={target:{value:new Date(x),name:"end.onDate.date"}};I(n)}},[g,x]);var I=function(e){var n=e.target,t=(0,O.Z)({},d);eq()(t,n.name,n.value),c((0,O.Z)({},t));var a=eK(t),r=a.rruleString,s=a.rruleText;i("frequency",r),o((0,O.Z)({},t)),i("frequencyDescription",s)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},t),{name:"frequency",type:"hidden"})),(0,a.jsxs)(eZ.Z,{id:"Form",children:[(0,a.jsx)(ej.Z,{label:"Date of first job",children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},b),{name:"start.onDate.date",placeholder:"Date of first job",shouldCloseOnSelect:!0,onChange:function(e){var n=er()(e).utc(!0).startOf("day").toDate();y("start.onDate.date",new Date(n)),i("start.onDate.date",new Date(n))}}))}),(0,a.jsx)(nS,{data:d,defaultOptions:b,handleChange:I,setValue:y,watch:f}),(0,a.jsx)(nm,{data:d,defaultOptions:b,handleChange:I,mainDefaultOptions:t,setValue:y,setValueParent:i,watch:f})]})]})};nw.propTypes={defaultOptions:c.object.isRequired,setValueParent:c.func.isRequired,watchParent:c.func.isRequired};var nC=t(66812),n_=t(25742),nk=t(74231),nD=(0,nk.Ry)().shape({shortDescription:(0,nk.Ry)().required(),description:(0,nk.Z_)().required(),costCategory:(0,nk.Ry)().required(),service:(0,nk.Ry)().required(),supplier:(0,nk.Ry)().required(),assetCategory:(0,nk.Ry)().nullable(),assetSelected:(0,nk.IX)(),frequency:(0,nk.Z_)().required(),costCustomer:(0,nk.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),costSupplier:(0,nk.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),formErrors:(0,nk.Z_)().required(),estimatedDuration:(0,nk.Rx)().min(0),estimatedDurationUnit:(0,nk.Z_)()}),nT=(0,nk.Ry)().shape({frequencyConfirm:(0,nk.Z_)().oneOf(["yes"]),supplierConfirm:(0,nk.Z_)()}),nA=function(e){var n,t=e.isDatesChanged,i=e.isSupplierChanged,o=e.onConfirm,r=e.toggleShow,s=(0,ef.cI)({resolver:(0,eb.S)(nT)}),u=s.control,l=s.errors,d=s.handleSubmit,c=s.register,m=(n=(0,et.Z)(function(e){return(0,ei.__generator)(this,function(n){return o({updateAllJobs:"futureJobs"===e.supplierConfirm,updateCurrentJob:"nextJob"===e.supplierConfirm}),r(),[2]})}),function(e){return n.apply(this,arguments)}),p={control:u,errors:l,register:c};return(0,a.jsxs)(eZ.Z,{handleSubmit:d(m),children:[t&&(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},p),{data:[{label:"Do you confirm to change frequency?",key:"frequencyConfirm",value:"yes"}],name:"frequencyConfirm"})),i&&(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},p),{legend:"Do you want to change supplier for next job only or all future jobs?",name:"supplierConfirm",data:[{id:"nextJob",label:"Next job only",value:"nextJob"},{id:"futureJobs",label:"All future jobs",value:"futureJobs"}]})),(0,a.jsx)(n_.H,{content:"Update",type:"submit"})]})};nA.propType={form:c.object,onConfirm:c.func,toggleShow:c.func};var n$=t(32749),nq=function(e){var n,t,a=e.defaultValues,i=e.data;if(!((null==a?void 0:null===(n=a.jobs)||void 0===n?void 0:n.length)>0))return{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1};var o=nP(null==a?void 0:a.dates,i.dates)||(null==a?void 0:a.frequency)!==i.frequency,r=i.meta.supplierId!==(null==a?void 0:null===(t=a.supplier)||void 0===t?void 0:t.value);return r||o?{isConfirm:!0,isSupplierChanged:r,isDatesChanged:o}:{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1}},nP=function(e,n){return Array.isArray(e)?!(e.length===n.length&&n.every(function(n,t){var a=n.date,i=n.selected;return e[t].selected===i&&er()(e[t].date).isSame(a)})):!n.every(function(e){return e.selected})};eu()(er());var nE,nR=["assetCategory","costCategory","service","shortDescription","supplier"],nM=function(e){var n,t,a,i=e.form,o=e.location,r=e.rruleMeta,s=e.dates,u=e.scheduleJobId;return i.dates=s,i.locationId=o.id,i.sublocationId=(null===(n=i.sublocation)||void 0===n?void 0:n.value)||null,nR.forEach(function(e){i[e]&&i[e].value&&(i[e+"Id"]=i[e].value,i[e+"Name"]=i[e].label),delete i[e]}),i.meta={assetCategoryId:i.assetCategoryId,assetCategoryName:i.assetCategoryName,costCategoryId:i.costCategoryId,costCategoryName:i.costCategoryName,complianceSelect:i.complianceSelect,costCustomer:i.costCustomer,costSupplier:i.costSupplier,description:i.description,serviceId:i.serviceId,serviceName:i.serviceName,shortDescriptionId:i.shortDescriptionId,shortDescriptionName:i.shortDescriptionName,supplierId:i.supplierId,supplierName:i.supplierName,customerSignature:i.customerSignature,supplierSignature:i.supplierSignature,reportPassFail:!!i.reportPassFail,reportPassFailTitle:i.reportPassFailTitle,requireReportRecommendations:!!i.requireReportRecommendations,rruleMeta:r,tags:i.tags,assets:null===(t=i.assetSelected)||void 0===t?void 0:t.map(function(e){return{value:e.value,label:e.label}})},i.tags&&(i.Taxonomy={data:null===(a=i.tags)||void 0===a?void 0:a.map(function(e){return{entity:"JobSchedule",entityId:u,taxonomyId:e.tag.id}})}),i.estimatedDuration&&i.estimatedDurationUnit?i.estimatedDuration=er().duration(i.estimatedDuration,i.estimatedDurationUnit).as("milliseconds"):(delete i.estimatedDuration,delete i.estimatedDurationUnit),delete i.tags,delete i.assetSelected,delete i.assetCategoryId,delete i.assetCategoryName,delete i.compliance,delete i.complianceSelect,delete i.costCategoryId,delete i.costCategoryName,delete i.serviceId,delete i.serviceName,delete i.description,delete i.shortDescriptionId,delete i.shortDescriptionName,delete i.supplierId,delete i.supplierName,delete i.costCustomer,delete i.costSupplier,delete i.reportPassFail,delete i.reportPassFailTitle,delete i.customerSignature,delete i.supplierSignature,delete i.requireReportRecommendations,delete i.sublocation,i},nJ=t(15033),nO=t(20823),nF=t(59002);eu()(er());var nL=(nE=(0,et.Z)(function(e){var n,t,a,i,o,r,s,u,l,d,c,m,p,v,h,y,f,b,g,x,Z,j,I,S,w,C,_,k,D;return(0,ei.__generator)(this,function(T){return n=e.adminId,t=e.defaultValues,a=e.form,i=e.location,g=(b=(0,nF.K)(null==a?void 0:null===(o=a.meta)||void 0===o?void 0:o.rruleMeta)).isAnyTime,x=b.excludingWeekends,Z=[],Z=Array.isArray(a.dates)?a.dates.filter(function(e){return e.selected}).map(function(e){return e.date}):(0,nO.p)(a.frequency,g,x),j=a.meta.costCustomer,I=a.meta.costSupplier,S=(null==i?void 0:null===(r=i.user)||void 0===r?void 0:r.id)||null,w=a.meta.supplierId,C=null==a?void 0:null===(s=a.meta)||void 0===s?void 0:null===(u=s.rruleMeta)||void 0===u?void 0:null===(l=u.repeat)||void 0===l?void 0:l.frequency,_=null==a?void 0:null===(d=a.meta)||void 0===d?void 0:null===(c=d.rruleMeta)||void 0===c?void 0:null===(m=c.repeat)||void 0===m?void 0:null===(p=m[C.toLocaleLowerCase()])||void 0===p?void 0:p.hourStart,k=null==a?void 0:null===(v=a.meta)||void 0===v?void 0:null===(h=v.rruleMeta)||void 0===h?void 0:null===(y=h.repeat)||void 0===y?void 0:null===(f=y[C.toLocaleLowerCase()])||void 0===f?void 0:f.hourEnd,D=[],Z.forEach(function(e){var o,r,s,u,l,d,c,m,p={access:i.access,adminId:n,amount:j,assetCategoryId:a.meta.assetCategoryId,costCategoryId:a.meta.costCategoryId,customerId:i.customer[0].account.id,customerUserId:S,description:a.meta.description,jobScheduleId:t.id,locationId:i.id,sublocationId:a.sublocationId,managerId:i.customer[0].account.managerId,pricing:"fixed",serviceId:a.meta.serviceId,source:"other",status:"offered",paymentMethod:"invoice",supplierLabourAmount:I,timing:"at",timingStart:e,timingEnd:er()(e).endOf(eP._f[C]),title:a.meta.shortDescriptionName,type:"ppm",reference:a.reference,reportPassFail:a.meta.reportPassFail,reportPassFailTitle:a.meta.reportPassFailTitle,requireReportRecommendations:a.meta.requireReportRecommendations,anyTimeOption:g,hourStart:_?er()(_).format("HH:mm:ssZ"):null,hourEnd:k?er()(k).format("HH:mm:ssZ"):null,JobTimings:{data:[{status:"raised"},{status:"offered"}]},SupplierOffers:{data:[{status:"offered",accountId:w}]},Taxonomy:{data:[{entity:"Job",taxonomyId:null===(o=a.meta)||void 0===o?void 0:o.shortDescriptionId}]}};(null==a?void 0:null===(r=a.meta)||void 0===r?void 0:null===(s=r.rruleMeta)||void 0===s?void 0:null===(u=s.repeat)||void 0===u?void 0:null===(l=u[C.toLocaleLowerCase()])||void 0===l?void 0:l.excludingWeekends)&&(p.timingEnd.day()===eP.p3.Saturday||p.timingEnd.day()===eP.p3.Sunday)&&p.timingEnd.subtract(eP.Fs[p.timingEnd.day()],"day"),a.meta.hasCompliance&&(null===(d=a.meta.complianceSelect)||void 0===d?void 0:d.value)&&(p.Compliances={data:{complianceId:a.meta.complianceSelect.value,entity:"Job",status:"active"}}),a.estimatedDuration&&a.estimatedDurationUnit&&(p.estimatedDuration=a.estimatedDuration,p.estimatedDurationUnit=a.estimatedDurationUnit),(null===(c=a.meta)||void 0===c?void 0:null===(m=c.assets)||void 0===m?void 0:m.length)>0&&(p.Assets={data:a.meta.assets.map(function(e){return{status:"active",assetId:e.value}})}),D.push(p)}),[2,D]})}),function(e){return nE.apply(this,arguments)}),nN=t(18586),nH=t(89256);function nW(){var e=(0,I.Z)(["\n  && > div:first-of-type {\n    ","\n  }\n"]);return nW=function(){return e},e}eu()(er());var nV=function(e){var n,t,i,o,s,u,c=e.currentJob,m=e.defaultValues,v=e.location,h=e.onSuccess,y=(0,Z.x)(),f=y.user,b=y.hasRole,g=(0,ee.a)(),j=(0,nN.q)(),I=null==j?void 0:null===(n=j.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,S=(0,r.useState)(null==m?void 0:m.rruleMeta),w=S[0],C=S[1],_=(0,nF.K)(w),k=_.isAnyTime,D=_.excludingWeekends,T=(0,r.useState)((null==m?void 0:m.dates)||[]),A=T[0],$=T[1],q=(0,r.useRef)(!0),P=(0,ef.cI)({defaultValues:(0,F.Z)((0,O.Z)({},m),{estimatedDuration:er().duration(m.estimatedDuration,"milliseconds").as(m.estimatedDurationUnit)}),resolver:(0,eb.S)(nD)}),E=P.control,R=P.errors,M=P.handleSubmit,J=P.register,L=P.setValue,N=P.watch,H=N("frequency"),W=N("shortDescription"),V=N("compliance",null==m?void 0:m.compliance),U=N("service"),z=N("assetCategory",null==m?void 0:m.assetCategory),G=N("tags",null==m?void 0:m.tags),B=(0,eg.Z)(W),Y=(0,eg.Z)(z),K=(0,eg.Z)(U);(0,r.useEffect)(function(){var e,n,t,a,i,o,r,s,u,l,d,c,m,p,v,h,y,f,b;(null==B?void 0:B.value)!==(null==W?void 0:W.value)&&(null==W?void 0:null===(e=W.meta)||void 0===e?void 0:e.template)&&[{name:"description",value:null===(o=W.meta)||void 0===o?void 0:null===(r=o.template)||void 0===r?void 0:r.description},{name:"costCategory",value:null===(s=W.meta)||void 0===s?void 0:null===(u=s.template)||void 0===u?void 0:u.costCategorySelected},{name:"service",value:null===(l=W.meta)||void 0===l?void 0:null===(d=l.template)||void 0===d?void 0:d.serviceSelected},{name:"reportPassFail",value:(null==W?void 0:null===(c=W.meta)||void 0===c?void 0:null===(m=c.template)||void 0===m?void 0:m.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==W?void 0:null===(p=W.meta)||void 0===p?void 0:null===(v=p.template)||void 0===v?void 0:v.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==W?void 0:null===(h=W.meta)||void 0===h?void 0:null===(y=h.template)||void 0===y?void 0:y.requireReportRecommendations)||!1},{name:"tags",value:(null==W?void 0:null===(f=W.meta)||void 0===f?void 0:null===(b=f.template)||void 0===b?void 0:b.tags)||[]}].map(function(e){var n;return L(e.name,e.value)}),(null==W?void 0:null===(n=W.meta)||void 0===n?void 0:null===(t=n.template)||void 0===t?void 0:t.customerSignature)&&L("customerSignature",!0),(null==W?void 0:null===(a=W.meta)||void 0===a?void 0:null===(i=a.template)||void 0===i?void 0:i.supplierSignature)&&L("supplierSignature",!0),z!==Y&&Y&&L("assetSelected",null),U!==K&&K&&L("supplier",null)},[z,m,Y,K,B,U,L,W]),(0,r.useEffect)(function(){if(H){if(Array.isArray(null==m?void 0:m.dates)&&q.current){q.current=!1;return}$((0,nO.p)(H,k,D).map(function(e){return{date:e,selected:!0}}))}},[H,D,null==m?void 0:m.dates,k]);var Q,X,en=(0,ea.Z)((0,el.D)(ev,{onCompleted:function(e){}}),2),eo=en[0],es=en[1].loading,eu=(0,ea.Z)((0,el.D)(ey,{onCompleted:function(e){}}),2),ed=eu[0],ec=eu[1].loading,em=(0,x.WE)(v,"registered"),ep=(0,ex.Z)({postCode:null==em?void 0:null===(i=em.address)||void 0===i?void 0:i.postCode,country:null==em?void 0:null===(o=em.address)||void 0===o?void 0:null===(s=o.country)||void 0===s?void 0:s.code}),eh=(null==ep?void 0:ep.area)?ep.area.toUpperCase():null,e$=(Q=(0,et.Z)(function(e){var n,t,a,i,o;return(0,ei.__generator)(this,function(r){switch(r.label){case 0:if(delete e.formErrors,n=nM({form:e,location:v,rruleMeta:w,dates:A,scheduleJobId:m.id}),null==m?void 0:m.id)return[3,2];return[4,eo({variables:{objects:[n]}})];case 1:return r.sent(),h&&h(),[3,5];case 2:var s;if(delete n.Taxonomy,a=(t=nq({defaultValues:m,data:n})).isConfirm,i=t.isDatesChanged,o=t.isSupplierChanged,!a)return[3,3];return eq({isDatesChanged:i,isSupplierChanged:o,onConfirm:(s=(0,et.Z)(function(e){var t,a,r,s;return(0,ei.__generator)(this,function(u){switch(u.label){case 0:if(t=e.updateAllJobs,a=e.updateCurrentJob,r=[],s=[],!i)return[3,2];return[4,nL({adminId:f.adminId,defaultValues:m,form:n,location:v})];case 1:r=u.sent(),u.label=2;case 2:return o&&(s={supplierId:n.meta.supplierId}),[4,eP({data:n,frequencyChanged:i,job:s,jobs:r,updateAllJobs:t,updateCurrentJob:a})];case 3:return u.sent(),[2]}})}),function(e){return s.apply(this,arguments)})}),[3,5];case 3:return[4,eP({data:n,frequencyChanged:!1,job:{},jobs:[],updateAllJobs:!1,updateCurrentJob:!1})];case 4:r.sent(),r.label=5;case 5:return[2]}})}),function(e){return Q.apply(this,arguments)}),eq=function(e){var n=e.isDatesChanged,t=e.isSupplierChanged,i=e.onConfirm;g.show({content:(0,a.jsx)(nA,{isDatesChanged:n,isSupplierChanged:t,onConfirm:i,toggleShow:g.close}),title:"Confirm",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},eP=(X=(0,et.Z)(function(e){var n,t,a,i,o,r,s;return(0,ei.__generator)(this,function(u){switch(u.label){case 0:return n=e.data,t=e.frequencyChanged,a=e.job,i=e.jobs,o=e.updateAllJobs,r=e.updateCurrentJob,s=t&&i.length>0,[4,ed({variables:{adminId:f.adminId,currentJobId:(null==c?void 0:c.id)||null,changes:n,frequencyChanged:t,hasCreateJobs:s,id:m.id,job:a,jobs:i,today:new Date,updateAllJobs:o,updateCurrentJob:r}})];case 1:return u.sent(),h&&h(),[2]}})}),function(e){return X.apply(this,arguments)}),eE={control:E,errors:R,register:J},eR=function(e,n){$(function(t){return t.map(function(t,a){return a===n?(0,F.Z)((0,O.Z)({},t),{selected:e.target.checked}):t})})},eM=function(e){$(function(n){return n.map(function(n){return(0,F.Z)((0,O.Z)({},n),{selected:e.target.checked})})})},eJ=A.map(function(e,n){var t=e.date,a=e.selected;return{date:t,id:n,weekDay:er()(t).format("ddd"),day:er()(t).format("DD"),month:er()(t).format("MMM"),year:er()(t).format("YYYY"),selected:a}});return(0,a.jsxs)(eZ.Z,{id:"offCanvasForm",handleSubmit:M(e$),children:[(es||ec)&&(0,a.jsx)(ek.Z,{sx:{zIndex:1e5},open:!0,children:(0,a.jsx)(eD.Z,{color:"secondary"})}),(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)(d.Z,{md:6,children:[(0,a.jsx)(nC.P,(0,F.Z)((0,O.Z)({},eE),{isClearable:!0,label:"Sublocation",locationId:v.id,name:"sublocation",type:"sublocation"})),(0,a.jsx)(n$.l,(0,F.Z)((0,O.Z)({},eE),{label:"Short job description",name:"shortDescription",type:"jobTags"})),(0,a.jsx)(ej.Z,{label:"Work description",children:(0,a.jsx)(eI.Z,(0,F.Z)((0,O.Z)({},eE),{name:"description",rows:3}))}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(ej.Z,{label:"Estimated duration",children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(ej.Z,{label:"Unit",children:(0,a.jsx)(ew.Z,(0,F.Z)((0,O.Z)({},eE),{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,a.jsx)(ej.Z,{label:"Customer reference",children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"reference"}))}),(0,a.jsx)(n$.l,(0,F.Z)((0,O.Z)({},eE),{label:"Cost category",name:"costCategory",type:"costCategory"})),(0,a.jsx)(nC.P,(0,F.Z)((0,O.Z)({},eE),{label:"Service",name:"service",type:"service"})),U&&(0,a.jsx)(nC.P,(0,F.Z)((0,O.Z)({},eE),{label:"Supplier",name:"supplier",type:"supplier",area:eh,serviceId:(null==U?void 0:U.value)||null})),I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(nC.P,(0,F.Z)((0,O.Z)({},eE),{label:"Asset Category",locationId:v.id,name:"assetCategory",type:"assetCategory"})),(0,a.jsx)(nU,(0,F.Z)((0,O.Z)({},eE),{isDisabled:!z,label:"Assets",locationId:v.id,assetCategoryId:(null==z?void 0:z.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]}),(0,a.jsx)(eC.Z,(0,F.Z)((0,O.Z)({},eE),{data:[{id:"compliance",label:"Compliance",value:!!V}],name:"compliance"})),V&&(0,a.jsx)(nC.P,(0,F.Z)((0,O.Z)({},eE),{label:"",locationId:v.id,name:"complianceSelect",type:"compliance"})),(0,a.jsx)(nw,{defaultValues:m,defaultOptions:eE,name:"frequencyForm",setValueParent:L,watchParent:N,setRRuleMeta:C,rruleMeta:w}),(0,a.jsx)(ej.Z,{label:"Frequency description",children:(0,a.jsx)(eI.Z,(0,F.Z)((0,O.Z)({},eE),{name:"frequencyDescription",rows:3}))}),b("admin")&&(0,a.jsx)(nH.n,{values:G,setValue:L,entityId:null!==(u=null==m?void 0:m.id)&&void 0!==u?u:null,entity:"JobSchedule",name:"tags"}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(e_.Z,(0,F.Z)((0,O.Z)({},eE),{label:"Customer cost per visit",name:"costCustomer",vat:"Ex VAT"}))}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(e_.Z,(0,F.Z)((0,O.Z)({},eE),{label:"Supplier cost per visit",name:"costSupplier",vat:"Ex VAT"}))})]}),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"customerSignature",type:"hidden"})),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"supplierSignature",type:"hidden"})),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"reportPassFail",type:"hidden"})),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"reportPassFailTitle",type:"hidden"})),(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},eE),{name:"requireReportRecommendations",type:"hidden"}))]}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(p.Z,{open:!0,title:"Schedule jobs preview",children:(0,a.jsx)(nJ.i,{getRowClassName:function(e){return e.row.id%2==0?"even":"odd"},columnHeaderHeight:35,rowHeight:35,columns:[{width:30,field:"date",renderHeader:function(){return(0,a.jsx)(eA.Z,{title:"To skip or remove jobs from the PPM schedule to be created,\n             deselect the relevant lines below",slotProps:{popper:{sx:{zIndex:1e4}}},children:(0,a.jsx)(eT.Z,{color:"secondary",checked:A.every(function(e){return e.selected}),onChange:function(e){return eM(e)}})})},sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsx)(eT.Z,{color:"secondary",checked:n.selected,onChange:function(e){return eR(e,n.id)}})}},{flex:1,field:"id",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.id+1}},{flex:1,field:"weekDay",headerName:"Day of week",sortable:!1},{flex:1,field:"day",headerName:"Day of month",sortable:!1},{flex:1,field:"month",headerName:"Month",sortable:!1},{flex:1,field:"year",headerName:"Year",sortable:!1}],rows:eJ})})})]}),(0,a.jsx)("input",(0,O.Z)({type:"hidden"},J("tags")))]})};nV.propTypes={currentJob:c.object,defaultValues:c.object,location:c.object,onSuccess:c.func.isRequired,user:c.object.isRequired};var nU=(0,$.ZP)(nC.P).withConfig({displayName:"form__StyledSelect",componentId:"sc-a136af17-0"})(nW(),function(e){return e.isDisabled?"background-color: #cecece !important;":""}),nz=t(66252),nG=t(72309),nB=t(74975),nY=t(55843),nK=t(83075),nQ=t(9928),nX=t(13077),n0=t(46901),n1=t(15861),n2=t(11057),n3=t(67720),n6=t(51233),n5=function(e){var n,t=e.jobs,i=e.location,s=e.offCanvas,u=e.refetch,l=e.row,d=e.showCreateJobButton,c=e.hideSupplier,m=(0,Z.x)().user,v=(0,nz.x)(),h=(0,r.useState)(!1),y=h[0],f=h[1],b=eE.ZP.fromString(l.frequency).origOptions.dtstart,g=er()(b).isBefore(er()(),"day"),x=(0,ea.Z)((0,el.D)(N.mJ,{onCompleted:(n=(0,et.Z)(function(e){var n,t,a,i,o,r,s,l,d,c,m,p;return(0,ei.__generator)(this,function(c){switch(c.label){case 0:if(!(i=(null==e?void 0:null===(n=e.createJob)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:null===(a=t.insert_Job)||void 0===a?void 0:a.returning)||[]).length)return[3,8];o=!0,r=!1,s=void 0,c.label=1;case 1:c.trys.push([1,6,7,8]),l=i[Symbol.iterator](),c.label=2;case 2:if(o=(d=l.next()).done)return[3,5];return m=d.value.id,[4,(0,nQ.F)(v,m)];case 3:c.sent(),c.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return p=c.sent(),r=!0,s=p,[3,8];case 7:try{o||null==l.return||l.return()}finally{if(r)throw s}return[7];case 8:return u(),[2]}})}),function(e){return n.apply(this,arguments)})}),1)[0],j=(0,ea.Z)((0,el.D)(eh),1)[0];t.sort(function(e,n){return e.timingStart>n.timingStart?1:n.timingStart>e.timingStart?-1:0});var I,S=t.filter(function(e){return new Date(e.timingStart)<new Date}).length,w=S>0?"(".concat(S," Past Occurrence)"):"",C=t.length,_=function(e,n){e.stopPropagation(),s.close(),o().push("/dashboard/issues/view?id=".concat(n))},k=(I=(0,et.Z)(function(){return(0,ei.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,,3,4]),f(!0),[4,j({variables:{id:l.id,object:{status:"ppmSupplierContractAdded"}}})];case 1:return e.sent(),[4,(0,nK.U$)({addJobFunc:x,location:i,row:l,adminId:m.adminId})];case 2:return e.sent(),u(),s.close(),[3,4];case 3:return f(!1),[7];case 4:return[2]}})}),function(){return I.apply(this,arguments)}),D=function(e){var n=e.job;return(0,a.jsxs)(H.Z,{children:[(0,a.jsx)(R.Z,{content:(0,nX.B)({value:n.status,textColor:"white"}),context:"dark",size:"sm"}),(0,a.jsx)(R.Z,(0,F.Z)((0,O.Z)({},{context:"secondary",size:"sm",startIconProps:{size:"lg"}}),{onClick:function(e){return _(e,n.number)},startIcon:"eye"}))]})};return(0,a.jsxs)(a.Fragment,{children:[y&&(0,a.jsx)(ek.Z,{sx:{zIndex:1e5},open:!0,children:(0,a.jsx)(eD.Z,{color:"secondary"})}),C<=0&&d?(0,a.jsxs)(n6.Z,{spacing:2,children:[!l.supplier&&(0,a.jsx)(n0.Z,{variant:"filled",severity:"error",children:"Error. There is no supplier currently specified for this item. Please select a supplier before trying to create jobs."}),g&&(0,a.jsx)(n0.Z,{variant:"filled",severity:"warning",color:"info",children:"The specified date of first job has passed. Please edit as required before creating these jobs."}),(0,a.jsxs)(n6.Z,{children:[(0,a.jsx)(n1.Z,{fontSize:16,sx:{alignSelf:"center"},children:"No jobs have been created as yet"}),(0,a.jsx)(n3.Z,{})]}),(0,a.jsx)(n6.Z,{direction:"row",justifyContent:"flex-end",children:(0,a.jsx)(n2.Z,{disabled:y||!l.supplier,onClick:k,variant:"contained",size:"large",children:"Create Jobs"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{children:"".concat(C," Future Occurrences ").concat(w)}),(0,a.jsx)(nY.Z,{}),t.map(function(e,n){var t,i;return(0,a.jsxs)(r.Fragment,{children:["".concat((0,nG.Z)(new Date(e.timingStart),{addSuffix:!0})," - ").concat((0,nB.Z)(new Date(e.timingStart),"LLL do yyyy")),(0,a.jsxs)(p.Z,{context:e.rag||"primary",open:n===S,title:"".concat(e.number," - ").concat((null===(t=e.shortJobDesc[0])||void 0===t?void 0:t.taxonomy.name)||e.title),toolbar:(0,a.jsx)(D,{job:e}),children:[(0,a.jsx)(q.Z,{content:"Description",text:e.description}),!c&&(0,a.jsx)(q.Z,{content:"Supplier",text:null===(i=e.supplier)||void 0===i?void 0:i.name})]},e.id),(0,a.jsx)(nY.Z,{marginBottom:"md"})]},n)})]})]})};function n4(){var e=(0,I.Z)(["\n  query GetScheduledJobInvoices(\n    $type: String\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $orderBy: AccountEntry_order_by!\n  ) {\n    ScheduledJobInvoice: AccountEntry(\n      limit: $limit\n      offset: $offset\n      where: { locationId: { _eq: $locationId }, Invoices: { invoiceType: { _eq: $type } } }\n      order_by: [$orderBy]\n    ) {\n      account: Account {\n        type\n      }\n      id\n      type\n      createdAt\n      debit\n      meta\n      outstandingdays\n      outstandingAmount\n      invoices: Invoices {\n        id\n        invoiceNumber\n      }\n      account: Account {\n        name\n      }\n    }\n    meta: AccountEntry_aggregate(\n      where: { locationId: { _eq: $locationId }, Invoices: { invoiceType: { _eq: $type } } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return n4=function(){return e},e}function n8(){var e=(0,I.Z)(['\n  query GetJobsForinvoice(\n    $type: String\n    $endDate: timestamptz\n    $locationId: Int\n    $startDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        JobTimings: { status: { _eq: "reportSent" } }\n        locationId: { _eq: $locationId }\n        jobScheduleId: { _is_null: false }\n        _and: [\n          {\n            JobTimings: {\n              status: { _eq: "completed" }\n              _and: [{ createdAt: { _gte: $startDate } }, { createdAt: { _lte: $endDate } }]\n            }\n          }\n        ]\n        _not: { JobTimings: { status: { _eq: $type } } }\n      }\n    ) {\n      id\n      number\n      adminId\n      title\n      description\n      quoted\n      reference\n      access\n      costCategory\n      pricing\n      timing\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      timingNormalHours\n      paymentMethod\n      customerSpendThreshold\n      time\n      amount\n      supplierLabourAmount\n      supplierMaterialsAmount\n      type\n      meta\n      source\n      discount\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      admin: Admin {\n        id\n        name\n        meta\n        bankAccounts: BankAccounts {\n          id\n          bank\n          stripeId\n          accountNumber\n          routingNumber\n          bic\n          iban\n          status\n          default\n          createdAt\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      timings: JobTimings(order_by: { createdAt: desc }) {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n        vatId\n      }\n      customer: Customer {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        financial: Financial {\n          id\n          amountOutstanding\n          approvalThreshold\n          arrangementFee\n          createdAt\n          creditLimit\n          creditRating\n          defaultPaymentMethod\n          invoicing\n          serviceRate\n          spendThreshold\n          stripeId\n          totalRevenue\n          unpaidInvoices\n        }\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        expenses: Expenses(where: { entity: { _eq: "Location" } }) {\n          id\n          amount\n          description\n          markup\n          total\n          unit\n          vat\n          paid\n          occurredAt\n          recurring\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          meta\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n        }\n      }\n      accountEntries: AccountEntries {\n        id\n        type\n      }\n    }\n  }\n']);return n8=function(){return e},e}function n7(){var e=(0,I.Z)(["\n  query GetPpmInvoiceItems($locationId: Int!, $startDate: timestamptz!, $endDate: timestamptz!) {\n    expenses: Expense(\n      where: {\n        locationId: { _eq: $locationId }\n        _and: [{ startDate: { _gte: $startDate } }, { endDate: { _lte: $endDate } }]\n      }\n    ) {\n      id\n      amount\n      unit\n      description\n      paid\n      vat\n      __typename\n    }\n  }\n"]);return n7=function(){return e},e}function n9(){var e=(0,I.Z)(["\n  mutation UpsertExpensesForPpmLocation($objects: [Expense_insert_input!]!) {\n    insert_Expense(\n      objects: $objects\n      on_conflict: { constraint: pk_Expense, update_columns: [description, amount, vat, total] }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return n9=function(){return e},e}function te(){var e=(0,I.Z)(["\n  mutation DeletePpmInvoiceItems($id: Int!) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return te=function(){return e},e}function tn(){var e=(0,I.Z)(["\n  mutation AddPPMInvoice(\n    $accountId: Int!\n    $timings: [JobTiming_insert_input!]!\n    $account: Account_set_input\n    $invoice: [Invoice_insert_input!]!\n  ) {\n    insert_Invoice(objects: $invoice) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $timings) {\n      returning {\n        id\n      }\n    }\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $account) {\n      id\n    }\n  }\n"]);return tn=function(){return e},e}function tt(){var e=(0,I.Z)(["\n  mutation AddPPMInvoice($invoice: [Invoice_insert_input!]!) {\n    insert_Invoice(objects: $invoice) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return tt=function(){return e},e}function ta(){var e=(0,I.Z)(["\n  mutation updateJob($id: Int!, $meta: jsonb!, $status: String) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: { status: $status, meta: $meta }) {\n      id\n    }\n  }\n"]);return ta=function(){return e},e}function ti(){var e=(0,I.Z)(["\n  mutation GenerateCustomerPpmInvoice($invoiceJobInput: CreatePpmInvoiceCustomerInput!) {\n    createPpmInvoiceCustomer(invoiceJobInput: $invoiceJobInput) {\n      data\n      success\n    }\n  }\n"]);return ti=function(){return e},e}function to(){var e=(0,I.Z)(["\n  mutation GenerateSupplierPpmInvoice($invoiceJobInput: CreatePpmInvoiceSupplierInput!) {\n    createPpmInvoiceSupplier(invoiceJobInput: $invoiceJobInput) {\n      data\n      success\n    }\n  }\n"]);return to=function(){return e},e}n5.propTypes={jobs:c.array.isRequired,showCreateJobButton:c.bool,hideSupplier:c.bool},n5.defaultProps={showCreateJobButton:!0,hideSupplier:!1};var tr=(0,S.Ps)(n4()),ts=(0,S.Ps)(n8()),tu=(0,S.Ps)(n7()),tl=(0,S.Ps)(n9()),td=(0,S.Ps)(te());(0,S.Ps)(tn()),(0,S.Ps)(tt()),(0,S.Ps)(ta());var tc=(0,S.Ps)(ti()),tm=(0,S.Ps)(to()),tp=t(74297),tv=t(46169),th=t(45416),ty=t(77651),tf=t(50480),tb=nk.Ry({dueDate:nk.Z_().required()}),tg=t(56063),tx=t(32979),tZ=[{id:"default",label:"Default (20%)",value:20},{id:"custom",label:"Custom",value:"custom"}],tj=function(e){var n=e.defaultValues,t=e.onClose,i=e.onAdd,o=e.onEdit;(null==n?void 0:n.vat)&&(null==n?void 0:n.vat)!==20?n.vatRadio="custom":n.vatRadio="20";var r=(0,ef.cI)({defaultValues:n}),s=r.register,u=r.control,c=r.errors,m=r.handleSubmit,p=(0,r.watch)("vatRadio"),v=function(e){var t=(0,F.Z)((0,O.Z)({},e),{id:n.id,index:n.index});"custom"!==t.vatRadio&&(t.vat=Number(t.vatRadio),delete t.vatRadio),n.edit?o(t):i(t)},h={register:s,control:u,errors:c};return(0,a.jsx)(eZ.Z,{handleSubmit:m(v),children:(0,a.jsxs)(d.Z,{md:12,children:[(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:4,children:(0,a.jsx)(ej.Z,{label:"Description",children:(0,a.jsx)(eS.Z,(0,F.Z)((0,O.Z)({},h),{name:"description"}))})}),(0,a.jsx)(d.Z,{md:4,children:(0,a.jsx)(e_.Z,(0,F.Z)((0,O.Z)({},h),{label:"Amount",vat:"Ex VAT",name:"amount"}))}),(0,a.jsx)(d.Z,{md:4,children:(0,a.jsx)(nh.Z,(0,F.Z)((0,O.Z)({},h),{name:"vatRadio",data:tZ,legend:"VAT"}))})]}),"custom"===p&&(0,a.jsx)(l.Z,{justify:"end",children:(0,a.jsx)(d.Z,{md:4,children:(0,a.jsx)(tx.Z,(0,F.Z)((0,O.Z)({},h),{label:"Custom VAT",name:"vat"}))})}),(0,a.jsxs)(H.Z,{align:"flex-end",children:[(0,a.jsx)(R.Z,{context:"danger",content:"Cancel",size:"sm",onClick:t}),(0,a.jsx)(R.Z,{context:"secondary",content:"Save",size:"sm",type:"submit"})]})]})})};tj.propTypes={defaultValues:(0,c.arrayOf)((0,c.shape)({index:c.number.isRequired})),onClose:c.func.isRequired,onAdd:c.func.isRequired,onEdit:c.func.isRequired};var tI=function(e){var n=e.defaultValues,t=e.onSubmit,i=e.onDelete,o=(0,r.useState)([]),s=o[0],u=o[1],l=(0,r.useState)(null),d=l[0],c=l[1];(0,r.useEffect)(function(){u(n)},[n]);var m=function(e){var n=(0,eN.Z)(s).concat([e]);t(n),c(null)},p=function(e){var n=(0,eN.Z)(s);n[e.index]=e,t(n),c(null)},h=function(e){i(e.id)},y=function(){c(null)},f=function(){c({})},b=[{hidden:!0},{hidden:!0},{text:"Description",formatter:function(e){return e.row.description}},{text:"Amount",formatter:function(e){return e.row.amount}},{text:"VAT",formatter:function(e){return e.row.vat}},{formatter:U.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){c((0,O.Z)({edit:!0},n))},tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:function(e,n){h(n)},tooltip:"Delete"}],text:"Actions"}];return(0,a.jsx)(a.Fragment,{children:d?(0,a.jsx)(tj,{defaultValues:d,onAdd:m,onEdit:p,onClose:y}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{columns:b,rows:s.map(function(e,n){return{index:n,id:e.id,description:e.description,amount:e.amount,vat:e.vat,actions:""}})}),(0,a.jsx)(H.Z,{align:"flex-end",children:(0,a.jsx)(R.Z,{context:"success",content:"Add Item",size:"sm",onClick:f})})," "]})})};tI.propTypes={onSubmit:c.func.isRequired,onDelete:c.func.isRequired,defaultValues:(0,c.arrayOf)((0,c.shape)({id:c.number.isRequired,description:c.string.isRequired,amount:c.number.isRequired,vat:c.number.isRequired}))};var tS=function(e){var n=e.items,t=e.locationId,a=e.startDate,i=e.endDate;return n.map(function(e){return{id:e.id,description:e.description,amount:e.amount,unit:1,markup:0,vat:e.vat,total:e.amount*(1+e.vat/100),locationId:t,startDate:a,endDate:i}})},tw=t(22595),tC=t(40234),t_={"customer-invoice":"invoiceSent","supplier-invoice":"invoiceSentSupplier"},tk=function(e){var n=e.locationId,t=e.toggleShow,i=e.numberPrefix,o=e.numberSuffix,c=e.mainJobRefetch,m=(0,ef.cI)({defaultValues:{month:new Date},resolver:(0,eb.S)(tb)}),p=m.control,h=m.errors,y=m.handleSubmit,f=m.register,b=m.getValues,g=m.setValue,x=(0,Z.x)().user,j=er()().utcOffset(),I=(0,r.useState)("customer-invoice"),S=I[0],w=I[1],C=(0,r.useState)(null),_=C[0],k=C[1],D=(0,r.useState)(!1),T=D[0],A=D[1],$=(0,r.useState)(!1),q=$[0],P=$[1],J=(0,r.useState)(new Date),L=J[0],N=J[1],W=(0,r.useState)(!1),U=W[0],G=W[1],B=(0,r.useState)([]),Y=B[0],K=B[1],Q=(0,r.useState)(!1),X=Q[0],ee=Q[1],en=(0,s.aM)(ts,{variables:{type:t_[S],endDate:q?null:er()(L).endOf("month").add(j,"minutes"),locationId:n,startDate:q?null:er()(L).startOf("month").add(j,"minutes")}}),eo=en.data,es=(void 0===eo?{jobs:[]}:eo).jobs,eu=en.refetch;(0,r.useEffect)(function(){var e=null==es?void 0:es[0];if(e){var n=S.split("-")[0];g("dueDate",(0,tC.I)({job:e,type:n,invoiceDate:new Date}))}},[es]),(0,r.useEffect)(function(){G(!1)},[es,L]),(0,r.useEffect)(function(){K([])},[L]);var ed,ec,em=(0,s.aM)(tu,{variables:{locationId:n,startDate:er()(L).startOf("month").add(j,"minutes"),endDate:er()(L).endOf("month").add(j,"minutes")}}),ep=em.data,ev=(void 0===ep?{expenses:[]}:ep).expenses,eh=em.refetch,ey=(0,ea.Z)((0,el.D)(tl,{onCompleted:function(){eh()}}),1)[0],eg=(0,ea.Z)((0,el.D)(td,{onCompleted:function(){eh()}}),1)[0],ex=(0,ea.Z)((0,el.D)(tc),1)[0],ej=(0,ea.Z)((0,el.D)(tm),1)[0],eI=(0,ea.Z)((0,el.D)(tc,{onCompleted:function(e){var n=e.createPpmInvoiceCustomer.data.accountEntry.meta;(0,tg.$)(n)}}),1)[0],eS=(0,ea.Z)((0,el.D)(tm,{onCompleted:function(e){e.createPpmInvoiceSupplier.data.accountEntries.forEach(function(e){var n=e.meta;(0,tg.$)(n)})}}),1)[0],ew=(ed=(0,et.Z)(function(e){var t,a;return(0,ei.__generator)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,5,6,7]),A(!0),t=er()().utcOffset(),"customer-invoice"!==S)return[3,2];return[4,ex({variables:{invoiceJobInput:{jobIds:Y,userId:x.id,locationId:n,dueDate:new Date(e.dueDate),invoicePeriodStart:er()(L).startOf("month").add(t,"minutes"),invoicePeriodEnd:er()(L).endOf("month").add(t,"minutes")}}})];case 1:return a.sent(),[3,4];case 2:if("supplier-invoice"!==S)return[3,4];return[4,ej({variables:{invoiceJobInput:{jobIds:Y,userId:x.id,locationId:n,dueDate:new Date(e.dueDate),invoicePeriodStart:er()(L).startOf("month").add(t,"minutes"),invoicePeriodEnd:er()(L).endOf("month").add(t,"minutes")}}})];case 3:a.sent(),a.label=4;case 4:return eu(),c(),[3,7];case 5:return k(a.sent()),[3,7];case 6:return A(!1),[7];case 7:return[2]}})}),function(e){return ed.apply(this,arguments)}),eC=(ec=(0,et.Z)(function(){var e,t;return(0,ei.__generator)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,5,6,7]),A(!0),e=b("dueDate"),"customer-invoice"!==S)return[3,2];return[4,eI({variables:{invoiceJobInput:{jobIds:Y,userId:x.id,locationId:n,dueDate:e||new Date,invoicePeriodStart:er()(L).startOf("month").add(j,"minutes"),invoicePeriodEnd:er()(L).endOf("month").add(j,"minutes"),preview:!0}}})];case 1:return t.sent(),[3,4];case 2:if("supplier-invoice"!==S)return[3,4];return[4,eS({variables:{invoiceJobInput:{jobIds:Y,userId:x.id,locationId:n,dueDate:e||new Date,invoicePeriodStart:er()(L).startOf("month").add(j,"minutes"),invoicePeriodEnd:er()(L).endOf("month").add(j,"minutes"),preview:!0}}})];case 3:t.sent(),t.label=4;case 4:return[3,7];case 5:return k(t.sent()),[3,7];case 6:return A(!1),[7];case 7:return[2]}})}),function(){return ec.apply(this,arguments)}),e_=function(){ee(!0)},ek=function(){N(b("month"))},eD=function(e,n){var t=n.id;e?K(function(e){return(0,eN.Z)(e).concat([t])}):K(function(e){return(0,eN.Z)(e.filter(function(e){return e!==t}))})},eA=function(e){e?(G(!0),K(es.map(function(e){return e.id}))):(G(!1),K([]))},e$=function(e){P(e)},eq=function(e){var t=tS({items:e,locationId:n,startDate:er()(L).startOf("month").add(j,"minutes"),endDate:er()(L).endOf("month").add(j,"minutes")});ey({variables:{objects:t}})},eP=function(e){eg({variables:{id:e}})},eE=[{text:(0,a.jsx)(eT.Z,{defaultChecked:!1,checked:U,onChange:function(e,n){eA(n)}}),formatter:function(e){var n=e.row;return(0,a.jsx)(eT.Z,{defaultChecked:!1,checked:Y.includes(n.id),onChange:function(e,t){eD(t,n)}})}},{text:"ID",formatter:function(e){var n;return n=e.row,(0,a.jsx)(th.D,{id:n.id,number:n.number,numberPrefix:i,numberSuffix:o,openCanvas:!0,type:"ppm",toggleShow:t})}},{text:"Supplier",hidden:"customer-invoice"===S},{text:"Short job description"},{text:"Start date",formatter:function(e){var n=e.row;return(0,a.jsx)("div",{style:{textWrap:"nowrap"},children:n.date})}},{text:"Completed date"},{text:"Customer Amount",hidden:"supplier-invoice"===S},{text:"Supplier Amount",hidden:"customer-invoice"===S},{text:"Customer Expenses",hidden:"supplier-invoice"===S},{text:"Supplier Expenses",hidden:"customer-invoice"===S},{text:"Status"}],eR={control:p,errors:h,register:f},eM=function(){k(null)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eZ.Z,{handleSubmit:y(ew),children:[(0,a.jsx)(ty.Z,{anchorOrigin:{vertical:"top",horizontal:"right"},open:!!_,autoHideDuration:6e3,onClose:eM,children:(0,a.jsx)(n0.Z,{onClose:eM,severity:"error",variant:"filled",sx:{width:"100%"},children:(null==_?void 0:_.message)||"Oops some error occurred. Please try again later"})}),(0,a.jsxs)(u.Z,{handleChange:!1,onTabChange:function(e){w(e)},children:[(0,a.jsx)("div",{active:"customer-invoice"===S,label:"Customer Invoice",children:null}),(0,a.jsx)("div",{active:"supplier-invoice"===S,label:"Supplier Invoice",children:null})]}),(0,a.jsx)(z.Z,{context:"info",content:"Only jobs with sent reports are available to invoice"}),(0,a.jsx)(nY.Z,{}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:3,style:{marginTop:"14px"},children:(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},eR),{dateFormat:"MM/yyyy",name:"month",placeholderText:"Click to select month",showMonthYearPicker:!0,isClearable:!1}))}),(0,a.jsx)(d.Z,{md:3,style:{alignSelf:"center"},children:(0,a.jsx)(R.Z,{content:"Show jobs",context:"secondary",size:"sm",onClick:ek})}),(0,a.jsx)(d.Z,{md:6,style:{alignSelf:"center"},children:(0,a.jsx)(tf.Z,{control:(0,a.jsx)(eT.Z,{color:"secondary",defaultChecked:!1,checked:q,onChange:function(e,n){e$(n)}}),label:"Include jobs not invoiced"})})]}),(0,a.jsx)(v.Z,{columns:eE,rows:es.map(function(e,n){var t,a,i;return{id:e.id,number:e.number,supplier:e.supplier.name,shortJobDesc:(null===(t=e.shortJobDesc)||void 0===t?void 0:null===(a=t[0])||void 0===a?void 0:null===(i=a.taxonomy)||void 0===i?void 0:i.name)||"-",date:(0,E.Z)(e.timingStart),completedDate:(0,E.Z)((0,tw.E)(e,"completed")),customerAmount:(0,M.Z)(e.amount),supplierAmount:(0,M.Z)(e.supplierLabourAmount+e.supplierMaterialsAmount),expensesCustomer:(0,M.Z)((0,tv.E)(e.expenses,0,"customer").totalExpenses),expensesSupplier:(0,M.Z)((0,tv.E)(e.expenses,0,"supplier").totalExpenses),status:(0,tp.Z)(e.status)}}),loading:T}),es&&es.length>0&&(0,a.jsxs)(l.Z,{style:{marginTop:"5px"},children:[(0,a.jsxs)(d.Z,{md:5,children:[(0,a.jsx)(V.Z,{children:"Due Date:"}),(0,a.jsx)(no.M,(0,F.Z)((0,O.Z)({},eR),{name:"dueDate",placeholder:"Due date",isClearable:!1}))]}),(0,a.jsx)(d.Z,{md:7,style:{alignSelf:"center",marginTop:"5px"},children:(0,a.jsxs)(H.Z,{align:"flex-end",children:["customer-invoice"===S&&!X&&0===ev.length&&(0,a.jsx)(R.Z,{disabled:T,context:"success",content:"Add Invoice Item",onClick:e_,size:"sm"}),(0,a.jsx)(R.Z,{disabled:T,context:"dark",content:"Preview Invoice",onClick:eC,size:"sm"}),(0,a.jsx)(R.Z,{disabled:T,context:"secondary",content:"Generate Invoice",type:"submit",size:"sm"})]})})]})]}),"customer-invoice"===S&&(X||ev.length>0)&&(0,a.jsx)(tI,{defaultValues:ev,onSubmit:eq,onDelete:eP})]})};tk.propTypes={customerId:c.number,locationId:c.number,jobScheduled:c.array,user:c.object,numberPrefix:c.string,numberSuffix:c.string};var tD=t(20705),tT=t(67427),tA={"customer-invoice":"customerPpmInvoice","supplier-invoice":"supplierPpmInvoice"},t$=function(e){var n,t,i=e.locationId,o=e.numberPrefix,l=e.numberSuffix,d=e.toggleShow,c=(0,ee.a)(),m=(0,Z.x)().hasRole,p=(0,r.useState)("customer-invoice"),v=p[0],h=p[1],y=(0,tD.x)({filters:{}}),f=y.initialData,b=y.ref,g=(0,O.Z)({type:tA[v],locationId:i},f),x=(0,s.aM)(tr,{variables:g}),j=x.data,I=void 0===j?{ScheduledJobInvoice:[],meta:{aggregate:{totalCount:0}}}:j,S=I.ScheduledJobInvoice,w=I.meta,C=x.loading,_=x.refetch,k=(n=(0,et.Z)(function(e,n){return(0,ei.__generator)(this,function(t){return e.preventDefault(),e.stopPropagation(),(0,tg.$)((0,O.Z)({},n.meta)),[2]})}),function(e,t){return n.apply(this,arguments)}),D=[{hidden:!0},{hidden:!0},{text:"Invoice Number"},{text:"Supplier",hidden:"customer-invoice"===v},{text:"Type"},{text:"Date"},{hidden:!0},{hidden:!0},{text:"Amount",formatter:function(e){var n=e.row;return(0,M.Z)(n.debit)}},{hidden:!0},{hidden:!0},{formatter:U.Z,formatterData:[{context:"secondary",icon:["fas","download"],onClick:(t={editClick:function(e,n){return k(e,n)}}).editClick,tooltip:"Download"}],text:"Actions"}],T=function(e){c.show({content:(0,a.jsx)(tT.u,{type:"customer",accountEntryType:e.itemType,data:e,numberSuffix:l,numberPrefix:o,refetch:_,toggleShow:function(){c.close(),d&&d()}}),title:"Invoice Details",submit:!1})};return(0,a.jsxs)(a.Fragment,{children:[m("admin","superadmin")?(0,a.jsxs)(u.Z,{handleChange:!1,onTabChange:function(e){h(e)},children:[(0,a.jsx)("div",{active:"customer-invoice"===v,label:"Customer Invoice",children:null}),(0,a.jsx)("div",{active:"supplier-invoice"===v,label:"Supplier Invoice",children:null})]}):(0,a.jsx)(u.Z,{handleChange:!1,onTabChange:function(e){h(e)},children:(0,a.jsx)("div",{active:"customer-invoice"===v,label:"Customer Invoice",children:null})}),(0,a.jsx)(B.t,{columns:D,loading:C,meta:w,ref:b,refetch:_,rows:S.map(function(e){var n,t;return{id:e.id,itemType:e.type,invoiceNumber:null===(n=e.invoices)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.invoiceNumber,supplier:e.account.name,type:(0,tp.Z)(e.account.type),date:(0,E.Z)(e.createdAt),outstandingDays:e.outstandingdays,outstandingAmount:e.outstandingAmount,debit:e.debit,credit:0,meta:e.meta,actions:""}}),rowClick:T})]})};t$.propTypes={locationId:c.number,numberPrefix:c.string,numberSuffix:c.string};var tq=function(e){var n=e.hasRole,t=e.locationId,i=e.numberPrefix,o=e.numberSuffix,r=e.toggleShow,s=e.mainJobRefetch;return n(["admin","superadmin"])?(0,a.jsxs)(u.Z,{handleChange:!1,children:[(0,a.jsx)("div",{active:!0,label:"All Invoices",children:(0,a.jsx)(t$,{locationId:t,numberPrefix:i,numberSuffix:o,toggleShow:r})}),(0,a.jsx)("div",{label:"New Invoice",children:(0,a.jsx)(tk,{locationId:t,toggleShow:r,numberPrefix:i,numberSuffix:o,mainJobRefetch:s})})]}):(0,a.jsx)(u.Z,{handleChange:!1,children:(0,a.jsx)("div",{active:!0,label:"All Invoices",children:(0,a.jsx)(t$,{locationId:t,numberPrefix:i,numberSuffix:o,toggleShow:r})})})};tq.propTypes={locationId:c.number,numberPrefix:c.string,numberSuffix:c.string,toggleShow:c.func};var tP=t(67230),tE=function(e){var n=e.id,t=e.onSuccess,i=(0,ea.Z)((0,el.D)(N.Ms,{onCompleted:t}),1)[0],o=function(){i({variables:{id:n}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{children:"Are you sure you want to delete JobSchedule?"}),(0,a.jsx)(n_.H,{content:"Delete",context:"danger",handleClick:o})]})};tE.propTypes={id:c.number.isRequired,onSuccess:c.func.isRequired};var tR=t(5616),tM=t(41899),tJ=t(86886),tO=t(90629);function tF(){var e=(0,I.Z)(["\n  query GetJobSchedule(\n    $locationId: Int\n    $orderBy: JobSchedule_order_by!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      where: { locationId: { _eq: $locationId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return tF=function(){return e},e}function tL(){var e=(0,I.Z)(["\n  mutation CopyScheduleItems(\n    $originLocationId: Int!\n    $copyLocationIds: [Int!]!\n    $selectType: String!\n    $scheduleIds: [Int]\n  ) {\n    copyScheduleItems(\n      originLocationId: $originLocationId\n      copyLocationIds: $copyLocationIds\n      selectType: $selectType\n      scheduleIds: $scheduleIds\n    ) {\n      data\n      success\n    }\n  }\n"]);return tL=function(){return e},e}var tN=(0,S.Ps)(tF()),tH=(0,S.Ps)(tL()),tW=t(4972),tV=t(48580),tU=nk.Ry({locations:nk.IX().of(nk.Ry({value:nk.Rx().integer().required(),label:nk.Z_().required()}).required()).min(1).required()}),tz=t(39641),tG={item:"createdAt",order:"asc"},tB=function(e){var n,t=e.locationId,i=(0,tz.D)(),o=(0,(0,Z.x)().hasRole)("admin"),u=(0,r.useState)("selectAll"),l=u[0],d=u[1],c=(0,r.useState)([]),m=c[0],p=c[1],v=(0,r.useState)(""),h=v[0],y=v[1],f=(0,tD.x)({initialSort:tG}),b=f.initialData,g=f.ref,x=(0,ef.cI)({defaultValues:{locations:[]},resolver:(0,eb.S)(tU)}),j=x.handleSubmit,I=x.control,S=x.errors,w=(0,ea.Z)((0,el.D)(tH,{onCompleted:function(){i.show({content:"Success. This planned maintenance schedule\n        has been copied to the selected locations.\n        Please note that you will still need to click on the relevant\n        item in the location to create the individual jobs."})},onError:function(e){i.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),C=w[0],_=w[1].loading,k=(0,s.aM)(tN,{variables:(0,F.Z)((0,O.Z)({},b),{locationId:t})}),D=k.data,T=void 0===D?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:D,A=T.jobSchedule,$=T.meta,q=k.loading,P=k.refetch,E=(0,s.aM)(tW._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==h?"%".concat(h,"%"):null}},limit:50,offset:0}}),R=E.loading,M=E.data,J=(void 0===M?{items:[]}:M).items,L=function(e){var n=e.row;return"selectAll"===l||"excludeAll"!==l&&("selectSome"===l?m.includes(n.id):"excludeSome"===l&&!m.includes(n.id))},N=function(e){var n=e.row;return function(e,t){var a=m.includes(n.id)&&1===m.length;return"selectAll"!==l&&"excludeSome"!==l||t?"excludeSome"===l&&t?(a&&d("selectAll"),p(function(e){return e.filter(function(e){return e!==n.id})})):("excludeAll"===l||"selectSome"===l)&&t?(d("selectSome"),p(function(e){return(0,eN.Z)(e).concat([n.id])})):"selectSome"!==l||t?void 0:(a&&d("excludeAll"),p(function(e){return e.filter(function(e){return e!==n.id})})):(d("excludeSome"),p(function(e){return(0,eN.Z)(e).concat([n.id])}))}},H=A.map(function(e,n){return{index:n,id:e.id,title:e.meta.shortDescriptionName,description:e.meta.description,sublocation:e.sublocation,service:e.meta.serviceName,supplier:e.meta.supplierName,frequencyDescription:e.frequencyDescription}}),W=(n=(0,et.Z)(function(e){return(0,ei.__generator)(this,function(n){switch(n.label){case 0:if("excludeAll"===l)return[2];return[4,C({variables:{originLocationId:t,copyLocationIds:e.locations.map(function(e){return e.value}),selectType:l,scheduleIds:m}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),V=(0,r.useMemo)(function(){return J.map(function(e){var n,t,a=null===(n=e.registeredAddress)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address;return{label:"".concat(e.label,", ").concat((null==a?void 0:a.addressLine1)||""),value:e.value}})},[J]);return(0,a.jsxs)("form",{id:"offCanvasForm",onSubmit:j(W),children:[_&&(0,a.jsx)(ek.Z,{sx:{zIndex:1e5},open:!0,children:(0,a.jsx)(eD.Z,{color:"secondary"})}),(0,a.jsxs)(tJ.ZP,{container:!0,rowSpacing:4,children:[(0,a.jsx)(tJ.ZP,{item:!0,xs:12,children:(0,a.jsx)(ef.Qr,{name:"locations",control:I,render:function(e){var n,t=e.value,i=e.onChange;return(0,a.jsx)(tV.q,{multiple:!0,limitTags:6,color:"secondary",filterSelectedOptions:!0,loading:R,value:t||[],onChange:function(e,n){i(n)},options:V,setSearch:y,textFieldProps:{label:"Select locations",variant:"standard",color:"secondary",error:S.locations,helperText:null===(n=S.locations)||void 0===n?void 0:n.message}})}})}),(0,a.jsx)(tJ.ZP,{item:!0,xs:12,children:(0,a.jsx)(tO.Z,{elevation:5,sx:{pb:1},children:(0,a.jsx)(nJ.i,{paginationSize:10,ref:g,getRowHeight:function(e){return e.model.sublocation?72:52},getRowClassName:function(e){return e.row.index%2==0?"even":"odd"},loading:q,columns:[{width:50,field:"select",sortable:!1,renderHeader:function(){return(0,a.jsx)(eT.Z,{color:"secondary",checked:"selectAll"===l,onChange:function(e,n){n?(d("selectAll"),p([])):(d("excludeAll"),p([]))}})},renderCell:function(e){var n=e.row;return(0,a.jsx)(eT.Z,{color:"secondary",checked:L({row:n}),onChange:N({row:n})})}},{minWidth:40,width:40,field:"index",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.index+1+b.offset}},{flex:1,field:"job",headerName:"Job",sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsxs)(n6.Z,{children:[(0,a.jsx)(n1.Z,{fontWeight:700,children:n.title}),(0,a.jsx)(n1.Z,{children:n.description}),n.sublocation&&(0,a.jsxs)(n6.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(n1.Z,{fontWeight:700,children:"Sublocation:"}),(0,a.jsxs)(n1.Z,{children:[" ",n.sublocation.name]})]})]})}},{flex:1,field:"service",headerName:"Service",sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsxs)(n6.Z,{children:[(0,a.jsx)(n1.Z,{children:n.service}),o&&(0,a.jsxs)(n1.Z,{children:["Assigned to: ",n.supplier]})]})}},{flex:1,field:"frequencyDescription",headerName:"Frequency",sortable:!1}],rows:H,meta:$,refetch:P})})})]})]})};tB.defaultProps={},tB.propTypes={locationId:m().number.isRequired};var tY=t(86267),tK=t(83985),tQ={item:"id",order:"asc"},tX=function(e){var n,t,i,o=e.location,u=e.refetch,l=e.setNextJob,d=e.setNextTaskExp,c=e.user,m=e.editable,v=(0,nN.q)(),h=v.admin,y=v.hasUserModule,f=(0,Z.x)().hasRole,b=(0,L.useMainContext)(),g=b.customerDetails,x=b.setCustomerDetails,j=b.supplierDetails,I=b.setSupplierDetails,S=(0,r.useState)(!1),w=S[0],C=S[1],_=(0,r.useState)(!1),k=_[0],D=_[1],T=(0,r.useState)(!0),A=T[0],$=T[1],q=(null==h?void 0:null===(n=h.jobSetting)||void 0===n?void 0:n.jobNumberPrefix)||"",E=(null==h?void 0:null===(t=h.jobSetting)||void 0===t?void 0:t.jobNumberSuffix)||"",J=(0,tD.x)({filters:{},initialSort:tQ}),K=J.initialData,Q=J.ref,X=f("tenant"),et=f("admin"),ea=f("supplier"),ei=f("customer"),eo=f("customer_user"),er=y("finances"),es=(0,ee.a)(),eu=(0,s.aM)(N.RV,{variables:(0,O.Z)({locationId:o.id},K)}),el=eu.loading,ed=eu.data,ec=void 0===ed?{JobSchedule:[],meta:{aggregate:{totalCount:0}}}:ed,em=ec.JobSchedule,ep=ec.meta,ev=eu.refetch;(0,r.useEffect)(function(){var e=(0,nK.BH)({scheduledJobs:em});d(e.nextExpire),l(e.nextJob)},[em,l,d]);var eh,ey=(0,s.aM)(N.B6,{variables:{locationId:o.id}}),ef=ey.data,eb=(void 0===ef?{jobs:[]}:ef).jobs,eg=ey.refetch,ex=eb.length>0,eZ=(0,r.useCallback)(function(){es.close(),ev(),eg(),C(!0)},[es,eg,ev]),ej=function(e,n,t){D(!1),es.show({content:(0,a.jsx)(n5,{hideSupplier:X,jobs:eb.filter(function(a){return n?a.jobScheduleId===(null==e?void 0:e.id)&&(0,nK.CH)(a,t):a.jobScheduleId===(null==e?void 0:e.id)}),location:o,offCanvas:es,refetch:u,row:e}),submit:!1,title:"Work orders"})},eI=(0,r.useCallback)(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.stopPropagation(),D(!1);var t=(0,O.Z)({estimatedDuration:54e5,estimatedDurationUnit:"minutes"},n);if("inactive"===o.status){D(!0);return}es.show({content:(0,a.jsx)(nV,{currentJob:eb.find(function(e){return new Date(e.timingStart)>new Date||!(0,tw.E)(e,"completed")}),defaultValues:t,location:o,onSuccess:eZ,user:c}),title:"Add item",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},[eZ,eb,o,es,c]),eS=(0,r.useCallback)(function(e){e.stopPropagation(),D(!1),es.show({content:(0,a.jsx)(tq,{hasRole:f,mainJobRefetch:eZ,locationId:o.id,numberPrefix:q,numberSuffix:E,toggleShow:es.close}),title:"Invoices",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},[eZ,f,o.id,q,E,es]),ew=(0,r.useCallback)(function(e,n){e.stopPropagation(),D(!1),es.show({content:(0,a.jsx)(tY.G,{expanded:!0,hideExpandIcon:!0,entity:"JobSchedule",entityId:null==n?void 0:n.id,onMediaAdd:function(){return ev()},onMediaRemove:function(){return ev()}}),submit:!1,title:"Media"})},[es,ev]),eC=(0,r.useCallback)(function(e,n){e.stopPropagation(),D(!1);var t=n.jobs.filter(function(e){return!(0,tw.E)(e,["completed","closed"])});es.show({content:(0,a.jsx)(Y.z,{entity:"JobSchedule",entityId:n.id,jobs:t,withDetails:!1}),submit:!1,title:"Expenses"})},[es]),e_=(0,r.useCallback)(function(e){e.stopPropagation(),$(!A)},[A]),ek=(0,r.useCallback)(function(e,n){var t;if(e.stopPropagation(),(null===(t=n.jobs)||void 0===t?void 0:t.length)>0)return!1;es.show({content:(0,a.jsx)(tE,{id:n.id,onSuccess:eZ}),submit:!1,title:"Delete JobSchedule"})},[eZ,es]),eD=(0,r.useCallback)(function(e){e.stopPropagation(),es.show({content:(0,a.jsx)(tB,{locationId:o.id}),title:"Copy Schedule",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"90vw",lg:"90vw",lg2:"80vw"})},[o.id,es]),eA=(0,r.useCallback)(function(){var e={context:"secondary",size:"sm",startIconProps:{size:"lg"}};return(0,a.jsxs)(H.Z,{children:[(0,a.jsx)(W.Z,{content:"Calendar view",children:(0,a.jsx)(R.Z,(0,F.Z)((0,O.Z)({},e),{context:"info",onClick:function(e){return e_(e)},startIcon:A?"table":"calendar-alt"}))}),!X&&(!eo||er)&&(0,a.jsx)(W.Z,{content:"Invoices",children:(0,a.jsx)(R.Z,(0,F.Z)((0,O.Z)({},e),{onClick:function(e){return eS(e)},startIcon:"file-invoice"}))}),(0,a.jsx)(P.Z,{border:!1,to:"/reports/ppm/schedule?locationId=".concat(o.id),onClick:function(e){return e.stopPropagation()},children:(0,a.jsx)(W.Z,{content:"View as PDF",children:(0,a.jsx)(R.Z,(0,F.Z)((0,O.Z)({},e),{startIcon:"file-pdf"}))})}),!ei&&!X&&(0,a.jsx)(W.Z,{content:"Add Item",children:(0,a.jsx)(R.Z,(0,F.Z)((0,O.Z)({},e),{context:"primary",onClick:eI,startIcon:"plus"}))}),et&&(0,a.jsx)(n2.Z,{variant:"contained",color:"secondary",sx:{height:"31px"},onClick:eD,children:(0,a.jsx)(tM.Z,{sx:{height:"18px"}})})]})},[eD,eI,eS,e_,er,et,ei,eo,X,o.id,A]),e$=0,eq=0,eP=function(e){"supplierDetails"===e.target.name?I(!j):"customerDetails"===e.target.name&&x(!g)},eE=(0,r.useMemo)(function(){return[{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{size:"sm",children:n.title}),(0,a.jsx)(tK.O,{maxLength:40,children:n.description}),n.sublocation&&(0,a.jsxs)(V.Z,{size:"xs",children:["Sublocation: ",n.sublocation.label]})]})},text:"Job"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{size:"sm",children:n.service.label}),f("admin")&&n.supplier&&(0,a.jsxs)(V.Z,{size:"xs",children:["Assigned to: ",n.supplier.label]})]})},text:"Service"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n,t=e.row;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{size:"sm",children:"".concat(null===(n=t.jobs)||void 0===n?void 0:n.length," Jobs ").concat(t.completeCount," completed")}),(0,a.jsx)(V.Z,{size:"xs",children:t.frequencyDescription})]})},text:"Frequency"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n,t,i=e.row;return(0,a.jsxs)(a.Fragment,{children:[g&&f("admin")&&(0,a.jsxs)(V.Z,{size:"sm",children:["Customer ",(null===(n=o.meta)||void 0===n?void 0:n.monthlyAmount)?"":(0,M.Z)(i.costCustomerSoFar)]}),j&&f("admin")&&(0,a.jsxs)(V.Z,{size:"sm",children:["Supplier ",(0,M.Z)(i.costSupplierSoFar)]}),ei&&(0,a.jsx)(V.Z,{size:"sm",children:(null===(t=o.meta)||void 0===t?void 0:t.monthlyAmount)?"":(0,M.Z)(i.costCustomerSoFar)}),ea&&(0,a.jsx)(V.Z,{size:"sm",children:(0,M.Z)(i.costSupplierSoFar)})]})},text:"Price",hidden:!g&&!j&&f("admin")||X||eo&&!er},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:f("customer")||!m,formatter:U.Z,formatterData:function(e){var n;return[{context:"secondary",icon:["fas","file-upload"],numberOverlay:"mediaCount",onClick:function(e,n){return ew(e,n)},tooltip:"Media"},{context:"secondary",icon:["fas","receipt"],onClick:function(e,n){return eC(e,n)},tooltip:"Expenses"},{context:"info",icon:["fas","edit"],onClick:function(e,n){return eI(e,n)},tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:function(e,n){return ek(e,n)},tooltip:"Delete",disabled:(null==e?void 0:null===(n=e.jobs)||void 0===n?void 0:n.length)>0}]},text:"Actions"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0}]},[g,m,eC,ew,eI,ek,er,f,ei,eo,ea,X,null===(i=o.meta)||void 0===i?void 0:i.monthlyAmount,j]),eR=(0,r.useMemo)(function(){return em.map(function(e){var n,t,a,i,o,r,s,u,l,d=[];e$+=(0,nK.tf)({frequency:e.frequency,cost:e.meta.costCustomer}),eq+=(0,nK.tf)({frequency:e.frequency,cost:e.meta.costSupplier});var c=(null===(n=e.meta)||void 0===n?void 0:n.assetCategoryId)?{value:e.meta.assetCategoryId,label:e.meta.assetCategoryName}:null;return(null===(t=e.meta)||void 0===t?void 0:null===(a=t.assets)||void 0===a?void 0:a.length)>0&&(d=e.meta.assets),{id:e.id,tags:e.meta.tags,title:e.meta.shortDescriptionName,description:e.meta.description,costCategory:{value:e.meta.costCategoryId,label:e.meta.costCategoryName},service:{value:e.meta.serviceId,label:e.meta.serviceName},serviceName:e.meta.serviceName,supplier:e.meta.supplierId?{value:e.meta.supplierId,label:e.meta.supplierName}:null,supplierName:e.meta.supplierName,assetCategory:c,assetSelected:d,frequency:e.frequency,frequencyDescription:e.frequencyDescription,jobs:e.jobs,completeCount:(0,nK.k3)({jobScheduleId:e.id,jobs:eb}),paymentMethod:e.paymentMethod,shortDescription:{value:e.meta.shortDescriptionId,label:e.meta.shortDescriptionName},complianceSelect:e.meta.complianceSelect,costCustomer:e.meta.costCustomer,costSupplier:e.meta.costSupplier,costCustomerSoFar:(0,nK.tf)({frequency:e.frequency,cost:e.meta.costCustomer}),costSupplierSoFar:(0,nK.tf)({frequency:e.frequency,cost:e.meta.costSupplier}),jobScheduledExpenses:e.expenses,actions:"",mediaCount:null==e?void 0:null===(i=e.media)||void 0===i?void 0:i.length,reference:e.reference,reportPassFail:e.meta.reportPassFail,reportPassFailTitle:e.meta.reportPassFailTitle,customerSignature:null===(o=e.meta)||void 0===o?void 0:o.customerSignature,supplierSignature:null===(r=e.meta)||void 0===r?void 0:r.supplierSignature,requireReportRecommendations:e.meta.requireReportRecommendations,sublocation:e.sublocation?{label:null===(s=e.sublocation)||void 0===s?void 0:s.name,value:null===(u=e.sublocation)||void 0===u?void 0:u.id}:null,estimatedDuration:e.estimatedDuration,estimatedDurationUnit:e.estimatedDurationUnit,rruleMeta:null===(l=e.meta)||void 0===l?void 0:l.rruleMeta,dates:e.dates}})},[em]);return(0,a.jsxs)(a.Fragment,{children:[f("admin")&&(0,a.jsxs)(tR.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(tf.Z,{control:(0,a.jsx)(eT.Z,{color:"secondary",name:"customerDetails",checked:g,onChange:eP}),label:"Show customer amounts"}),(0,a.jsx)(tf.Z,{control:(0,a.jsx)(eT.Z,{color:"secondary",name:"supplierDetails",checked:j,onChange:eP}),label:"Show supplier amounts"})]}),(0,a.jsx)(p.Z,{fitParentHeight:!0,open:!0,title:"Items",toolbar:(0,a.jsx)(eA,{}),children:A?(0,a.jsxs)(a.Fragment,{children:[k&&(0,a.jsx)(z.Z,{context:"info",content:"This location is inactive"}),(0,a.jsx)(B.t,{columns:eE,initialSort:tQ,loading:el,meta:ep,ref:Q,refetch:u,rowClick:ej,rows:eR}),!X&&(0,a.jsxs)("div",{style:{textAlign:"right",marginTop:"8px"},children:[(et&&g||ei&&(!eo||er))&&(0,a.jsx)(G.Z,{content:(0,a.jsxs)(a.Fragment,{children:[f("customer")?"Total":"Customer Total",":"," ",(0,a.jsx)("b",{children:(null===(eh=o.meta)||void 0===eh?void 0:eh.monthlyAmount)?"Monthly: ".concat((0,M.Z)(o.meta.monthlyAmount)):(0,M.Z)(e$)})]}),context:"dark",shape:"round",size:"sm"}),(j||f("supplier"))&&(0,a.jsx)(G.Z,{content:(0,a.jsxs)(a.Fragment,{children:[f("supplier")?"Total":"Supplier Total",":"," ",(0,a.jsx)("b",{children:(0,M.Z)(eq)})]}),context:"dark",shape:"round",size:"sm"})]})]}):(0,a.jsx)(en,{jobs:eb,jobSchedule:em})}),ex&&(0,a.jsx)(tP.K,{refetchSchedule:w,setRefetchSchedule:C,locationId:o.id,handleHistory:ej,customerDetails:g,supplierDetails:j})]})};tX.propTypes={location:c.object.isRequired,refetch:c.func.isRequired};var t0=t(35418),t1=t(16352);function t2(){var e=(0,I.Z)(["\n  min-height: 130px;\n  div {\n    font-size: 16px;\n  }\n"]);return t2=function(){return e},e}var t3=function(e){var n,t,i,o,s,u,c=e.location,m=e.refetch,v=e.user,h=(0,Z.x)().hasRole,y=(0,nN.q)().hasUserModule,f=(0,ee.a)(),b=(0,r.useState)(null),g=b[0],x=b[1],j=(0,r.useState)(null),I=j[0],S=j[1],w=h("tenant"),C=h("admin"),_=h("customer_user"),k=y("finances"),D=c.meta,T=void 0===D?{}:D,A=function(e){e.stopPropagation(),f.show({content:(0,a.jsx)(t1.Z,{defaultValues:{monthlyAmount:null==T?void 0:T.monthlyAmount},location:c,offCanvas:f,refetch:m}),submit:!0,title:"Billing"})};return(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)(d.Z,{md:3,children:[(0,a.jsxs)(l.Z,{children:[g&&g.name&&(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(t6,{body:g.name,className:"tile1",colourConfig:{10:"success"},description:g.date&&(0,E.Z)(g.date),rounded:!0,size:"xxs",title:"Next task"})}),I&&I.title&&(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(t6,{body:"".concat(I.title),colourConfig:{10:"success"},description:I.timingStart&&"".concat((0,E.Z)(I.timingStart)),rounded:!0,size:"xxs",title:"Next job"})})]}),(t=c.access,i=c.customer,o=c.id,s=c.name,u=c.user,(0,a.jsxs)(p.Z,{fitParentHeight:!0,title:"Contact",children:[(0,a.jsx)(q.Z,{text:w?i[0].account.manager.fullName:(0,a.jsx)(P.Z,{to:"/dashboard/users/view?id=".concat(i[0].account.managerId),children:i[0].account.manager.fullName}),content:"Assigned to"}),(0,a.jsx)(q.Z,{text:w?i[0].account.name:(0,a.jsx)(P.Z,{to:"/dashboard/customers/view?id=".concat(i[0].account.id),children:i[0].account.name}),content:"Customer"}),(0,a.jsx)(q.Z,{text:(0,a.jsxs)(a.Fragment,{children:[w?(0,a.jsx)(a.Fragment,{children:u?u.fullName:""}):(0,a.jsx)(P.Z,{to:"/dashboard/users/view?id=".concat(u&&u.id),children:u?u.fullName:""}),(0,a.jsx)("br",{}),w?(0,a.jsx)(a.Fragment,{children:u?u.phone:""}):(0,a.jsx)(P.Z,{to:"tel:".concat(u&&u.phone),children:u?u.phone:""})]}),content:"Contact"}),(0,a.jsx)(q.Z,{text:w?s:(0,a.jsx)(P.Z,{to:"/dashboard/properties/view?id=".concat(o,"&tab=details"),children:s}),content:"Location"}),(0,a.jsx)(q.Z,{text:t,content:"Access information"})]})),!w&&(!_||k)&&(0,a.jsx)(p.Z,{toolbar:(0,a.jsx)(R.Z,{context:"info",onClick:A,size:"sm",startIcon:"edit"}),open:!0,title:"Billing",children:(0,a.jsx)(q.Z,{content:"Monthly amount",text:(null==T?void 0:T.monthlyAmount)?(0,M.Z)(T.monthlyAmount):(0,M.Z)(0)})}),(0,a.jsx)(t0.G,{showActionButtons:!w,category:"PPM",details:!0,entity:"Location",entityId:c.id,summary:"Documentation"})]}),(0,a.jsx)(d.Z,{md:9,children:(0,a.jsx)(tX,{location:c,refetch:m,setNextTaskExp:x,setNextJob:S,user:v,editable:C})})]})},t6=(0,$.ZP)(J.Z).withConfig({displayName:"view__StyledTile",componentId:"sc-9b8ea357-0"})(t2());t3.propTypes={location:c.object.isRequired,refetch:c.func.isRequired};var t5=t(67259),t4=function(e){var n,t,c,m,p,v,h,y,f,b,g,x,I,S,w,$,q,P,E,R,M,J,O,F,L,N=e.id,H=(0,Z.x)().hasRole,W=(0,i.useRouter)().query,V=(0,nN.q)(),U=null==V?void 0:null===(n=V.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,z=H("tenant"),G=(0,r.useMemo)(function(){return W.tab||"details"},[W.tab]),B=(0,s.aM)(C,{fetchPolicy:"no-cache",variables:{id:N}}),Y=B.loading,K=B.data,Q=B.error,X=B.refetch;if(Q)return o().push("/404"),!1;if(Y)return(0,a.jsx)(n6.Z,{height:"100%",width:"100%",justifyContent:"center",alignItems:"center",children:(0,a.jsx)(eD.Z,{color:"secondary"})});var ee=[(0,a.jsx)("div",{active:"details"===G||!G,label:"Details",children:(0,a.jsx)(j,{tenant:K.tenant,refetch:X,location:K.tenant.booking[0].location})}),(0,a.jsx)("div",{active:"sublocations"===G,label:"Sublocations",children:(0,a.jsx)(D.E,{editable:!z,hideLink:z,location:K.tenant.booking[0].location,customer:K.tenant.booking[0].location.customer[0].account})}),(0,a.jsx)("div",{hide:!U,active:"assets"===G,label:"Assets",children:(0,a.jsx)(A.E,{editable:!1,hideLink:!0,hideCustomerInfo:!0,hideLocationInfo:!0,showHeader:!1,initialFilters:{locationId:null===(m=null==K?void 0:null===(c=K.tenant)||void 0===c?void 0:c.booking[0])||void 0===m?void 0:null===(p=m.location)||void 0===p?void 0:p.id,filterType:"tenant_assets"}})}),(0,a.jsx)("div",{active:"slas"===G,label:"SLAs",children:(0,a.jsxs)(u.Z,{handleChange:!1,children:[(0,a.jsx)("div",{active:!0,label:"Work Order SLAs",children:(0,a.jsx)(T.H,{title:"Work Order SLAs",subtype:"reactive",isEntity:!0,isLocation:!0,entity:"Location",entityId:null===(h=null==K?void 0:null===(v=K.tenant)||void 0===v?void 0:v.booking[0])||void 0===h?void 0:null===(y=h.location)||void 0===y?void 0:y.id})}),(0,a.jsx)("div",{label:"Quote SLAs",children:(0,a.jsx)(T.H,{title:"Quote SLAs",subtype:"quote",isEntity:!0,isLocation:!0,entity:"Location",entityId:null===(b=null==K?void 0:null===(f=K.tenant)||void 0===f?void 0:f.booking[0])||void 0===b?void 0:null===(g=b.location)||void 0===g?void 0:g.id})})]})}),(0,a.jsx)("div",{active:"work-orders"===G,label:"Work Orders",children:(0,a.jsx)(t5.A,{filtersVisibilityModel:{customer:H("admin"),location:H(["admin","supplier"]),user:H("supplier"),manager:!1,customerManager:!1,accountManager:!1},entityRelationToFetch:{locationId:null===(I=null==K?void 0:null===(x=K.tenant)||void 0===x?void 0:x.booking[0])||void 0===I?void 0:null===(S=I.location)||void 0===S?void 0:S.id},initialFilters:{startDate:null,endDate:null,status:null,id:null,filterType:"tenants_work_orders_tab"}})}),(0,a.jsx)("div",{active:"compliance"===G,label:"Compliance",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(_.M,{data:null===($=null==K?void 0:null===(w=K.tenant)||void 0===w?void 0:w.booking[0])||void 0===$?void 0:null===(q=$.location)||void 0===q?void 0:q.compliances,entity:"Location",entityId:null===(E=null==K?void 0:null===(P=K.tenant)||void 0===P?void 0:P.booking[0])||void 0===E?void 0:null===(R=E.location)||void 0===R?void 0:R.id,refetch:X,showOverallRating:!0})}),(0,a.jsx)(d.Z,{md:6,children:(0,a.jsx)(k.F,{compliance:!0,locationId:null===(J=null==K?void 0:null===(M=K.tenant)||void 0===M?void 0:M.booking[0])||void 0===J?void 0:null===(O=J.location)||void 0===O?void 0:O.id,showFilters:!1})})]})}),(0,a.jsx)("div",{active:"planned-maintenance"===G,label:"Planned Maintenance",children:(0,a.jsx)(t3,{location:null===(L=null==K?void 0:null===(F=K.tenant)||void 0===F?void 0:F.booking[0])||void 0===L?void 0:L.location,refetch:X,user:K})})];return(0,a.jsx)(u.Z,{children:ee.filter(function(e){return!e.props.hide}).map(function(e){return e})},G)},t8=function(){var e=(0,i.useRouter)().query,n=(0,Z.x)(),t=n.hasRole,r=n.user,s=t("tenant"),u=s?r.id:e.id;return u?(0,a.jsx)(t4,{id:u,isTenant:s,adminId:null==r?void 0:r.adminId}):(o().push("/404"),null)},t7=t(58849),t9=function(){return(0,a.jsx)(t8,{})};t9.getLayout=function(e){return(0,a.jsx)(t7.Z,{children:e})};var ae=t9}},function(e){e.O(0,[3662,367,9809,2283,212,8890,619,2583,4135,8579,6043,1838,4244,3911,1417,3776,1564,3054,2329,8500,778,4046,1023,7454,1870,2797,1047,4043,8062,3058,6313,597,3754,1050,4061,6075,4191,5447,1836,7490,108,7349,8849,8344,6733,6096,7305,1514,2982,5469,6625,5656,7641,9774,2888,179],function(){return e(e.s=24903)}),_N_E=e.O()}]);