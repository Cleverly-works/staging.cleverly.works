(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6889],{51332:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/admins/view",function(){return e(36502)}])},71225:function(n,t,e){"use strict";e.d(t,{Q:function(){return i}});var i=function(n){var t,e,i=n&&n.length>0&&n.find(function(n){var t;return(null===(t=n.medium)||void 0===t?void 0:t.category)==="avatar"});if(!i)return null;var o="".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(i.medium.filename),r=null==i?void 0:null===(t=i.medium)||void 0===t?void 0:null===(e=t.meta)||void 0===e?void 0:e.thumbnails;if(null==r?void 0:r.length){var a=r.find(function(n){return"small"===n.name});(null==a?void 0:a.relativePath)&&(o="".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(a.relativePath))}return o}},35418:function(n,t,e){"use strict";e.d(t,{G:function(){return k}});var i=e(26042),o=e(69396),r=e(7297),a=e(85893),c=e(67294),u=e(45697),s=e(6388),d=e(52824),l=e(10367),m=e(78289),f=e(41564),p=e(34953),v=e(62466),h=e(68956),g=e(73373),y=e(11585),x=e(28733),_=e(55377),I=e(16551),b=e(77439),Z=e(74297),j=e(23892),w=e(39087),$=e(76256),A=e(75795),C=e(91272),P=e(20705),U=e(2845);function S(){var n=(0,r.Z)(["\n  width: 24px;\n"]);return S=function(){return n},n}function q(){var n=(0,r.Z)(["\n  border: 1px solid #eee;\n"]);return q=function(){return n},n}var k=function(n){var t=n.carousel,e=n.category,r=n.children,u=n.data,l=(n.details,n.entity),S=n.entityId,q=n.filters,k=(n.limit,n.listView),T=n.mediaMeta,E=n.onMediaAdd,L=n.onMediaRemove,z=(n.pagination,n.showActionButtons),D=n.showEntityColumn,F=n.showItemActions,R=n.summary,H=n.type,G=(0,P.x)({filters:q}),O=G.initialData,B=G.ref,Q=(0,U.x)(),V=Q.hasRole,W=Q.user,X=(0,c.useContext)(m.Z),Y=(0,s.aM)(d.t,{variables:(0,o.Z)((0,i.Z)({},O),{entity:l,entityId:S,category:e,adminId:W.adminId,meta:T})}),J=Y.data,K=void 0===J?{items:[],meta:{aggregate:{totalCount:0}}}:J,nn=K.items,nt=K.meta,ne=Y.loading,ni=Y.refetch,no=function(n){X.close(),u.length||ni(),E&&E(n)},nr=function(n){X.close(),u.length||ni(),L&&L(n)},na=function(n){n.stopPropagation(),X.show({content:(0,a.jsx)($.z,{accept:"image/*",adminId:W.adminId,category:e,entity:l,entityId:S,expiryShow:!1,mediaMeta:T,multiple:!0,onSuccess:no,type:"image"}),title:"Upload Photos"})},nc=function(n){n.stopPropagation(),X.show({content:(0,a.jsx)($.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:W.adminId,category:e,entity:l,entityId:S,expiryShow:!1,mediaMeta:T,onSuccess:no,type:"document"}),title:"Upload Documents"})},nu=function(n){X.show({content:(0,a.jsx)(j.d,{mediaId:n.data.id,onSuccess:nr}),submit:!1,title:"Delete Media"})},ns=function(n){X.show({content:(0,a.jsx)(w.z,{media:n.data,toggleShow:X.close}),submit:!1,title:"Media Details",width:"50%"})},nd=[{context:"primary",icon:["fas","info-circle"],onClick:function(n,t){return ns(t)},tooltip:"Details"}];V("admin")&&nd.push({context:"danger",icon:["fas","trash"],onClick:function(n,t){return nu(t)},tooltip:"Delete"});var nl=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!D,text:"Entity"},{formatter:function(n){var t,e=n.row;return(0,a.jsx)(N,{children:(null==e?void 0:null===(t=e.authority)||void 0===t?void 0:t.adminOnly)&&(0,a.jsx)(f.Z,{content:"Admin user only",children:(0,a.jsx)(p.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,v.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!k,text:"Thumbnails"},{hidden:!F,formatter:h.Z,formatterData:nd,text:"Actions"}],nm=function(n,t){n.preventDefault(),window.open("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(t))},nf=[],np=nn.map(function(n){var t=n.entity,e=n.entityId,i=n.id,o=n.item,r=o.caption,c=o.filename,u=o.meta,s=o.name,d=o.type,l=o.user;return{data:o,id:i,userId:null==l?void 0:l.id,file:function(){return(0,a.jsx)(g.Z,{onClick:function(n){return nm(n,c)},children:r||s||c})},entity:t&&"".concat(t,"#").concat(e),authority:u,uploaded:"".concat(null==l?void 0:l.nameFirst," ").concat(null==l?void 0:l.nameLast),thumbnails:(0,A.S)(d,u),actions:""}}),nv=(nn.forEach(function(n){var t=n.item,e=t.caption,i=t.filename;"image"===t.type&&nf.push({caption:e,filename:i})}),nf),nh=nv.length;return(0,a.jsxs)(y.Z,{fitParentHeight:!0,open:!0,title:R,children:[r,t&&nh>0&&(0,a.jsx)(M,{children:(0,a.jsx)(x.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:nv.map(function(n){var t=n.caption,e=n.filename;return{node:(0,a.jsx)(p.Z,{alt:t,src:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e)}),text:" "}})})}),(0,a.jsx)(C.t,{columns:nl,loading:ne,fullHeight:!0,paginationSize:!1,meta:nt,ref:B,refetch:ni,rows:np}),z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{size:"sm"}),(0,a.jsxs)(I.Z,{align:"flex-end",children:[(!H||"document"===H)&&!V("supplier")&&(0,a.jsx)(b.Z,{content:"Add Document",context:"secondary",onClick:nc,size:"sm"}),(!H||"image"===H||"avatar"===H)&&!V("supplier")&&(0,a.jsx)(b.Z,{content:"Add ".concat((0,Z.Z)(H||"Image")),context:"secondary",onClick:na,size:"sm"})]})]})]})},N=l.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-9d92024f-0"})(S()),M=l.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-9d92024f-1"})(q());k.propTypes={carousel:u.bool,category:u.string,children:u.node,data:u.array,details:u.bool,entity:u.string,entityId:u.number,filters:u.object,limit:u.number,listView:u.bool,mediaMeta:u.object,onMediaAdd:u.func,onMediaRemove:u.func,pagination:u.object,showActionButtons:u.bool,showEntityColumn:u.bool,showItemActions:u.bool,summary:u.string,type:u.string},k.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},4380:function(n,t,e){"use strict";e.d(t,{g:function(){return G}});var i=e(7297),o=e(85893),r=e(67294),a=e(45697),c=e(10367),u=e(78289),s=e(74147),d=e(9270),l=e(62140),m=e(65414),f=e(55843),p=e(45481),v=e(97303),h=e(33006),g=e(40826),y=e(55171),x=e.n(y),_=e(6388),I=e(75063);function b(){var n=(0,i.Z)(["\n  query GetLog($entityId: bigint!, $entityName: String!) {\n    activity: audit_Activity(\n      where: { _and: [{ entityid: { _eq: $entityId } }, { entity: { _eq: $entityName } }] }\n    ) {\n      eventId\n      userId\n      user: User {\n        fullName\n      }\n      sessionUserName\n      transactionStart\n      statementStart\n      applicationName\n      clientAddr\n      clientPort\n      action\n      changedFields\n    }\n  }\n"]);return b=function(){return n},n}var Z=(0,I.Ps)(b()),j=e(11585),w=e(26186),$=e(86036),A=e(49501),C={U:"Update",I:"Insert",D:"Delete"},P=function(n){var t=n.entityId,e=n.entityName,i=(0,_.aM)(Z,{variables:{entityId:t,entityName:e}}),r=i.loading,a=i.data,c=(void 0===a?{activity:[]}:a).activity;return!r&&(0,o.jsx)(d.Z,{children:(0,o.jsx)(l.Z,{md:12,children:c.map(function(n){var t,e;return(0,o.jsxs)(j.Z,{title:"".concat((null===(t=n.user)||void 0===t?void 0:t.fullName)||"Backend"," - ").concat((0,w.Z)(n.transactionStart,!0)),children:[(0,o.jsx)($.Z,{content:"Action:",text:C[e=n.action]||"-"}),(0,o.jsx)(f.Z,{}),(0,o.jsx)(A.Z,{label:"Changed:",children:(0,o.jsx)(x(),{collapsed:!0,displayDataTypes:!1,src:n.changedFields||"-"})}),(0,o.jsx)($.Z,{content:"Application:",text:n.applicationName||"-"})]},n.userId)})})})};P.propTypes={entityId:a.number.isRequired,entityName:a.string.isRequired};var U=e(35418),S=e(97768),q=e(45416),k=e(96216),N=e(2845),M=function(n){var t,e,i,r,a=n.job,c=n.numberPrefix,u=n.numberSuffix,s=(0,N.x)().hasRole;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)($.Z,{content:"Type",text:(null===(t=S.x.find(function(n){return n.value===a.type}))||void 0===t?void 0:t.text)||"-"}),(0,o.jsx)($.Z,{content:"Order",text:(0,o.jsx)(q.D,{id:a.id,number:a.number,invoiceNumber:null==a?void 0:null===(e=a.invoices)||void 0===e?void 0:null===(i=e[0])||void 0===i?void 0:i.invoiceNumber,type:a.type,numberPrefix:c,numberSuffix:u,isQuote:a.quoted})}),s("admin")&&a.source&&(0,o.jsx)($.Z,{content:"Source",text:null===(r=k.Y.find(function(n){return n.value===a.source}))||void 0===r?void 0:r.text})]})};function T(){var n=(0,i.Z)(["\n  background-color: #fff;\n  border: 1px solid #eee;\n  box-shadow: rgba(45, 62, 80, 0.12) 0 1px 5px 0;\n  margin-bottom: 0.5rem;\n  padding: 1rem 0;\n"]);return T=function(){return n},n}function E(){var n=(0,i.Z)(["\n  font-size: 1rem;\n  margin-top: 0.5rem;\n"]);return E=function(){return n},n}function L(){var n=(0,i.Z)(["\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n"]);return L=function(){return n},n}function z(){var n=(0,i.Z)(["\n  margin-bottom: 1rem;\n"]);return z=function(){return n},n}function D(){var n=(0,i.Z)(["\n  margin-right: 0.5rem;\n"]);return D=function(){return n},n}function F(){var n=(0,i.Z)(["\n  display: inline;\n"]);return F=function(){return n},n}function R(){var n=(0,i.Z)(["\n  display: flex;\n  justify-content: center;\n"]);return R=function(){return n},n}function H(){var n=(0,i.Z)(["\n  cursor: pointer;\n"]);return H=function(){return n},n}M.propTypes={job:a.object,numberPrefix:a.string,numberSuffix:a.string},M.defaultProps={numberPrefix:"",numberSuffix:""};var G=function(n){var t=n.avatar,e=n.editable,i=n.entity,a=n.entityName,c=n.icons,h=n.job,g=n.linkTitleTo,y=n.log,x=n.numberPrefix,_=n.numberSuffix,I=n.prefix,b=(0,r.useContext)(u.Z),Z=(0,r.useState)(t),j=Z[0],w=Z[1],$=function(n){b.close(),(null==n?void 0:n.filename)?w("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(null==n?void 0:n.filename)):w(null)},A=function(){b.show({content:(0,o.jsx)(U.G,{category:"avatar",entity:a,entityId:null==i?void 0:i.id,filters:{category:"avatar"},limit:1,onMediaAdd:$,onMediaRemove:$,type:"image"}),title:"Avatar"})},C=function(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(W,{context:"primary",icon:"building"}),g?(0,o.jsx)(X,{border:!1,passHref:!0,to:g,children:null==i?void 0:i.name}):null==i?void 0:i.name]})},S=function(){b.show({content:(0,o.jsx)(P,{entityId:Number(null==y?void 0:y.entityId),entityName:null==y?void 0:y.entityName}),submit:!1,title:"Log Details",width:"50%"})};return(0,o.jsxs)(O,{children:[(0,o.jsx)(s.Z,{children:(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(l.Z,{md:3,children:(0,o.jsx)(m.Z,{action:e?"Edit":null,actionClick:A,content:(null==i?void 0:i.name)||"test",context:"primary",gmail:null==i?void 0:i.email,src:j})}),(0,o.jsxs)(l.Z,{md:9,children:[(0,o.jsx)(B,{content:(0,o.jsx)(C,{}),noMargin:!0}),(null==i?void 0:i.description)&&(0,o.jsx)(Q,{content:null==i?void 0:i.description,noMargin:!0}),(null==i?void 0:i.website)&&(0,o.jsxs)(V,{href:null==i?void 0:i.website,rel:"nofollow noopener noreferrer",target:"_blank",children:[(0,o.jsx)(W,{context:"primary",icon:"window-maximize"}),"Visit website"]})]}),h&&(0,o.jsx)(l.Z,{md:12,children:(0,o.jsx)(M,{job:h,numberPrefix:x,numberSuffix:_})})]})}),(0,o.jsx)(f.Z,{marginTop:"sm"}),c&&(0,o.jsxs)(Y,{children:[c.map(function(n){var t=n.icon,e=n.onClick,i=n.to;return(0,o.jsxs)("div",{children:[e&&(0,o.jsx)(J,{onClick:e,children:(0,o.jsx)(p.Z,{icon:t,prefix:I})}),i&&(0,o.jsx)(v.Z,{border:!1,passHref:!0,to:i,children:(0,o.jsx)(p.Z,{icon:t,prefix:I})})]},t)}),y&&(0,o.jsx)(J,{onClick:S,children:(0,o.jsx)(p.Z,{icon:"history",size:"lg"})})]})]})},O=c.ZP.div.withConfig({displayName:"profileHeader__StyledHeader",componentId:"sc-35c52c2f-0"})(T()),B=(0,c.ZP)(h.Z).withConfig({displayName:"profileHeader__StyledHeading",componentId:"sc-35c52c2f-1"})(E()),Q=(0,c.ZP)(h.Z).withConfig({displayName:"profileHeader__StyledDescription",componentId:"sc-35c52c2f-2"})(L()),V=c.ZP.a.withConfig({displayName:"profileHeader__StyledLink",componentId:"sc-35c52c2f-3"})(z()),W=(0,c.ZP)(g.Z).withConfig({displayName:"profileHeader__StyledIcon",componentId:"sc-35c52c2f-4"})(D()),X=(0,c.ZP)(v.Z).withConfig({displayName:"profileHeader__StyledTitle",componentId:"sc-35c52c2f-5"})(F()),Y=c.ZP.div.withConfig({displayName:"profileHeader__StyledIconContainer",componentId:"sc-35c52c2f-6"})(R()),J=c.ZP.div.withConfig({displayName:"profileHeader__Click",componentId:"sc-35c52c2f-7"})(H());G.propTypes={avatar:a.string,editable:a.bool,entity:a.object.isRequired,entityName:a.string.isRequired,icons:a.array,job:a.object,linkTitleTo:a.string,log:a.object,prefix:a.string,numberPrefix:a.string,numberSuffix:a.string},G.defaultProps={avatar:"",editable:!0,numberPrefix:"",numberSuffix:""}},91272:function(n,t,e){"use strict";e.d(t,{t:function(){return s}});var i=e(85893),o=e(67294),r=e(45697),a=e(11163),c=e(46003),u=e(8500),s=(0,o.forwardRef)(function(n,t){var e=n.columns,r=n.history,s=n.initialSort,d=n.loading,l=n.meta,m=n.paginationSize,f=n.refetch,p=n.submissionsRefetch,v=n.rowClick,h=n.rows,g=n.xeroPageSize,y=(0,a.useRouter)(),x=y.query,_=void 0===x?{}:x,I=(0,o.useState)(parseInt(null==_?void 0:_.page,10)||1),b=I[0],Z=I[1],j=(0,o.useState)(g||c.C1.paginationSize),w=j[0],$=j[1];s||(s={item:"createdAt",order:"desc"});var A=(0,o.useState)({item:s.item,order:s.order}),C=A[0],P=A[1],U=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,e=void 0===t?{}:t;if(n>1?e.page=n:delete e.page,!(Object.keys(e).length>0))return{};var i=Object.keys(e).map(function(t){return"page"===t?"".concat(t,"=").concat(n):"".concat(t,"=").concat(e[t])}).join("&");return"?".concat(i)},S=function(){P({item:s.item,order:s.order}),Z(1);var n=U();y.push(n),$(g||c.C1.paginationSize)};(0,o.useImperativeHandle)(t,function(){return{currentPage:b,pageSize:w,sort:C,resetPagination:function(){S()}}});var q=function(n){var t=U(n);r&&y.push(t),Z(n),!r&&f&&f()&&p&&p()},k=function(n){n!==c.C1.paginationSize&&($(n),f&&f()&&p&&p())},N=function(n){var t;P({item:n.item,order:n.order}),f&&f()&&p&&p()};return(0,i.jsx)(u.Z,{columns:e,loading:d,paginationSize:m,pagination:l&&!0,paginationProps:l&&{currentPage:b,onPageChange:q,onPageSizeChange:k,pageCount:Math.ceil(l.aggregate.totalCount/w),perPage:w},rowClick:v,rows:h,sort:C,setSort:N})});s.propTypes={columns:r.array.isRequired,history:r.bool,initialSort:r.object,loading:r.bool,meta:r.object,refetch:r.func,submissionsRefetch:r.func,rowClick:r.func,rows:r.array.isRequired},s.defaultProps={history:!0,loading:!0,paginationSize:!1}},8299:function(n,t,e){"use strict";e.d(t,{P:function(){return M}});var i=e(47568),o=e(26042),r=e(828),a=e(29815),c=e(97582),u=e(85893),s=e(67294),d=e(45697),l=e(11163),m=e.n(l),f=e(66252),p=e(6388),v=e(50319),h=e(75327),g=e(78289),y=e(73987),x=e(62466),_=e(68956),I=e(26186),b=e(16551),Z=e(77439),j=e(11585),w=e(55843),$=e(15214),A=e(91272),C=e(35418),P=e(20705),U=e(24237),S=e(63626),q=e(14651),k=e(20932),N=e(92148),M=function(n){var t,e=n.accountType,d=n.filters,l=(0,f.x)(),M=(0,P.x)({filters:d}),T=M.initialData,E=M.ref,L=(0,s.useContext)(g.Z),z=(0,s.useContext)(y.Z).user,D=null,F=(0,p.aM)(h.fo,{variables:T}),R=F.data,H=void 0===R?{users:[],meta:{aggregate:{totalCount:0}}}:R,G=H.users,O=H.meta,B=F.loading,Q=F.refetch,V=(0,r.Z)((0,v.D)(h.I4,{onCompleted:function(n){L.close(),Q()}}),2),W=V[0],X=V[1].error,Y=(0,r.Z)((0,v.D)(h.AX,{onCompleted:function(n){L.close(),Q()}}),2),J=Y[0],K=Y[1].error,nn=(0,r.Z)((0,v.D)(h.tW,{onCompleted:function(n){Q()}}),2),nt=nn[0],ne=nn[1].error;X&&X.graphQLErrors.forEach(function(n){var t;D=(null===(t=n.extensions)||void 0===t?void 0:t.code)==="constraint-violation"?"Error: a user with this e-mail address already exists":"Error creating user"}),K&&K.graphQLErrors.forEach(function(n){var t;D=(null===(t=n.extensions)||void 0===t?void 0:t.code)==="constraint-violation"?"Error, a user with this e-mail address already exists":"Error updating user"}),ne&&(D="Error getting user`s locations");var ni,no=(t=(0,i.Z)(function(n,t){var e,i,r,a,u;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,(0,k.E)(l,n.email,!0)];case 1:if(e=r.sent(),i=(0,S.te)(n,t,e),!n.id)return[3,2];return J({variables:(0,o.Z)({},i)}),n.location&&nt({variables:(0,o.Z)({},(0,S.qF)(n))}),[3,4];case 2:return[4,W({variables:{objects:i}})];case 3:u=r.sent().data.insert_Account_User.returning,n.location&&nt({variables:(0,o.Z)({},(0,S.qF)({location:n.location,accountUserId:u[0].id}))}),r.label=4;case 4:return[2]}})}),function(n,e){return t.apply(this,arguments)}),nr=function(n,t){n.stopPropagation(),L.show({content:(0,u.jsx)(U.H,{userId:null==t?void 0:t.id,accountId:null==t?void 0:t.accountId,accountType:e,submit:no,submitError:D}),title:"Edit user",width:"50%"})},na=function(n){n.stopPropagation(),L.show({content:(0,u.jsx)(U.H,{accountId:d.accountId,accountType:e,submit:no,submitError:D}),title:"Add user",width:"50%"})},nc=function(n,t){n.stopPropagation(),L.show({content:(0,u.jsx)(C.G,{category:"avatar",entity:"User",entityId:t.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})},nu=[{hidden:!0},{text:"Name"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:d.accountId,formatter:(0,x.Z)("","accountId","account","url"),text:"Account"},{text:"Email Address"},{text:"Contact User",formatter:function(n){var t=n.row;if(n.data,t.accountUser.isContact)return(0,u.jsx)(q.Z,{color:"error"})}},{text:"Phone"},{text:"Position"},{hidden:!0},{hidden:!d.accountId,text:"Role"},{text:"Status"},{text:"Date Added",sortable:!0,sortName:"createdAt"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(n){var t=n.row,i=n.data;if(("supplier"===e||"customer"===e)&&(z.email===t.email||(0,a.Z)(N.td).concat((0,a.Z)(N.Sf),(0,a.Z)(N.n),(0,a.Z)(N.nx)).includes(z.role))||(0,a.Z)(N.td).concat((0,a.Z)(N.Sf),(0,a.Z)(N.n),(0,a.Z)(N.nx)).includes(z.role))return(0,u.jsx)(_.Z,{row:t,data:i})},formatterData:[{context:"secondary",icon:["fas","edit"],onClick:nr,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:nc,tooltip:"Avatar"}],text:"Actions"}],ns=function(n){m().push("".concat("/dashboard/users/","view?id=").concat(n.id))},nd=function(){return(0,u.jsx)(b.Z,{children:(0,u.jsx)(Z.Z,{context:"secondary",content:"Edit",onClick:na,size:"sm",children:"Create User"})})};return(0,u.jsxs)(j.Z,{toolbar:d.accountId&&(0,a.Z)(N.td).concat((0,a.Z)(N.Sf),(0,a.Z)(N.n),(0,a.Z)(N.nx)).includes(z.role)&&(0,u.jsx)(nd,{}),open:!0,title:"Users",children:[(0,u.jsx)(A.t,{columns:nu,loading:B,meta:O,ref:E,refetch:Q,rowClick:ns,rows:(ni=[],G.forEach(function(n){var t=null;t=d.accountId?n.accounts.find(function(n){var t;return(null===(t=n.account)||void 0===t?void 0:t.id)===parseInt(d.accountId)}):n.accounts.find(function(n){return null!==n.account});var e={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:t&&t.account.id,type:t&&t.account.type,email:n.email,account:t?"".concat(t.account.name," (").concat(t.account.type,")"):"-",phone:n.phone,position:(null==t?void 0:t.position)?t.position:"N/A",accountUser:t,role:null==t?void 0:t.role,status:t?t.status:n.status,createdAt:(0,I.Z)(n.createdAt),url:t&&!["admin","tenant"].includes(t.account.type.toLowerCase())?"/dashboard/".concat(null==t?void 0:t.account.type.toLowerCase(),"s/view"):"",invoiceThreshold:n.invoiceThreshold,quoteThreshold:n.quoteThreshold,meta:n.meta,actions:""};ni.push(e)}),ni)}),D&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(w.Z,{}),(0,u.jsx)($.Z,{content:D,context:"warning"})]})]})};M.propTypes={accountType:d.string,filters:d.object}},75327:function(n,t,e){"use strict";e.d(t,{$E:function(){return T},AX:function(){return j},I4:function(){return Z},JA:function(){return $},MT:function(){return S},Px:function(){return C},WF:function(){return A},ZA:function(){return z},a8:function(){return P},fA:function(){return M},fo:function(){return w},ge:function(){return L},iM:function(){return N},nE:function(){return q},nh:function(){return k},r1:function(){return U},tW:function(){return D},uz:function(){return E}});var i=e(7297),o=e(75063);function r(){var n=(0,i.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,i.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return a=function(){return n},n}function c(){var n=(0,i.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return c=function(){return n},n}function u(){var n=(0,i.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,i.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,i.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,i.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]);return l=function(){return n},n}function m(){var n=(0,i.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]);return m=function(){return n},n}function f(){var n=(0,i.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]);return f=function(){return n},n}function p(){var n=(0,i.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]);return p=function(){return n},n}function v(){var n=(0,i.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]);return v=function(){return n},n}function h(){var n=(0,i.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]);return h=function(){return n},n}function g(){var n=(0,i.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return g=function(){return n},n}function y(){var n=(0,i.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]);return y=function(){return n},n}function x(){var n=(0,i.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]);return x=function(){return n},n}function _(){var n=(0,i.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']);return _=function(){return n},n}function I(){var n=(0,i.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return I=function(){return n},n}function b(){var n=(0,i.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"]);return b=function(){return n},n}var Z=(0,o.Ps)(r()),j=(0,o.Ps)(a()),w=(0,o.Ps)(c()),$=(0,o.Ps)(u()),A=(0,o.Ps)(s()),C=(0,o.Ps)(d()),P=(0,o.Ps)(l()),U=(0,o.Ps)(m()),S=(0,o.Ps)(f()),q=(0,o.Ps)(p()),k=(0,o.Ps)(v()),N=(0,o.Ps)(h()),M=(0,o.Ps)(g()),T=(0,o.Ps)(y()),E=(0,o.Ps)(x()),L=(0,o.Ps)(_()),z=(0,o.Ps)(I()),D=(0,o.Ps)(b())},97768:function(n,t,e){"use strict";e.d(t,{x:function(){return i}});var i=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},96216:function(n,t,e){"use strict";e.d(t,{Y:function(){return i}});var i=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},21789:function(n,t,e){"use strict";e.d(t,{bg:function(){return i}});var i=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},36502:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return x}});var i=e(85893),o=e(19076),r=e(11163),a=e(6388),c=e(7297),u=e(75063);function s(){var n=(0,c.Z)(["\n  query GetAdmin($id: Int!) {\n    admin: Account_by_pk(id: $id) {\n      id\n      name\n      type\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n    }\n  }\n"]);return s=function(){return n},n}var d=(0,u.Ps)(s()),l=e(9270),m=e(62140),f=e(20402),p=e(71225),v=e(4380),h=e(2845),g=e(8299),y=function(){var n=(0,r.useRouter)().query,t=(0,h.x)(),e=t.hasRole,o=t.user,c=null;e("superadmin")&&n.id?c=parseInt(n.id):e(["admin","superadmin"])&&o.accountId&&(c=o.accountId);var u=(0,a.aM)(d,{skip:!c,variables:{id:c}}),s=u.loading,y=u.data,x=(void 0===y?{admin:{}}:y).admin;return s||!c?null:(0,i.jsx)(l.Z,{children:(0,i.jsxs)(m.Z,{md:12,children:[(0,i.jsx)(l.Z,{children:(0,i.jsx)(m.Z,{md:4,children:(0,i.jsx)(v.g,{avatar:(0,p.Q)(x.media),entity:x,entityName:"Account",icons:e(["admin","superadmin"])?(0,f.Y)(x):[]})})}),(0,i.jsx)(g.P,{accountType:"admin",filters:{accountId:c}})]})})},x=function(){return(0,i.jsx)(o.Z,{View:(0,i.jsx)(y,{})})}}},function(n){n.O(0,[3662,367,2283,212,8890,619,2583,4135,8579,6043,1838,4244,3911,1417,3776,1564,3054,2329,8500,778,4046,1023,1870,2797,1047,3058,8316,8344,6733,5463,9774,2888,179],function(){return n(n.s=51332)}),_N_E=n.O()}]);