(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8978],{81548:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/compliance",function(){return t(29322)}])},25742:function(n,e,t){"use strict";t.d(e,{H:function(){return c}});var i=t(26042),r=t(85893),o=t(45697),a=t(55377),s=t(16551),u=t(77439),c=function(n){var e=n.children,t=n.content,o=n.context,c=n.data,l=n.disabled,d=n.handleClick,m=n.size,p=n.type;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{size:"sm"}),(0,r.jsxs)(s.Z,{align:"flex-end",children:[e,(0,r.jsx)(u.Z,(0,i.Z)({content:t,context:o,disabled:l,onClick:d,size:m,type:p},c))]})]})};c.propTypes={children:o.node,content:o.string,context:o.string,data:o.object,disabled:o.bool,handleClick:o.func,size:o.string,type:o.string},c.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},52475:function(n,e,t){"use strict";t.d(e,{z:function(){return j}});var i=t(47568),r=t(26042),o=t(69396),a=t(828),s=t(97582),u=t(85893),c=t(45697),l=t(50319),d=t(79434),m=t(42283),p=t(79665),y=t(76600),f=t(49501),g=t(55563),v=t(6710),_=t(58594),x=t(95103),h=t(2845),Z=t(21789),$=t(32749),b=t(74231),C=(0,b.Ry)().shape({name:(0,b.Z_)().required(),status:(0,b.Z_)().oneOf(["active","inactive"]).required(),complianceCategorySelected:(0,b.Ry)().required(),url:(0,b.Z_)().url()}),q=function(n){var e=n.form,t=n.id,i=n.user;return(e.categoryId=e.complianceCategorySelected.value,delete e.complianceCategorySelected,t)?{id:t,changes:e}:(e.adminId=i.accountId,{objects:[e]})},j=function(n){var e,t=n.defaultValues,c=n.onSuccess,b=(0,h.x)().user,j=(0,m.cI)({defaultValues:t,resolver:(0,p.S)(C)}),S=j.control,I=j.errors,T=j.handleSubmit,w=j.register,E=(0,a.Z)((0,l.D)(d.gO,{onCompleted:function(n){var e=n.insert_Compliance.returning[0].id;c&&c(e)}}),1)[0],k=(0,a.Z)((0,l.D)(d.Vd,{onCompleted:function(n){var e=n.update_Compliance_by_pk.id;c&&c(e)}}),1)[0],P=(e=(0,i.Z)(function(n){var e;return(0,s.__generator)(this,function(i){switch(i.label){case 0:if(e=q({form:n,id:t.id,user:b}),!t.id)return[3,2];return[4,k({variables:e})];case 1:return i.sent(),[3,4];case 2:return[4,E({variables:e})];case 3:i.sent(),i.label=4;case 4:return[2]}})}),function(n){return e.apply(this,arguments)}),A={control:S,errors:I,register:w};return(0,u.jsxs)(y.Z,{id:"offCanvasForm",handleSubmit:T(P),children:[(0,u.jsx)(f.Z,{label:"Name",children:(0,u.jsx)(g.Z,(0,o.Z)((0,r.Z)({},A),{name:"name"}))}),(0,u.jsx)($.l,(0,o.Z)((0,r.Z)({},A),{label:"Category",name:"complianceCategorySelected",type:"complianceCategory"})),(0,u.jsx)(f.Z,{label:"Description",children:(0,u.jsx)(v.Z,(0,o.Z)((0,r.Z)({},A),{name:"description",rows:2}))}),(0,u.jsx)(f.Z,{label:"Governing Body",children:(0,u.jsx)(g.Z,(0,o.Z)((0,r.Z)({},A),{name:"governingBody"}))}),(0,u.jsx)(f.Z,{label:"Registration number example",children:(0,u.jsx)(g.Z,(0,o.Z)((0,r.Z)({},A),{name:"regNumExample"}))}),(0,u.jsx)(f.Z,{label:"URL",children:(0,u.jsx)(g.Z,(0,o.Z)((0,r.Z)({},A),{name:"url"}))}),(0,u.jsx)(_.Z,(0,o.Z)((0,r.Z)({},A),{data:[{id:"hasInsuranceAmount",label:"Has Insurance Amount Attached"}],name:"hasInsuranceAmount"})),(0,u.jsx)(_.Z,(0,o.Z)((0,r.Z)({},A),{data:[{id:"expectCertificate",label:"Expect Certificate"}],name:"expectCertificate"})),(0,u.jsx)(f.Z,{label:"Status",children:(0,u.jsx)(x.Z,(0,o.Z)((0,r.Z)({},A),{name:"status",options:Z.bg}))})]})};j.propTypes={defaultValues:c.object,onSuccess:c.func.isRequired}},79434:function(n,e,t){"use strict";t.d(e,{$i:function(){return c},G1:function(){return l},Vd:function(){return m},gO:function(){return d}});var i=t(7297),r=t(75063);function o(){var n=(0,i.Z)(["\n  query GetCompliace($id: Int!) {\n    compliance: Compliance_by_pk(id: $id) {\n      id\n      name\n      url\n      regNumExample\n      status\n      type\n      governingBody\n      hasInsuranceAmount\n      description\n      createdAt\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      Compliance_Entities {\n        Location {\n          id\n          name\n          status\n        }\n        Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return o=function(){return n},n}function a(){var n=(0,i.Z)(['\n  query GetCompliances(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Compliance_order_by!\n    $status: String\n    $type: String\n  ) {\n    compliance: Compliance(\n      limit: $limit\n      offset: $offset\n      where: { name: { _ilike: $q }, status: { _eq: $status }, type: { _eq: $type } }\n      order_by: [$orderBy]\n    ) {\n      id\n      name\n      description\n      status\n      regNumExample\n      hasInsuranceAmount\n      expectCertificate\n      url\n      governingBody\n      createdAt\n      category: Category {\n        id\n        name\n      }\n      questions: Taxonomies {\n        id\n      }\n      media: Media(where: { entity: { _eq: "Compliance" } }) {\n        mediaId\n      }\n    }\n    meta: Compliance_aggregate(\n      where: { name: { _ilike: $q }, status: { _eq: $status }, type: { _eq: $type } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return a=function(){return n},n}function s(){var n=(0,i.Z)(["\n  mutation AddCompliance($objects: [Compliance_insert_input!]!) {\n    insert_Compliance(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return s=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation UpdateCompliance($id: Int!, $changes: Compliance_set_input) {\n    update_Compliance_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return n},n}var c=(0,r.Ps)(o()),l=(0,r.Ps)(a()),d=(0,r.Ps)(s()),m=(0,r.Ps)(u())},20705:function(n,e,t){"use strict";t.d(e,{x:function(){return l}});var i=t(14924),r=t(26042),o=t(69396),a=t(67294),s=t(96486),u=t(46003),c=function(n){try{return JSON.parse(n)}catch(e){return!1}},l=function(n){var e,t,l,d,m,p,y,f,g,v,_,x=n.filters,h=n.newFilters,Z=n.initialSort,$=(0,a.useRef)(),b=(0,a.useState)({}),C=b[0],q=b[1],j=(0,a.useState)({}),S=j[0],I=j[1],T=Z||{item:"createdAt",order:"desc"},w=(0,i.Z)({},(null===(e=$.current)||void 0===e?void 0:e.sort.item)||T.item,T.inneritem?(0,i.Z)({},T.inneritem,(null===(t=$.current)||void 0===t?void 0:t.sort.order)||T.order):(null===(l=$.current)||void 0===l?void 0:l.sort.order)||T.order);return(0,a.useEffect)(function(){var n=!(0,s.isEqual)(C,x),e=!(0,s.isEqual)(S,h);if(n&&(q(x),null==$||null===(i=$.current)||void 0===i||i.resetPagination()),e&&(I(h),null==$||null===(r=$.current)||void 0===r||r.resetPagination()),(null==$?void 0:null===(t=$.current)||void 0===t?void 0:t.setSort)&&!(n||e)){var t,i,r,o,a,u,c,l,d,m,p,y=(null===(o=$.current)||void 0===o?void 0:null===(a=o.sort)||void 0===a?void 0:a.item)&&(null===(u=$.current)||void 0===u?void 0:null===(c=u.sort)||void 0===c?void 0:c.order)?{item:null===(l=$.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(m=$.current)||void 0===m?void 0:null===(p=m.sort)||void 0===p?void 0:p.order}:w;$.current.setSort(y)}},[x,h]),{initialData:(0,o.Z)((0,r.Z)({},x),{newFilters:(null==h?void 0:h.length)>0?h:void 0,limit:(null===(d=$.current)||void 0===d?void 0:d.pageSize)==="Infinity"?null:parseInt(null===(m=$.current)||void 0===m?void 0:m.pageSize,10)||u.C1.paginationSize,offset:((null===(p=$.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(y=$.current)||void 0===y?void 0:y.pageSize)||u.C1.paginationSize),orderBy:c(null===(f=$.current)||void 0===f?void 0:null===(g=f.sort)||void 0===g?void 0:null===(v=g.item)||void 0===v?void 0:v.replace(/ORDER/i,null===(_=$.current)||void 0===_?void 0:_.sort.order))||w}),initialSort:Z,ref:$}}},42575:function(n,e,t){"use strict";t.d(e,{Im:function(){return m},RQ:function(){return f},X4:function(){return v},fC:function(){return g},mW:function(){return p},ze:function(){return y}});var i=t(7297),r=t(75063);function o(){var n=(0,i.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n']);return o=function(){return n},n}function a(){var n=(0,i.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"]);return a=function(){return n},n}function s(){var n=(0,i.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]);return s=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]);return u=function(){return n},n}function c(){var n=(0,i.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]);return c=function(){return n},n}function l(){var n=(0,i.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return l=function(){return n},n}function d(){var n=(0,i.Z)(["\n  query GetSlasForTemplate($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    slas: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      id\n      label: name\n      subtype\n      notes\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n    }\n  }\n"]);return d=function(){return n},n}var m=(0,r.Ps)(o());(0,r.Ps)(a());var p=(0,r.Ps)(s()),y=(0,r.Ps)(u()),f=(0,r.Ps)(c()),g=(0,r.Ps)(l()),v=(0,r.Ps)(d())},32749:function(n,e,t){"use strict";t.d(e,{l:function(){return y}});var i=t(26042),r=t(69396),o=t(99534),a=t(85893),s=t(67294),u=t(45697),c=t(6388),l=t(42575),d=t(49501),m=t(84043),p=function(n,e){var t,i,r,o=!0;return(null===(t=n.errors[n.name])||void 0===t?void 0:t.message)!==(null===(i=e.errors[e.name])||void 0===i?void 0:i.message)&&(o=!1),["name","type"].forEach(function(t){n[t]!==e[t]&&(o=!1)}),o},y=(0,s.memo)(function(n){var e,t,s,u=n.control,p=n.errors,y=n.label,f=n.name,g=n.register,v=n.type,_=n.filters,x=(0,o.Z)(n,["control","errors","label","name","register","type","filters"]),h=(s=(void 0===(t=(0,c.aM)(l.Im,{variables:(0,r.Z)((0,i.Z)({isGroup:"assetCategory"===v},_),{orderBy:{name:"asc"},type:v})}).data)?{taxonomy:[]}:t).taxonomy,"assetCategory"===v?s.map(function(n){return{label:n.name,options:n.options,childs:n.childs,meta:n.meta}}):s.map(function(n){return{label:n.name,value:n.id,childs:n.childs,meta:n.meta}}));return(0,a.jsx)(d.Z,{id:f,label:y,children:(0,a.jsx)(m.Z,(0,i.Z)((0,r.Z)((0,i.Z)({},{control:u,errors:p,register:g}),{cacheOptions:!0,isClearable:!0,options:h,name:f}),x))})},p);y.propTypes={control:u.object.isRequired,errors:u.object.isRequired,label:u.string.isRequired,filters:u.object,type:(0,u.oneOf)(["assetCategory","expenseCategory","jobTags","costCategory","clientType","tags"])},y.defaultProps={filters:{}}},29322:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return z}});var i=t(85893),r=t(19076),o=t(55862),a=t(26042),s=t(67294),u=t(45697),c=t(11163),l=t.n(c),d=t(6388),m=t(79434),p=t(78289),y=t(68956),f=t(26186),g=t(74297),v=t(16551),_=t(77439),x=t(11585),h=t(91272),Z=t(52475),$=t(23390),b=t(20705),C=t(2845),q={item:"name",order:"asc"},j=function(n){var e=n.filters,t=(0,b.x)({filters:e,initialSort:q}),r=t.initialData,o=t.ref,u=(0,(0,C.x)().hasRole)("customer"),c=(0,s.useContext)(p.Z),j=(0,d.aM)(m.G1,{variables:r}),S=j.data,I=void 0===S?{compliance:[],meta:{aggregate:{totalCount:0}}}:S,T=I.compliance,w=I.meta,E=j.loading,k=j.refetch,P=function(){k(),c.close()},A=function(n,e){n.stopPropagation();var t={};e?(t=(0,a.Z)({},e.item)).complianceCategorySelected={label:e.item.category.name,value:e.item.category.id}:t.status="active",c.show({content:(0,i.jsx)(Z.z,{defaultValues:t,onSuccess:P}),title:t.id?"Edit":"Add Compliance"})},G=function(n,e){c.show({content:(0,i.jsx)($.R,{defaultValues:e,entity:"Compliance",entityId:e.id,groups:{},parentId:e.id,refetchCompliance:k,type:"complianceQuestions"}),submit:!1,title:"Questions"}),n.stopPropagation()},R=[{hidden:!0},{sortable:!0,sortName:"name",text:"Name"},{text:"Category"},{hidden:!0},{text:"Date"},{text:"Status"},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:y.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(n,e){return A(n,e)},tooltip:"Edit"},{context:"info",icon:["fas","question"],numberOverlay:"childCount",onClick:function(n,e){return G(n,e)},tooltip:"Manage Questions"}],text:"Actions"}],z=function(n){l().push("".concat("/dashboard/compliance/","view?id=").concat(n.id))},N=function(){return(0,i.jsx)(v.Z,{children:(0,i.jsx)(_.Z,{context:"secondary",content:"Add New",onClick:A,size:"sm"})})};return(0,i.jsx)(x.Z,{open:!0,title:"Compliance",toolbar:!u&&(0,i.jsx)(N,{}),children:(0,i.jsx)(h.t,{columns:R,initialSort:q,loading:E,meta:w,ref:o,refetch:k,rowClick:z,rows:T.map(function(n){var e,t;return{id:n.id,name:n.name,categoryName:n.category.name,description:n.description,date:(0,f.Z)(n.createdAt),status:(0,g.Z)(n.status),mediaCount:(null===(e=n.media)||void 0===e?void 0:e.length)||null,childCount:(null===(t=n.questions)||void 0===t?void 0:t.length)||null,item:n,actions:""}})})})};j.propTypes={filters:u.object};var S=t(69396),I=t(9270),T=t(62140),w=t(95103),E=t(46929),k=[{text:"Type",value:""},{text:"Regulatory",value:"regulatory"},{text:"SSIP",value:"ssip"}],P=t(21789),A=function(n){var e=n.errors,t=n.register,r=n.setFilters,o={errors:e,register:t};return(0,i.jsxs)(I.Z,{children:[(0,i.jsx)(T.Z,{md:6,children:(0,i.jsx)(w.Z,(0,S.Z)((0,a.Z)({},o),{name:"type",onChange:function(n){return r(function(e){return(0,S.Z)((0,a.Z)({},e),{type:n.target.value||null})})},options:k}))}),(0,i.jsx)(T.Z,{md:6,children:(0,i.jsx)(E.r,(0,S.Z)((0,a.Z)({},o),{onChange:function(n){return r(function(e){return(0,S.Z)((0,a.Z)({},e),{status:n.target.value||null})})},options:P.bg}))})]})};A.propTypes={errors:u.object.isRequired,register:u.func.isRequired,setFilters:u.func.isRequired};var G={q:null,status:null,type:null,filterType:"compliance_table"},R=function(){return(0,i.jsx)(o.J,{FiltersComp:A,initialFilters:G,TableComp:j})},z=function(){return(0,i.jsx)(r.Z,{pageHeading:{heading:"Compliance"},View:(0,i.jsx)(R,{})})}}},function(n){n.O(0,[3662,2283,212,619,1838,1417,1564,3054,8500,4043,5566,495,9774,2888,179],function(){return n(n.s=81548)}),_N_E=n.O()}]);