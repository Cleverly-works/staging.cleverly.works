(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1052],{1215:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties",function(){return t(15284)}])},46602:function(e,n,t){"use strict";t.d(n,{k:function(){return x}});var r=t(26042),i=t(69396),o=t(85893),a=t(45697),s=t(42283),c=t(79665),u=t(76600),d=t(9270),l=t(62140),m=t(49501),p=t(55563),v=t(6710),f=t(95103),h=t(74231),g=(0,h.Ry)().shape({name:(0,h.Z_)(),invoicingEntity:(0,h.Z_)(),addressLine1:(0,h.Z_)().required(),addressLine2:(0,h.Z_)(),addressLine3:(0,h.Z_)(),city:(0,h.Z_)().required(),postCode:(0,h.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,h.Z_)(),countryId:(0,h.Z_)().required()}),y=t(25742),Z=t(73760),x=function(e){var n=e.defaultValues,t=(e.onCancel,e.onSubmit),a=e.type,h=(0,s.cI)({defaultValues:(0,r.Z)({},n),resolver:(0,c.S)(g)}),x=h.control,b=h.errors,I=h.handleSubmit,j={control:x,errors:b,register:h.register};return(0,o.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:I(t),children:[(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(l.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Address name",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"name"}))})}),"invoice"===a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"invoicing email",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"invoicingEmail",type:"email"}))})}),(0,o.jsx)(l.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Invoicing entity",children:(0,o.jsx)(v.Z,(0,i.Z)((0,r.Z)({},j),{name:"invoicingEntity",rows:4}))})})]}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 1",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"addressLine1"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 2",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"addressLine2"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 3",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"addressLine3"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"City",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"city"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Post Code",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"postCode"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"County",children:(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"county"}))})}),(0,o.jsx)(l.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Country",children:(0,o.jsx)(f.Z,(0,i.Z)((0,r.Z)({},j),{name:"countryId",options:Z.O}))})})]}),(0,o.jsx)(d.Z,{justify:"end",children:(0,o.jsx)(l.Z,{md:12,children:(0,o.jsx)(y.H,{content:"Submit",type:"submit"})})}),(null==n?void 0:n.id)&&(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"id",type:"hidden"})),(null==n?void 0:n.meta)&&(0,o.jsx)(p.Z,(0,i.Z)((0,r.Z)({},j),{name:"meta",type:"hidden"}))]})};x.propTypes={defaultValues:a.object,onCancel:a.func.isRequired,onSubmit:a.func.isRequired,type:a.string}},48580:function(e,n,t){"use strict";t.d(n,{q:function(){return v}});var r=t(26042),i=t(69396),o=t(99534),a=t(85893),s=t(87918),c=t(98456),u=t(23776),d=t(50135),l=t(67294),m=t(45697),p=t.n(m),v=function(e){var n=e.loading,t=e.setSearch,m=e.textFieldProps,p=(0,o.Z)(e,["loading","setSearch","textFieldProps"]),v=(0,l.useState)(""),f=v[0],h=v[1];return(0,l.useEffect)(function(){var e=setTimeout(function(){t(f)},500);return function(){return clearTimeout(e)}},[f,t]),(0,a.jsx)(u.Z,(0,i.Z)((0,r.Z)({isOptionEqualToValue:function(e,n){return e.value===n.value}},p),{loading:n,onInputChange:function(e,n){h(n)},getOptionLabel:function(e){return e.label},renderTags:function(e,n){return e.map(function(e,t){return(0,a.jsx)(s.Z,(0,r.Z)({size:"small",label:e.label},n({index:t})))})},renderInput:function(e){return(0,a.jsx)(d.Z,(0,i.Z)((0,r.Z)({},e,m),{InputProps:(0,i.Z)((0,r.Z)({},e.InputProps,m.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[n?(0,a.jsx)(c.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};v.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},v.propTypes={multiple:p().bool,limitTags:p().number,filterSelectedOptions:p().bool,color:p().string,loading:p().bool,value:p().oneOf([p().array,p().object]),onChange:p().func,options:p().arrayOf(p().shape({value:p().any.isRequired,label:p().string.isRequired})).isRequired,onOpen:p().func,setSearch:p().func,textFieldProps:p().shape({label:p().string,variant:p().oneOf(["standard"]),color:p().string,error:p().bool,helperText:p().string})}},25742:function(e,n,t){"use strict";t.d(n,{H:function(){return u}});var r=t(26042),i=t(85893),o=t(45697),a=t(55377),s=t(16551),c=t(77439),u=function(e){var n=e.children,t=e.content,o=e.context,u=e.data,d=e.disabled,l=e.handleClick,m=e.size,p=e.type;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.Z,{size:"sm"}),(0,i.jsxs)(s.Z,{align:"flex-end",children:[n,(0,i.jsx)(c.Z,(0,r.Z)({content:t,context:o,disabled:d,onClick:l,size:m,type:p},u))]})]})};u.propTypes={children:o.node,content:o.string,context:o.string,data:o.object,disabled:o.bool,handleClick:o.func,size:o.string,type:o.string},u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},22595:function(e,n,t){"use strict";t.d(n,{E:function(){return r}});var r=function(e,n){if(Array.isArray(n)){var t,r=null;return n.forEach(function(n){var t,i=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});r=(null==i?void 0:i.createdAt)||r}),r}var i=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==i?void 0:i.createdAt)||null}},12547:function(e,n,t){"use strict";t.d(n,{r:function(){return l}});var r=t(26042),i=t(69396),o=t(85893),a=t(45697),s=t.n(a),c=t(41664),u=t.n(c),d=t(23795),l=function(e){var n=e.children,t=e.href,a=e.noWrap,s=e.target,c=e.sx,l=void 0===c?{}:c;return a?(0,o.jsx)(o.Fragment,{children:n}):t?(0,o.jsx)(u(),{href:t,target:s,passHref:!0,children:(0,o.jsx)(d.Z,(0,i.Z)((0,r.Z)({sx:l},e),{children:n}))}):(0,o.jsx)(d.Z,(0,i.Z)((0,r.Z)({sx:l},e),{children:n}))};l.defaultProps={onClick:function(e){e.stopPropagation()}},l.propTypes={onClick:s().func,href:s().string,noWrap:s().bool,color:s().string}},71306:function(e,n,t){"use strict";t.d(n,{V:function(){return Y}});var r=t(26042),i=t(828),o=t(85893),a=t(67294),s=t(45697),c=t(30381),u=t.n(c),d=t(11163),l=t.n(d),m=t(57460),p=t.n(m),v=t(6388),f=t(73359),h=t(7297),g=t(75063);function y(){var e=(0,h.Z)(['\n  query GetLocations(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n      status\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n      customer: Account_Locations {\n        id\n        account: Account {\n          id\n          name\n        }\n      }\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        expiryAt\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n      bookings: Jobs(\n        where: { Invoices: { invoiceType: { _in: ["customerVat", "ProformaInvoiceCustomer"] } } }\n      ) {\n        id\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return y=function(){return e},e}var Z=(0,g.Ps)(y()),x=t(12547),b=t(90629),I=t(15861),j=t(98456),C=t(51233),_=t(11057),q=t(93946),S=t(5616),A=t(61730),w=t(2548),L=t(81261),P=t(25993),k=t(15033),T=t(69396),R=t(42283),M=t(11994),$=t(90948),F=t(50135),N=t(48580),O=t(59938),U=t(4972),D=function(e){var n=e.initialFilters,t=e.filters,s=e.setFilters,c=e.open,u=e.onClose,l=(0,d.useRouter)().query,m=(0,A.Z)("(max-width: 400px)"),p=(0,a.useMemo)(function(){return(null==l?void 0:l.tab)==="locations"},[l]),v=(0,i.Z)((0,O.X)("form_data_".concat(n.filterType).concat(p?"_".concat(n.accountId):""),n),2),h=v[0],g=v[1],y=(0,a.useState)(),Z=y[0],x=y[1],I=(0,R.cI)({defaultValues:h}),j=I.control,q=I.handleSubmit,S=I.register,w=I.reset,L=I.errors,P=(0,i.Z)((0,f.t)(U.SW,{variables:{where:{name:{_ilike:""!==Z?"%".concat(Z,"%"):null}}}}),2),k=P[0],M=P[1],$=M.loading,D=M.data,G=(void 0===D?{items:[]}:D).items,H=function(){s(n),w(),u(),g((0,T.Z)((0,r.Z)({},n),{filterType:n.filterType}))},V=function(e){var i,o=(0,T.Z)((0,r.Z)({},t,e),{accountId:p?n.accountId:null===(i=e.customer)||void 0===i?void 0:i.value,q:e.q});s((0,T.Z)((0,r.Z)({},o),{q:e.q?"%".concat(e.q,"%"):null})),g((0,T.Z)((0,r.Z)({},o),{customer:p?null:e.customer,filterType:n.filterType})),w(),u()};return(0,o.jsx)(z,{open:c,onClose:u,children:(0,o.jsx)(b.Z,{sx:{minWidth:m?"300px":"400px",padding:"20px 40px"},children:(0,o.jsxs)("form",{onSubmit:q(V),children:[(0,o.jsxs)(C.Z,{spacing:p?8:4,children:[(0,o.jsx)(F.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:S}),!p&&(0,o.jsx)(R.Qr,{name:"customer",control:j,render:function(e){var n,t=e.value,r=e.onChange;return(0,o.jsx)(N.q,{limitTags:6,color:"secondary",value:t,onChange:function(e,n){return r(n)},label:"Select customer",loading:$,onOpen:function(){return k()},options:G,setSearch:x,textFieldProps:{label:"Select customer",variant:"standard",color:"secondary",error:L.customer,helperText:null===(n=L.customer)||void 0===n?void 0:n.message}})}})]}),(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:{margin:"20px 0"},children:[(0,o.jsx)(_.Z,{variant:"contained",color:"danger",onClick:function(){return H()},children:"Cancel"}),(0,o.jsx)(_.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},z=(0,$.ZP)(M.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}});D.propTypes={open:s.bool,onClose:s.func,initialFilters:s.object,setFilters:s.func.isRequired};var G=t(75832),H=t(20705),V=t(9492),E=t(63139),B=t(93884),W=t(64872),J=function(e){return u()(e).format("YYYY-MM-DD")},Y=function(e){var n,t=e.accountId,s=e.accountName,c=e.initialFilters,u=e.columnVisibilityModel,d=e.tableContainerHeight,m=(0,a.useState)(!1),h=m[0],g=m[1],y=(0,a.useState)(!1),T=y[0],R=y[1],M=(0,a.useState)((0,r.Z)({},c)),$=M[0],F=M[1],N=(0,H.x)({filters:$}),O=N.initialData,U=N.ref,z=(0,W.a)(),Y=(0,A.Z)("(max-width: 400px)"),X=(0,E.s)(),K=(0,v.aM)(Z,{variables:O}),Q=K.data,ee=void 0===Q?{properties:[],meta:{aggregate:{totalCount:0}}}:Q,en=ee.properties,et=ee.meta,er=K.loading,ei=K.refetch,eo=(0,i.Z)((0,f.t)(Z,{fetchPolicy:"no-cache",variables:{accountId:O.accountId,q:O.q,orderBy:O.orderBy},onCompleted:function(e){try{var n=p().unparse(eu(e.properties)),t="data:application/octet-stream,"+encodeURIComponent(n);(0,V.S)(t,"locations.csv")}finally{R(!1)}}}),1)[0],ea=function(e){e.stopPropagation(),R(!0),eo()},es=(0,a.useCallback)(function(e,n){e.stopPropagation(),z.show({content:(0,o.jsx)(P.V,{accountId:t,accountName:s,data:null==n?void 0:n.data,entity:"Location",refetch:ei}),title:(null==n?void 0:n.data)?"Edit location":"Create location"})},[z,t,s,ei]),ec=function(e){var n=e.row;l().push("".concat("/dashboard/properties/","view?id=").concat(n.data.id,"&tab=details"))},eu=function(e){return e.map(function(e){var n,t,r=null===(n=null==e?void 0:e.addresses[0])||void 0===n?void 0:n.address;return{name:e.name||"Not Specified",customer:e.customer[0].account.name,address:r?"".concat(r.addressLine1," - ").concat(r.postCode):"",bookings:null===(t=e.bookings)||void 0===t?void 0:t.length,totalSpent:(0,G.T)(0),createdAt:J(e.createdAt)}})},ed=(0,a.useCallback)(function(){return en.map(function(e){var n,t,r,i;return{id:e.id,data:e,name:e.name||"Not Specified",address:(null===(n=e.addresses[0])||void 0===n?void 0:n.address)?"\n            ".concat(null===(t=e.addresses[0])||void 0===t?void 0:t.address.addressLine1," -\n            ").concat(null===(r=e.addresses[0])||void 0===r?void 0:r.address.postCode):"Please Add",customer:e.customer[0].account.name,customerId:e.customer[0].account.id,workOrders:null===(i=e.bookings)||void 0===i?void 0:i.length,totalSpent:(0,G.T)(0),compliancesList:e.compliances,createdAt:J(e.createdAt),status:e.status,actions:""}})},[en]),el=(0,a.useMemo)(function(){var e={};return!ed().length&&(null==O?void 0:O.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No locations",subtitleFirstLine:"You currently have no locations set up in the system",subtitleSecondLine:"Click\xa0create location\xa0to get started building.",buttonText:"Create location",onAction:es}},[es,null==O?void 0:O.q,ed]),em=(0,r.Z)({},u);return(0,o.jsxs)(o.Fragment,{children:[h&&(0,o.jsx)(D,{initialFilters:c,open:h,filters:$,setFilters:F,onClose:function(){return g(!1)}}),(0,o.jsxs)(C.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(_.Z,{variant:"contained",startIcon:(0,o.jsx)(L.Z,{}),onClick:function(){return g(!0)},children:"Filters"}),(0,o.jsxs)(C.Z,{direction:"row",spacing:2,children:[(0,o.jsx)(_.Z,{variant:"contained",color:"secondary",onClick:es,children:"Create Location"}),!X&&(0,o.jsx)(_.Z,{startIcon:!T&&(0,o.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:T,variant:"contained",color:"success",onClick:ea,children:T?(0,o.jsx)(j.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,o.jsxs)(b.Z,{sx:{padding:"16px 0px",height:d},children:[(0,o.jsx)(I.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Locations"}),(null===(n=ed())||void 0===n?void 0:n.length)?(0,o.jsx)(k.i,{ref:U,loading:er,columns:[{headerName:"Name",field:"name",minWidth:370,flex:1},{headerName:"Address",field:"address",minWidth:300,flex:1,sortable:!1},{headerName:"Customer",field:"customer",sortable:!1,flex:1,minWidth:Y?100:"auto",renderCell:function(e){var n=e.row,t=n.customer,r=n.customerId;return(0,o.jsx)(x.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(r),children:t})}},{headerName:"Work Orders",field:"workOrders",sortable:!1,minWidth:Y?100:"auto",renderCell:function(e){var n=e.row.workOrders;return(0,o.jsx)(S.Z,{sx:{marginLeft:"3em"},children:n})},flex:1},{headerName:"Total Spent",field:"totalSpent",sortable:!1,minWidth:Y?140:"auto",renderCell:function(e){var n=e.row.totalSpent;return(0,o.jsx)(S.Z,{sx:{marginLeft:"1.5em"},children:n})},flex:1},{field:"createdAt",headerName:"Created At",minWidth:Y?200:"auto",flex:1,sortable:!0},{field:"actions",headerName:"Actions",sortable:!1,minWidth:Y?80:"auto",renderCell:function(e){var n=e.row;return(0,o.jsx)(q.Z,{sx:{marginLeft:"1em"},onClick:function(){return ec({row:n})},children:(0,o.jsx)(w.Z,{})})},flex:1}],rows:ed(),columnVisibilityModel:em,meta:et,refetch:ei,autoHeight:!1,containerHeight:"calc(100% - 52px)",onRowClick:ec}):!er&&(0,o.jsx)(B.C,(0,r.Z)({imageSrc:"/static/icons/no_locations_found.svg"},el))]})]})]})};Y.propTypes={accountId:s.number,accountName:s.string,initialFilters:s.object,columnVisibilityModel:s.object,tableContainerHeight:s.string},Y.defaultProps={columnVisibilityModel:{},tableContainerHeight:"calc(100% - 52px)"}},25993:function(e,n,t){"use strict";t.d(n,{V:function(){return z}});var r=t(47568),i=t(26042),o=t(69396),a=t(828),s=t(97582),c=t(85893),u=t(67294),d=t(45697),l=t(6388),m=t(50319),p=t(51809),v=t(11163),f=t.n(v),h=t(42283),g=t(79665),y=t(76600),Z=t(15214),x=t(9270),b=t(62140),I=t(49501),j=t(55563),C=t(6710),_=t(95103),q=t(84043),S=t(11057),A=t(69368),w=t(50480),L=t(6054),P=t(66812),k=function(e){var n=e.accountId,t=e.accountName,r=e.canSelectAccount,a=e.control,s=e.errors,d=e.setValue,l=e.watch,m=n?{value:n,label:t}:l("propertyOwner"),p=(0,L.Z)(m),v=function(e){d("contactUser",null)};(0,u.useEffect)(function(){m!==p&&p&&v(m)},[m]);var f={control:a,errors:s};return(0,c.jsxs)(x.Z,{children:[(0,c.jsx)(b.Z,{md:6,children:(0,c.jsx)(P.P,(0,o.Z)((0,i.Z)({},f),{defaultValue:n&&{value:n,label:t},errors:(0,i.Z)({},s),isDisabled:!r,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,c.jsx)(b.Z,{md:6,children:(0,c.jsx)(P.P,(0,o.Z)((0,i.Z)({},f),{accountId:(null==m?void 0:m.value)||null,errors:(0,i.Z)({},s),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};k.propTypes={accountId:d.number,accountName:d.string,canSelectAccount:d.bool.isRequired,control:d.func.isRequired,errors:d.object.isRequired,setValue:d.func.isRequired,watch:d.func.isRequired};var T=t(22595),R=function(e,n){var t=e.propertyOwner,r=e.contactUser;return e.Account_Locations={data:{accountId:t.value}},delete e.propertyOwner,e.contactUserId=(null==r?void 0:r.value)||null,delete e.contactUser,n&&delete e.Account_Locations,e},M=function(e,n,t,r){var i={location:R(e,!0),locationId:n.locationId,accountId:n.accountId,newAccountId:n.newAccountId,hasChanged:n.hasChanged};r({variables:i})},$=t(74231),F=t(46602),N=t(21789),O=t(2845),U=t(64872),D="/dashboard/properties/",z=function(e){var n,t,d,v,L=e.accountId,P=e.accountName,z=e.entity,G=e.data,H=e.refetch,V=e.onAddressCreated,E=e.isPropsComponent,B=e.initialValues,W=e.xeroContactId,J=e.displayXeroContacts,Y=e.xeroContacts,X=e.displaySignin,K=e.handleXeroAuthorize,Q=e.onClose,ee=(0,U.a)(),en=(0,O.x)().hasRole,et=(0,u.useState)(!1),er=et[0],ei=et[1],eo=null==Y?void 0:Y.find(function(e){return e.value===W}),ea=(0,o.Z)((0,i.Z)({},G?(location.propertyOwner={label:G.customer[0].account.name,value:G.customer[0].account.id},location.contactUser=(null==G?void 0:G.user)&&G.customer[0].account.id&&{label:G.user.fullName,value:G.user.id},location.access=G.access,location.name=G.name,location.status=G.status,location.permitsRequired=G.permitsRequired,location):{},B),{xeroContact:eo})||{},es=(0,h.cI)({defaultValues:ea,resolver:(0,g.S)((0,$.Ry)().shape({access:(0,$.Z_)().required(),contactUser:(0,$.Ry)().required(),name:(0,$.Z_)().required(),propertyOwner:(0,$.Ry)().required(),status:en("admin")&&(0,$.Z_)().required(),permitsRequired:(0,$.O7)()}))}),ec=es.control,eu=es.errors,ed=es.handleSubmit,el=es.register,em=es.setValue,ep=es.getValues,ev=es.watch,ef=(0,l.aM)(p.yf,{variables:{id:null==G?void 0:G.id},skip:!(null==G?void 0:G.id)}).data,eh=(void 0===ef?{property:{}}:ef).property,eg=(d=(0,r.Z)(function(e){var n,t,r,o,a,c,u,d,l,m,p;return(0,s.__generator)(this,function(a){switch(a.label){case 0:var s,u;return n=e.addressFormData,t=e.outerFormData,r={Addresses:{data:{Address:{data:(0,i.Z)({},n)},entity:z}}},o=(0,i.Z)({},ep(),r,t),en("customer")&&(o.status="active"),[4,ex({variables:{objects:[R(s=o)]}})];case 1:return p=void 0===(m=(void 0===(d=(void 0===(c=a.sent().data)?{}:c).insert_Location)?{}:d).returning)?{}:m,V&&V(p),ee.close(),[2]}})}),function(e){return d.apply(this,arguments)}),ey=(v=(0,r.Z)(function(e){return(0,s.__generator)(this,function(n){return ee.show({title:"Add new address",content:(0,c.jsx)(F.k,{onCancel:function(){},onSubmit:function(n){eg({addressFormData:n,outerFormData:e})},type:"text"}),submit:!1}),[2]})}),function(e){return v.apply(this,arguments)}),eZ=(0,a.Z)((0,m.D)(p.A1,{onCompleted:function(e){if(!E){var n=e.insert_Location.returning[0].id;ee.close(),H?H():f().push("".concat(D,"view?id=").concat(n))}}}),2),ex=eZ[0],eb=eZ[1].loading,eI=(0,a.Z)((0,m.D)(p.$A,{onCompleted:function(e){var n=e.update_Location_by_pk.id;ee.close(),H?H():f().push("".concat(D,"view?id=").concat(n))}}),2),ej=eI[0],eC=eI[1].loading,e_=(0,a.Z)((0,m.D)(p.$E),1)[0],eq=function(e){if(ei(!1),G){if("inactive"===e.status&&!(n=eh.jobs).every(function(e){return!!(0,T.E)(e,["completed","closed"])})){ei(!0);return}e.xeroContact&&e_({variables:{id:null===(s=null==G?void 0:G.customer[0])||void 0===s?void 0:s.account.id,changes:{meta:(0,o.Z)((0,i.Z)({},null===(c=null==G?void 0:G.customer[0])||void 0===c?void 0:c.account.meta),{xeroContactId:e.xeroContact.value})}}});var n,t,r,a,s,c,u={locationId:null==G?void 0:G.id,accountId:null===(t=null==G?void 0:G.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==e?void 0:null===(r=e.propertyOwner)||void 0===r?void 0:r.value,hasChanged:(null===(a=null==G?void 0:G.customer[0])||void 0===a?void 0:a.account.id)!==(null==e?void 0:e.propertyOwner.value)};M((0,o.Z)((0,i.Z)({},e),{xeroContact:void 0}),u,G.id,ej),Q()}else ey(e),Q()},eS={control:ec,errors:eu,register:el};return(0,c.jsxs)(y.Z,{disabled:eb||eC,id:"offCanvasForm",handleSubmit:ed(eq),children:[er&&(0,c.jsx)(Z.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,c.jsx)(x.Z,{children:(0,c.jsx)(b.Z,{md:12,children:(0,c.jsx)(k,(0,o.Z)((0,i.Z)({},eS),{accountId:L,accountName:P,canSelectAccount:!L,setValue:em,watch:ev}))})}),(0,c.jsx)(I.Z,{label:"Name",children:(0,c.jsx)(j.Z,(0,o.Z)((0,i.Z)({},eS),{name:"name"}))}),(0,c.jsx)(I.Z,{label:"Access information",children:(0,c.jsx)(C.Z,(0,o.Z)((0,i.Z)({},eS),{name:"access",rows:4}))}),en("admin")&&(0,c.jsx)(I.Z,{label:"Status",children:(0,c.jsx)(_.Z,(0,o.Z)((0,i.Z)({},eS),{name:"status",options:N.bg}))}),(0,c.jsx)(h.Qr,{name:"permitsRequired",control:ec,render:function(e){var n=e.value,t=e.onChange;return(0,c.jsx)(w.Z,{control:(0,c.jsx)(A.Z,{color:"secondary",checked:n||!1,onChange:function(e){return t(e.target.checked)}}),label:"Permits required"})}}),en("admin")&&void 0!==J&&J&&(0,c.jsx)(I.Z,{label:"Xero Contact",children:X?(0,c.jsx)(S.Z,{variant:"contained",onClick:function(){K()},children:"Connect to Xero to select Contact"}):(0,c.jsx)(q.Z,(0,o.Z)((0,i.Z)({options:Y},eS),{name:"xeroContact"}))})]})};k.propTypes={accountId:d.number,accountName:d.string,data:d.object,refetch:d.func,offCanvas:d.func}},51809:function(e,n,t){"use strict";t.d(n,{$A:function(){return f},$E:function(){return h},A1:function(){return v},Un:function(){return p},yf:function(){return y},zg:function(){return g}});var r=t(7297),i=t(75063);function o(){var e=(0,r.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return a=function(){return e},e}function s(){var e=(0,r.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return s=function(){return e},e}function c(){var e=(0,r.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return c=function(){return e},e}function u(){var e=(0,r.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,r.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}function l(){var e=(0,r.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return l=function(){return e},e}function m(){var e=(0,r.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return m=function(){return e},e}(0,i.Ps)(o());var p=(0,i.Ps)(a()),v=(0,i.Ps)(s()),f=(0,i.Ps)(c()),h=(0,i.Ps)(u()),g=(0,i.Ps)(d());(0,i.Ps)(l());var y=(0,i.Ps)(m())},93884:function(e,n,t){"use strict";t.d(n,{C:function(){return p}});var r=t(26042),i=t(69396),o=t(85893);t(67294);var a=t(45697),s=t(90948),c=t(15861),u=t(51233),d=t(11057),l=t(61730),m=(0,s.ZP)("img")({width:"300px",height:"250px"}),p=function(e){var n=e.imageSrc,t=e.sx,a=e.imageSx,s=e.title,p=e.titleSx,v=e.subtitleFirstLine,f=e.subtitleFirstLineSx,h=e.subtitleSecondLine,g=e.subtitleSecondLineSx,y=e.buttonText,Z=e.onAction,x=(0,l.Z)("(max-width: 400px)");return(0,o.jsxs)(u.Z,{sx:(0,i.Z)((0,r.Z)({},t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,o.jsx)(m,{src:n,sx:(0,i.Z)((0,r.Z)({},a),{width:x?"250px":"300px"})}),(0,o.jsx)(c.Z,{typography:"h5",sx:(0,r.Z)({},p),children:s}),(0,o.jsxs)(u.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,o.jsx)(c.Z,{sx:(0,r.Z)({},f),children:v}),(0,o.jsx)(c.Z,{sx:(0,r.Z)({},g),children:h})]}),y&&Z&&(0,o.jsx)(d.Z,{variant:"contained",color:"secondary",onClick:Z,children:y})]})};p.propTypes={imageSrc:a.string,title:a.string,subtitleFirstLine:a.string,subtitleSecondLine:a.string,onAction:a.func,sx:a.object,imageSx:a.object,titleSx:a.object,subtitleFirstLineSx:a.object,subtitleSecondLineSx:a.object},p.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},66812:function(e,n,t){"use strict";t.d(n,{P:function(){return C}});var r=t(47568),i=t(26042),o=t(99534),a=t(7297),s=t(97582),c=t(85893),u=t(67294),d=t(45697),l=t(10367),m=t(66252),p=t(4972),v=t(78289),f=t(52019),h=t(49501),g=t(9270),y=t(62140),Z=t(84043),x=t(77439);function b(){var e=(0,a.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return b=function(){return e},e}var I=function(e,n){var t,r,i,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(t){e[t]!==n[t]&&(o=!1)}),o},j=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,i=e.entity,o=e.entityId,a=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,u=e.taxonomyGroupType,d=e.customerId,l=e.customerRole,m=e.type,v=e.userId,f=e.invoiceThreshold,h=e.quoteThreshold,g=m;switch(l&&(g="".concat(m,"_").concat(l)),g){case"address":return{query:p.cz,variables:{entity:i,entityId:o}};case"asset":return{query:p.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:p.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:p.nD,variables:{id:a}};case"assetSublocation":return{query:p.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"compliance":return{query:p.kU,variables:{locationId:s}};case"coverage":return{query:p.j$};case"customer":return{query:p.SW};case"job":return{query:p.Qn,variables:{locationId:s}};case"manager":return{query:p.he,variables:{accountId:n,userId:v}};case"thresholdManagers":return{query:p.Ak,variables:{accountId:n,userId:v,invoiceThreshold:f,quoteThreshold:h}};case"product":return{query:p.UH,variables:{category:"product",locationId:s}};case"property":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:p.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:p.kx};case"sla":return{query:p.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:p.zR,variables:{locationId:s}};case"supplier":var y={type:{_eq:"supplier"}};return t&&(y.PostcodeAreas={PostcodeArea:{area:{_eq:t}},entity:{_eq:"Account"},status:{_eq:"active"}}),c&&(y.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:c}},t&&(y.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:t}}})),{query:p.by,variables:{where:y}};case"user":return{query:p.yR,variables:{accountId:n}};case"usersForBookings":return{query:p.yR,variables:{accountId:v}};case"tenant":return{query:p.RJ};case"taxonomyGroup":return{query:p.Cj,variables:{type:u}};case"expenseCategory":return{query:p.Ve};default:return{query:p.qd}}},C=(0,u.memo)(function(e){var n,t=e.AddForm,a=e.accountId,d=e.area,l=e.assetCategoryId,p=e.control,b=e.entity,I=e.entityId,C=e.errors,q=e.id,S=e.isClearable,A=e.isDisabled,w=e.label,L=e.locationId,P=e.name,k=e.serviceId,T=e.taxonomyGroupType,R=e.customerId,M=e.customerRole,$=e.type,F=e.userId,N=e.invoiceThreshold,O=e.quoteThreshold,U=(0,o.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),D=(0,m.x)(),z=(0,u.useState)(!1),G=z[0],H=z[1],V=(0,u.useState)(),E=V[0],B=V[1],W=(0,u.useState)(!1),J=W[0],Y=W[1],X=(0,u.useContext)(v.Z),K=(0,u.useContext)(f.Z).hasRole,Q=(0,u.useState)(!1),ee=Q[0],en=Q[1];(0,u.useEffect)(function(){return en(!1),Y(!1),function(){}},[a,l,b,I,L,k,$,R,M,F]);var et=(n=(0,r.Z)(function(){var e,n,t,r,o,c,u;return(0,s.__generator)(this,function(o){switch(o.label){case 0:if(J)return en(!0),[2,null];return H(!0),n=(e=j({accountId:a,area:d,assetCategoryId:l,entity:b,entityId:I,hasRole:K,id:q,locationId:L,serviceId:k,taxonomyGroupType:T,customerId:R,customerRole:M,type:$,userId:F,invoiceThreshold:N,quoteThreshold:O})).query,r=void 0===(t=e.variables)?{}:t,[4,D.query({query:n,variables:(0,i.Z)({},r)})];case 1:return B((void 0===(c=o.sent().data)?{items:[]}:c).items),H(!1),Y(!0),en(!0),[2]}})}),function(){return n.apply(this,arguments)}),er=function(){X.show({content:(0,c.jsx)("div",{children:(0,c.jsx)(t,{})}),title:"Add form"})};return(0,c.jsx)(h.Z,{id:P,label:w,children:(0,c.jsxs)(g.Z,{children:[(0,c.jsx)(y.Z,{md:t?11:12,children:(0,c.jsx)(Z.Z,(0,i.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:p,errors:C,isDisabled:A,isClearable:S,isLoading:G,menuIsOpen:ee,options:E,onFocus:et,onBlur:function(){en(!1)},name:P,searchable:!0},U),U.defaultValue)}),t&&(0,c.jsx)(y.Z,{md:1,children:(0,c.jsx)(_,{children:(0,c.jsx)(x.Z,{content:null,startIcon:"plus",size:"sm",onClick:er})})})]})})},I),_=l.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-fdff7245-0"})(b());C.propTypes={AddForm:d.object,area:d.string,accountId:d.number,assetCategoryId:d.number,control:d.object.isRequired,errors:d.object.isRequired,entity:d.string,entityId:d.number,id:d.number,isClearable:d.bool,label:d.string.isRequired,locationId:d.number,name:d.string.isRequired,serviceId:d.number,taxonomyGroupType:(0,d.oneOf)(["expenseCategory","costCategory","jobTags"]),type:d.string},C.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},15033:function(e,n,t){"use strict";t.d(n,{i:function(){return _}});var r=t(14924),i=t(26042),o=t(69396),a=t(85893),s=t(67294),c=t(11163),u=t(45697),d=t.n(u),l=t(61870),m=t(5616),p=t(51233),v=t(15861),f=t(90948),h=t(41796),g=t(29217),y=t(45111),Z=t(46003),x=t(70872),b=t(58886),I=t(61730),j=function(e){var n=e.currentPage,t=e.totalCount,r=e.pageSize,o=e.onPageChange,s=(0,I.Z)("(max-width:400px)"),c=(0,I.Z)("(max-width:500px)");return(0,a.jsx)(C,{mb:2,page:n,count:Math.ceil(t/r),onChange:function(e,n){return o(n)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===n,hideNextButton:n===Math.ceil(t/r),siblingCount:c?0:1,renderItem:function(e){return(0,a.jsx)(b.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};j.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},j.propTypes={currentPage:d().number,totalCount:d().number,pageSize:d().number,onPageChange:d().func};var C=(0,f.ZP)(x.Z)(function(e){var n,t=e.hidePrevButton,o=e.hideNextButton,a=e.theme;return n={},(0,r.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(n,"& button.Mui-selected",(0,i.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},t?{borderRadius:"5px 0 0 5px"}:{})),n}),_=(0,s.forwardRef)(function(e,n){var t=e.columns,r=e.history,o=e.initialSort,u=e.meta,d=e.refetch,l=e.paginationSize,m=e.containerHeight,f=e.noResultsMessage,h=e.autoHeight,x=(0,c.useRouter)(),b=x.query,I=void 0===b?{}:b,C=(0,s.useState)(parseInt(null==I?void 0:I.page,10)||1),_=C[0],A=C[1],w=(0,s.useState)(l||Z.C1.paginationSize),L=w[0],P=w[1];o||(o={item:"createdAt",order:"desc"});var k=(0,s.useState)({item:o.item,order:o.order}),T=k[0],R=k[1],M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=x.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var r=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(r)},$=function(){R({item:o.item,order:o.order}),A(1);var e=M();x.push(e),P(l||Z.C1.paginationSize)};(0,s.useImperativeHandle)(n,function(){return{currentPage:_,pageSize:L,sort:T,resetPagination:function(){$()}}});var F=function(e){var n=M(e);r&&x.push(n),A(e),!r&&d&&d()},N=function(e){e&&e.field&&e.sort?(R({item:t.find(function(n){return n.field===e.field}).sortName||e.field||e.item||o.item,order:e.sort||e.order||o.order}),d&&d()):(R({item:o.item,order:o.order}),d&&d())};return(0,a.jsxs)(q,{containerHeight:m,children:[(0,a.jsx)(S,(0,i.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:h,sortingMode:"server",onSortModelChange:function(e){return N(e[0])},columns:t,pageSize:L,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(g.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(y.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(p.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(g.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(y.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(v.Z,{children:f})})},noRowsOverlay:function(){return(0,a.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(v.Z,{children:f})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/L)>1&&(0,a.jsx)(j,{currentPage:_,totalCount:u.aggregate.totalCount,pageSize:L,onPageChange:F})]})});_.propTypes={history:d().bool,initialSort:d().object,loading:d().bool,meta:d().object,refetch:d().func,paginationSize:d().number,noResultsMessage:d().string,columns:d().array.isRequired,rows:d().array.isRequired,autoHeight:d().bool},_.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var q=(0,f.ZP)(m.Z)(function(e){return{height:e.containerHeight,display:"flex",flexDirection:"column"}}),S=(0,f.ZP)(l.s)(function(e){var n,t=e.theme,a=e.hideHeader,s=(e.rows,e.loading,e.rowHeight),c=e.isPdf;return n={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(n,"&.MuiDataGrid-root",(0,i.Z)({color:t.palette.black.main,border:"none"},c&&{"@media print":{display:"block"}})),(0,r.Z)(n,"& .MuiDataGrid-main",(0,i.Z)({},c&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,i.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(n,"& .MuiDataGrid-virtualScroller",(0,i.Z)({},a&&{marginTop:"0 !important"},c&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(n,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerContent",(0,i.Z)({},c&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerRenderZone",(0,i.Z)({},c&&{position:"relative"})),(0,r.Z)(n,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,r.Z)(n,"& .MuiDataGrid-row",(0,i.Z)({},c&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,i.Z)({},c&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),n})},20705:function(e,n,t){"use strict";t.d(n,{x:function(){return d}});var r=t(14924),i=t(26042),o=t(69396),a=t(67294),s=t(96486),c=t(46003),u=function(e){try{return JSON.parse(e)}catch(n){return!1}},d=function(e){var n,t,d,l,m,p,v,f,h,g,y,Z=e.filters,x=e.newFilters,b=e.initialSort,I=(0,a.useRef)(),j=(0,a.useState)({}),C=j[0],_=j[1],q=(0,a.useState)({}),S=q[0],A=q[1],w=b||{item:"createdAt",order:"desc"},L=(0,r.Z)({},(null===(n=I.current)||void 0===n?void 0:n.sort.item)||w.item,w.inneritem?(0,r.Z)({},w.inneritem,(null===(t=I.current)||void 0===t?void 0:t.sort.order)||w.order):(null===(d=I.current)||void 0===d?void 0:d.sort.order)||w.order);return(0,a.useEffect)(function(){var e=!(0,s.isEqual)(C,Z),n=!(0,s.isEqual)(S,x);if(e&&(_(Z),null==I||null===(r=I.current)||void 0===r||r.resetPagination()),n&&(A(x),null==I||null===(i=I.current)||void 0===i||i.resetPagination()),(null==I?void 0:null===(t=I.current)||void 0===t?void 0:t.setSort)&&!(e||n)){var t,r,i,o,a,c,u,d,l,m,p,v=(null===(o=I.current)||void 0===o?void 0:null===(a=o.sort)||void 0===a?void 0:a.item)&&(null===(c=I.current)||void 0===c?void 0:null===(u=c.sort)||void 0===u?void 0:u.order)?{item:null===(d=I.current)||void 0===d?void 0:null===(l=d.sort)||void 0===l?void 0:l.item,order:null===(m=I.current)||void 0===m?void 0:null===(p=m.sort)||void 0===p?void 0:p.order}:L;I.current.setSort(v)}},[Z,x]),{initialData:(0,o.Z)((0,i.Z)({},Z),{newFilters:(null==x?void 0:x.length)>0?x:void 0,limit:(null===(l=I.current)||void 0===l?void 0:l.pageSize)==="Infinity"?null:parseInt(null===(m=I.current)||void 0===m?void 0:m.pageSize,10)||c.C1.paginationSize,offset:((null===(p=I.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(v=I.current)||void 0===v?void 0:v.pageSize)||c.C1.paginationSize),orderBy:u(null===(f=I.current)||void 0===f?void 0:null===(h=f.sort)||void 0===h?void 0:null===(g=h.item)||void 0===g?void 0:g.replace(/ORDER/i,null===(y=I.current)||void 0===y?void 0:y.sort.order))||L}),initialSort:b,ref:I}}},9492:function(e,n,t){"use strict";t.d(n,{S:function(){return r}});var r=function(e,n){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=n,t.href=e,t.click(),document.body.removeChild(t)):location.replace(e)}},75832:function(e,n,t){"use strict";function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat(["en-GB"],{currency:n,currencyDisplay:"symbol",style:"currency"}).format(e)}t.d(n,{T:function(){return r}})},59938:function(e,n,t){"use strict";t.d(n,{X:function(){return v}});var r=t(14924),i=t(82670),o=t(828),a=t(7297),s=t(67294),c=t(6388),u=t(50319),d=t(75063),l=t(18586);function m(){var e=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return p=function(){return e},e}function v(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,l.q)().user,d=(0,s.useState)(function(){try{switch(t){case"network":case"state":return n;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||n}}catch(r){return n}}),m=d[0],p=d[1],v=function(n){try{var o=(0,i.Z)(n,Function)?n(m):n;switch(p(o),t){case"network":g({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,r.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(s){}};(0,c.aM)(f,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==t,onCompleted:function(t){var r=t.accountUser;r&&p(r.filters[e]||n)}});var g=(0,o.Z)((0,u.D)(h),1)[0];return[m,v]}var f=(0,d.Ps)(m()),h=(0,d.Ps)(p())},73760:function(e,n,t){"use strict";t.d(n,{O:function(){return r},v:function(){return i}});var r=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],i=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},21789:function(e,n,t){"use strict";t.d(n,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},15284:function(e,n,t){"use strict";t.r(n);var r=t(85893),i=t(71306),o=t(18586),a=t(2845),s=t(58849),c={accountId:null,q:null,filterType:"locations_table"},u=function(){var e=(0,o.q)().hasUserModule,n=(0,(0,a.x)().hasRole)("customer_user"),t=e("finances");return(0,r.jsx)(s.Z,{children:(0,r.jsx)(i.V,{initialFilters:c,columnVisibilityModel:{totalSpent:!n||t}})})};u.getLayout=function(e){return e},n.default=u}},function(e){e.O(0,[3662,2283,212,8890,619,2583,4135,8579,6043,1838,4244,1417,3776,2329,778,1023,7454,1870,4043,5497,8544,8849,4972,9774,2888,179],function(){return e(e.s=1215)}),_N_E=e.O()}]);