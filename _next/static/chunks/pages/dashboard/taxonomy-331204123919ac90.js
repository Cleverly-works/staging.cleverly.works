(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4031],{23570:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/taxonomy",function(){return n(56942)}])},667:function(e,t,n){"use strict";n.d(t,{R:function(){return d}});var o=n(85893);n(67294);var i=n(64666),r=n(5616),a=n(15861),s=n(6514),l=n(31425),u=n(51233),c=n(11057),d=function(e){var t,n=e.onClose,d=e.onAccept,p=e.type,m={draft:{title:"Are you sure you want to move this form to Draft?",content:"It will become available for selection in tasks and work orders.",cancelAction:"Cancel",okAction:"Move to draft"},publish:{title:"Are you sure you want to publish this form?",content:"It will become available for selection in tasks and work orders.",cancelAction:"Cancel",okAction:"Publish form"},applyToIncomplete:{title:"Apply to incomplete jobs?",content:"Do you want to apply this new template to all incomplete jobs and tasks?",cancelAction:"No",okAction:"Yes"},applyToNew:{title:"Apply new template",content:"Please note that these changes will only be applied to new jobs created using this template.",okAction:"Ok"}};return(0,o.jsx)(i.Z,{open:open,onClose:n,PaperProps:{sx:{borderRadius:"8px",overflow:"hidden",width:"421px",maxWidth:"421px",height:"239px",display:"flex",alignItems:"center",justifyContent:"center",margin:0,position:"relative"}},slotProps:{backdrop:{sx:{backgroundColor:"rgba(0, 0, 0, 0.6)"}}},children:(0,o.jsxs)(r.Z,{sx:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[(0,o.jsx)(r.Z,{sx:{position:"absolute",top:0,left:0,right:0,backgroundColor:"#2673CA",color:"#ffffff",textAlign:"center",fontSize:"12px",display:"flex",justifyContent:"center",alignItems:"center",height:"64px"},children:(0,o.jsx)(a.Z,{align:"center",sx:{fontSize:"15px",justifyContent:"center"},children:m[p].title})}),(0,o.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",padding:0,paddingTop:"74px",flexGrow:1},children:(0,o.jsx)(a.Z,{align:"center",alignContent:"center",sx:{fontSize:"14px",maxWidth:"320px",lineHeight:1.57},children:m[p].content})}),(0,o.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",padding:0,marginTop:"10px",paddingBottom:"10px"},children:(0,o.jsxs)(u.Z,{direction:"row",justifyContent:"center",sx:{display:"flex",gap:"46px"},children:[(null===(t=m[p])||void 0===t?void 0:t.cancelAction)&&(0,o.jsx)(c.Z,{color:"secondary",variant:"contained",size:"small",onClick:n,sx:{height:"36px",minHeight:"36px",paddingInline:"24px",color:"#919191",backgroundColor:"transparent",justifyContent:"center",alignItems:"center",boxShadow:"none",border:"1px solid #9C9C9C",borderRadius:"4px",marginLeft:"0 !important","&:hover":{color:"#919191",backgroundColor:"transparent"}},children:m[p].cancelAction}),(0,o.jsx)(c.Z,{color:"secondary",variant:"contained",size:"small",onClick:void 0===d?n:d,sx:{height:"36px",minHeight:"36px",paddingInline:"24px",color:"F5F5F5",backgroundColor:"#1565C0",justifyContent:"center",alignItems:"center",boxShadow:"none",borderRadius:"4px","&:hover":{color:"F5F5F5",backgroundColor:"#1565C0"}},children:m[p].okAction})]})})]})})}},28591:function(e,t,n){"use strict";n.d(t,{i:function(){return T}});var o=n(47568),i=n(26042),r=n(69396),a=n(828),s=n(29815),l=n(97582),u=n(85893),c=n(67294),d=n(6388),p=n(50319),m=n(38216),f=n(42283),y=n(15861),v=n(23776),g=n(50135),h=n(93946),x=n(11994),b=n(5616),j=n(90629),Z=n(22961),C=n(72450),I=n(93739),S=n(74231),q=n(2845),T=function(e){var t,n,T,k,w,F=e.control,A=e.errors,P=e.register,E=e.setValue,R=e.entity,D=e.entityId,$=e.hasSelect,M=void 0===$||$,N=e.hasForm,z=e.hasPreview,O=void 0!==z&&z,V=e.isSubmit,G=void 0!==V&&V,H=e.linkedTo,L=e.isDisabled,Q=e.showScoreAndLabels,W=e.doValidation,B=void 0!==W&&W,U=e.handleValidation,J=e.onTotalScoreAndLabelChange,X=void 0===J?function(){}:J,Y=(0,c.useState)([]),K=Y[0],ee=Y[1],et=(0,c.useState)(),en=et[0],eo=et[1],ei=(0,c.useState)(!1),er=ei[0],ea=ei[1],es=(0,c.useState)(!1),el=es[0],eu=es[1],ec=(0,q.x)().user,ed=(0,c.useState)({}),ep=ed[0],em=ed[1],ef=(0,c.useState)(null),ey=ef[0],ev=ef[1],eg=(0,c.useState)(null),eh=eg[0],ex=eg[1],eb=(0,c.useState)(0),ej=eb[0],eZ=eb[1],eC=(0,c.useState)(""),eI=eC[0],eS=eC[1],eq=(0,c.useState)(0)[1],eT=function(e){eZ(e);var t=eF(e,ew);X(e,t)},e_=function(e){eq(e)},ek=(0,d.aM)(m.n).data,ew=(null==ek?void 0:ek.Form.map(function(e){return e.settings}).flat())||[],eF=function(e){var t=null==ew?void 0:ew.find(function(t){return e>=(null==t?void 0:t.min)&&e<=(null==t?void 0:t.max)});return t?t.label:null},eA=(0,d.aM)(m.Q2,{variables:{entity:ep.entity,entityId:ep.entityId},skip:!ep.entity||!ep.entityId}),eP=eA.data,eE=eA.refetch,eR=(0,a.Z)((0,p.D)(m.Vw),1)[0],eD=(0,a.Z)((0,p.D)(m.FE),1)[0],e$=(0,a.Z)((0,p.D)(m._q),1)[0],eM={formId:null==en?void 0:en.value,formFields:null==en?void 0:en.formFields,submissionData:eh},eN=function(e){var t,n=null==en?void 0:null===(t=en.formFields)||void 0===t?void 0:t.reduce(function(e,t){if(t.required)switch(t.type){case"defaultText":case"text":case"input":case"longText":case"textArea":e[t.stateName]=S.Z_().trim().required("".concat(t.label," is required"));break;case"numberInput":case"currency":case"slider":e[t.stateName]=S.Rx().required("".concat(t.label," is required")).nullable();break;case"select":case"signerInitials":case"radio":e[t.stateName]=S.Z_().required("".concat(t.label," is required"));break;case"multiSelect":e[t.stateName]=S.IX().of(S.Z_().required("Select a value")).min(1,"".concat(t.label," requires at least one selection")).required("".concat(t.label," is required"));break;case"checkbox":e[t.stateName]=S.IX().min(1,"".concat(t.label," requires at least one selection")).required("".concat(t.label," is required"));break;case"datepicker":e[t.stateName]=S.hT().required("".concat(t.label," is required"));break;case"time":e[t.stateName]=S.Z_().required("".concat(t.label," is required")).matches(/^\d{2}:\d{2}$/,"Time must be in HH:MM format");break;case"timeRange":e[t.stateName]=S.Ry().shape({startTime:S.Z_().required("Start time is required").matches(/^\d{2}:\d{2}$/,"Must be in HH:MM format"),endTime:S.Z_().required("End time is required").matches(/^\d{2}:\d{2}$/,"Must be in HH:MM format")}).required("".concat(t.label," is required"));break;case"signature":e[t.stateName]=S.Z_().required("Signature is required").nullable()}return e},{});return S.Ry().shape(n).validate(e,{abortEarly:!1})},ez=(T=(0,o.Z)(function(){return(0,l.__generator)(this,function(e){switch(e.label){case 0:if(!D||!R)return[2];return[4,eR({variables:{formId:en.value,userId:ec.id,submissionData:eh,formFields:en.formFields,entity:R,entityId:D}})];case 1:return e.sent(),[2]}})}),function(){return T.apply(this,arguments)}),eO=(k=(0,o.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,eD({variables:{id:null===(e=null==eP?void 0:eP.FormSubmissions[0])||void 0===e?void 0:e.id,changes:eM}})];case 1:return t.sent(),[2]}})}),function(){return k.apply(this,arguments)}),eV=(w=(0,o.Z)(function(){var e,t;return(0,l.__generator)(this,function(n){switch(n.label){case 0:if((null===(e=null==eP?void 0:eP.FormSubmissions[0])||void 0===e?void 0:e.entityId)!==D)return[2];return[4,e$({variables:{id:null===(t=null==eP?void 0:eP.FormSubmissions[0])||void 0===t?void 0:t.id}})];case 1:return n.sent(),[2]}})}),function(){return w.apply(this,arguments)}),eG=function(){(null==en?void 0:en.name)==="None"?eu(!0):(null==en?void 0:en.id)&&(ea(!er),eu(!1))},eH=function(e){e&&(E("formSubmission",e),eu(!1))},eL=function(e){ex(e)};return(0,c.useEffect)(function(){(null==H?void 0:H.entity)&&(null==H?void 0:H.entityId)&&null===ey&&ev(H)},[H,ey]),(0,c.useEffect)(function(){eE()},[ep.entityId,ep.entity]),(0,c.useEffect)(function(){R&&null!=R&&""!==R&&D&&null!=D&&""!==R&&em({entity:R,entityId:D})},[]),(0,c.useEffect)(function(){(null==H?void 0:H.entityId)!==(null==ey?void 0:ey.entityId)&&(null===ey&&D||em(H),ev(H))},[null==H?void 0:H.entityId]),(0,c.useEffect)(function(){var e;if(null==ek?void 0:null===(e=ek.Form)||void 0===e?void 0:e.length){var t,n=(0,s.Z)(ek.Form).map(function(e){return(0,r.Z)((0,i.Z)({},e),{value:e.id})}).sort(function(e,t){return e.id-t.id});if(!(null===(t=null==eP?void 0:eP.FormSubmissions[0])||void 0===t?void 0:t.id)){var o=n.find(function(e){return 1===e.id});eo((0,r.Z)((0,i.Z)({},o),{value:null==o?void 0:o.id}))}ee(n)}},[ek]),(0,c.useEffect)(function(){var e;(null===(e=null==eP?void 0:eP.FormSubmissions[0])||void 0===e?void 0:e.id)&&(eo({id:null==eP?void 0:eP.FormSubmissions[0].id,name:null==eP?void 0:eP.FormSubmissions[0].form.name,value:null==eP?void 0:eP.FormSubmissions[0].formId,formFields:null==eP?void 0:eP.FormSubmissions[0].formFields,submissionData:null==eP?void 0:eP.FormSubmissions[0].submissionData}),ex(null==eP?void 0:eP.FormSubmissions[0].submissionData))},[null===(t=null==eP?void 0:eP.FormSubmissions[0])||void 0===t?void 0:t.id]),(0,c.useEffect)(function(){if((null==K?void 0:K.length)&&!(null==eP?void 0:eP.FormSubmissions[0])){var e=K.find(function(e){return 1===e.id});eo((0,r.Z)((0,i.Z)({},e),{value:null==e?void 0:e.id}))}},[K,null==eP?void 0:eP.FormSubmissions[0]]),(0,c.useEffect)(function(){eH(en)},[en]),(0,c.useEffect)(function(){if(G&&en){if((null==en?void 0:en.id)===1)eV();else{var e,t,n;(null===(e=null==eP?void 0:eP.FormSubmissions[0])||void 0===e?void 0:e.id)&&(null===(t=null==eP?void 0:eP.FormSubmissions[0])||void 0===t?void 0:t.entityId)===D&&(null===(n=null==eP?void 0:eP.FormSubmissions[0])||void 0===n?void 0:n.entity)===R?eO():ez()}}},[G]),(0,c.useEffect)(function(){B&&eh&&eN(eh).then(function(){U(!0),eS("")}).catch(function(e){U(!1),eS(e.inner.map(function(e){return e.message}).join(", "))})},[B,eh]),(0,u.jsxs)(u.Fragment,{children:[B&&eI&&(0,u.jsx)(y.Z,{fontSize:"14px",color:"error",children:eI}),K.length&&(0,u.jsx)(f.Qr,(0,r.Z)((0,i.Z)({},{errors:A,register:P,control:F}),{name:"formSubmission",render:function(e){return(0,u.jsxs)("div",{style:_.autocompleteWrapper,children:[(0,u.jsx)(v.Z,(0,r.Z)((0,i.Z)({},e),{disablePortal:!0,options:K,disabled:L,value:en,getOptionLabel:function(e){return e.name},sx:(0,r.Z)((0,i.Z)({},_.autocomplete),{visibility:!M&&"hidden",height:!M&&0,margin:!M&&0}),onChange:function(e,t){var n=t||(0,i.Z)({},K.find(function(e){return 1===e.id}));eo(n),eH(n)},renderInput:function(e){return(0,u.jsx)(g.Z,(0,r.Z)((0,i.Z)({},e),{label:"Select Form",variant:"outlined",inputProps:(0,i.Z)({},e.inputProps)}))}})),O&&(0,u.jsx)(h.Z,{color:(null==en?void 0:en.value)&&(null==en?void 0:en.value)!==1?"primary":"disabled",onClick:eG,sx:{marginLeft:"10px"},children:(0,u.jsx)(Z.Z,{sx:{fontSize:20}})}),el&&(0,u.jsx)("div",{className:"eyeNotification",style:_.eyeNotification,children:(0,u.jsxs)(y.Z,{fontSize:"12px",color:"error",children:["No form will be created inside the job","."]})})]})}})),en&&(null==en?void 0:en.id)!==1&&void 0!==N&&N&&(0,u.jsx)(I.L,{entityId:null===(n=null==eP?void 0:eP.FormSubmissions[0])||void 0===n?void 0:n.id,refetch:eE,scheme:en.formFields,submissionData:en.submissionData,isOffCanvas:!0,liftingSubmissions:eL,calculatedTotalScore:eT,scoreLabels:ew,blockStyle:_.blockStyle,onFileCountChange:e_}),(void 0===Q||Q)&&ej>0&&(0,u.jsxs)(y.Z,{variant:"h6",sx:{padding:"10px",borderTop:1,fontFamily:"Nunito-Regular",fontSize:"16px"},children:["Total Score: ",ej,eF(ej,ew)&&" (".concat(eF(ej,ew),")")]}),en&&(0,u.jsx)(x.Z,{open:er,onClose:eG,style:{zIndex:"9999"},slotProps:{backdrop:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)"}}},children:(0,u.jsx)(b.Z,{sx:_.modalContainerStyle,children:(0,u.jsxs)(j.Z,{sx:_.modalContentStyle,children:[(0,u.jsxs)(b.Z,{sx:_.stickyHeaderStyle,marginBottom:1,children:[(0,u.jsx)(y.Z,{variant:"h6",sx:{fontFamily:"Nunito-Regular",fontSize:"16px",paddingLeft:"10px"},children:"Form preview"}),(0,u.jsx)(h.Z,{color:"secondary",onClick:eG,sx:{marginLeft:"10px"},children:(0,u.jsx)(C.Z,{sx:{fontSize:20}})})]}),(0,u.jsx)("div",{style:_.previewScheme,children:(0,u.jsx)(I.L,{scheme:null==en?void 0:en.formFields,submissionData:null==en?void 0:en.submissionData,formSchemeOnEdit:null,formSchemeOnCopy:null,formSchemeOnDelete:null,blockStyle:_.blockStyle})})]})})})]})},_={autocomplete:{marginBottom:"1rem",marginTop:"1rem",flex:1},autocompleteWrapper:{display:"flex",alignItems:"center",position:"relative",width:"100%"},iconPreview:{height:"minContent"},blockStyle:{border:"none",backgroundColor:"#FFFFFF",highlighted:""},previewScheme:{pointerEvents:"none"},modalContainerStyle:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",zIndex:"9999"},eyeNotification:{position:"absolute",bottom:"-40px",right:"0",backgroundColor:"#fff",padding:"4px",zIndex:2,border:"2px solid #f5f5f5",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",width:"auto",maxWidth:"300px",minWidth:"250px",wordWrap:"break-word"},modalContentStyle:{width:"650px",height:"600px",padding:"10px",overflowY:"auto",borderRadius:"12px",backgroundColor:"#FFFFFF"},stickyHeaderStyle:{position:"sticky",top:0,height:"44px",backgroundColor:"#F5F5F5",borderRadius:"12px",zIndex:1,fontFamily:"Nunito-SemiBold",border:1,padding:"15px",display:"flex",alignItems:"center",justifyContent:"space-between"}}},12547:function(e,t,n){"use strict";n.d(t,{r:function(){return d}});var o=n(26042),i=n(69396),r=n(85893),a=n(45697),s=n.n(a),l=n(41664),u=n.n(l),c=n(23795),d=function(e){var t=e.children,n=e.href,a=e.noWrap,s=e.target,l=e.sx,d=void 0===l?{}:l;return a?(0,r.jsx)(r.Fragment,{children:t}):n?(0,r.jsx)(u(),{href:n,target:s,passHref:!0,children:(0,r.jsx)(c.Z,(0,i.Z)((0,o.Z)({sx:d},e),{children:t}))}):(0,r.jsx)(c.Z,(0,i.Z)((0,o.Z)({sx:d},e),{children:t}))};d.defaultProps={onClick:function(e){e.stopPropagation()}},d.propTypes={onClick:s().func,href:s().string,noWrap:s().bool,color:s().string}},66812:function(e,t,n){"use strict";n.d(t,{P:function(){return I}});var o=n(47568),i=n(26042),r=n(99534),a=n(7297),s=n(97582),l=n(85893),u=n(67294),c=n(45697),d=n(10367),p=n(66252),m=n(4972),f=n(78289),y=n(52019),v=n(49501),g=n(9270),h=n(62140),x=n(84043),b=n(77439);function j(){var e=(0,a.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return j=function(){return e},e}var Z=function(e,t){var n,o,i,r=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(o=t.errors[t.name])||void 0===o?void 0:o.message)&&(r=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(n){e[n]!==t[n]&&(r=!1)}),r},C=function(e){var t=e.accountId,n=e.area,o=e.assetCategoryId,i=e.entity,r=e.entityId,a=(e.hasRole,e.id),s=e.locationId,l=e.serviceId,u=e.taxonomyGroupType,c=e.customerId,d=e.customerRole,p=e.type,f=e.userId,y=e.invoiceThreshold,v=e.quoteThreshold,g=p;switch(d&&(g="".concat(p,"_").concat(d)),g){case"address":return{query:m.cz,variables:{entity:i,entityId:r}};case"asset":return{query:m.UH,variables:{categoryId:o,locationId:s}};case"assetBookable":return{query:m.UH,variables:{categoryId:o,locationId:s,bookable:"yes"}};case"assetCategory":return{query:m.nD,variables:{id:a}};case"assetSublocation":return{query:m.UH,variables:{category:"sublocation",adminId:t,locationId:s}};case"compliance":return{query:m.kU,variables:{locationId:s}};case"coverage":return{query:m.j$};case"customer":return{query:m.SW};case"job":return{query:m.Qn,variables:{locationId:s}};case"manager":return{query:m.he,variables:{accountId:t,userId:f}};case"thresholdManagers":return{query:m.Ak,variables:{accountId:t,userId:f,invoiceThreshold:y,quoteThreshold:v}};case"product":return{query:m.UH,variables:{category:"product",locationId:s}};case"property":return{query:m._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t}}}}};case"property_user":return{query:m._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:c}}},User_Account_Locations:{Account_User:{userId:{_eq:c},accountId:{_eq:t}}}}}}};case"sensor":return{query:m.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:m.kx};case"sla":return{query:m.t1,variables:{type:"priority",adminId:t}};case"sublocation":return{query:m.zR,variables:{locationId:s}};case"supplier":var h={type:{_eq:"supplier"}};return n&&(h.PostcodeAreas={PostcodeArea:{area:{_eq:n}},entity:{_eq:"Account"},status:{_eq:"active"}}),l&&(h.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:l}},n&&(h.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:n}}})),{query:m.by,variables:{where:h}};case"user":return{query:m.yR,variables:{accountId:t}};case"usersForBookings":return{query:m.yR,variables:{accountId:f}};case"tenant":return{query:m.RJ};case"taxonomyGroup":return{query:m.Cj,variables:{type:u}};case"expenseCategory":return{query:m.Ve};default:return{query:m.qd}}},I=(0,u.memo)(function(e){var t,n=e.AddForm,a=e.accountId,c=e.area,d=e.assetCategoryId,m=e.control,j=e.entity,Z=e.entityId,I=e.errors,q=e.id,T=e.isClearable,_=e.isDisabled,k=e.label,w=e.locationId,F=e.name,A=e.serviceId,P=e.taxonomyGroupType,E=e.customerId,R=e.customerRole,D=e.type,$=e.userId,M=e.invoiceThreshold,N=e.quoteThreshold,z=(0,r.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),O=(0,p.x)(),V=(0,u.useState)(!1),G=V[0],H=V[1],L=(0,u.useState)(),Q=L[0],W=L[1],B=(0,u.useState)(!1),U=B[0],J=B[1],X=(0,u.useContext)(f.Z),Y=(0,u.useContext)(y.Z).hasRole,K=(0,u.useState)(!1),ee=K[0],et=K[1];(0,u.useEffect)(function(){return et(!1),J(!1),function(){}},[a,d,j,Z,w,A,D,E,R,$]);var en=(t=(0,o.Z)(function(){var e,t,n,o,r,l,u;return(0,s.__generator)(this,function(r){switch(r.label){case 0:if(U)return et(!0),[2,null];return H(!0),t=(e=C({accountId:a,area:c,assetCategoryId:d,entity:j,entityId:Z,hasRole:Y,id:q,locationId:w,serviceId:A,taxonomyGroupType:P,customerId:E,customerRole:R,type:D,userId:$,invoiceThreshold:M,quoteThreshold:N})).query,o=void 0===(n=e.variables)?{}:n,[4,O.query({query:t,variables:(0,i.Z)({},o)})];case 1:return W((void 0===(l=r.sent().data)?{items:[]}:l).items),H(!1),J(!0),et(!0),[2]}})}),function(){return t.apply(this,arguments)}),eo=function(){X.show({content:(0,l.jsx)("div",{children:(0,l.jsx)(n,{})}),title:"Add form"})};return(0,l.jsx)(v.Z,{id:F,label:k,children:(0,l.jsxs)(g.Z,{children:[(0,l.jsx)(h.Z,{md:n?11:12,children:(0,l.jsx)(x.Z,(0,i.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:m,errors:I,isDisabled:_,isClearable:T,isLoading:G,menuIsOpen:ee,options:Q,onFocus:en,onBlur:function(){et(!1)},name:F,searchable:!0},z),z.defaultValue)}),n&&(0,l.jsx)(h.Z,{md:1,children:(0,l.jsx)(S,{children:(0,l.jsx)(b.Z,{content:null,startIcon:"plus",size:"sm",onClick:eo})})})]})})},Z),S=d.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-fdff7245-0"})(j());I.propTypes={AddForm:c.object,area:c.string,accountId:c.number,assetCategoryId:c.number,control:c.object.isRequired,errors:c.object.isRequired,entity:c.string,entityId:c.number,id:c.number,isClearable:c.bool,label:c.string.isRequired,locationId:c.number,name:c.string.isRequired,serviceId:c.number,taxonomyGroupType:(0,c.oneOf)(["expenseCategory","costCategory","jobTags"]),type:c.string},I.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},28864:function(e,t,n){"use strict";n.d(t,{T:function(){return h}});var o=n(85893),i=n(45697),r=n.n(i),a=n(93946),s=n(97212),l=n(98619),u=n(59334),c=n(51233),d=n(50135),p=n(50594),m=n(40055),f=n(5336),y=n(10166),v=n(67294),g=n(42283),h=function(e){var t=e.tagEntityId,n=e.tagId,i=e.name,r=e.color,u=e.editable,y=e.onDelete,h=e.onColorChange,b=e.onNameChange,j=(0,g.cI)({defaultValues:{name:i,color:r}}),Z=j.register,C=j.handleSubmit,I=(0,v.useState)(null),S=I[0],q=I[1],T=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),y(t)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),q("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),q("changeColor")},tooltip:"Change color"}]},_=function(e){e.stopPropagation(),q(null)},k=function(e){h({tagId:n,color:e.color}),q(null)},w=function(e){b({tagId:n,name:e.name}),q(null)};return(0,o.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!u||!S&&(0,o.jsx)(f.C,{icon:"defaultHoriz",actionsData:T}),children:S?({changeColor:function(){return(0,o.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,o.jsx)("input",{name:"color",ref:Z,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,o.jsx)(a.Z,{size:"small",color:"danger",onClick:_,children:(0,o.jsx)(p.Z,{})}),(0,o.jsx)(a.Z,{size:"small",color:"success",onClick:C(k),children:(0,o.jsx)(m.Z,{})})]})]})},rename:function(){return(0,o.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,o.jsx)(d.Z,{name:"name",inputRef:Z,variant:"standard",color:"secondary"}),(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,o.jsx)(a.Z,{size:"small",color:"danger",onClick:_,children:(0,o.jsx)(p.Z,{})}),(0,o.jsx)(a.Z,{size:"small",color:"success",onClick:C(w),children:(0,o.jsx)(m.Z,{})})]})]})}})[S]():(0,o.jsx)(l.Z,{children:(0,o.jsx)(x,{primary:i,color:r})})},n)};h.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},h.propTypes={tagEntityId:r().string.isRequired,tagId:r().string.isRequired,name:r().string.isRequired,color:r().string.isRequired,editable:r().bool,onDelete:r().func.isRequired,onColorChange:r().func.isRequired,onNameChange:r().func.isRequired};var x=(0,y.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},11975:function(e,t,n){"use strict";n.d(t,{P:function(){return m}});var o=n(85893),i=n(67294),r=n(45697),a=n.n(r),s=n(15861),l=n(14564),u=n(78462),c=n(51233),d=n(22186),p=n(28864),m=function(e){var t=e.tags,n=(e.title,e.handleDeleteTagEntity),r=(0,i.useState)(null),a=r[0],m=r[1],f=null==t?void 0:t.slice(0,5),y=(null==t?void 0:t.length)-(null==f?void 0:f.length),v=Boolean(a);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{direction:"row",spacing:1,children:f.map(function(e,t){var i;return(0,o.jsx)(d.V,{tagEntityId:e.id||t,name:e.tag.name,color:null===(i=e.tag.meta)||void 0===i?void 0:i.color,onDelete:n})})}),y>0&&(0,o.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){m(e.currentTarget),e.stopPropagation()},children:["+",y]}),(0,o.jsx)(l.ZP,{id:v?"tags-in-table-popover":void 0,open:v,anchorEl:a,onClose:function(){return m(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,o.jsx)(u.Z,{children:null==t?void 0:t.map(function(e){var t;return(0,o.jsx)(p.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,editable:!1},e.tag.id)})})})]})};m.propTypes={tags:a().object,title:a().string},m.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},89256:function(e,t,n){"use strict";n.d(t,{n:function(){return P}});var o=n(47568),i=n(26042),r=n(69396),a=n(828),s=n(29815),l=n(97582),u=n(85893),c=n(45697),d=n.n(c),p=n(96486),m=n(6388),f=n(50319),y=n(11961),v=n(93362),g=n(23776),h=n(5616),x=n(98456),b=n(93946),j=n(78462),Z=n(18972),C=n(14564),I=n(51233),S=n(50135),q=n(67294),T=n(10166),_=n(2845),k=n(28864),w=n(51738),F=n(11975),A=(0,v.D)(),P=function(e){var t=e.entityId,n=e.entity,c=e.values,d=void 0===c?[]:c,v=e.name,C=void 0===v?"tags":v,T=e.setValue,P=(0,_.x)().user,R=(0,q.useState)(null),D=R[0],$=R[1],M=(0,q.useState)(""),N=M[0],z=M[1],O=(0,q.useState)(""),V=O[0],G=O[1],H=(0,q.useState)(""),L=H[0],Q=H[1],W=(0,m.aM)(w.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){T(C,e.tags)}}),B=W.data,U=(void 0===B?{tags:[]}:B).tags,J=W.loading,X=W.refetch,Y=(0,m.aM)(w.gI,{skip:!D,variables:{entityId:t,entity:n,q:""!==L?"%".concat(L,"%"):null}}),K=Y.data,ee=(void 0===K?{tags:[]}:K).tags,et=Y.loading,en=(0,a.Z)((0,f.D)(w.Zm,{refetchQueries:["GetAllTags"]}),2),eo=en[0],ei=en[1].loading,er=(0,a.Z)((0,f.D)(w.LE,{onCompleted:function(){X()}}),2),ea=er[0],es=er[1].loading,el=(0,a.Z)((0,f.D)(w.cS,{onCompleted:function(){X()}}),2),eu=el[0],ec=el[1].loading,ed=(0,a.Z)((0,f.D)(w.g$,{refetchQueries:["GetAllTags"]}),2),ep=ed[0],em=ed[1].loading;(0,q.useEffect)(function(){var e=setTimeout(function(){Q(V)},500);return function(){return clearTimeout(e)}},[V]);var ef,ey,ev,eg=function(e){e.stopPropagation(),$(e.currentTarget)},eh=function(){$(null)},ex=(ef=(0,o.Z)(function(e,o){var i,r,a;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof o)return[3,1];return z({label:o}),[3,6];case 1:if(!(o&&o.inputValue&&t))return[3,2];return ea({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:P.adminId}}}]}}),z(null),[3,6];case 2:if(!(o&&o.value&&t))return[3,3];return ea({variables:{objects:[{entity:n,entityId:t,taxonomyId:o.value}]}}),z(null),[3,6];case 3:if(!(o&&o.inputValue))return[3,5];return[4,eo({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:P.adminId}]}})];case 4:return a=e.sent().data.insert_Taxonomy,T(C,(0,s.Z)(d).concat([{id:null,tag:{id:a.returning[0].id,name:a.returning[0].name,meta:a.returning[0].meta}}])),z(null),[3,6];case 5:o&&o.value&&(T(C,(0,s.Z)(d).concat([{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),z(null)),e.label=6;case 6:return[2]}})}),function(e,t){return ef.apply(this,arguments)}),eb=(0,q.useCallback)(function(e,t){var n=A(e,t),o=t.inputValue,i=e.some(function(e){return o===e.label});return""===o||i||n.push({inputValue:o,label:'Add "'.concat(o,'"')}),n},[]),ej=(0,q.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),eZ=function(e){t?eu({variables:{tagEntityId:e}}):T(C,d.filter(function(t,n){return n!==e}))},eC=(ey=(0,o.Z)(function(e){var t,n,o,a,s,u;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=n.sent().data.update_Taxonomy_by_pk,T(C,d.map(function(e){return e.tag.id===t?(0,r.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return ey.apply(this,arguments)}),eI=(ev=(0,o.Z)(function(e){var t,n,o,a,s,u;return(0,l.__generator)(this,function(o){switch(o.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{name:n=e.name}}})];case 1:return s=o.sent().data.update_Taxonomy_by_pk,T(n,d.map(function(e){return e.tag.id===t?(0,r.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return ev.apply(this,arguments)}),eS=Boolean(D),eq=(0,q.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eT=(0,q.useMemo)(function(){return p.uniqBy((0,s.Z)(U).concat((0,s.Z)(d)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[U,d]);return(0,u.jsxs)(I.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(F.P,{tags:eT,handleDeleteTagEntity:eZ}),(0,u.jsx)(E,{id:eS?"tags-popover":void 0,open:eS,anchorEl:D,onClose:eh,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(h.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(g.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eq),value:N,onChange:ex,onInputChange:function(e,t){G(t)},filterOptions:eb,getOptionLabel:ej,renderOption:function(e,t){return(0,u.jsx)(Z.Z,(0,r.Z)((0,i.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,u.jsx)(S.Z,(0,r.Z)((0,i.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,r.Z)((0,i.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[et||ei||es?(0,u.jsx)(x.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),J||ec||em?(0,u.jsx)(I.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(x.Z,{color:"secondary"})}):(0,u.jsx)(j.Z,{children:null==eT?void 0:eT.map(function(e,t){var n;return(0,u.jsx)(k.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:eZ,onColorChange:eC,onNameChange:eI})})})]})}),(0,u.jsx)(b.Z,{color:"black",onClick:eg,children:(0,u.jsx)(y.Z,{sx:{height:"16px",width:"16px"}})})]})};P.defaultProps={entityId:null},P.propTypes={entityId:d().number};var E=(0,T.Z)(C.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},51738:function(e,t,n){"use strict";n.d(t,{Aw:function(){return Z},BU:function(){return v},C3:function(){return j},LE:function(){return h},Zm:function(){return y},cS:function(){return x},g$:function(){return b},gI:function(){return f},lx:function(){return g}});var o=n(7297),i=n(75063);function r(){var e=(0,o.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return r=function(){return e},e}function a(){var e=(0,o.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,o.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,o.Z)(['\n  query GetTagsForSelect($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,o.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,o.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,o.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,o.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}function m(){var e=(0,o.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}var f=(0,i.Ps)(r()),y=(0,i.Ps)(a()),v=(0,i.Ps)(s()),g=(0,i.Ps)(l()),h=(0,i.Ps)(u()),x=(0,i.Ps)(c()),b=(0,i.Ps)(d()),j=(0,i.Ps)(p()),Z=(0,i.Ps)(m())},62551:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var o=n(85893),i=n(11994),r=n(67294);function a(){var e=(0,r.useState)(null),t=e[0],n=e[1],a=(0,r.useCallback)(function(){n(null)},[]),s=(0,r.useMemo)(function(){if(null===t)return null;var e=t.content,n=t.keepMounted;return(0,o.jsx)(i.Z,{open:!0,keepMounted:n,onClose:a,children:e})},[t,a]),l=(0,r.useCallback)(function(e){var t=e.content,o=e.keepMounted;n({keepMounted:void 0===o||o,content:t({onClose:a})})},[a]);return[s,l]}},56942:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ef}});var o=n(85893),i=n(19076),r=n(67294),a=n(11163),s=n(41085),l=n(45697),u=n(55862),c=n(26042),d=n(69396),p=n(828),m=n(6388),f=n(42575),y=n(38216),v=n(97303),g=n(68956),h=n(74297),x=n(16551),b=n(77439),j=n(11585),Z=n(40826),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dark";return function(){return(0,o.jsx)(Z.Z,{context:t,icon:"check",size:"sm",title:e})}},I=function(e,t){return"assetCategory"===e&&!t},S=n(91272),q=n(47568),T=n(97582),_=n(50319),k=n(42283),w=n(76600),F=n(49501),A=n(6710),P=n(90951),E=n(15214),R=n(28497),D=n(9270),$=n(62140),M=n(79665),N=n(66812),z=n(32749),O=n(43006),V=n(69368),G=n(50480),H=n(56815),L=n(15861),Q=n(35292),W=n(40656),B=n(2845),U=n(89256),J=n(28591),X=function(e){var t,n,i,a=e.defaultValues,s=e.onSuccess,l=(e.groups,e.parentId),u=void 0===l?null:l;e.formData;var y,v=(0,r.useState)(!1),g=v[0],h=v[1],x=(0,B.x)().hasRole,b=(0,k.cI)({defaultValues:null==a?void 0:a.template,resolver:(0,M.S)(Q.b)}),j=b.control,Z=b.errors,C=b.handleSubmit,I=b.register,S=b.watch,W=b.setValue,X=(0,p.Z)((0,_.D)(f.ze,{onCompleted:function(e){var t=e.update_Taxonomy_by_pk.id;s&&s(t)}}),1)[0],K=(0,m.aM)(f.X4,{variables:{where:{subtype:{_eq:"reactive"}}}}).data,ee=(0,m.aM)(f.X4,{variables:{where:{subtype:{_eq:"quote"}}}}).data,et=S("reportPassFail"),en=S("reportPassFailTitle"),eo=S("slaIdReactive"),ei=S("slaIdQuote"),er=S("tags"),ea=(0,O.GU)("reactive",K),es=null===(t=null==ea?void 0:ea.find(function(e){return e.id===Number(eo)}))||void 0===t?void 0:t.notes,el=(0,O.GU)("quote",ee),eu=null===(n=null==el?void 0:el.find(function(e){return e.id===Number(ei)}))||void 0===n?void 0:n.notes,ec=(y=(0,q.Z)(function(e){var t;return(0,T.__generator)(this,function(n){switch(n.label){case 0:if(!u)return[3,2];return h(!0),e.parentId=u,t={meta:(0,d.Z)((0,c.Z)({},a||{}),{template:e})},[4,X({variables:{id:u,changes:t}})];case 1:n.sent(),n.label=2;case 2:return[2]}})}),function(e){return y.apply(this,arguments)}),ed={errors:Z,register:I,control:j};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(w.Z,{id:"offCanvasForm",handleSubmit:C(ec),children:[(0,o.jsx)(F.Z,{label:"Work Description",children:(0,o.jsx)(A.Z,(0,d.Z)((0,c.Z)({},ed),{name:"description",rows:3}))}),x("admin")&&(0,o.jsx)(U.n,{entityId:u,entity:"Taxonomy",name:"tags",setValue:W,values:er}),(0,o.jsx)(G.Z,{sx:Y,control:(0,o.jsx)(k.Qr,{name:"reportPassFail",control:j,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(V.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Add Pass/Fail status"}),!!et&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(G.Z,{sx:Y,control:(0,o.jsx)(k.Qr,{name:"requireReportRecommendations",control:j,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(V.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:'Require "Recommendations" if job fails'}),(0,o.jsxs)(F.Z,{label:"Specify text to appear Pass/Fail toggle",children:[(0,o.jsx)(A.Z,(0,d.Z)((0,c.Z)({},ed),{name:"reportPassFailTitle",rows:3})),(null==Z?void 0:Z.reportPassFailTitle)&&(0,o.jsx)(H.Z,{sx:{m:0},children:null==Z?void 0:null===(i=Z.reportPassFailTitle)||void 0===i?void 0:i.message}),(0,o.jsxs)(L.Z,{children:[(null==en?void 0:en.length)||0,"/50"]})]})]}),(0,o.jsx)(P.Z,(0,d.Z)((0,c.Z)({},ed),{data:ea,legend:"Priority Work Orders",name:"slaIdReactive"})),eo&&(0,o.jsx)(E.Z,{content:es||"-",context:"light"}),(0,o.jsx)(P.Z,(0,d.Z)((0,c.Z)({},ed),{data:el,legend:"Priority Quotes",name:"slaIdQuote"})),ei&&(0,o.jsx)(E.Z,{content:eu||"-",context:"light"}),(0,o.jsx)(z.l,(0,d.Z)((0,c.Z)({},ed),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,o.jsx)(N.P,(0,d.Z)((0,c.Z)({},ed),{errors:(0,c.Z)({},Z),name:"serviceSelected",label:"Service",type:"service"})),(0,o.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ed),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,o.jsxs)(D.Z,{children:[(0,o.jsx)($.Z,{sm:12,md:6,children:(0,o.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ed),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,o.jsx)($.Z,{sm:12,md:6,children:(0,o.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ed),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]}),(0,o.jsx)(G.Z,{sx:Y,control:(0,o.jsx)(k.Qr,{name:"customerSignature",control:j,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(V.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require customer signature"}),(0,o.jsx)(G.Z,{sx:Y,control:(0,o.jsx)(k.Qr,{name:"supplierSignature",control:j,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(V.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require engineer signature"}),(0,o.jsx)("input",(0,c.Z)({type:"hidden"},I("tags"))),(0,o.jsx)(J.i,{control:j,errors:Z,register:I,setValue:W,entity:"Taxonomy",entityId:u,hasForm:!0,isSubmit:g,showScoreAndLabels:!1})]})})};X.propTypes={defaultValues:l.object,onSuccess:l.func.isRequired};var Y={color:W.Q.COLOUR.dark,"& .MuiTypography-root":{fontFamily:"Arial,sans-serif,sans-serif"}},K=n(23390),ee=n(70616),et=n(20705),en=n(86267),eo=function(e){var t=e.entityId,n=(0,p.Z)((0,_.D)(f.ze),1)[0],i=function(e){n({variables:{id:t,changes:{meta:{imageLink:e[0].link}}}})};return(0,o.jsx)(en.G,{entity:"Taxonomy",entityId:t,type:"image",onMediaAdd:i,onlySingleMedia:!0})},ei=n(64872),er=n(62551),ea=n(667),es=function(e){var t,n=e.filters,i=e.props,r={item:"id",order:"desc"},a=(0,et.x)({filters:n,initialSort:r}),s=a.initialData,l=a.ref,u=(0,ei.a)(),Z=(0,p.Z)((0,er.d)(),2),q=Z[0],T=Z[1],_=(0,d.Z)((0,c.Z)({},s),{isGroup:i.isAssetCategoryParent,typeGroup:(t=i.type,"expenseCategory"===t?"expenseCategoryGroup":t),fetchGroup:"expenseCategory"===i.type||"assetCategory"===i.type}),k=(0,m.aM)(f.Im,{variables:_}),w=k.data,F=void 0===w?{taxonomy:[],meta:{aggregate:{totalCount:0}}}:w,A=F.taxonomy,P=F.meta,E=F.taxonomyGroup,R=k.loading,D=k.refetch,$=A.map(function(e){return e.id}),M=(0,m.aM)(y.q0,{variables:{taxonomyIds:$}}),N=M.data,z=M.refetch,O=function(){u.close(),D(),z(),T({content:function(e){var t=e.onClose;return(0,o.jsx)(ea.R,{onClose:t||function(){},type:"applyToNew"})}})},V=function(e,t){var n,r;e.stopPropagation(),t||(t={status:"active"}),t.type=i.type,u.show({content:(0,o.jsx)(ee.j,{defaultValues:t,onSuccess:O,isAssetCategoryParent:i.isAssetCategoryParent,groups:("expenseCategory"===i.type||I(i.type,i.isAssetCategoryParent))&&E,hasSublocation:A.find(function(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.sublocation)===!0}),systemQuestions:{sensor:void 0!==A.find(function(e){var t;return null===(t=e.childs)||void 0===t?void 0:t.find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})})}}),title:t.id?"Edit":"Add ".concat(i.title)})},G=function(e){u.show({content:(0,o.jsx)(K.R,{defaultValues:e,entity:"Taxonomy",entityId:e.id,type:"jobTags"===i.type?"jobQuestion":"assetQuestion",parentId:e.id,groups:{}}),submit:!1,title:"Questions"})},H=function(e,t){t||u.show({content:(0,o.jsx)(X,{defaultValues:(0,d.Z)((0,c.Z)({},e.meta),{name:e.name}),groups:{},onSuccess:O,parentId:e.id,formData:e.item}),title:e.name,width:"35%"})},L=function(e){u.show({content:(0,o.jsx)(eo,{entityId:e.id}),title:e.name,width:"35%",submit:!1})},Q=function(e){if(N){var t,n,i,r=N.FormSubmissions.find(function(t){return t.entityId===e.id});return(0,o.jsx)(v.Z,{color:"secondary",to:(null==r?void 0:null===(t=r.form)||void 0===t?void 0:t.name)?"/dashboard/formBuilder/edit/submission?id=".concat(r.id):"#",onClick:function(){var t;return H(e,null==r?void 0:null===(t=r.form)||void 0===t?void 0:t.name)},children:(0,o.jsx)("span",{style:{color:"rgb(6, 121, 216)"},children:null!==(i=null==r?void 0:null===(n=r.form)||void 0===n?void 0:n.name)&&void 0!==i?i:"Basic job template"})})}},W=[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){return V(e,t)},tooltip:"Edit"}];["jobTags","assetCategory"].includes(i.type)&&!i.isAssetCategoryParent&&W.push({context:"info",icon:["fas","question"],numberOverlay:"childCount",onClick:function(e,t){return G(t)},tooltip:"Manage Questions"}),"jobTags"===i.type&&W.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return H(t)},tooltip:"Add Template"}),"issueType"===i.type&&W.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return L(t)},tooltip:"Add issue type photo"});var B=[{hidden:!0},{hidden:!0},{text:"Name"},{hidden:"expenseCategory"!==i.type&&!I(i.type,i.isAssetCategoryParent),text:"Group"},{hidden:"jobTags"!==i.type,text:"Jobs"},{hidden:!0},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"TCO"},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"Sensor"},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"Sublocation"},{text:"Status"},{hidden:"signatures"!==i.type,text:"Display for"},{hidden:!0},{hidden:!0,text:"meta"},{hidden:!0},{hidden:"jobTags"!==i.type||i.isAssetCategoryParent,formatter:function(e){return Q(e.row)},text:"Job template"},{formatter:g.Z,formatterData:W,text:"Actions"}],U=function(){return(0,o.jsx)(x.Z,{children:(0,o.jsx)(b.Z,{context:"secondary",content:"Add New",onClick:V,size:"sm"})})};return(0,o.jsxs)(o.Fragment,{children:[q,(0,o.jsx)(j.Z,{handleClick:V,open:!0,title:i.title,toolbar:(0,o.jsx)(U,{}),children:(0,o.jsx)(S.t,{columns:B,loading:R,meta:P,ref:l,initialSort:r,refetch:D,submissionsRefetch:z,rows:A.map(function(e){var t,n,o,i,r,a,s,l,u,c,d=[];return((null===(t=e.meta)||void 0===t?void 0:t.customerSignature)||(null===(n=e.meta)||void 0===n?void 0:n.supplierSignature))&&((null===(s=e.meta)||void 0===s?void 0:s.customerSignature)&&d.push("Customer"),(null===(l=e.meta)||void 0===l?void 0:l.supplierSignature)&&d.push("Supplier")),{id:e.id,parentId:e.parentId,name:e.name,groupText:null===(o=e.parent)||void 0===o?void 0:o.name,jobs:e.jobs.aggregate.count,status:e.status,hasTCO:(u=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="tco"})&&C("TCO"),hasSensor:(c=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})&&C("Sensor"),hasSublocation:(null===(i=e.meta)||void 0===i?void 0:i.sublocation)&&C("Sub-location"),statusText:(0,h.Z)(e.status),displayFor:d.length>0&&d.join(", "),childCount:null===(r=e.childs)||void 0===r?void 0:r.length,meta:e.meta,hasDescription:(null===(a=e.meta)||void 0===a?void 0:a.template)?"1":"",actions:"",item:e}})})})]})};es.propTypes={filters:l.object};var el=n(46929),eu=n(21789),ec=function(e){var t=e.control,n=e.errors,i=e.register,a=e.setFilters,s=e.props,l=e.watch,u={control:t,errors:n,register:i},p=l("parentId");return(0,r.useEffect)(function(){a(function(e){return(0,d.Z)((0,c.Z)({},e),{parentId:(null==p?void 0:p.value)||null,type:s.type})})},[p]),(0,o.jsxs)(D.Z,{align:"baseline",children:[(0,o.jsx)($.Z,{md:6,children:(0,o.jsx)(el.r,(0,d.Z)((0,c.Z)({},u),{onChange:function(e){return a(function(t){return(0,d.Z)((0,c.Z)({},t),{status:e.target.value||null,type:s.type})})},options:eu.bg}))}),"expenseCategory"===s.type&&(0,o.jsx)($.Z,{md:6,children:(0,o.jsx)(N.P,(0,d.Z)((0,c.Z)({},u),{errors:(0,c.Z)({},n),label:"",name:"parentId",placeholder:"Group",type:"taxonomyGroup",isClearable:!0,taxonomyGroupType:"expenseCategoryGroup"}))})]})};ec.propTypes={control:l.object.isRequired,errors:l.object.isRequired,register:l.func.isRequired,setFilters:l.func.isRequired};var ed=function(e){var t={q:null,status:null,type:e.type||"",parentId:null,filterType:"taxonomy_table"};return(0,o.jsx)(u.J,{FiltersComp:ec,initialFilters:t,props:e,TableComp:es})};ed.propTypes={type:(0,l.oneOf)(["assetCategory","complianceCategory","expenseCategory","costCategory","tags","supplierQuestion","signatures"])};var ep=n(18586),em=function(){var e,t,n=(0,a.useRouter)().query,i=(0,ep.q)(),l=null==i?void 0:null===(e=i.admin)||void 0===e?void 0:null===(t=e.modules)||void 0===t?void 0:t.assets,u=(0,r.useMemo)(function(){return n.tab||"expense-categories"},[n.tab]),c=[(0,o.jsx)("div",{active:"expense-categories"===u,label:"Expense Categories",children:(0,o.jsx)(ed,{type:"expenseCategory",title:"Expense Categories"})}),(0,o.jsx)("div",{active:"cost-categories"===u,label:"Cost Categories",children:(0,o.jsx)(ed,{type:"costCategory",title:"Cost Categories"})}),(0,o.jsx)("div",{active:"job-templates-and-questions"===u,label:"Job templates and questions",children:(0,o.jsx)(ed,{type:"jobTags",title:"Job Descriptions"})}),(0,o.jsx)("div",{active:"supplier-questions"===u,label:"Supplier Questions",children:(0,o.jsx)(ed,{type:"supplierQuestion",title:"Supplier Questions"})}),(0,o.jsx)("div",{hide:!l,active:"asset-categories"===u,label:"Asset Categories",children:(0,o.jsxs)(s.Z,{handleChange:!1,children:[(0,o.jsx)("div",{active:!0,label:"Asset Categories Parent",children:(0,o.jsx)(ed,{type:"assetCategory",title:"Asset Categories Parent",isAssetCategoryParent:!0})}),(0,o.jsx)("div",{label:"Asset Categories Child",children:(0,o.jsx)(ed,{type:"assetCategory",title:"Asset Categories Child"})})]})}),(0,o.jsx)("div",{active:"compliance-categories"===u,label:"Compliance Categories",children:(0,o.jsx)(ed,{type:"complianceCategory",title:"Compliance Categories"})}),(0,o.jsx)("div",{active:"client-type"===u,label:"Client Type",children:(0,o.jsx)(ed,{type:"clientType",title:"Client Type"})}),(0,o.jsx)("div",{active:"tags"===u,label:"Tags",children:(0,o.jsx)(ed,{type:"tags",title:"Tags"})}),(0,o.jsx)("div",{active:"job-hold-reason"===u,label:"Job Hold Reason",children:(0,o.jsx)(ed,{type:"jobHoldReason",title:"Job Hold Reason"})}),(0,o.jsx)("div",{active:"signatures"===u,label:"Signatures",children:(0,o.jsx)(ed,{type:"signatures",title:"Signatures"})}),(0,o.jsx)("div",{active:"issue-types"===u,label:"Issue Types",children:(0,o.jsx)(ed,{type:"issueType",title:"Issue types"})})];return(0,o.jsx)(s.Z,{children:c.filter(function(e){return!e.props.hide}).map(function(e){return e})},u)},ef=function(){return(0,o.jsx)(i.Z,{pageHeading:{heading:"Categories"},View:(0,o.jsx)(em,{})})}}},function(e){e.O(0,[3662,630,2283,212,8890,619,2583,4135,6043,1838,3911,1417,3776,1564,3054,2329,8500,778,4046,1023,1870,2797,1047,4043,6313,597,1050,4030,4191,7050,6733,7554,8287,495,9774,2888,179],function(){return e(e.s=23570)}),_N_E=e.O()}]);