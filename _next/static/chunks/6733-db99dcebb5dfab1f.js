"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6733],{48580:function(e,n,t){t.d(n,{q:function(){return v}});var i=t(26042),r=t(69396),a=t(99534),o=t(85893),l=t(87918),u=t(98456),s=t(23776),d=t(50135),c=t(67294),m=t(45697),p=t.n(m),v=function(e){var n=e.loading,t=e.setSearch,m=e.textFieldProps,p=(0,a.Z)(e,["loading","setSearch","textFieldProps"]),v=(0,c.useState)(""),f=v[0],y=v[1];return(0,c.useEffect)(function(){var e=setTimeout(function(){t(f)},500);return function(){return clearTimeout(e)}},[f,t]),(0,o.jsx)(s.Z,(0,r.Z)((0,i.Z)({isOptionEqualToValue:function(e,n){return e.value===n.value}},p),{loading:n,onInputChange:function(e,n){y(n)},getOptionLabel:function(e){return e.label},renderTags:function(e,n){return e.map(function(e,t){return(0,o.jsx)(l.Z,(0,i.Z)({size:"small",label:e.label},n({index:t})))})},renderInput:function(e){return(0,o.jsx)(d.Z,(0,r.Z)((0,i.Z)({},e,m),{InputProps:(0,r.Z)((0,i.Z)({},e.InputProps,m.InputProps||{}),{endAdornment:(0,o.jsxs)(o.Fragment,{children:[n?(0,o.jsx)(u.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};v.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},v.propTypes={multiple:p().bool,limitTags:p().number,filterSelectedOptions:p().bool,color:p().string,loading:p().bool,value:p().oneOf([p().array,p().object]),onChange:p().func,options:p().arrayOf(p().shape({value:p().any.isRequired,label:p().string.isRequired})).isRequired,onOpen:p().func,setSearch:p().func,textFieldProps:p().shape({label:p().string,variant:p().oneOf(["standard"]),color:p().string,error:p().bool,helperText:p().string})}},25742:function(e,n,t){t.d(n,{H:function(){return s}});var i=t(26042),r=t(85893),a=t(45697),o=t(55377),l=t(16551),u=t(77439),s=function(e){var n=e.children,t=e.content,a=e.context,s=e.data,d=e.disabled,c=e.handleClick,m=e.size,p=e.type;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{size:"sm"}),(0,r.jsxs)(l.Z,{align:"flex-end",children:[n,(0,r.jsx)(u.Z,(0,i.Z)({content:t,context:a,disabled:d,onClick:c,size:m,type:p},s))]})]})};s.propTypes={children:a.node,content:a.string,context:a.string,data:a.object,disabled:a.bool,handleClick:a.func,size:a.string,type:a.string},s.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},21300:function(e,n,t){t.d(n,{M:function(){return d}});var i=t(26042),r=t(99534),a=t(85893),o=t(45697),l=t(89345),u=t(99505),s=t(55843),d=function(e){var n=e.control,t=e.errors,o=e.name,d=e.space,c=(0,r.Z)(e,["control","errors","name","space"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,(0,i.Z)({control:n,errors:t,locale:l.Z,name:o},c)),d&&(0,a.jsx)(s.Z,{marginBottom:"sm"})]})};d.propTypes={control:o.object.isRequired,errors:o.object.isRequired,name:o.string.isRequired,space:o.bool},d.defaultProps={space:!0}},75795:function(e,n,t){t.d(n,{S:function(){return a}});var i=t(85893),r=t(40826),a=function(e,n){var t=function(){return(0,i.jsx)(r.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},a=function(){return(0,i.jsx)(r.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},o=function(){return(0,i.jsx)(r.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?(null==n?void 0:n.thumbnails)&&(null==n?void 0:n.thumbnails.length)?t:a:o}},52824:function(e,n,t){t.d(n,{O:function(){return u},t:function(){return l}});var i=t(7297),r=t(75063);function a(){var e=(0,i.Z)(["\n  query MEDIAS(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $type: String\n    $adminId: Int\n    $meta: jsonb\n  ) {\n    items: Media_Entity(\n      limit: $limit\n      offset: $offset\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n      order_by: { Medium: { createdAt: desc } }\n    ) {\n      id\n      entity\n      entityId\n      mediaId\n      item: Medium {\n        id\n        visibility\n        caption\n        category\n        createdAt\n        expiryAt\n        filename\n        name\n        type\n        meta\n        userId\n        user: User {\n          id\n          nameFirst\n          nameLast\n        }\n      }\n    }\n    meta: Media_Entity_aggregate(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: {\n          adminId: { _eq: $adminId }\n          caption: { _ilike: $q }\n          category: { _eq: $category }\n          type: { _eq: $type }\n          meta: { _contains: $meta }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return a=function(){return e},e}function o(){var e=(0,i.Z)(["\n  query GetPreloadedMediaByEntity(\n    $category: String\n    $entity: String\n    $entityId: Int\n    $adminId: Int\n  ) {\n    items: Media_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Medium: { adminId: { _eq: $adminId }, category: { _eq: $category } }\n      }\n    ) {\n      mediaId\n      media: Medium {\n        id\n        filename\n        caption\n      }\n    }\n  }\n"]);return o=function(){return e},e}var l=(0,r.Ps)(a()),u=(0,r.Ps)(o())},23892:function(e,n,t){t.d(n,{d:function(){return m}});var i=t(828),r=t(85893),a=t(50319),o=t(24043),l=t(84808),u=t(11057),s=t(98456),d=t(51233),c=t(15861),m=function(e){var n=e.mediaId,t=e.onSuccess,m=(0,i.Z)((0,a.D)(o.CI,{variables:{mediaId:n},refetchQueries:["MEDIAS"],onCompleted:function(){return t(n)}}),2),p=m[0],v=m[1].loading;return v?(0,r.jsx)(l.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(s.Z,{color:"secondary"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{children:"Are you sure you want to delete this?"}),(0,r.jsx)(d.Z,{alignItems:"flex-end",children:(0,r.jsx)(u.Z,{variant:"contained",color:"danger",disabled:v,onClick:function(){return p()},children:"Delete"})})]})}},39087:function(e,n,t){t.d(n,{z:function(){return w}});var i=t(47568),r=t(26042),a=t(828),o=t(97582),l=t(85893),u=t(67294),s=t(45697),d=t(50319),c=t(24043),m=t(84808),p=t(98456),v=t(26186),f=t(76600),y=t(34953),g=t(8500),h=t(55843),b=t(75795),I=t(97345),x=t(44449),Z=t(13777),_=t(2845),S=t(42283),j=t(48580),w=function(e){var n,t=e.media,s=e.toggleShow,w=(0,u.useState)(!1),A=w[0],M=w[1],P=(0,_.x)().hasRole,$=t.caption,E=t.createdAt,C=t.entity,q=t.entityId,z=t.filename,k=t.mediaId,D=t.meta,O=t.name,N=t.id,L=t.visibility,R=t.type,T=t.user,F=(0,S.cI)({defaultValues:{visibility:(0,x.c)(L)}}),U=F.control,V=F.handleSubmit,Q=(0,a.Z)((0,d.D)(c.o7,{refetchQueries:["MEDIAS"],onCompleted:function(e){M(!1),e&&s&&s()}}),2),B=Q[0];Q[1].error;var Y,H=(n=(0,i.Z)(function(e){return(0,o.__generator)(this,function(n){return B({variables:{changes:{visibility:e.visibility.value},id:N}}).then(function(){return s()}),[2]})}),function(e){return n.apply(this,arguments)}),J=[{key:"ID",value:k,hidden:!0},{key:"Name",value:O||z},{key:"Visible to",value:L.join(", ")},{key:"Caption",value:$},{key:"Entity",value:C?"".concat(C,"#").concat(q):"-",hidden:!0},{key:"Type",value:R},{key:"Uploaded by",value:"".concat(null==T?void 0:T.nameFirst," ").concat(null==T?void 0:T.nameLast)},{key:"Created at",value:(0,v.Z)(E)}];"image"===R&&J.push({key:"Thumbnails",value:(0,b.S)(R,D),hidden:!0}),(0,i.Z)(function(){var e,n,t,i;return(0,o.__generator)(this,function(a){switch(a.label){case 0:return M(!0),n="".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat((null==D?void 0:null===(e=D.original)||void 0===e?void 0:e.relativePath)?D.original.relativePath:z),t=(0,I.V)(),(i=new window.FormData).append("sizes",t),i.append("url",n),[4,window.fetch("https://aws-staging.cleverly.works/image/process",{method:"POST",body:i}).then(function(e){return e.json()}).then(function(e){var n,t=null,i=(0,r.Z)({},D)||{},a=e.key,o=e.data.find(function(e){return"large"===e.name});a.startsWith("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com")&&(a=a.replace("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/"),"")),t=o?o.relativePath:a,i.original={relativePath:a},i.thumbnails=e.data||null,B({variables:{changes:{extension:null==t?void 0:t.split(".").pop(),filename:t,meta:i},id:k}})}).catch(function(e){(0,Z.Tb)({message:e,section:"fetch"})})];case 1:return a.sent(),[2]}})}),null==D||D.thumbnails;var G=(0,x.z)(P).options;return A?(0,l.jsx)(m.Z,{sx:{zIndex:1e5},open:!0,children:(0,l.jsx)(p.Z,{color:"secondary"})}):(0,l.jsxs)(f.Z,{id:"offCanvasForm",handleSubmit:V(H),children:["image"===R&&(0,l.jsx)(y.Z,{alt:$||z,src:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(z)}),(0,l.jsx)(g.Z,{rows:J}),(0,l.jsx)(S.Qr,{name:"visibility",control:U,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(j.q,{value:n,disableClearable:!0,textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,n){return t(n)},options:G})}}),!1,(0,l.jsx)(h.Z,{}),!1]})};w.propTypes={media:s.object,toggleShow:s.func},w.defaultProps={type:"image"}},76256:function(e,n,t){t.d(n,{z:function(){return z}});var i=t(47568),r=t(26042),a=t(69396),o=t(828),l=t(97582),u=t(85893),s=t(67294),d=t(45697),c=t(42283),m=t(79665),p=t(30381),v=t.n(p),f=t(50319),y=t(24043),g=t(73987),h=t(76600),b=t(49501),I=t(55563),x=t(13439),Z=t(51466),_=t(25742),S=t(21300),j=t(56671),w=t(74231),A=(0,w.Ry)().shape({caption:(0,w.Z_)(),dropzone:(0,w.nK)().required()}),M=t(2845),P=t(48580),$=t(13777),E=t(84808),C=t(98456),q=t(44449),z=function(e){var n,t=e.accept,d=e.adminId,p=e.category,w=e.entity,z=e.entityId,k=e.expiryShow,D=e.mediaMeta,O=e.multiple,N=e.onSuccess,L=e.type,R=e.showSubmitButton,T=(0,s.useState)(!1),F=T[0],U=T[1],V=(0,s.useState)(!1),Q=V[0],B=V[1],Y=(0,M.x)().hasRole,H=(0,q.z)(Y),J=H.defaultOption,G=H.options,K=(0,c.cI)({resolver:(0,m.S)(A),defaultValues:{visibility:J}}),W=K.control,X=K.errors,ee=K.handleSubmit,en=K.register,et=K.reset,ei=(0,s.useContext)(g.Z).user,er=(0,o.Z)((0,f.D)(y.xM,{refetchQueries:["MEDIAS"]}),2),ea=er[0],eo=er[1].loading,el=(0,o.Z)((0,f.D)(y.tv,{refetchQueries:["MEDIAS"]}),2),eu=el[0],es=el[1].loading,ed=(n=(0,i.Z)(function(e){var n,t,a,o,u,s,c;return(0,l.__generator)(this,function(u){var m,f;switch(u.label){case 0:n=e.caption,t=e.visibility,a=e.dropzone,o=e.expiryAt,u.label=1;case 1:return u.trys.push([1,4,,5]),U(!0),B(!1),s=Promise.all,[4,a.map((m=(0,i.Z)(function(e){var i,a,u,s,c,m;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(!e)return[3,2];return[4,(0,j.V)(e,L)];case 1:return i=l.sent(),a=null,u=null,"image"===L?(s=i.key,a=(c=i.data.find(function(e){return"large"===e.name}))?c.relativePath:s,u={original:{relativePath:s},thumbnails:i.data||null}):a=i.key,[2,{adminId:d,category:p,caption:n,expiryAt:o?v()(o).utc().format():null,extension:null==a?void 0:a.split(".").pop(),userId:ei.id,filename:a,meta:(0,r.Z)({},u,D),type:L,visibility:t.value}];case 2:return[2]}})}),function(e){return m.apply(this,arguments)}))];case 2:return[4,s.apply(Promise,[u.sent()])];case 3:return ea({variables:{objects:u.sent()}}).then((f=(0,i.Z)(function(e){var n,t,i;return(0,l.__generator)(this,function(n){switch(n.label){case 0:if(t=e.data.insert_Media.returning,!(w&&z))return[3,2];return i=t.map(function(e){return{mediaId:e.id,entity:w,entityId:z}}),[4,eu({variables:{objects:i}})];case 1:n.sent(),n.label=2;case 2:return et(),U(!1),N&&N(t),[2]}})}),function(e){return f.apply(this,arguments)})),[3,5];case 4:return c=u.sent(),U(!1),B(!0),(0,$.Tb)({message:c,section:"upload"}),[3,5];case 5:return[2]}})}),function(e){return n.apply(this,arguments)}),ec={control:W,errors:X,register:en};return F||eo||es?(0,u.jsx)(E.Z,{sx:{zIndex:1e5},open:!0,children:(0,u.jsx)(C.Z,{color:"secondary"})}):(0,u.jsxs)(h.Z,{id:"offCanvasForm",handleSubmit:ee(ed),children:[(0,u.jsx)(b.Z,{label:"Caption",children:(0,u.jsx)(I.Z,(0,a.Z)((0,r.Z)({},ec),{name:"caption"}))}),k&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(b.Z,{label:"Expiry"}),(0,u.jsx)(S.M,(0,a.Z)((0,r.Z)({},ec),{name:"expiryAt"}))]}),(0,u.jsx)(b.Z,{label:"Media"}),(0,u.jsx)(c.Qr,(0,a.Z)((0,r.Z)({},ec),{as:(0,u.jsx)(x.Z,{accept:"image/*"===t?t+", .heic":t,multiple:(null==window||!window.Capacitor||"android"!==window.Capacitor.getPlatform())&&O}),name:"dropzone"})),(0,u.jsx)(c.Qr,{name:"visibility",control:W,render:function(e){var n=e.value,t=e.onChange;return(0,u.jsx)(P.q,{value:n,disableClearable:!0,getOptionLabel:function(e){return e.label},textFieldProps:{color:"secondary",variant:"standard",label:"Select media visibility"},onChange:function(e,n){return t(n)},options:G})}}),Q&&(0,u.jsx)(Z.Z,{context:"danger",content:"Can not upload Media"}),R&&(0,u.jsx)(_.H,{content:"Submit",type:"submit"})]})};z.propTypes={accept:d.string,adminId:d.number,category:d.string,entity:d.string,entityId:d.number,expiryShow:d.bool,onSuccess:d.any,showSubmitButton:d.bool,type:d.string,mediaMeta:d.object,showAdminOnly:d.bool},z.defaultProps={accept:x.Z.defaultProps.accept,category:null,expiryShow:!0,mediaMeta:null,showSubmitButton:!1,showAdminOnly:!0,type:"image"}},24043:function(e,n,t){t.d(n,{CI:function(){return c},o7:function(){return m},tv:function(){return d},xM:function(){return s}});var i=t(7297),r=t(75063);function a(){var e=(0,i.Z)(["\n  mutation AddMedia($objects: [Media_insert_input!]!) {\n    insert_Media(objects: $objects) {\n      returning {\n        id\n        filename\n      }\n    }\n  }\n"]);return a=function(){return e},e}function o(){var e=(0,i.Z)(["\n  mutation AddMediaEntity($objects: [Media_Entity_insert_input!]!) {\n    insert_Media_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return o=function(){return e},e}function l(){var e=(0,i.Z)(["\n  mutation DeleteMedia($mediaId: Int!) {\n    deleteMedia(mediaId: $mediaId) {\n      success\n      data\n    }\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation UpdateMedia($changes: Media_set_input, $id: Int!) {\n    update_Media_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}var s=(0,r.Ps)(a()),d=(0,r.Ps)(o()),c=(0,r.Ps)(l()),m=(0,r.Ps)(u())},97345:function(e,n,t){t.d(n,{V:function(){return i}});var i=function(){var e="cleverly-staging-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])}},56671:function(e,n,t){t.d(n,{V:function(){return l}});var i,r=t(47568),a=t(97582),o=t(97345),l=(i=(0,r.Z)(function(e,n){var t,i,r,l,u;return(0,a.__generator)(this,function(a){switch(a.label){case 0:switch(t="cleverly-staging-media",i="https://aws-staging.cleverly.works/aws/s3/upload",(r=new window.FormData).append("file",e,e.name),n){case"image":l="https://aws-staging.cleverly.works/image/process",r.append("sizes",(0,o.V)());break;case"document":case"audio":r.append("bucket",t),r.append("folder","".concat(n,"s")),l=i}return[4,window.fetch(l,{method:"POST",body:r})];case 1:return[2,a.sent().json()]}})}),function(e,n){return i.apply(this,arguments)})},20705:function(e,n,t){t.d(n,{x:function(){return d}});var i=t(14924),r=t(26042),a=t(69396),o=t(67294),l=t(96486),u=t(46003),s=function(e){try{return JSON.parse(e)}catch(n){return!1}},d=function(e){var n,t,d,c,m,p,v,f,y,g,h,b=e.filters,I=e.newFilters,x=e.initialSort,Z=(0,o.useRef)(),_=(0,o.useState)({}),S=_[0],j=_[1],w=(0,o.useState)({}),A=w[0],M=w[1],P=x||{item:"createdAt",order:"desc"},$=(0,i.Z)({},(null===(n=Z.current)||void 0===n?void 0:n.sort.item)||P.item,P.inneritem?(0,i.Z)({},P.inneritem,(null===(t=Z.current)||void 0===t?void 0:t.sort.order)||P.order):(null===(d=Z.current)||void 0===d?void 0:d.sort.order)||P.order);return(0,o.useEffect)(function(){var e=!(0,l.isEqual)(S,b),n=!(0,l.isEqual)(A,I);if(e&&(j(b),null==Z||null===(i=Z.current)||void 0===i||i.resetPagination()),n&&(M(I),null==Z||null===(r=Z.current)||void 0===r||r.resetPagination()),(null==Z?void 0:null===(t=Z.current)||void 0===t?void 0:t.setSort)&&!(e||n)){var t,i,r,a,o,u,s,d,c,m,p,v=(null===(a=Z.current)||void 0===a?void 0:null===(o=a.sort)||void 0===o?void 0:o.item)&&(null===(u=Z.current)||void 0===u?void 0:null===(s=u.sort)||void 0===s?void 0:s.order)?{item:null===(d=Z.current)||void 0===d?void 0:null===(c=d.sort)||void 0===c?void 0:c.item,order:null===(m=Z.current)||void 0===m?void 0:null===(p=m.sort)||void 0===p?void 0:p.order}:$;Z.current.setSort(v)}},[b,I]),{initialData:(0,a.Z)((0,r.Z)({},b),{newFilters:(null==I?void 0:I.length)>0?I:void 0,limit:(null===(c=Z.current)||void 0===c?void 0:c.pageSize)==="Infinity"?null:parseInt(null===(m=Z.current)||void 0===m?void 0:m.pageSize,10)||u.C1.paginationSize,offset:((null===(p=Z.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(v=Z.current)||void 0===v?void 0:v.pageSize)||u.C1.paginationSize),orderBy:s(null===(f=Z.current)||void 0===f?void 0:null===(y=f.sort)||void 0===y?void 0:null===(g=y.item)||void 0===g?void 0:g.replace(/ORDER/i,null===(h=Z.current)||void 0===h?void 0:h.sort.order))||$}),initialSort:x,ref:Z}}},44449:function(e,n,t){t.d(n,{z:function(){return o},c:function(){return l}});var i=t(29815),r=t(96486),a={ALL:["admin","customer","supplier","tenant"],ADMIN_ONLY:["admin"],ADMIN_CUSTOMER:["admin","customer"],ADMIN_SUPPLIER:["admin","supplier"]},o=function(e){return e("admin")?{defaultOption:{label:"All",value:a.ALL},options:[{label:"All",value:a.ALL},{label:"Admin only",value:a.ADMIN_ONLY},{label:"Admin+customer",value:a.ADMIN_CUSTOMER},{label:"Admin+supplier",value:a.ADMIN_SUPPLIER}]}:e("customer")?{defaultOption:{label:"Admin+customer",value:a.ADMIN_CUSTOMER},options:[{label:"All",value:a.ALL},{label:"Admin+customer",value:a.ADMIN_CUSTOMER}]}:e("supplier")?{defaultOption:{label:"Admin+supplier",value:a.ADMIN_SUPPLIER},options:[{label:"All",value:a.ALL},{label:"Admin+supplier",value:a.ADMIN_SUPPLIER}]}:void 0},l=function(e){var n=(0,i.Z)(e).sort();return r.isEqual(n,a.ALL)?{label:"All",value:a.ALL}:r.isEqual(n,a.ADMIN_ONLY)?{label:"Admin only",value:a.ADMIN_ONLY}:r.isEqual(n,a.ADMIN_CUSTOMER)?{label:"Admin+customer",value:a.ADMIN_CUSTOMER}:r.isEqual(n,a.ADMIN_SUPPLIER)?{label:"Admin+supplier",value:a.ADMIN_SUPPLIER}:void 0}}}]);