"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3203],{48218:function(e,n,t){t.d(n,{L:function(){return o}});var o=function(e){for(var n="",t=e.slice().sort(function(e,n){return Number(e.id)-Number(n.id)}),o=t.length-1;o>=0;o--){var r=t[o].status;if("onHold"===r||"resumed"===r||"paused"===r||"continued"===r){n=t[o].status;break}}return n}},22595:function(e,n,t){t.d(n,{E:function(){return o}});var o=function(e,n){if(Array.isArray(n)){var t,o=null;return n.forEach(function(n){var t,r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});o=(null==r?void 0:r.createdAt)||o}),o}var r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.createdAt)||null}},90114:function(e,n,t){t.d(n,{OQ:function(){return s},Pn:function(){return r},TT:function(){return a},Xd:function(){return i},aH:function(){return o},nN:function(){return l}});var o=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproval")&&t===n.quoteId})},r=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproved")&&t===n.quoteId})},a=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdRejected")&&t===n.quoteId})},i=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproval")})},l=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});if(Array.isArray(e)){var r=null;return e.forEach(function(e){r=(null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")}))||r}),r}return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")})},s=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdRejected")})}},51809:function(e,n,t){t.d(n,{$A:function(){return v},$E:function(){return f},A1:function(){return h},Un:function(){return m},yf:function(){return g},zg:function(){return x}});var o=t(7297),r=t(75063);function a(){var e=(0,o.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return a=function(){return e},e}function i(){var e=(0,o.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return i=function(){return e},e}function l(){var e=(0,o.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return l=function(){return e},e}function s(){var e=(0,o.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,o.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,o.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,o.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return c=function(){return e},e}function p(){var e=(0,o.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return p=function(){return e},e}(0,r.Ps)(a());var m=(0,r.Ps)(i()),h=(0,r.Ps)(l()),v=(0,r.Ps)(s()),f=(0,r.Ps)(u()),x=(0,r.Ps)(d());(0,r.Ps)(c());var g=(0,r.Ps)(p())},10545:function(e,n,t){t.d(n,{c:function(){return b}});var o=t(14924),r=t(26042),a=t(69396),i=t(828),l=t(29815),s=t(85893),u=t(87109),d=t(21023),c=t(39522),p=t(40876),m=t(67294),h=t(48580),v=t(73359),f=t(4972),x=t(11163),g=t.n(x),b=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth,o=e.locationId,r=e.locationName,a=(0,m.useState)(""),x=a[0],b=a[1],j=(0,m.useState)(o?{label:r,value:o}:{label:"All locations",value:"all"})[0],Z=(0,i.Z)((0,v.t)(f._d,{variables:{where:{name:{_ilike:""!==x?"%".concat(x,"%"):null}},offset:0,limit:50}}),2),w=Z[0],C=Z[1],I=C.data,S=(void 0===I?{items:[]}:I).items,P=C.loading,_=function(e,n){if(!(null==n?void 0:n.value))return null;if("/dashboard/scheduledjob"===g().pathname){if("all"===n.value)return null;g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))}else"all"===n.value?g().push("/dashboard/scheduledjob"):g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))};return(0,s.jsx)(d.Z,{followCursor:!0,title:j.label,children:(0,s.jsx)(h.q,{loading:P,options:[{label:"All locations",value:"all"}].concat((0,l.Z)(S)),value:j,onChange:_,setSearch:b,onOpen:w,isOptionEqualToValue:function(e,n){return e.value===n.value},popupIcon:(0,s.jsx)(p.Z,{}),clearIcon:null,textFieldProps:{placeholder:"Location name",InputProps:{startAdornment:(0,s.jsx)(u.Z,{position:"start",children:(0,s.jsx)(c.Z,{color:"white.main"})})}},size:"small",sx:y({withoutRightBorderRadius:n,fullWidth:t})})})},y=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth;return(0,a.Z)((0,r.Z)({height:"32px",width:t?"170px":"220px",backgroundColor:"secondary.main",borderRadius:1},n&&{borderTopRightRadius:0,borderBottomRightRadius:0}),(0,o.Z)({"& .MuiInputBase-root":{color:"white.main"},"& .MuiOutlinedInput-root.MuiInputBase-sizeSmall":{paddingTop:"4px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},"& .MuiAutocomplete-endAdornment .MuiSvgIcon-root,\n  .MuiInputAdornment-root.MuiInputAdornment-positionStart",{color:"white.main"}))}},93203:function(e,n,t){t.d(n,{A:function(){return iJ}});var o,r,a=t(26042),i=t(85893),l=t(67294),s=t(51233),u=t(90629),d=t(90948),c=t(3892),p=t(40044),m=t(10545),h=t(47568),v=t(69396),f=t(828),x=t(97582),g=t(45697),b=t.n(g),y=t(30381),j=t.n(y),Z=t(6388),w=t(73359),C=t(50319),I=t(90263),S=t(5616),P=t(15861),_=t(86886),k=t(93946),q=t(11057),D=t(84808),T=t(98456),M=t(41899),O=t(41733),F=t(91379),A=t(77957),E=t(81261),R=t(24519),$=t(62177),N=t(57460),W=t.n(N),J=t(12547),L=t(29815),B=t(86532),Y=t(38895),H=t(22797),V=t(61730),G=t(11163),Q=t.n(G),z=t(2388),U=t(66242),K=t(44267),X=t(22244),ee=t(11383);function en(){return(en=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let et=e=>l.createElement("svg",en({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 23 22",width:"1em",height:"1em"},e),l.createElement("path",{fill:"#C1C1C1",d:"M10.504.223a2.35 2.35 0 0 1 1.994 0l9.277 4.34c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937zm9.013 8.783 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34A1.04 1.04 0 0 1 .637 11c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0zm-6.45 8.517 6.45-3.017 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0"}));var eo=t(83985),er=t(2845),ea={jobTitle:{color:"#5C5C5C",fontSize:"14px",marginBottom:"12px"},status:{fontWeight:"600",textTransform:"capitalize"},link:{textDecoration:"none"},assignedToLabel:{fontWeight:"300",whiteSpace:"nowrap"}},ei=function(e){var n=e.id,t=e.number,o=e.status,r=e.description,a=e.supplierId,l=e.supplierName,u=e.onSelectJob,d=e.selected,c=e.onClose,p=(0,er.x)().hasRole,m=p("supplier"),h=p("customer"),v=(0,ee.b)(o),f=((0,L.Z)(X.iz).concat((0,L.Z)(X.yW),(0,L.Z)(X.l8)).find(function(e){return e.value===o})||{statusText:""}).text,x=function(e){e.stopPropagation(),Q().push("/dashboard/issues/view?id=".concat(t)).then(function(){return c()})};return(0,i.jsxs)(s.Z,{direction:"row",width:"100%",spacing:1,onClick:function(){return u(n)},children:[(0,i.jsx)(el,{selected:d,children:(0,i.jsxs)(K.Z,{children:[(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,mb:1.5,children:[(0,i.jsx)(q.Z,{onClick:x,color:v,variant:"contained",size:"small",children:t}),(0,i.jsx)(P.Z,{sx:ea.status,typography:"subtitle1",children:f})]}),(0,i.jsx)(eo.O,{maxLength:10,sx:ea.jobTitle,children:r}),!h&&(0,i.jsxs)(s.Z,{direction:"row",columnGap:1,children:[(0,i.jsx)(P.Z,{typography:"subtitle2",sx:ea.assignedToLabel,children:"Assigned to:\xa0"}),(0,i.jsx)(P.Z,{typography:"subtitle2",children:(0,i.jsx)(J.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(a),noWrap:!a||m,sx:{fontSize:"14px"},children:l||"-"})})]})]})}),d&&(0,i.jsx)(es,{}),!d&&(0,i.jsx)(eu,{children:(0,i.jsx)(K.Z,{children:(0,i.jsx)(et,{className:"stacked-layers"})})})]})};ei.propTypes={id:b().number.isRequired,number:b().string.isRequired,status:b().string.isRequired,description:b().string.isRequired,supplierId:b().number,supplierName:b().string,onSelectJob:b().func.isRequired,selected:b().bool,onClose:b().func.isRequired};var el=(0,d.ZP)(U.Z)(function(e){var n=e.selected;return(0,a.Z)({position:"relative",width:"calc(100% - 60px)",display:"flex",flexDirection:"column",justifyContent:"center",height:"140px",backgroundColor:"#F9F9F9"},!n&&{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"}},n&&{width:"100%",border:"1px solid #50AEFC"})}),es=(0,d.ZP)("div")({position:"relative",width:"12px",marginLeft:"0px !important","&:after":{content:'""',position:"absolute",bottom:"50%",left:"-6px",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"0px solid transparent",borderBottom:"12px solid #50AEFC",transform:"rotate(-45deg)"}}),eu=(0,d.ZP)(U.Z)(function(){return{width:"60px",display:"flex",justifyContent:"center",alignItems:"center",height:"140px",backgroundColor:"#F9F9F9",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"},"& .MuiCardContent-root":{padding:"0px",display:"flex",justifyContent:"center",alignItems:"center"},"& .stacked-layers":{fontSize:"24px"}}}),ed=t(48580),ec=t(75759),ep=t(7297),em=t(75063);function eh(){var e=(0,ep.Z)(["\n  fragment JobScheduleFields on JobSchedule {\n    contractId\n    createdAt\n    customerMonthlyCharge\n    dates\n    estimatedDuration\n    estimatedDurationUnit\n    finalInvoiceDate\n    firstInvoiceDate\n    frequency\n    frequencyDescription\n    id\n    invoiceBasis\n    locationId\n    meta\n    paymentMethod\n    reference\n    status\n    sublocationId\n    supplierMonthlyCharge\n    updatedAt\n    scheduleStart\n    scheduleEnd\n    assetCategoryId\n    description\n    customerId\n  }\n"]);return eh=function(){return e},e}var ev=(0,em.Ps)(eh());function ef(){var e=(0,ep.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return ef=function(){return e},e}function ex(){var e=(0,ep.Z)(['\n  query GetJobSchedule($jobScheduleId: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $jobScheduleId) {\n      ...JobScheduleFields\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets(where: { entity: { _eq: "JobSchedule" } }) {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        status\n      }\n    }\n  }\n  ',"\n"]);return ex=function(){return e},e}function eg(){var e=(0,ep.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $where: JobSchedule_bool_exp!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      ...JobScheduleFields\n      location: Location {\n        id\n        access\n        customer: Account_Locations {\n          account: Account {\n            id\n            managerId\n          }\n        }\n        user: User {\n          id\n          nameLast\n          nameFirst\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        rag\n        title\n        timingStart\n        status\n        statusData\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return eg=function(){return e},e}function eb(){var e=(0,ep.Z)(["\n  query GetJobSchedule(\n    $locationId: Int\n    $orderBy: JobSchedule_order_by!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      where: { locationId: { _eq: $locationId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return eb=function(){return e},e}function ey(){var e=(0,ep.Z)(["\n  mutation CopyScheduleItems(\n    $originLocationId: Int!\n    $copyLocationIds: [Int!]!\n    $selectType: String!\n    $scheduleIds: [Int]\n  ) {\n    copyScheduleItems(\n      originLocationId: $originLocationId\n      copyLocationIds: $copyLocationIds\n      selectType: $selectType\n      scheduleIds: $scheduleIds\n    ) {\n      data\n      success\n    }\n  }\n"]);return ey=function(){return e},e}function ej(){var e=(0,ep.Z)(['\n  query GetJobsListFromSchedule(\n    $jobScheduleId: Int!\n    $supplierId: Int\n    $status: [String]\n    $startDate: timestamptz\n    $endDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        jobScheduleId: { _eq: $jobScheduleId }\n        status: { _in: $status, _neq: "canceled" }\n        timingStart: { _gte: $startDate, _lte: $endDate }\n        _or: [\n          { supplierId: { _eq: $supplierId } }\n          { SupplierOffers: { accountId: { _eq: $supplierId } }, status: { _eq: "offered" } }\n        ]\n      }\n      order_by: { id: asc }\n    ) {\n      id\n      number\n      status\n      description\n      supplier: Supplier {\n        id\n        name\n      }\n    }\n  }\n']);return ej=function(){return e},e}function eZ(){var e=(0,ep.Z)(['\n  query GetJobFromSchedule($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      id\n      status\n      type\n      description\n      timingStatus\n      correctStart\n      correctEnd\n      scheduledAt\n      number\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      arrivalAnytime: meta(path: "arrivalAnytime")\n      supplier: Supplier {\n        id\n        name\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        accountEntry: AccountEntry {\n          id\n          meta\n        }\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n      }\n      compliances: Compliances(where: { entity: { _eq: "Job" } }) {\n        id\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n']);return eZ=function(){return e},e}function ew(){var e=(0,ep.Z)(["\n  query CountTotalJobs($where: Job_bool_exp) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return ew=function(){return e},e}function eC(){var e=(0,ep.Z)(["\n  query CountTotalJobsList($where: Job_bool_exp, $limit: Int = 50, $offset: Int = 0) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset) {\n      id\n      number\n      title\n      status\n    }\n  }\n"]);return eC=function(){return e},e}function eI(){var e=(0,ep.Z)(['\n  query GetNextJob($locationId: Int, $now: timestamptz!) {\n    nextJob: Job(\n      where: {\n        type: { _eq: "ppm" }\n        status: { _nin: ["closed", "canceled"] }\n        locationId: { _eq: $locationId }\n        timingStart: { _gt: $now }\n      }\n      order_by: { timingStart: asc }\n      limit: 1\n    ) {\n      id\n      number\n      title\n      status\n      scheduledAt\n    }\n  }\n']);return eI=function(){return e},e}function eS(){var e=(0,ep.Z)(['\n  query GetLocationInfo($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n        account: Account {\n          id\n          name\n          meta\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, invoice: { _eq: true } }) {\n        id\n        address: Address {\n          id\n          name\n          postCode\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n        }\n      }\n    }\n  }\n']);return eS=function(){return e},e}function eP(){var e=(0,ep.Z)(["\n  mutation AddJobSchedule($objects: [JobSchedule_insert_input!]!) {\n    insert_JobSchedule(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return eP=function(){return e},e}function e_(){var e=(0,ep.Z)(["\n  mutation UpdateJobSchedule($data: jsonb!) {\n    updateJobSchedule(data: $data) {\n      success\n      data\n    }\n  }\n"]);return e_=function(){return e},e}function ek(){var e=(0,ep.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return ek=function(){return e},e}function eq(){var e=(0,ep.Z)(["\n  mutation GeneratePpmJobs($jobScheduleId: Int!) {\n    createPpmJobs(jobScheduleId: $jobScheduleId) {\n      success\n      data\n    }\n  }\n"]);return eq=function(){return e},e}function eD(){var e=(0,ep.Z)(['\n  query GetScheduledJobs(\n    $where: Job_bool_exp\n    $limit: Int!\n    $offset: Int!\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      id\n      number\n      type\n      timingStart\n      createdAt\n      status\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        name\n      }\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      customer: Customer {\n        id\n        name\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { _and: [{ status: { _eq: "active" } }, { type: { _eq: "tags" } }] }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eD=function(){return e},e}function eT(){var e=(0,ep.Z)(['\n  query GetScheduleItemsForCalendar(\n    $locationId: Int\n    $where: JobSchedule_bool_exp!\n    $jobWhere: Job_bool_exp!\n    $offset: Int = 0\n    $limit: Int = 50\n  ) {\n    jobSchedules: JobSchedule(\n      where: $where\n      offset: $offset\n      limit: $limit\n      order_by: { id: desc }\n    ) {\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      serviceName: meta(path: "$.serviceName")\n      jobs: Jobs(where: $jobWhere) {\n        id\n        timingStart\n        statusData\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eT=function(){return e},e}function eM(){var e=(0,ep.Z)(['\n  query GetCustomerFinances($locationId: Int!) {\n    invoices: AccountEntry(where: { locationId: { _eq: $locationId } }, order_by: { id: desc }) {\n      id\n      invoiceNumber\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      meta\n      createdAt\n      amountPaid: InvoiceReconciliations_aggregate(\n        where: { creditEntity: { _eq: "PaymentReceipt" } }\n      ) {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n      amountDeducted: InvoiceReconciliations_aggregate(\n        where: { creditEntity: { _eq: "CreditNote" } }\n      ) {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n    }\n    meta: AccountEntry_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eM=function(){return e},e}function eO(){var e=(0,ep.Z)(['\n  query GetCustomerPossibleFutureInvoicesData(\n    $locationId: Int!\n    $now: timestamptz!\n    $endOfYear: timestamptz!\n  ) {\n    jobs: Job(\n      where: {\n        JobSchedule: { locationId: { _eq: $locationId } }\n        timingStart: { _gte: $now, _lte: $endOfYear }\n        type: { _in: ["ppm", "cppm"] }\n      }\n    ) {\n      id\n      timingStart\n      jobSchedule: JobSchedule {\n        invoiceBasis\n        customerMonthlyCharge\n        meta\n      }\n    }\n  }\n']);return eO=function(){return e},e}function eF(){var e=(0,ep.Z)(["\n  query GetScheduleItemsTotalByJobsForCalendar(\n    $whereComplete: Job_bool_exp!\n    $whereIncomplete: Job_bool_exp!\n    $whereFollowOn: Job_bool_exp!\n    $whereIncompleteCompliance: Job_bool_exp!\n  ) {\n    jobsCompleteCount: Job_aggregate(where: $whereComplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteCount: Job_aggregate(where: $whereIncomplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsFollowOnCount: Job_aggregate(where: $whereFollowOn) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteComplianceCount: Job_aggregate(where: $whereIncompleteCompliance) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return eF=function(){return e},e}function eA(){var e=(0,ep.Z)(["\n  query GetScheduleItemsCountTotalForCalendar($where: Job_bool_exp!) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return eA=function(){return e},e}function eE(){var e=(0,ep.Z)(["\n  query GetSupplierForInvoice($supplierId: Int!) {\n    supplier: Account_by_pk(id: $supplierId) {\n      id\n      name\n      vatId\n    }\n  }\n"]);return eE=function(){return e},e}function eR(){var e=(0,ep.Z)(['\n  query GetSupplierPpmInvoices(\n    $jobScheduleId: Int!\n    $supplierId: Int!\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $orderBy: AccountEntry_order_by!\n  ) {\n    invoices: AccountEntry(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        accountId: { _eq: $supplierId }\n        locationId: { _eq: $locationId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n    }\n    meta: AccountEntry_aggregate(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        accountId: { _eq: $supplierId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eR=function(){return e},e}function e$(){var e=(0,ep.Z)(["\n  query GetSupplierPpmInvoiceById($id: Int!) {\n    invoice: AccountEntry_by_pk(id: $id) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      items\n      meta\n      location: Location {\n        id\n        name\n      }\n      account: Account {\n        id\n        name\n        vatId\n      }\n    }\n  }\n"]);return e$=function(){return e},e}function eN(){var e=(0,ep.Z)(["\n  mutation UpsertSupplierPPMInvoice($data: jsonb!) {\n    upsertSupplierPpmInvoice(data: $data) {\n      success\n      data\n    }\n  }\n"]);return eN=function(){return e},e}function eW(){var e=(0,ep.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $locationId: Int\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      limit: $limit\n      offset: $offset\n      where: { locationId: { _eq: $locationId } }\n      order_by: [$orderBy]\n    ) {\n      ...JobScheduleFields\n      invoicesReceived\n      invoicesPaid\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        status\n        timingStart\n        statusData\n        supplierGross: supplierFinances(path: "amountInfo.vatTotal")\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return eW=function(){return e},e}function eJ(){var e=(0,ep.Z)(["\n  query SupplierInvoiceTotalByMonth(\n    $locationId: Int!\n    $supplierId: Int\n    $startDate: timestamptz!\n    $endDate: timestamptz!\n  ) {\n    items: select_supplier_ppm_invoice_totals_by_month(\n      args: {\n        supplierid: $supplierId\n        locationid: $locationId\n        startdate: $startDate\n        enddate: $endDate\n      }\n      order_by: { month: asc }\n    ) {\n      locationId\n      month\n      totalPaid\n      totalUnpaid\n      totalPartial\n    }\n  }\n"]);return eJ=function(){return e},e}function eL(){var e=(0,ep.Z)(["\n  query GetAccountByLocation($locationId: Int!) {\n    account: Account(where: { Account_Locations: { Location: { id: { _eq: $locationId } } } }) {\n      id\n      name\n    }\n  }\n"]);return eL=function(){return e},e}(0,em.Ps)(ef());var eB=(0,em.Ps)(ex(),ev),eY=(0,em.Ps)(eg(),ev),eH=(0,em.Ps)(eb()),eV=(0,em.Ps)(ey()),eG=(0,em.Ps)(ej()),eQ=(0,em.Ps)(eZ()),ez=(0,em.Ps)(ew()),eU=(0,em.Ps)(eC()),eK=(0,em.Ps)(eI()),eX=(0,em.Ps)(eS()),e0=(0,em.Ps)(eP()),e1=(0,em.Ps)(e_()),e2=(0,em.Ps)(ek()),e3=(0,em.Ps)(eq()),e5=(0,em.Ps)(eD()),e6=(0,em.Ps)(eT()),e4=(0,em.Ps)(eM()),e9=(0,em.Ps)(eO()),e7=(0,em.Ps)(eF());(0,em.Ps)(eA());var e8=(0,em.Ps)(eE()),ne=(0,em.Ps)(eR()),nn=(0,em.Ps)(e$()),nt=(0,em.Ps)(eN()),no=(0,em.Ps)(eW(),ev),nr=(0,em.Ps)(eJ()),na=(0,em.Ps)(eL()),ni=t(4972),nl=[{label:"All jobs",value:null},{label:"Raised jobs",value:"raised"},{label:"Offered jobs",value:"offered"},{label:"Accepted jobs",value:"accepted"},{label:"In progress jobs",value:"inProgress"},{label:"Completed jobs",value:"completed"},{label:"Report sent jobs",value:"reportSent"},{label:"Follow on jobs",value:"followOn"}],ns=t(11082),nu=t(22595),nd=t(35381),nc=t(48218),np=t(90114),nm=t(98552),nh=function(e){var n,t=e.timings,o=(void 0===t?[]:t).find(function(e){return"reportSentSupplier"===e.status});return o&&"Report Sent by ".concat((null==o?void 0:null===(n=o.user)||void 0===n?void 0:n.fullName)||"")},nv=function(e){var n,t=e.timings,o=void 0===t?[]:t,r=null==o?void 0:o.find(function(e){return"invoiceSent"===e.status});return r&&"Invoice sent by ".concat((null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.fullName)||"")},nf=function(e){var n,t,o,r,a=e.supplier,i=e.supplierUser,l=e.customerVatTotal,s=e.timings,u=void 0===s?[]:s,d=e.timingStatus,c=e.correctStart,p=e.correctEnd,m=e.scheduledAt,h=e.arrivalAnytime,v=e.compliances,f=void 0===v?[]:v,x=e.supplierOffers,g=void 0===x?[]:x,b=e.invoices,y=e.user,Z=null==y?void 0:y.invoiceThreshold,w="onHold"===(0,nc.L)(u),C=(0,nu.E)({timings:u},"accepted"),I=(0,nu.E)({timings:u},"closed"),S="incorrect"===d?p:(0,nu.E)({timings:u},"completed"),P=(0,nu.E)({timings:u},"complianceRejected"),_=(0,nu.E)({timings:u},"complianceApproved"),k=(0,nu.E)({timings:u},"complianceRequestedDocumentation"),q=(0,nu.E)({timings:u},"customerPaid"),D=(null==f?void 0:f.length)>0,T="incorrect"===d?c:(0,nu.E)({timings:u},"inProgress"),M=(0,nu.E)({timings:u},"invoiceSent"),O=(0,nu.E)({timings:u},"offered"),F=(0,nu.E)({timings:u},"pricingChanged"),A=(0,nu.E)({timings:u},"quoteAccepted"),E=(0,nu.E)({timings:u},"rejected"),R=(0,nu.E)({timings:u},"reportSent"),$=(0,nu.E)({timings:u},"reportSentSupplier"),N=(0,nu.E)({timings:u},"supplierPaid"),W=(0,nu.E)({timings:u},"timingChanged"),J=(0,nu.E)({timings:u},"validated"),L=(0,nu.E)({timings:u},"updateAcceptOfferInput"),B=(0,nu.E)({timings:u},"supplierCancel"),Y=(0,nu.E)({timings:u},"expensesPendingAmount"),H=(0,nu.E)({timings:u},"expensesPendingAmountResolved"),V=m?h?"".concat(j()(m).format("D MMM YYYY")," (anytime)"):j()(m).format("D MMM YYYY HH:mm"):j()(A||C).format("D MMM YYYY HH:mm"),G=g.filter(function(e){return"cancelled"!==e.status}).length,Q=(0,np.Xd)("adminInvoice",u),z=(0,np.nN)(["adminUplift","adminInvoice"],u),U=(0,np.OQ)("adminInvoice",u),K=null==b?void 0:b.filter(function(e){return nm.SR.customer.includes(e.invoiceType)}),X=null==b?void 0:b.filter(function(e){return nm.SR.supplier.includes(e.invoiceType)}),ee=(null==K?void 0:K.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,en=(null==X?void 0:X.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,et=(null==K?void 0:K.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null,eo=(null==X?void 0:X.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null;return[{id:1,label:"Job raised",date:(0,nu.E)({timings:u},["raised","quoteNew"]),content:[{id:1,active:!0,data:"Created By ".concat((null===(n=u[0])||void 0===n?void 0:null===(t=n.user)||void 0===t?void 0:t.fullName)||"")}]},{id:2,label:"Job offered",info:"no assigned suppliers",date:O,content:[{id:1,active:!w&&O&&!T&&!C&&!W&&!F&&g&&g.length>0,data:"Offered to ".concat(G," suppliers")},{id:2,active:!w&&E,data:"Job rejected by supplier"}]},{id:3,label:"Accepted",info:"waiting for supplier to accept",date:(0,nu.E)({timings:u},"accepted"),content:[{id:1,active:(C||A||W||F)&&a,data:"Assigned to ".concat(null==a?void 0:a.name)},{id:2,active:(C||A)&&i,data:"Operative: ".concat(null==i?void 0:i.fullName)},{id:3,active:C||A,data:"Arrival time: ".concat(V)},{id:4,active:W&&!C&&a,data:"Job timing has changed, supplier needs to Accept the job again and set new\n          attendance time"},{id:5,active:F&&!C&&a,data:"Job service or pricing has changed, supplier needs to Accept the job again and\n          confirm attendance and operative"},{id:6,active:L,data:"Attendance and operative has changed by ".concat((0,nd.j$)({timings:u},"updateAcceptOfferInput"))},{id:7,active:B,data:"Job canceled by ".concat((0,nd.j$)({timings:u},"supplierCancel"))},{id:8,active:!0}]},{id:4,label:"In progress",info:"waiting for supplier to start",date:T},{id:7,label:"Complete",info:"waiting for supplier to complete",date:S},{id:8,label:"Report sent",info:"after job complete",date:R,content:[{id:1,active:$,data:"Report submitted by supplier"},{id:2,active:!0,data:nh({timings:u})}]},{id:9,label:"Customer Sign Off",info:"",date:D&&(_||P),active:D,content:[{id:1,active:_,data:"Compliance sing off by ".concat((0,nd.j$)({timings:u},"complianceApproved"))},{id:2,active:P,data:"Compliance rejected by ".concat((0,nd.j$)({timings:u},"complianceRejected"))},{id:3,active:!w&&D&&k&&!(_||P)}]},{id:10,label:"Threshold approval",info:"",date:(null==z?void 0:z.createdAt)||(null==U?void 0:U.createdAt),active:!!(Q||z||U),content:[{id:1,active:Q&&!z&&!U,data:"Awaiting threshold approval"},{id:2,active:z,data:"Threshold approved by ".concat(null==z?void 0:null===(o=z.user)||void 0===o?void 0:o.fullName)},{id:3,active:U,data:"Threshold rejected by ".concat(null==U?void 0:null===(r=U.user)||void 0===r?void 0:r.fullName)},{id:4,active:!w&&Q&&(0,nd.il)(Z,l||0)}]},{id:11,label:"Awaiting expenses pricing",info:"",date:H,active:!!(Y||H)},{id:12,label:"Invoices sent",info:"after validation",date:M,content:[{id:1,active:J,data:"Job validated"},{id:2,active:!0,data:nv({timings:u})}]},{id:13,label:"Customer ".concat(q?"paid":ee>0?"partially paid":"not paid"),date:q,active:!0,content:[{id:1,active:!q&&ee,data:"Reconciled amount ".concat((0,ns.Z)(ee))},{id:2,active:!q&&ee,data:"Amount outstanding ".concat((0,ns.Z)(et))}]},{id:14,label:"Supplier ".concat(N?"paid":en>0?"partially paid":"not paid"),date:N,active:!0,content:[{id:1,active:!N&&en,data:"Reconciled amount ".concat((0,ns.Z)(en))},{id:2,active:!N&&en,data:"Amount outstanding ".concat((0,ns.Z)(eo))}]},{id:15,label:"Closed",info:"automatically after steps complete",date:I}]},nx=t(93884),ng={wrapper:{marginBottom:"10px"},subtitle:{fontWeight:"300"},title:{fontWeight:"500"},selector:function(e){return{width:e?"100%":"300px"}},jobCountLabel:{fontWeight:"300"},accordion:{borderTop:"0px",boxShadow:"none"},jobNumber:function(e,n){return{color:e,backgroundColor:n,width:"67px",cursor:"pointer",padding:"0 10px",borderRadius:"5px"}}},nb=function(e){var n,t,o,r=e.jobScheduleId,u=e.status,d=e.startDate,c=e.endDate,p=e.onClose,m=e.hideFilters,h=(0,er.x)().hasRole,v=h("supplier"),x=h("customer"),g=(0,l.useState)(null),b=g[0],y=g[1],j=(0,l.useState)(u),C=j[0],I=j[1],k=(0,l.useState)(null),q=k[0],D=k[1],M=(0,V.Z)("(max-width: 600px)"),O=(0,er.x)().user,F=(0,G.useRouter)().query,A=(0,Z.aM)(eG,{variables:{jobScheduleId:r,supplierId:null==q?void 0:q.value,status:C||u,startDate:d,endDate:c}}),E=A.data,R=(void 0===E?{jobs:[]}:E).jobs,$=A.loading;(0,l.useEffect)(function(){F.scheduledTab||p()},[null==F?void 0:F.scheduledTab,p]);var N=(0,Z.aM)(eQ,{skip:!b,variables:{jobId:b}}),W=N.data,Q=(void 0===W?{job:{}}:W).job,U=N.loading,K=(0,f.Z)((0,w.t)(ni.by,{variables:{where:{type:{_eq:"supplier"}}}}),2),X=K[0],en=K[1],et=en.loading,ea=en.data,el=(void 0===ea?{items:[]}:ea).items,es=(0,l.useMemo)(function(){return{title:"No ppm jobs found",subtitleFirstLine:"Jobs for applied filters was not found or wasn`t created",subtitleSecondLine:"Please click Create jobs on PPM item or amend filters"}},[]),eu=R.length,ep=(0,l.useCallback)(function(e){return null==e?void 0:e.reduce(function(e,n){var t=nl.find(function(e){return e.value===n});return t?(0,L.Z)(e).concat([{value:n,label:t.label}]):e},[])},[]);return $?(0,i.jsx)(s.Z,{height:"100%",justifyContent:"center",alignItems:"center",children:(0,i.jsx)(T.Z,{color:"secondary"})}):(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(s.Z,{direction:M?"column":"row",alignItems:M?"space-between":"flex-end",spacing:1,children:[!m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ed.q,{multiple:!0,limitTags:1,value:ep(C)||[],sx:ng.selector(M),onChange:function(e,n){n.length?I((0,L.Z)(n.map(function(e){return e.value}))):I(u)},textFieldProps:{color:"secondary",variant:"standard",label:"Select status"},options:nl}),!v&&(0,i.jsx)(ed.q,{value:q,sx:ng.selector(M),onChange:function(e,n){return D(n)},textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"},loading:et,onOpen:function(){return X()},options:el})]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:ng.jobCountLabel,mt:M?2:0,children:["Item has ",eu," scheduled jobs"]})]}),(null==R?void 0:R.length)?(0,i.jsxs)(_.ZP,{container:!0,mt:3,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,md:5,lg:5,sx:{height:M?"auto":"750px",padding:"15px 10px",overflow:"scroll"},children:(0,i.jsx)(s.Z,{rowGap:2,children:null==R?void 0:R.map(function(e){var n,t;return(0,i.jsx)(ei,{id:e.id,number:e.number,status:e.status,description:e.description,supplierId:null===(n=e.supplier)||void 0===n?void 0:n.id,supplierName:null===(t=e.supplier)||void 0===t?void 0:t.name,onSelectJob:y,selected:b===e.id,onClose:p})})})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:6,lg:6,ml:3,children:b&&!U&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.Z,{sx:ng.wrapper,children:[(0,i.jsx)(ny,{backgroundColor:(0,ee.b)(Q.status),children:Q.number}),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{typography:"subtitle2",sx:ng.subtitle,children:"Description"}),(0,i.jsx)(eo.O,{maxLength:40,sx:{wordBreak:"break-all"},children:Q.description})]}),!x&&(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{typography:"subtitle2",sx:ng.subtitle,children:"Supplier"}),(0,i.jsx)(P.Z,{typography:"subtitle2",children:(0,i.jsx)(J.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=Q.supplier)||void 0===n?void 0:n.id),noWrap:!(null===(t=Q.supplier)||void 0===t?void 0:t.id)||v,children:(null===(o=Q.supplier)||void 0===o?void 0:o.name)||"-"})})]})]}),(0,i.jsxs)(B.Z,{sx:ng.accordion,expanded:!0,children:[(0,i.jsx)(Y.Z,{children:(0,i.jsxs)(s.Z,{direction:"row",spacing:3,children:[(0,i.jsx)(P.Z,{variant:"h6",children:"Workflow"}),(0,i.jsx)(ec.B,{value:Q.status})]})}),(0,i.jsx)(H.Z,{children:(0,i.jsx)(z.v,{steps:nf({supplier:Q.supplier,supplierUser:Q.supplierUser,customerVatTotal:Q.customerVatTotal,timings:Q.timings,timingStatus:Q.timingStatus,correctStart:Q.correctStart,correctEnd:Q.correctEnd,scheduledAt:Q.scheduledAt,arrivalAnytime:Q.arrivalAnytime,compliances:Q.compliances,supplierOffers:Q.supplierOffers,invoices:Q.invoices,user:O})})})]})]})})]}):(0,i.jsx)(S.Z,{p:3,children:(0,i.jsx)(nx.C,(0,a.Z)({imageSrc:"/static/icons/no_locations_found.svg"},es))})]})};nb.propTypes={jobScheduleId:b().string.isRequired,status:b().array,startDate:b().string,endDate:b().string,onClose:b().func.isRequired,hideFilters:b().bool};var ny=(0,d.ZP)(S.Z)(function(e){var n=e.theme,t=e.backgroundColor;return{color:n.palette[t].contrastText,backgroundColor:n.palette[t].main,cursor:"pointer",padding:"0 10px",width:"fit-content",borderRadius:"5px"}}),nj=t(23776),nZ=t(50135),nw=t(22961),nC=[{name:"setLocation",hasRequiredFields:!0,requiredFields:function(){return["location"]},value:1},{name:"workDescription",hasRequiredFields:!0,requiredFields:function(){return["shortDescription","description","estimatedDuration","estimatedDurationUnit"]},value:2},{name:"selectService",hasRequiredFields:!0,requiredFields:function(){return["costCategory","service","supplier"]},value:3},{name:"setSchedule",hasRequiredFields:!0,requiredFields:function(){return["frequency","frequencyDescription"]},value:4},{name:"invoicing",hasRequiredFields:!0,requiredFields:function(e){return"onCompletion"===e.invoicingBasis?["costCustomer","costSupplier"]:["customerMonthlyCharge","supplierMonthlyCharge","firstInvoiceDate","finalInvoiceDate"]},value:5}],nI=function(e){switch(e){case"raised":return{backgroundColor:"rgb(249, 156, 35)",color:"#ffffff"};case"offered":return{backgroundColor:"rgb(230, 8, 17)",color:"#ffffff"};case"accepted":return{backgroundColor:"rgb(0, 180, 60)",color:"#ffffff"};case"inProgress":return{backgroundColor:"rgb(0, 204, 188)",color:"#ffffff"};case"completed":return{backgroundColor:"rgb(217, 217, 217)",color:"#000000"};case"reportSent":return{backgroundColor:"rgb(153, 153, 153)",color:"#000000"};default:return{backgroundColor:"#C1C1C1",color:"#000000"}}},nS={subtitle:{color:"#323E4E",fontWeight:"300"},statusSquaredIcon:function(e,n,t){return{backgroundColor:n,color:e,borderRadius:"5px",height:"30px","& .Mui-disabled":{backgroundColor:"".concat(n,"!important"),opacity:.5},"&:hover":{opacity:.8,backgroundColor:n}}},selectStatusAutocomplete:function(e,n){return{width:"170px","& .MuiInputBase-root":{border:"0px!important solid transparent",backgroundColor:"".concat(n,"!important"),padding:"3px!important",color:"".concat(e,"!important"),"-webkit-text-fill-color":"".concat(e,"!important"),input:{padding:"3px!important"},svg:{color:"".concat(e,"!important")}},"& .Mui-disabled":{opacity:.5}}}},nP=function(e){var n,t,o,r,u,d=e.row,c=e.handleOpenJobsFromSchedule,p=e.sessionData,m=e.saveSessionData,h=(0,l.useState)(null!=p?p:nl[0]),v=h[0],f=h[1],x=nI(null==v?void 0:v.value),g=x.color,b=x.backgroundColor;return(0,i.jsxs)(s.Z,{columnGap:1,children:[!!(null===(n=d.jobs)||void 0===n?void 0:n.length)&&(0,i.jsx)(P.Z,{typography:"subtitle1",children:"".concat(null===(t=d.jobs)||void 0===t?void 0:t.length," Jobs ").concat(d.completeCount," completed")}),(0,i.jsx)(P.Z,{typography:"subtitle2",sx:nS.subtitle,children:"Check a status of selected job"}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:1,children:[(0,i.jsx)(nj.Z,{disableClearable:!0,disabled:!(null==d?void 0:null===(o=d.jobs)||void 0===o?void 0:o.length),sx:nS.selectStatusAutocomplete(g,b),value:v,onChange:function(e,n){e.stopPropagation(),m(d.id,n),f(n)},options:nl,renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,a.Z)({},e))}}),(0,i.jsx)(k.Z,{disabled:!(null==d?void 0:null===(r=d.jobs)||void 0===r?void 0:r.length),sx:nS.statusSquaredIcon(g,b),onClick:function(e){var n,t;e.stopPropagation(),c({jobScheduleId:d.id,jobStatus:v.value,description:d.shortDescription.label,totalJobCount:null!==(t=null===(n=d.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:(0,i.jsx)(nw.Z,{sx:{color:g,opacity:(null==d?void 0:null===(u=d.jobs)||void 0===u?void 0:u.length)?1:.5}})})]})]})},n_=t(42283),nk=t(79665),nq=t(69368),nD=t(15033),nT=t(20705),nM=t(74231),nO=nM.Ry({locations:nM.IX().of(nM.Ry({value:nM.Rx().integer().required(),label:nM.Z_().required()}).required()).min(1).required()}),nF=nM.Ry().shape({location:nM.Ry().required(),sublocation:nM.Ry().nullable(),assetCategory:nM.Ry().nullable(),assets:nM.IX().nullable(),shortDescription:nM.Ry().required(),reference:nM.Z_().nullable(),description:nM.Z_().required(),estimatedDuration:nM.Rx().min(0).required(),estimatedDurationUnit:nM.Z_().oneOf(["hours","minutes","days"]).required(),compliance:nM.O7().nullable(),complianceSelect:nM.Ry().nullable(),costCategory:nM.Ry().required(),service:nM.Ry().required(),supplier:nM.Ry().required(),frequencyDescription:nM.Z_().nullable(),frequency:nM.Z_().required(),costCustomer:nM.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),costSupplier:nM.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),firstInvoiceDate:nM.hT().nullable(),finalInvoiceDate:nM.hT().nullable(),customerMonthlyCharge:nM.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMonthlyCharge:nM.Rx().transform(function(e){return isNaN(e)?null:e}).nullable()}),nA=nM.Ry().shape({reference:nM.Z_(),description:nM.Z_().required(),dueDate:nM.hT().when("$isSupplier",{is:!0,then:nM.hT().nullable()}),supplier:nM.Ry().when("$isSupplier",{is:!0,then:nM.Ry().nullable(),otherwise:nM.Ry().required()})}),nE=nM.Ry().shape({description:nM.Z_().required(),rate:nM.Rx().min(0).required(),quantity:nM.Rx().integer().min(0).required(),vatType:nM.Z_().oneOf(["default","custom"]).required(),vatPercentage:nM.Rx().min(0).required()}),nR=t(39641),n$={item:"createdAt",order:"asc"},nN=function(e){var n,t=e.locationId,o=(0,nR.D)(),r=(0,(0,er.x)().hasRole)("admin"),d=(0,l.useState)("selectAll"),c=d[0],p=d[1],m=(0,l.useState)([]),g=m[0],b=m[1],y=(0,l.useState)(""),j=y[0],w=y[1],I=(0,nT.x)({initialSort:n$}),S=I.initialData,k=I.ref,q=(0,n_.cI)({defaultValues:{locations:[]},resolver:(0,nk.S)(nO)}),M=q.handleSubmit,O=q.control,F=q.errors,A=(0,f.Z)((0,C.D)(eV,{onCompleted:function(){o.show({content:"Success. This planned maintenance schedule\n        has been copied to the selected locations.\n        Please note that you will still need to click on the relevant\n        item in the location to create the individual jobs."})},onError:function(e){o.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),E=A[0],R=A[1].loading,$=(0,Z.aM)(eH,{variables:(0,v.Z)((0,a.Z)({},S),{locationId:t})}),N=$.data,W=void 0===N?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:N,J=W.jobSchedule,B=W.meta,Y=$.loading,H=$.refetch,V=(0,Z.aM)(ni._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==j?"%".concat(j,"%"):null}},limit:50,offset:0}}),G=V.loading,Q=V.data,z=(void 0===Q?{items:[]}:Q).items,U=function(e){var n=e.row;return"selectAll"===c||"excludeAll"!==c&&("selectSome"===c?g.includes(n.id):"excludeSome"===c&&!g.includes(n.id))},K=function(e){var n=e.row;return function(e,t){var o=g.includes(n.id)&&1===g.length;return"selectAll"!==c&&"excludeSome"!==c||t?"excludeSome"===c&&t?(o&&p("selectAll"),b(function(e){return e.filter(function(e){return e!==n.id})})):("excludeAll"===c||"selectSome"===c)&&t?(p("selectSome"),b(function(e){return(0,L.Z)(e).concat([n.id])})):"selectSome"!==c||t?void 0:(o&&p("excludeAll"),b(function(e){return e.filter(function(e){return e!==n.id})})):(p("excludeSome"),b(function(e){return(0,L.Z)(e).concat([n.id])}))}},X=J.map(function(e,n){return{index:n,id:e.id,title:e.meta.shortDescriptionName,description:e.meta.description,sublocation:e.sublocation,service:e.meta.serviceName,supplier:e.meta.supplierName,frequencyDescription:e.frequencyDescription}}),ee=(n=(0,h.Z)(function(e){return(0,x.__generator)(this,function(n){switch(n.label){case 0:if("excludeAll"===c)return[2];return[4,E({variables:{originLocationId:t,copyLocationIds:e.locations.map(function(e){return e.value}),selectType:c,scheduleIds:g}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),en=(0,l.useMemo)(function(){return z.map(function(e){var n,t,o=null===(n=e.registeredAddress)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address;return{label:"".concat(e.label,", ").concat((null==o?void 0:o.addressLine1)||""),value:e.value}})},[z]);return(0,i.jsxs)("form",{id:"offCanvasForm",onSubmit:M(ee),children:[R&&(0,i.jsx)(D.Z,{sx:{zIndex:1e5},open:!0,children:(0,i.jsx)(T.Z,{color:"secondary"})}),(0,i.jsxs)(_.ZP,{container:!0,rowSpacing:4,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,children:(0,i.jsx)(n_.Qr,{name:"locations",control:O,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,limitTags:6,color:"secondary",filterSelectedOptions:!0,loading:G,value:t||[],onChange:function(e,n){o(n)},options:en,setSearch:w,textFieldProps:{label:"Select locations",variant:"standard",color:"secondary",error:F.locations,helperText:null===(n=F.locations)||void 0===n?void 0:n.message}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,children:(0,i.jsx)(u.Z,{elevation:5,sx:{pb:1},children:(0,i.jsx)(nD.i,{paginationSize:10,ref:k,getRowHeight:function(e){return e.model.sublocation?72:52},getRowClassName:function(e){return e.row.index%2==0?"even":"odd"},loading:Y,columns:[{width:50,field:"select",sortable:!1,renderHeader:function(){return(0,i.jsx)(nq.Z,{color:"secondary",checked:"selectAll"===c,onChange:function(e,n){n?(p("selectAll"),b([])):(p("excludeAll"),b([]))}})},renderCell:function(e){var n=e.row;return(0,i.jsx)(nq.Z,{color:"secondary",checked:U({row:n}),onChange:K({row:n})})}},{minWidth:40,width:40,field:"index",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.index+1+S.offset}},{flex:1,field:"job",headerName:"Job",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{fontWeight:700,children:n.title}),(0,i.jsx)(P.Z,{children:n.description}),n.sublocation&&(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Sublocation:"}),(0,i.jsxs)(P.Z,{children:[" ",n.sublocation.name]})]})]})}},{flex:1,field:"service",headerName:"Service",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{children:n.service}),r&&(0,i.jsxs)(P.Z,{children:["Assigned to: ",n.supplier]})]})}},{flex:1,field:"frequencyDescription",headerName:"Frequency",sortable:!1}],rows:X,meta:B,refetch:H})})})]})]})};nN.defaultProps={},nN.propTypes={locationId:b().number.isRequired};var nW=t(60888),nJ=t(50480),nL=t(21023),nB=t(87109),nY=t(36872),nH=t(33754),nV=t(53485),nG=t(36968),nQ=t.n(nG),nz=t(81836),nU=function(e){var n=e.onDate.date;return j().isMoment(j()(n))||(n=new Date().setMilliseconds(0)),{dtstart:j()(n).toDate()}},nK=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],nX=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n.bymonth=nK.indexOf(e.month)+1,n},n0=function(e){var n,t=e.mode,o=e.on,r=e.onThe;switch(e.excludingWeekends,t){case"on":return(0,a.Z)({freq:nz.Ci.YEARLY},(n=o,{bymonth:nK.indexOf(n.month)+1,bymonthday:n.day}));case"anyTimeOption":return{freq:nz.Ci.YEARLY};default:return(0,a.Z)({freq:nz.Ci.YEARLY},nX(r))}},n1=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n},n2=function(e){var n,t=e.mode,o=e.interval,r=e.on,i=e.onThe,l=e.excludingWeekends;switch(t){case"on":return(0,a.Z)({freq:nz.Ci.MONTHLY,interval:o},(n=r,{bymonthday:n.day}));case"anyTimeOption":return(0,a.Z)({freq:nz.Ci.MONTHLY,interval:o},l&&{byweekday:[nz.Ci.MO,nz.Ci.TU,nz.Ci.WE,nz.Ci.TH,nz.Ci.FR],bysetpos:[1]},!l&&{bymonthday:[1]});default:return(0,a.Z)({freq:nz.Ci.MONTHLY,interval:o},n1(i))}},n3=t(52628),n5=t.n(n3),n6=function(e){var n=e.mode,t=e.interval,o=e.days,r=e.excludingWeekends;return"anyTimeOption"===n?(0,a.Z)({freq:nz.Ci.WEEKLY,interval:t,bysetpos:[1]},r&&{byweekday:[nz.Ci.MO,nz.Ci.TU,nz.Ci.WE,nz.Ci.TH,nz.Ci.FR]},!r&&{byweekday:[nz.Ci.MO,nz.Ci.TU,nz.Ci.WE,nz.Ci.TH,nz.Ci.FR,nz.Ci.SA,nz.Ci.SU]}):(0,a.Z)({freq:nz.Ci.WEEKLY,interval:t,byweekday:n5()(o).reduce(function(e,n,t){return n?(0,L.Z)(e).concat([t]):e},[])},r&&{byweekday:[nz.Ci.MO,nz.Ci.TU,nz.Ci.WE,nz.Ci.TH,nz.Ci.FR],bysetpos:[1]})},n4=function(e){var n=e.interval;return e.excludingWeekends,{freq:nz.Ci.DAILY,interval:n}},n9=function(e){var n=e.interval,t=e.excludingWeekends;return(0,a.Z)({freq:nz.Ci.HOURLY,interval:n},t&&{byweekday:[nz.Ci.MO,nz.Ci.TU,nz.Ci.WE,nz.Ci.TH,nz.Ci.FR],bysetpos:[1]})},n7=function(e){var n=e.frequency,t=e.yearly,o=e.monthly,r=e.weekly,a=e.daily,i=e.hourly;switch(n){case"Yearly":return n0(t);case"Monthly":return n2(o);case"Weekly":return n6(r);case"Daily":return n4(a);case"Hourly":return n9(i);default:return{}}},n8=function(e){var n=e.mode,t=e.after,o=e.onDate.date,r={};return"After"===n&&(r.count=t),"On date"===n&&(r.until=j()(o).toDate()),r},te=function(e){var n=e.hideStart,t=e.weekStartsOnSunday,o={};return n&&(o.dtstart=null),t&&(o.wkst=nz.Ci.SU),o},tn=function(e){var n=e.start,t=e.repeat,o=e.end,r=e.options,i=(0,a.Z)({},nU(n),n7(t),n8(o),te(r)),l=new nz.Ci(i);return{rruleString:l.toString(),rruleText:l.toText()}},tt=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.start)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.start.onDate.date:n.dtstart?n.dtstart:e.start.onDate.date},to=function(e,n,t){var o;if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:o.frequency)return t.repeat.frequency;switch(n.freq){case 0:return"Yearly";case 1:return"Monthly";case 2:return"Weekly";case 3:return"Daily";case 4:return"Hourly";default:return e.repeat.frequency}},tr=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:r.mode)?t.repeat.yearly.mode:0===n.freq&&n.bymonth?n.bymonthday?"on":"on the":e.repeat.yearly.mode},ta=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.month)?t.repeat.yearly.on.month:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonth?nK[n.bymonth-1]:e.repeat.yearly.on.month},ti=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.yearly.on.day:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonthday?n.bymonthday:e.repeat.yearly.on.day},tl=function(e,n,t){var o,r,a,i;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.month)?t.repeat.yearly.onThe.month:0===n.freq&&n.byweekday?"number"==typeof n.bymonth?nK[n.bymonth-1]:(null===(i=n.bymonth)||void 0===i?void 0:i[0])?nK[n.bymonth[0]-1]:e.repeat.yearly.onThe.month:e.repeat.yearly.onThe.month},ts=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.yearly.onThe.day;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.yearly.onThe.day}},tu=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.yearly.onThe.which;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.yearly.onThe.which}},td=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.mode)?t.repeat.monthly.mode:1!==n.freq?e.repeat.monthly.mode:n.bymonthday?"on":"on the"},tc=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.interval)?t.repeat.monthly.interval:1!==n.freq?e.repeat.monthly.interval:n.interval},tp=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.monthly.on.day:1===n.freq&&n.bymonthday?"number"==typeof n.bymonthday?n.bymonthday:n.bymonthday[0]:e.repeat.monthly.on.day},tm=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.monthly.onThe.day;if(1!==n.freq||!n.byweekday)return e.repeat.monthly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.monthly.onThe.day}},th=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.monthly.onThe.which;if(1!==n.freq||!n.bysetpos)return e.repeat.monthly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.monthly.onThe.which}},tv=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.interval)?t.repeat.weekly.interval:2!==n.freq?e.repeat.weekly.interval:n.interval},tf=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.days)return t.repeat.weekly.days;var o,r,a=[];return 2!==n.freq?e.repeat.weekly.days:(n.byweekday&&(a=n.byweekday.map(function(e){return e.weekday})),{mon:a.includes(0),tue:a.includes(1),wed:a.includes(2),thu:a.includes(3),fri:a.includes(4),sat:a.includes(5),sun:a.includes(6)})},tx=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.weekStartsOnSunday)?t.repeat.weekly.weekStartsOnSunday:n.wkst?6===n.wkst:e.repeat.weekly.options.weekStartsOnSunday},tg=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.daily)||void 0===r?void 0:r.interval)?t.repeat.daily.interval:3!==n.freq?e.repeat.daily.interval:n.interval},tb=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.hourly)||void 0===r?void 0:r.interval)?t.repeat.hourly.interval:4!==n.freq?e.repeat.daily.interval:n.interval},ty=function(e,n,t){var o;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:o.after)?t.end.after:n.count||0===n.count?n.count:e.end.after},tj=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.end.onDate.date:n.end.onDate.date?n.end.onDate.date:e.end.onDate.date},tZ=function(e,n,t){if(!n&&!t)return e;try{var o,r,i,l,s,u,d,c,p,m,h,f,x,g,b,y,Z,w,C,I,S,P,_,k,q,D,T,M,O,F,A,E,R,$,N,W,J,L,B,Y,H,V,G,Q,z,U=(0,nz.SA)(n).origOptions;o=(0,v.Z)((0,a.Z)({},e),{start:(0,v.Z)((0,a.Z)({},e.start),{onDate:{date:j()(tt(e,U,t)),options:(0,v.Z)((0,a.Z)({},e.start.onDate.options),{weekStartsOnSunday:tx(e,U,t)})}}),repeat:(0,v.Z)((0,a.Z)({},e.repeat),{frequency:to(e,U,t),yearly:(0,v.Z)((0,a.Z)({},e.repeat.yearly),{mode:tr(e,U,t),excludingWeekends:null==t?void 0:null===(r=t.repeat)||void 0===r?void 0:null===(i=r.yearly)||void 0===i?void 0:i.excludingWeekends,hourStart:(null==t?void 0:null===(l=t.repeat)||void 0===l?void 0:null===(s=l.yearly)||void 0===s?void 0:s.hourStart)?new Date(null==t?void 0:null===(u=t.repeat)||void 0===u?void 0:null===(d=u.yearly)||void 0===d?void 0:d.hourStart):null,hourEnd:(null==t?void 0:null===(c=t.repeat)||void 0===c?void 0:null===(p=c.yearly)||void 0===p?void 0:p.hourEnd)?new Date(null==t?void 0:null===(m=t.repeat)||void 0===m?void 0:null===(h=m.yearly)||void 0===h?void 0:h.hourEnd):null,on:{month:ta(e,U,t),day:ti(e,U,t)},onThe:{month:tl(e,U,t),day:ts(e,U,t),which:tu(e,U,t)}}),monthly:(0,v.Z)((0,a.Z)({},e.repeat.monthly),{mode:td(e,U,t),excludingWeekends:null==t?void 0:null===(f=t.repeat)||void 0===f?void 0:null===(x=f.monthly)||void 0===x?void 0:x.excludingWeekends,hourStart:(null==t?void 0:null===(g=t.repeat)||void 0===g?void 0:null===(b=g.monthly)||void 0===b?void 0:b.hourStart)?new Date(null==t?void 0:null===(y=t.repeat)||void 0===y?void 0:null===(Z=y.monthly)||void 0===Z?void 0:Z.hourStart):null,hourEnd:(null==t?void 0:null===(w=t.repeat)||void 0===w?void 0:null===(C=w.monthly)||void 0===C?void 0:C.hourEnd)?new Date(null==t?void 0:null===(I=t.repeat)||void 0===I?void 0:null===(S=I.monthly)||void 0===S?void 0:S.hourEnd):null,interval:tc(e,U,t),on:{day:tp(e,U,t)},onThe:{day:tm(e,U,t),which:th(e,U,t)}}),weekly:{mode:null==t?void 0:null===(P=t.repeat)||void 0===P?void 0:null===(_=P.weekly)||void 0===_?void 0:_.mode,excludingWeekends:null==t?void 0:null===(k=t.repeat)||void 0===k?void 0:null===(q=k.weekly)||void 0===q?void 0:q.excludingWeekends,hourStart:(null==t?void 0:null===(D=t.repeat)||void 0===D?void 0:null===(T=D.weekly)||void 0===T?void 0:T.hourStart)?new Date(null==t?void 0:null===(M=t.repeat)||void 0===M?void 0:null===(O=M.weekly)||void 0===O?void 0:O.hourStart):null,hourEnd:(null==t?void 0:null===(F=t.repeat)||void 0===F?void 0:null===(A=F.weekly)||void 0===A?void 0:A.hourEnd)?new Date(null==t?void 0:null===(E=t.repeat)||void 0===E?void 0:null===(R=E.weekly)||void 0===R?void 0:R.hourEnd):null,interval:tv(e,U,t),days:tf(e,U,t),options:{weekStartsOnSunday:tx(e,U,t)}},daily:{mode:null==t?void 0:null===($=t.repeat)||void 0===$?void 0:null===(N=$.daily)||void 0===N?void 0:N.mode,interval:tg(e,U,t),excludingWeekends:null==t?void 0:null===(W=t.repeat)||void 0===W?void 0:null===(J=W.daily)||void 0===J?void 0:J.excludingWeekends,hourStart:(null==t?void 0:null===(L=t.repeat)||void 0===L?void 0:null===(B=L.daily)||void 0===B?void 0:B.hourStart)?new Date(null==t?void 0:null===(Y=t.repeat)||void 0===Y?void 0:null===(H=Y.daily)||void 0===H?void 0:H.hourStart):null,hourEnd:(null==t?void 0:null===(V=t.repeat)||void 0===V?void 0:null===(G=V.daily)||void 0===G?void 0:G.hourEnd)?new Date(null==t?void 0:null===(Q=t.repeat)||void 0===Q?void 0:null===(z=Q.daily)||void 0===z?void 0:z.hourEnd):null},hourly:{interval:tb(e,U,t)}}),end:(0,v.Z)((0,a.Z)({},e.end),{mode:"On date",after:ty(e,U,t),onDate:{date:j()(tj(e,U,t)),options:(0,v.Z)((0,a.Z)({},e.end.onDate.options),{weekStartsOnSunday:tx(e,U,t)})}}),options:(0,v.Z)((0,a.Z)({},e.options),{weekStartsOnSunday:tx(e,U,t)}),error:null})}catch(K){return(0,v.Z)((0,a.Z)({},e),{error:{value:n,message:K}})}return o},tw=t(41609),tC=t.n(tw),tI=t(73955),tS=t.n(tI),tP=t(7654),t_=t.n(tP),tk=function(e){return function(n){var t=+n.target.value;!t_()(t)&&!(t>=1e3)&&e({target:{value:t,name:n.target.name}})}},tq=t(15772),tD=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.daily.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value?"anyTimeOption":null}})},l=n.control,u=n.register;return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,i.jsx)(P.Z,{children:"every"}),(0,i.jsx)(nZ.Z,{fullWidth:!0,name:"repeat.daily.interval",inputRef:u,onChange:function(e){return tk(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(P.Z,{children:"day(s)"})]}),(0,i.jsx)(n_.Qr,{control:l,name:"repeat.daily.mode",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"any time",control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.daily.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),o&&(0,i.jsxs)(s.Z,{spacing:1,children:[(0,i.jsx)(P.Z,{children:"Between hours of"}),(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,children:[(0,i.jsx)(n_.Qr,{control:l,name:"repeat.daily.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.daily.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,i.jsx)(n_.Qr,{control:l,name:"repeat.daily.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.daily.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})};tD.propTypes={defaultOptions:g.object.isRequired,handleChange:g.func.isRequired};var tT=function(e){var n=e.defaultOptions,t=e.handleChange,o=n.register;return(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,i.jsx)(P.Z,{children:"every"}),(0,i.jsx)(nZ.Z,{fullWidth:!0,name:"repeat.hourly.interval",inputRef:o,onChange:function(e){return tk(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(P.Z,{children:"hours(s)"})]})};tT.propTypes={defaultOptions:g.object.isRequired,handleChange:g.func.isRequired};var tM=t(97871),tO=t(67574),tF=t(79717),tA={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},tE=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.monthly.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},l=n.control,u=n.register;return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"flex-start",columnGap:2,mt:2,children:[(0,i.jsx)(P.Z,{children:"every"}),(0,i.jsx)(nZ.Z,{fullWidth:!0,name:"repeat.monthly.interval",inputRef:u,onChange:function(e){return tk(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(P.Z,{children:"month(s)"})]}),(0,i.jsxs)(_.ZP,{container:!0,mt:2,children:[(0,i.jsx)(_.ZP,{item:!0,md:3,children:(0,i.jsx)(n_.Qr,{name:"repeat.monthly.mode",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsxs)(tF.Z,{sx:tA.radio,stackProps:{width:"100%",height:"100%"},value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.monthly.mode",value:n}})},children:[(0,i.jsx)(nJ.Z,{label:"on day",control:(0,i.jsx)(nY.Z,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(nJ.Z,{label:"on the",control:(0,i.jsx)(nY.Z,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(nJ.Z,{label:"any time (during month)",control:(0,i.jsx)(nY.Z,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,i.jsxs)(_.ZP,{item:!0,md:9,children:[(0,i.jsx)(n_.Qr,{name:"repeat.monthly.on.day",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{fullWidth:!0,value:n,disableClearable:!0,options:tM.e,onChange:function(e,n){t({target:{name:"repeat.yearly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{name:"repeat.yearly.onThe.which",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{fullWidth:!0,value:n,options:tO.HG,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(n_.Qr,{name:"repeat.yearly.onThe.day",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{fullWidth:!0,value:n,disableClearable:!0,options:tO.Ic,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===o&&(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(n_.Qr,{control:l,name:"repeat.monthly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"excluding weekends",control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.monthly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(s.Z,{spacing:1,children:[(0,i.jsx)(P.Z,{children:"Between hours of"}),(0,i.jsxs)(s.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(n_.Qr,{control:l,name:"repeat.monthly.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.monthly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,i.jsx)(n_.Qr,{control:l,name:"repeat.monthly.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.monthly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};tE.propTypes={defaultOptions:g.object.isRequired,handleChange:g.func.isRequired};var tR=function(e){var n=e.currentWeeklyDays,t=e.defaultOptions,o=e.handleChange,r=(0,e.watch)("repeat.weekly.mode"),l=function(e){Object.keys(n).forEach(function(e){return n[e]=!1}),e.forEach(function(e){n[e.value]=!0}),o({target:{value:n,name:"repeat.weekly.days"}})},u=function(e){var n,t=e.name;o({target:{name:t,value:e.value?"anyTimeOption":null}})},d=function(e){var n,t=e.name;o({target:{name:t,value:e.value}})},c=t.register,p=t.control;return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",spacing:2,mt:2,children:[(0,i.jsx)(P.Z,{children:"every"}),(0,i.jsx)(nZ.Z,{name:"repeat.weekly.interval",inputRef:c,onChange:function(e){return tk(o(e))},color:"secondary",size:"small"}),(0,i.jsx)(P.Z,{children:"week(s)"})]}),(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.weekly.days",control:p,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,limitTags:2,value:n,sx:{width:"100%",marginTop:"10px"},disabled:r,options:tO.$i,onChange:function(e,n){l(n),t(n)},size:"small",textFieldProps:{color:"secondary",label:"Day of the week"}})}}),(0,i.jsx)(n_.Qr,{control:p,name:"repeat.weekly.mode",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"any time",control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;u({name:"repeat.weekly.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),r&&(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(n_.Qr,{control:p,name:"repeat.weekly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"excluding weekends",control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;d({name:"repeat.weekly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(s.Z,{spacing:1,children:[(0,i.jsx)(P.Z,{children:"Between hours of"}),(0,i.jsxs)(s.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(n_.Qr,{control:p,name:"repeat.weekly.hourStart",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),o({target:{name:"repeat.weekly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,i.jsx)(n_.Qr,{control:p,name:"repeat.weekly.hourEnd",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),o({target:{name:"repeat.weekly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};tR.propTypes={currentWeeklyDays:g.object.isRequired,defaultOptions:g.object.isRequired,handleChange:g.func.isRequired,setValue:g.func.isRequired};var t$=t(89331),tN={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},tW=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.yearly.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},l=n.control;return(0,i.jsxs)(s.Z,{direction:"column",children:[(0,i.jsxs)(_.ZP,{container:!0,children:[(0,i.jsx)(_.ZP,{item:!0,md:4,mt:2,children:(0,i.jsx)(n_.Qr,{name:"repeat.yearly.mode",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsxs)(tF.Z,{sx:tN.radio,value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.yearly.mode",value:n}})},children:[(0,i.jsx)(nJ.Z,{label:"on",control:(0,i.jsx)(nY.Z,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(nJ.Z,{label:"on the",control:(0,i.jsx)(nY.Z,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(nJ.Z,{label:"any time (during month)",control:(0,i.jsx)(nY.Z,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,i.jsxs)(_.ZP,{item:!0,md:8,children:[(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.yearly.on.month",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{value:n,disableClearable:!0,options:t$.lb,onChange:function(e,n){tk(t({target:{name:"repeat.yearly.onThe.day",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.yearly.on.day",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{value:n,disableClearable:!0,options:tM.e,onChange:function(e,n){t({target:{name:"repeat.yearly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]}),(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.which",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{value:n,disableClearable:!0,options:tO.HG,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.day",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{value:n,options:tO.Ic,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.month",control:l,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(ed.q,{value:n,disableClearable:!0,options:t$.lb,onChange:function(e,n){tk(t({target:{name:"repeat.yearly.onThe.month",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===o&&(0,i.jsxs)(s.Z,{mt:2,rowGap:1,children:[(0,i.jsx)(n_.Qr,{control:l,name:"repeat.yearly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"excluding weekends",control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.yearly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(s.Z,{spacing:1,children:[(0,i.jsx)(P.Z,{children:"Between hours of"}),(0,i.jsxs)(s.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(n_.Qr,{control:l,name:"repeat.yearly.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.yearly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,i.jsx)(n_.Qr,{control:l,name:"repeat.yearly.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(tq.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.yearly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})]})};tW.propTypes={defaultOptions:g.object,handleChange:g.func};var tJ=function(e){var n=e.data,t=e.defaultOptions,o=e.handleChange,r=e.watch,a=t.control;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S.Z,{mt:2,children:(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"repeat.frequency",control:a,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{value:n,disableClearable:!0,options:tO.um,onChange:function(e,n){o({target:{name:"repeat.frequency",value:n.value}}),t(n)},textFieldProps:{color:"secondary",label:"Repeat"}})}})}),function(){switch(n.repeat.frequency){case"Yearly":return(0,i.jsx)(tW,{defaultOptions:t,handleChange:o,watch:r});case"Monthly":return(0,i.jsx)(tE,{defaultOptions:t,handleChange:o,watch:r});case"Weekly":return(0,i.jsx)(tR,{currentWeeklyDays:n.repeat.weekly.days,defaultOptions:t,handleChange:o,watch:r});case"Daily":return(0,i.jsx)(tD,{defaultOptions:t,handleChange:o,watch:r});case"Hourly":return(0,i.jsx)(tT,{defaultOptions:t,handleChange:o})}}()]})};tJ.propTypes={data:g.object.isRequired,defaultOptions:g.object.isRequired,handleChange:g.func.isRequired};var tL=function(e,n){var t=[];for(var o in e)!0===e[o]&&t.push(o);return n.filter(function(e){return t.includes(e.value)})},tB=function(e){return{"start.onDate.date":new Date(e.start.onDate.date),"repeat.frequency":{label:e.repeat.frequency,value:e.repeat.frequency},"repeat.yearly.mode":e.repeat.yearly.mode,"repeat.yearly.excludingWeekends":e.repeat.yearly.excludingWeekends,"repeat.yearly.hourStart":e.repeat.yearly.hourStart,"repeat.yearly.hourEnd":e.repeat.yearly.hourEnd,"repeat.yearly.on.month":{label:e.repeat.yearly.on.month,value:e.repeat.yearly.on.month},"repeat.yearly.on.day":{label:e.repeat.yearly.on.day,value:e.repeat.yearly.on.day},"repeat.yearly.onThe.which":{label:e.repeat.yearly.onThe.which,value:e.repeat.yearly.onThe.which},"repeat.yearly.onThe.day":{label:e.repeat.yearly.onThe.day,value:e.repeat.yearly.onThe.day},"repeat.yearly.onThe.month":{label:e.repeat.yearly.onThe.month,value:e.repeat.yearly.onThe.month},"repeat.monthly.interval":e.repeat.monthly.interval,"repeat.monthly.mode":e.repeat.monthly.mode,"repeat.monthly.excludingWeekends":e.repeat.monthly.excludingWeekends,"repeat.monthly.hourStart":e.repeat.monthly.hourStart,"repeat.monthly.hourEnd":e.repeat.monthly.hourEnd,"repeat.monthly.on.day":{label:e.repeat.monthly.on.day,value:e.repeat.monthly.on.day},"repeat.monthly.onThe.which":{label:e.repeat.monthly.onThe.which,value:e.repeat.monthly.onThe.which},"repeat.monthly.onThe.day":{label:e.repeat.monthly.onThe.day,value:e.repeat.monthly.onThe.day},"repeat.weekly.interval":e.repeat.weekly.interval,"repeat.weekly.mode":e.repeat.weekly.mode,"repeat.weekly.excludingWeekends":e.repeat.weekly.excludingWeekends,"repeat.weekly.hourStart":e.repeat.weekly.hourStart,"repeat.weekly.hourEnd":e.repeat.weekly.hourEnd,"repeat.weekly.days":tL(e.repeat.weekly.days,tO.$i),"repeat.daily.interval":e.repeat.daily.interval,"repeat.daily.mode":e.repeat.daily.mode,"repeat.daily.excludingWeekends":e.repeat.daily.excludingWeekends,"repeat.daily.hourStart":e.repeat.daily.hourStart,"repeat.daily.hourEnd":e.repeat.daily.hourEnd,"repeat.hourly.interval":e.repeat.hourly.interval,"end.mode":"On date","end.onDate.date":new Date(e.end.onDate.date)}},tY=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,o=tC()(t)?tS()("rrule-"):t,r={start:{onDate:{date:j()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:n}}},repeat:{frequency:e.repeat?e.repeat[0]:"Yearly",yearly:{mode:e.yearly||"on",on:{month:"Jan",day:1},onThe:{month:"Jan",day:"Monday",which:"First"},options:{modes:e.yearly}},monthly:{mode:e.monthly||"on",interval:1,on:{day:1},onThe:{day:"Monday",which:"First"},options:{modes:e.monthly}},weekly:{interval:1,days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},options:{weekStartsOnSunday:e.weekStartsOnSunday}},daily:{interval:1},hourly:{interval:1},options:{frequency:e.repeat}},end:{mode:"On date",onDate:{date:j()(),options:{weekStartsOnSunday:e.weekStartsOnSunday,calendarComponent:n}},options:{modes:e.end}},options:{hideStart:void 0===e.hideStart||e.hideStart,hideEnd:e.hideEnd,hideError:e.hideError,weekStartsOnSunday:e.weekStartsOnSunday},error:null};return{id:o,data:r,rrule:tn(r)}}({hideStart:!1},null,null),tH=function(e){var n=e.setValueParent,t=e.setOuterStartEndDates,o=e.setRRuleMeta,r=e.rruleMeta,u=e.frequency,d=(0,l.useState)(tZ(tY.data,u,r)),c=d[0],p=d[1],m=(0,n_.cI)({defaultValues:(0,a.Z)({},tB(c))}),h=m.control,f=m.errors,x=m.register,g=m.watch,b=m.reset,y=g("end.onDate.date"),Z=g("start.onDate.date"),w=j()(y).isSameOrBefore(Z);(0,l.useEffect)(function(){var e=tZ(tY.data,u,r);p((0,a.Z)({},e));var t=tn(e),i=t.rruleString,l=t.rruleText;o((0,a.Z)({},e)),n("frequency",i),n("frequencyDescription",l),b((0,a.Z)({},tB(e)))},[u,b,r,o,n]),(0,l.useEffect)(function(){t({scheduleStart:Z,scheduleEnd:y})},[Z,y,t]);var C=(0,l.useCallback)(function(e){var t=e.target,r=(0,a.Z)({},c);nQ()(r,t.name,t.value),p((0,a.Z)({},r));var i=tn(r),l=i.rruleString,s=i.rruleText;o((0,a.Z)({},r)),n("frequency",l),n("frequencyDescription",s)},[c,o,n]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("form",{id:"Form",style:{marginTop:"10px"},children:[(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,children:[(0,i.jsx)(n_.Qr,{name:"start.onDate.date",control:h,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(nH.M,{value:n,onChange:function(e){var n=j()(e).utc(!0).startOf("day").toDate();C({target:{name:"start.onDate.date",value:new Date(n)}}),o(new Date(n)),t(function(e){return(0,v.Z)((0,a.Z)({},e),{scheduleStart:new Date(n)})})},label:"Start date",renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}}),(0,i.jsx)(n_.Qr,{name:"end.onDate.date",control:h,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(nH.M,{value:n,errors:w?"":"End On should be less than start date",onChange:function(e){var n=j()(e).utc(!0).startOf("day").toDate();C({target:{name:"end.onDate.date",value:new Date(n)}}),o(new Date(n)),t(function(e){return(0,v.Z)((0,a.Z)({},e),{scheduleEnd:new Date(n)})})},label:"End date",renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}})]}),(0,i.jsx)(tJ,{data:c,defaultOptions:{control:h,errors:f,register:x,watch:g},handleChange:C,watch:g})]})})};tH.propTypes={defaultOptions:g.object.isRequired,setValueParent:g.func.isRequired,watchParent:g.func.isRequired};var tV=t(82749),tG=function(e){var n=e.postCode,t=e.country,o=tV.O.get(t),r=(null==n?void 0:n.match(o))||"";return{area:r[1],district:r&&r.length>2?r[2]:""}},tQ=function(e){var n,t,o,r,a=e.watchLocation,i=e.watchAssetsCategory,s=e.watchService,u=(0,l.useState)(""),d=u[0],c=u[1],p=(0,l.useState)(""),m=p[0],h=p[1],v=(0,l.useState)(""),x=v[0],g=v[1],b=(0,l.useState)(""),y=b[0],j=b[1],C=(0,l.useState)(""),I=C[0],S=C[1],P=(0,l.useState)(""),_=P[0],k=P[1],q=(0,l.useState)(""),D=q[0],T=q[1],M=(0,l.useState)(""),O=M[0],F=M[1],A=(0,l.useState)(""),E=A[0],R=A[1],$=(0,f.Z)((0,w.t)(ni._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==d?"%".concat(d,"%"):null}},limit:50,offset:0}}),2),N=$[0],W=$[1],J=W.loading,L=W.data,B=(void 0===L?{items:[]}:L).items,Y=(0,Z.aM)(na,{skip:!(null==a?void 0:a.value),variables:{locationId:null==a?void 0:a.value}}).data,H=(void 0===Y?{account:[]}:Y).account,V=(0,f.Z)((0,w.t)(ni.zR,{variables:{locationId:null==a?void 0:a.value,q:""!==m?"%".concat(m,"%"):null,limit:50,offset:0}}),2),G=V[0],Q=V[1],z=Q.loading,U=Q.data,K=(void 0===U?{items:[]}:U).items,X=(0,f.Z)((0,w.t)(ni.UM,{variables:{q:""!==x?"%".concat(x,"%"):null,limit:50,offset:0}}),2),ee=X[0],en=X[1],et=en.loading,eo=en.data,er=(void 0===eo?{items:[]}:eo).items,ea=(0,f.Z)((0,w.t)(ni.UH,{variables:{locationId:null==a?void 0:a.value,categoryId:null==i?void 0:i.value,q:""!==y?"%".concat(y,"%"):null,limit:50,offset:0}}),2),ei=ea[0],el=ea[1],es=el.loading,eu=el.data,ed=(void 0===eu?{items:[]}:eu).items,ec=(0,f.Z)((0,w.t)(ni._f,{variables:{where:{type:{_eq:"jobTags"},status:{_eq:"active"},name:{_ilike:""!==I?"%".concat(I,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"},includeMeta:!0}}),2),ep=ec[0],em=ec[1],eh=em.loading,ev=em.data,ef=(void 0===ev?{items:[]}:ev).items,ex=(0,f.Z)((0,w.t)(ni._f,{variables:{where:{type:{_eq:"costCategory"},status:{_eq:"active"},name:{_ilike:""!==_?"%".concat(_,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),eg=ex[0],eb=ex[1],ey=eb.loading,ej=eb.data,eZ=(void 0===ej?{items:[]}:ej).items,ew=(0,f.Z)((0,w.t)(ni.kx,{variables:{q:""!==D?"%".concat(D,"%"):null,limit:50,offset:0}}),2),eC=ew[0],eI=ew[1],eS=eI.loading,eP=eI.data,e_=(void 0===eP?{items:[]}:eP).items,ek=(0,f.Z)((0,w.t)(ni.Oq,{variables:{locationId:null==a?void 0:a.value,q:""!==E?"%".concat(E,"%"):null,limit:50,offset:0}}),2),eq=ek[0],eD=ek[1],eT=eD.loading,eM=eD.data,eO=(void 0===eM?{items:[]}:eM).items,eF=(0,Z.aM)(ni.nP,{skip:!(null==a?void 0:a.value),variables:{id:null==a?void 0:a.value}}).data,eA=(void 0===eF?{item:{}}:eF).item,eE=null==eA?void 0:null===(n=eA.registeredAddress)||void 0===n?void 0:n[0],eR=tG({postCode:null==eE?void 0:null===(t=eE.address)||void 0===t?void 0:t.postCode,country:null==eE?void 0:null===(o=eE.address)||void 0===o?void 0:null===(r=o.country)||void 0===r?void 0:r.code}),e$=(0,f.Z)((0,w.t)(ni.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eR?void 0:eR.area}},entity:{_eq:"Account"},status:{_eq:"active"}},ServiceSchedule:{status:{_eq:"active"},serviceId:{_eq:null==s?void 0:s.value},entity:{_eq:"Supplier"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eR?void 0:eR.area}}}},name:{_ilike:""!==O?"%".concat(O,"%"):null}},limit:50,offset:0}}),2),eN=e$[0],eW=e$[1],eJ=eW.loading,eL=eW.data;return{locationsProps:{onOpen:N,loading:J,options:B,setSearch:c},sublocationsProps:{onOpen:G,loading:z,options:K,setSearch:h},assetsCategoryProps:{onOpen:ee,loading:et,options:er,setSearch:g},assetsProps:{onOpen:ei,loading:es,options:ed,setSearch:j},shortDescriptionProps:{onOpen:ep,loading:eh,options:ef,setSearch:S},costCategoryProps:{onOpen:eg,loading:ey,options:eZ,setSearch:k},servicesProps:{onOpen:eC,loading:eS,options:e_,setSearch:T},supplierProps:{onOpen:eN,loading:eJ,options:(void 0===eL?{items:[]}:eL).items,setSearch:F},compliancesProps:{onOpen:eq,loading:eT,options:eO,setSearch:R},customer:null==H?void 0:H[0]}},tz=function(e,n,t){var o=nz.ZP.fromString(e.replace(/[\s\n]/gm,"\n")),r=o.origOptions,a=r.freq,i=r.until,l=r.dtstart,s=j()(l),u=o.all();t&&(s.day()===tO.p3.Saturday||s.day()===tO.p3.Sunday)&&s.add(s.day()===tO.p3.Saturday?2:1,"day");var d=1===j()(l).date(),c=s.isSame(l,"month");if(a===nz.Di.MONTHLY&&n&&!d&&c){var p=i?(0,L.Z)(u):u.slice(0,-1);return p.unshift(s),p}return a===nz.Di.YEARLY&&n?u.map(function(e,n){var o=j()(e);return n>0&&o.startOf("month"),t&&(o.day()===tO.p3.Saturday||o.day()===tO.p3.Sunday)&&o.add(o.day()===tO.p3.Saturday?2:1,"day"),o}):u},tU=function(e){var n,t,o,r,a,i,l,s,u=null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:null===(t=n.frequency)||void 0===t?void 0:null===(o=t.toLocaleLowerCase)||void 0===o?void 0:o.call(t);return{isAnyTime:(null==e?void 0:null===(r=e.repeat)||void 0===r?void 0:null===(a=r[u])||void 0===a?void 0:a.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(i=e.repeat)||void 0===i?void 0:null===(l=i[u])||void 0===l?void 0:l.excludingWeekends}},tK=t(83704),tX=t.n(tK);tX()(j());var t0={jobIds:function(e){var n;return null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.number}).join(", ")},jobName:function(e){var n;return null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.title}).join(", ")},jobStatus:function(e){var n;return null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.status}).join(", ")}},t1={service:function(e){var n;return null===(n=e.service)||void 0===n?void 0:n.name},supplier:function(e){var n;return null===(n=e.supplier)||void 0===n?void 0:n.name},manager:function(e){var n;return null===(n=e.manager)||void 0===n?void 0:n.fullName},customerManager:function(e){var n,t;return null===(n=e.customer)||void 0===n?void 0:null===(t=n.manager)||void 0===t?void 0:t.fullName},customer:function(e){var n;return null===(n=e.customer)||void 0===n?void 0:n.name},assetCategory:function(e){var n;return null===(n=e.assetCategory)||void 0===n?void 0:n.name},assets:function(e){var n,t;return null===(t=null===(n=e.assets)||void 0===n?void 0:n.map(function(e){return null==e?void 0:e.name}))||void 0===t?void 0:t.join(", ")},tags:function(e){var n,t;return null===(t=null===(n=e.tags)||void 0===n?void 0:n.map(function(e){return e.tag.name}))||void 0===t?void 0:t.join(", ")},scheduled:function(e){return e.timingStart},description:function(e){var n,t,o;return null===(n=e.shortJobDesc)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(o=t.taxonomy)||void 0===o?void 0:o.name}},t2=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[],r=e.map(function(e){return(0,a.Z)({},e,null!==(u=e.meta)&&void 0!==u?u:{})}),i=!0,l=!1,s=void 0;try{for(var u,d,c=r[Symbol.iterator]();!(i=(d=c.next()).done);i=!0){var p=d.value,m={},h=!0,v=!1,f=void 0;try{for(var x,g=n[Symbol.iterator]();!(h=(x=g.next()).done);h=!0){var b,y,j=x.value,Z=null;Z=t&&j.value in t?null!==(b=t[j.value](p))&&void 0!==b?b:"-":null!==(y=p[j.value])&&void 0!==y?y:"-",m[j.label]=Z}}catch(w){v=!0,f=w}finally{try{h||null==g.return||g.return()}finally{if(v)throw f}}o.push(m)}}catch(C){l=!0,s=C}finally{try{i||null==c.return||c.return()}finally{if(l)throw s}}return o},t3=function(e){var n,t,o,r,a,i,l,s,u,d,c=e.form,p=e.rruleMeta,m=e.dates,h=e.reportPassFailFeature,v=e.customerSignature,f=e.supplierSignature,x=e.startEndDates,g=e.adminId,b=e.customerId,y={};return y.meta={costCategoryId:null===(n=c.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=c.costCategory)||void 0===t?void 0:t.label,complianceSelect:c.complianceSelect,compliance:!!c.compliance,costCustomer:c.costCustomer,costSupplier:c.costSupplier,serviceId:c.service.value,serviceName:c.service.label,shortDescriptionId:c.shortDescription.value,shortDescriptionName:c.shortDescription.label,supplierId:null===(o=c.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=c.supplier)||void 0===r?void 0:r.label,customerSignature:v,supplierSignature:f,reportPassFail:h.reportPassFail,reportPassFailTitle:h.reportPassFailTitle,requireReportRecommendations:h.requireReportRecommendations,rruleMeta:p},y.assetCategoryId=null===(a=c.assetCategory)||void 0===a?void 0:a.value,y.dates=m,y.locationId=null===(i=c.location)||void 0===i?void 0:i.value,y.sublocationId=null===(l=c.sublocation)||void 0===l?void 0:l.value,y.frequency=c.frequency,y.frequencyDescription=c.frequencyDescription,y.reference=c.reference,y.customerMonthlyCharge=c.customerMonthlyCharge,y.supplierMonthlyCharge=c.supplierMonthlyCharge,y.firstInvoiceDate=c.firstInvoiceDate,y.finalInvoiceDate=c.finalInvoiceDate,y.invoiceBasis=c.invoicingType,y.scheduleStart=x.scheduleStart,y.scheduleEnd=x.scheduleEnd,y.description=c.description,y.adminId=g,y.customerId=b,(null===(s=c.assets)||void 0===s?void 0:s.length)>0&&(y.Assets={data:c.assets.map(function(e){return{status:"active",entity:"JobSchedule",assetId:e.value}})}),(null===(u=c.tags)||void 0===u?void 0:u.length)>0&&(y.Taxonomy={data:null===(d=c.tags)||void 0===d?void 0:d.map(function(e){return{entity:"JobSchedule",taxonomyId:e.tag.id}})}),c.estimatedDuration&&c.estimatedDurationUnit&&(y.estimatedDuration=j().duration(c.estimatedDuration,c.estimatedDurationUnit).as("milliseconds"),y.estimatedDurationUnit=c.estimatedDurationUnit),y},t5=function(e){var n,t,o,r,a,i,l,s=e.form,u=e.rruleMeta,d=e.dates,c=e.reportPassFailFeature,p=e.customerSignature,m=e.supplierSignature,h=e.startEndDates,v={};return v.meta={costCategoryId:null===(n=s.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=s.costCategory)||void 0===t?void 0:t.label,complianceSelect:s.complianceSelect,compliance:!!s.compliance,costCustomer:s.costCustomer,costSupplier:s.costSupplier,serviceId:s.service.value,serviceName:s.service.label,shortDescriptionId:s.shortDescription.value,shortDescriptionName:s.shortDescription.label,supplierId:null===(o=s.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=s.supplier)||void 0===r?void 0:r.label,customerSignature:p,supplierSignature:m,reportPassFail:c.reportPassFail,reportPassFailTitle:c.reportPassFailTitle,requireReportRecommendations:c.requireReportRecommendations,rruleMeta:u},v.assetCategoryId=null===(a=s.assetCategory)||void 0===a?void 0:a.value,v.dates=d,v.locationId=null===(i=s.location)||void 0===i?void 0:i.value,v.sublocationId=null===(l=s.sublocation)||void 0===l?void 0:l.value,v.frequency=s.frequency,v.frequencyDescription=s.frequencyDescription,v.reference=s.reference,v.customerMonthlyCharge=s.customerMonthlyCharge,v.supplierMonthlyCharge=s.supplierMonthlyCharge,v.firstInvoiceDate=s.firstInvoiceDate,v.finalInvoiceDate=s.finalInvoiceDate,v.invoiceBasis=s.invoicingType,v.assets=s.assets,v.scheduleStart=h.scheduleStart,v.scheduleEnd=h.scheduleEnd,v.description=s.description,s.estimatedDuration&&s.estimatedDurationUnit&&(v.estimatedDuration=j().duration(s.estimatedDuration,s.estimatedDurationUnit).as("milliseconds"),v.estimatedDurationUnit=s.estimatedDurationUnit),v},t6=function(e){var n,t,o,r,a,i,l,s,u,d,c,p,m,h,v,f,x,g,b,y,Z,w,C=e.jobSchedule;return{location:{value:C.location.id,label:C.location.name},sublocation:C.sublocation?{value:C.sublocation.id,label:C.sublocation.name}:null,frequency:C.frequency,frequencyDescription:C.frequencyDescription,reference:C.reference,customerMonthlyCharge:C.customerMonthlyCharge,supplierMonthlyCharge:C.supplierMonthlyCharge,firstInvoiceDate:C.firstInvoiceDate,finalInvoiceDate:C.finalInvoiceDate,invoicingType:C.invoiceBasis,estimatedDuration:C.estimatedDuration?j().duration(C.estimatedDuration,"milliseconds").as(C.estimatedDurationUnit):null,estimatedDurationUnit:C.estimatedDurationUnit,assetCategory:C.assetCategory?{value:null===(n=C.assetCategory)||void 0===n?void 0:n.id,label:null===(t=C.assetCategory)||void 0===t?void 0:t.name}:null,assets:(null===(o=C.assets)||void 0===o?void 0:o.map(function(e){var n=e.asset;return{value:n.id,label:n.name}}))||[],costCategory:(null===(r=C.meta)||void 0===r?void 0:r.costCategoryId)?{value:null===(a=C.meta)||void 0===a?void 0:a.costCategoryId,label:null===(i=C.meta)||void 0===i?void 0:i.costCategoryName}:null,complianceSelect:null===(l=C.meta)||void 0===l?void 0:l.complianceSelect,compliance:null===(s=C.meta)||void 0===s?void 0:s.compliance,costCustomer:null===(u=C.meta)||void 0===u?void 0:u.costCustomer,costSupplier:null===(d=C.meta)||void 0===d?void 0:d.costSupplier,description:C.description,service:{value:null===(c=C.meta)||void 0===c?void 0:c.serviceId,label:null===(p=C.meta)||void 0===p?void 0:p.serviceName},shortDescription:{value:null===(m=C.meta)||void 0===m?void 0:m.shortDescriptionId,label:null===(h=C.meta)||void 0===h?void 0:h.shortDescriptionName},supplier:(null===(v=C.meta)||void 0===v?void 0:v.supplierId)?{value:null===(f=C.meta)||void 0===f?void 0:f.supplierId,label:null===(x=C.meta)||void 0===x?void 0:x.supplierName}:null,customerSignature:null===(g=C.meta)||void 0===g?void 0:g.customerSignature,supplierSignature:null===(b=C.meta)||void 0===b?void 0:b.supplierSignature,reportPassFail:null===(y=C.meta)||void 0===y?void 0:y.reportPassFail,reportPassFailTitle:null===(Z=C.meta)||void 0===Z?void 0:Z.reportPassFailTitle,requireReportRecommendations:null===(w=C.meta)||void 0===w?void 0:w.requireReportRecommendations}},t4=function(e){var n,t=e.oldData,o=e.data;if(!t.jobs.length)return{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1};var r=t9(t.dates,o.dates)||t.frequency!==o.frequency,a=o.meta.supplierId!==(null===(n=t.meta)||void 0===n?void 0:n.supplierId);return a||r?{isConfirm:!0,isSupplierChanged:a,isDatesChanged:r}:{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1}},t9=function(e,n){return Array.isArray(e)?!(e.length===n.length&&n.every(function(n,t){var o=n.date,r=n.selected;return e[t].selected===r&&j()(e[t].date).isSame(o)})):!n.every(function(e){return e.selected})},t7=t(62551),t8=t(22927),oe=function(e){var n=e.onClose,t=e.onConfirm,o=(0,V.Z)("(max-width:600px)");return(0,i.jsx)(on,{is600pxOrLess:o,children:(0,i.jsxs)(s.Z,{spacing:2,alignItems:"center",width:"100%",children:[(0,i.jsx)(t8.Z,{color:"error",sx:{fontSize:32}}),(0,i.jsx)(P.Z,{variant:"h6",fontWeight:700,children:"Do you confirm to change frequency?"}),(0,i.jsxs)(s.Z,{direction:"row",justifyContent:"center",width:"100%",spacing:2,children:[(0,i.jsx)(q.Z,{variant:"outlined",color:"black",onClick:n,children:"Cancel"}),(0,i.jsx)(q.Z,{variant:"contained",color:"secondary",onClick:function(){n(),t()},children:"Confirm"})]})]})})};oe.propTypes={onClose:b().func.isRequired,onConfirm:b().func.isRequired},oe.defaultProps={onClose:function(){},onConfirm:function(){}};var on=(0,d.ZP)(u.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"auto",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}}),ot=t(92321),oo=t(96486),or=t(11961),oa=t(93362),oi=t(78462),ol=t(18972),os=t(14564),ou=t(10166),od=t(28864),oc=t(51738),op=t(11975),om=(0,oa.D)(),oh=function(e){var n=e.entityId,t=e.entity,o=e.values,r=void 0===o?[]:o,u=e.name,d=void 0===u?"tags":u,c=e.setValue,p=e.followingEntity,m=e.followingEntityIds,g=void 0===m?[]:m,b=(0,er.x)().user,y=(0,l.useState)(null),j=y[0],w=y[1],I=(0,l.useState)(""),P=I[0],_=I[1],q=(0,l.useState)(""),D=q[0],M=q[1],O=(0,l.useState)(""),F=O[0],A=O[1],E=(0,Z.aM)(oc.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){c(d,e.tags)}}),R=E.data,$=(void 0===R?{tags:[]}:R).tags,N=E.loading,W=(0,Z.aM)(oc.gI,{skip:!j,variables:{entityId:n,entity:t,q:""!==F?"%".concat(F,"%"):null}}),J=W.data,B=(void 0===J?{tags:[]}:J).tags,Y=W.loading,H=(0,f.Z)((0,C.D)(oc.Zm,{refetchQueries:["GetAllTags"]}),2),V=H[0],G=H[1].loading,Q=(0,f.Z)((0,C.D)(oc.C3,{refetchQueries:["GetEntityTags"]}),2),z=Q[0],U=Q[1].loading,K=(0,f.Z)((0,C.D)(oc.cS,{refetchQueries:["GetEntityTags"]}),2),X=K[0],ee=K[1].loading,en=(0,f.Z)((0,C.D)(oc.Aw),1)[0],et=(0,f.Z)((0,C.D)(oc.g$,{refetchQueries:["GetAllTags"]}),2),eo=et[0],ea=et[1].loading;(0,l.useEffect)(function(){var e=setTimeout(function(){A(D)},500);return function(){return clearTimeout(e)}},[D]);var ei,el,es,eu,ed=function(e){e.stopPropagation(),w(e.currentTarget)},ec=function(){w(null)},ep=(ei=(0,h.Z)(function(e,o){var a,i,l,s,u,m,h,v;return(0,x.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof o)return[3,1];return _({label:o}),[3,7];case 1:if(!(o&&o.inputValue&&n))return[3,3];return[4,z({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:b.adminId}}}]}})];case 2:return l=e.sent().data.insert_Taxonomy_Entity,u=(0,f.Z)(l.returning,1)[0].taxonomyId,g.length>0&&z({variables:{objects:g.map(function(e){return{entity:p,entityId:e,taxonomyId:u}})}}),_(null),[3,7];case 3:if(!(o&&o.value&&n))return[3,4];return z({variables:{objects:[{entity:t,entityId:n,taxonomyId:o.value}].concat((0,L.Z)(g.map(function(e){return{entity:p,entityId:e,taxonomyId:o.value}})))}}),_(null),[3,7];case 4:if(!(o&&o.inputValue))return[3,6];return[4,V({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:b.adminId}]}})];case 5:return v=e.sent().data.insert_Taxonomy,c(d,(0,L.Z)(r).concat([{id:null,tag:{id:v.returning[0].id,name:v.returning[0].name,meta:v.returning[0].meta}}])),_(null),[3,7];case 6:o&&o.value&&(c(d,(0,L.Z)(r).concat([{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),_(null)),e.label=7;case 7:return[2]}})}),function(e,n){return ei.apply(this,arguments)}),em=(0,l.useCallback)(function(e,n){var t=om(e,n),o=n.inputValue,r=e.some(function(e){return o===e.label});return""===o||r||t.push({inputValue:o,label:'Add "'.concat(o,'"')}),t},[]),eh=(0,l.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ev=(el=(0,h.Z)(function(e){var t,o,a,i;return(0,x.__generator)(this,function(t){switch(t.label){case 0:if(!n)return[3,2];return[4,X({variables:{tagEntityId:e}})];case 1:return a=t.sent().data.delete_Taxonomy_Entity_by_pk.taxonomyId,g.length>0&&en({variables:{where:{taxonomyId:{_eq:a},entity:{_eq:p},entityId:{_in:g}}}}),[3,3];case 2:c(d,r.filter(function(n,t){return t!==e})),t.label=3;case 3:return[2]}})}),function(e){return el.apply(this,arguments)}),ef=(es=(0,h.Z)(function(e){var n,t,o,i,l,s;return(0,x.__generator)(this,function(t){switch(t.label){case 0:return[4,eo({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return l=t.sent().data.update_Taxonomy_by_pk,c(d,r.map(function(e){return e.tag.id===n?(0,v.Z)((0,a.Z)({},e),{tag:(0,a.Z)({},l)}):e})),[2]}})}),function(e){return es.apply(this,arguments)}),ex=(eu=(0,h.Z)(function(e){var n,t,o,i,l,s;return(0,x.__generator)(this,function(o){switch(o.label){case 0:return[4,eo({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return l=o.sent().data.update_Taxonomy_by_pk,c(t,r.map(function(e){return e.tag.id===n?(0,v.Z)((0,a.Z)({},e),{tag:(0,a.Z)({},l)}):e})),[2]}})}),function(e){return eu.apply(this,arguments)}),eg=Boolean(j),eb=(0,l.useMemo)(function(){return B.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[B]),ey=(0,l.useMemo)(function(){return oo.uniqBy((0,L.Z)($).concat((0,L.Z)(r)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[$,r]);return(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(op.P,{tags:ey,handleDeleteTagEntity:ev}),(0,i.jsx)(ov,{id:eg?"tags-popover":void 0,open:eg,anchorEl:j,onClose:ec,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,i.jsxs)(S.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,i.jsx)(nj.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,L.Z)(eb),value:P,onChange:ep,onInputChange:function(e,n){M(n)},filterOptions:em,getOptionLabel:eh,renderOption:function(e,n){return(0,i.jsx)(ol.Z,(0,v.Z)((0,a.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,v.Z)((0,a.Z)({},e.InputProps),{endAdornment:(0,i.jsxs)(i.Fragment,{children:[Y||G||U?(0,i.jsx)(T.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),N||ee||ea?(0,i.jsx)(s.Z,{width:"100%",alignItems:"center",p:4,children:(0,i.jsx)(T.Z,{color:"secondary"})}):(0,i.jsx)(oi.Z,{children:null==ey?void 0:ey.map(function(e,n){var t;return(0,i.jsx)(od.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:ev,onColorChange:ef,onNameChange:ex})})})]})}),(0,i.jsx)(k.Z,{color:"black",onClick:ed,children:(0,i.jsx)(or.Z,{sx:{height:"16px",width:"16px"}})})]})};oh.defaultProps={entityId:null},oh.propTypes={entityId:b().number,entity:b().string.isRequired,values:b().array,name:b().string,setValue:b().func.isRequired,followingEntity:b().string,followingEntityIds:b().array};var ov=(0,ou.Z)(os.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}}),of=t(28591);tX()(j());var ox={accordion:function(e){return{backgroundColor:"transparent",border:"1px solid ".concat(e?"#36CF57":"#9E9E9E")}},multilineTextField:{width:"100%",minHeight:"150px",textarea:{minHeight:"150px"}},adornment:{borderRadius:"50%",backgroundColor:"#9E9E9E",color:"#fff",padding:"0 7px",marginRight:"20px"},groupedSelector:{slotProps:{popper:{sx:{"& .MuiAutocomplete-groupLabel":{height:"30px",lineHeight:"30px",backgroundColor:"#f5f5f5",fontWeight:700}}}}}},og=function(e){var n,t,o,r=e.jobScheduleId,u=e.locationId,d=e.locationName,c=e.edit,p=e.onClose,m=(0,l.useState)(!1),g=m[0],b=m[1],y=(0,l.useState)(null),w=y[0],I=y[1],k=(0,l.useRef)(!0),M=(0,nR.D)(),O=(0,f.Z)((0,t7.d)(),2),F=O[0],A=O[1],E=(0,er.x)(),R=E.hasRole,$=E.user,N=(0,l.useState)("onCompletion"),W=N[0],J=N[1],L=(0,V.Z)("(max-width: 600px)"),B=(0,n_.cI)({resolver:(0,nk.S)(nF),defaultValues:(0,v.Z)((0,a.Z)({},ob,u&&{location:{value:u,label:d}}),{estimatedDuration:j().duration(54e5,"milliseconds").as("minutes"),estimatedDurationUnit:"minutes",firstInvoiceDate:"fixedMonthlyAmount"===W?new Date:null})}),Y=B.control,H=B.watch,G=B.register,Q=B.setValue,z=B.getValues,U=B.handleSubmit,K=B.errors,X=B.reset,ee=z("shortDescription"),en=H("location"),et=H("compliance"),eo=H("assetCategory"),ea=H("tags"),ei=H("frequency"),el=H("service"),es=H(),eu=tQ({watchLocation:en,watchAssetsCategory:eo,watchService:el}),ec=eu.locationsProps,ep=eu.assetsCategoryProps,em=eu.assetsProps,eh=eu.shortDescriptionProps,ev=eu.servicesProps,ef=eu.sublocationsProps,ex=eu.costCategoryProps,eg=eu.supplierProps,eb=eu.compliancesProps,ey=eu.customer,ej=(0,l.useState)([]),eZ=ej[0],ew=ej[1],eC=(0,l.useState)({scheduleStart:null,scheduleEnd:null}),eI=eC[0],eS=eC[1],eP=(0,l.useState)(null),e_=eP[0],ek=eP[1],eq=(0,l.useState)([]),eD=eq[0],eT=eq[1],eM=(0,l.useState)({reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:!1}),eO=eM[0],eF=eM[1],eA=(0,l.useState)(!1),eE=eA[0],eR=eA[1],e$=(0,l.useState)(!1),eN=e$[0],eW=e$[1],eJ=tU(e_),eL=eJ.isAnyTime,eY=eJ.excludingWeekends,eH=(0,Z.aM)(eB,{skip:!r,variables:{jobScheduleId:r},onCompleted:function(e){var n,t,o=e.jobSchedule,r=t6({jobSchedule:o});X((0,a.Z)({},r)),ek(null===(n=o.meta)||void 0===n?void 0:n.rruleMeta),J(o.invoiceBasis),(null===(t=o.dates)||void 0===t?void 0:t.length)>0&&eT(o.dates)}}),eV=eH.data,eG=(void 0===eV?{jobSchedule:{}}:eV).jobSchedule,eQ=eH.loading,ez=(0,f.Z)((0,C.D)(e0,{refetchQueries:["GetJobSchedules"],onCompleted:function(){M.show({content:"Job schedule was added.",severity:"success"}),p()},onError:function(e){M.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eU=ez[0],eK=ez[1].loading,eX=(0,f.Z)((0,C.D)(e1,{refetchQueries:["GetJobSchedules"],onCompleted:function(){M.show({content:"Job schedule was updated.",severity:"success"}),p()},onError:function(e){M.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),e2=eX[0],e3=eX[1].loading;(0,l.useEffect)(function(){var e,n=(e={location:null==es?void 0:es.location,shortDescription:null==es?void 0:es.shortDescription,description:null==es?void 0:es.description,estimatedDuration:null==es?void 0:es.estimatedDuration,estimatedDurationUnit:null==es?void 0:es.estimatedDurationUnit,costCategory:null==es?void 0:es.costCategory,service:null==es?void 0:es.service,supplier:null==es?void 0:es.supplier,frequency:null==es?void 0:es.frequency,frequencyDescription:null==es?void 0:es.frequencyDescription,costCustomer:null==es?void 0:es.costCustomer,costSupplier:null==es?void 0:es.costSupplier,customerMonthlyCharge:null==es?void 0:es.customerMonthlyCharge,supplierMonthlyCharge:null==es?void 0:es.supplierMonthlyCharge,firstInvoiceDate:null==es?void 0:es.firstInvoiceDate,finalInvoiceDate:null==es?void 0:es.finalInvoiceDate,invoicingBasis:W},nC.map(function(n){return Object.entries(e).filter(function(t){var o=(0,f.Z)(t,2),r=o[0],a=o[1];return n.requiredFields(e).includes(r)&&!!a}).length===n.requiredFields(e).length?n.value:null}).filter(Boolean));ew(n)},[W,null==es?void 0:es.costCategory,null==es?void 0:es.costCustomer,null==es?void 0:es.costSupplier,null==es?void 0:es.customerMonthlyCharge,null==es?void 0:es.description,null==es?void 0:es.estimatedDuration,null==es?void 0:es.estimatedDurationUnit,null==es?void 0:es.finalInvoiceDate,null==es?void 0:es.firstInvoiceDate,null==es?void 0:es.frequency,null==es?void 0:es.frequencyDescription,null==es?void 0:es.location,null==es?void 0:es.service,null==es?void 0:es.shortDescription,null==es?void 0:es.supplier,null==es?void 0:es.supplierMonthlyCharge]),(0,l.useEffect)(function(){if(ei){if(Array.isArray(null==eG?void 0:eG.dates)&&k.current){k.current=!1;return}var e=tz(ei,eL,eY).slice(0,355).map(function(e){return{date:e,selected:!0}});eT(e)}},[ei,eY,eL,eG.frequency,null==eG?void 0:eG.dates]);var e5=(o=(0,h.Z)(function(e){var n,t,o,r,i;return(0,x.__generator)(this,function(l){switch(l.label){case 0:return delete e.sublocation,delete e.formSubmission,r=t3({form:(0,v.Z)((0,a.Z)({},e),{invoicingType:W}),rruleMeta:e_,dates:eD,jobScheduleId:null,reportPassFailFeature:eO,customerSignature:eE,supplierSignature:eN,startEndDates:eI,adminId:$.adminId,customerId:ey.id}),[4,eU({variables:{objects:[r]}})];case 1:return(null===(o=null==(i=l.sent())?void 0:null===(n=i.data)||void 0===n?void 0:null===(t=n.insert_JobSchedule)||void 0===t?void 0:t.returning[0])||void 0===o?void 0:o.id)&&(I(i.data.insert_JobSchedule.returning[0].id),b(!0)),[2]}})}),function(e){return o.apply(this,arguments)}),e6=function(e){delete e.formSubmission;var n=t5({form:(0,v.Z)((0,a.Z)({},e),{invoicingType:W}),rruleMeta:e_,dates:eD,jobScheduleId:r,reportPassFailFeature:eO,customerSignature:eE,supplierSignature:eN,startEndDates:eI});t4({oldData:eG,data:n}).isConfirm?A({content:function(e){var t=e.onClose;return(0,i.jsx)(oe,{onClose:t,onConfirm:function(){e2({variables:{data:(0,v.Z)((0,a.Z)({},n),{id:r})}}),b(!0)}})}}):(e2({variables:{data:(0,v.Z)((0,a.Z)({},n),{id:r})}}),b(!0))},e4=function(e,n){eT(function(t){return t.map(function(t,o){return o===n?(0,v.Z)((0,a.Z)({},t),{selected:e.target.checked}):t})})},e9=function(e){eT(function(n){return n.map(function(n){return(0,v.Z)((0,a.Z)({},n),{selected:e.target.checked})})})},e7=function(e){return function(){J(e)}},e8=function(e){var n;if("object"==typeof(null==e?void 0:null===(n=e.meta)||void 0===n?void 0:n.template)){var t=e.meta.template,o=t.description,r=t.costCategorySelected,a=t.serviceSelected,i=t.amount,l=t.supplierLabourAmount,s=t.tags,u=t.reportPassFail,d=t.reportPassFailTitle,p=t.requireReportRecommendations,m=t.customerSignature,h=t.supplierSignature;Q("description",o),r&&Q("costCategory",{value:r.value,label:r.label}),a&&Q("service",{value:a.value,label:a.label}),"onCompletion"===W&&(i&&Q("costCustomer",i),l&&Q("costSupplier",l)),(null==s?void 0:s.length)>0&&!c&&Q("tags",s),eF({reportPassFail:Boolean(u),reportPassFailTitle:d||null,requireReportRecommendations:Boolean(p)}),eR(Boolean(m)),eW(Boolean(h))}},ne=(0,l.useMemo)(function(){return eD.map(function(e,n){var t=e.date,o=e.selected;return{date:t,id:n,weekDay:j()(t).format("ddd"),day:j()(t).format("DD"),month:j()(t).format("MMM"),year:j()(t).format("YYYY"),selected:o}})},[eD]),nn=function(e){var n=e.step;return eZ.includes(n)||c?(0,i.jsx)(nW.Z,{sx:{color:"#36CF57",marginRight:"20px"}}):(0,i.jsx)(S.Z,{sx:ox.adornment,children:n})};return(0,i.jsxs)(i.Fragment,{children:[F,(0,i.jsx)(D.Z,{open:eQ||eK||e3,sx:{zIndex:1e4},children:(0,i.jsx)(T.Z,{color:"secondary"})}),(0,i.jsxs)("form",{id:"addJobScheduleForm",onSubmit:U(c?e6:e5),children:[(0,i.jsxs)(_.ZP,{container:!0,columnSpacing:2,children:[(0,i.jsxs)(_.ZP,{item:!0,xs:12,md:6,children:[(0,i.jsx)(nV.s,{headerAdornment:function(){return(0,i.jsx)(nn,{step:1})},title:"Set location",accordionSummarySx:ox.accordion(eZ.includes(1)||c),children:(0,i.jsxs)(s.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{name:"location",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,disabled:c||u,sx:ox.selector,value:n},ec),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Location",error:null==K?void 0:K.location}}))}}),(0,i.jsx)(n_.Qr,{name:"sublocation",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n,sx:ox.selector,disabled:!(null==en?void 0:en.value)},ef),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Sublocation"}}))}}),(0,i.jsx)(n_.Qr,{name:"assetCategory",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n,sx:ox.selector},ep),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset category"}}))}}),(0,i.jsx)(n_.Qr,{name:"assets",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,multiple:!0,value:n,sx:ox.selector,disabled:!(null==eo?void 0:eo.value)},em),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset information"}}))}})]})}),(0,i.jsx)(nV.s,{headerAdornment:function(){return(0,i.jsx)(nn,{step:2})},title:"Work description",accordionSummarySx:ox.accordion(eZ.includes(2)||c),children:(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",flexWrap:"wrap",columnGap:2,rowGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{name:"shortDescription",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n,sx:ox.selector,onChange:function(e,n){t(n),e8(n)}},eh),{textFieldProps:{color:"secondary",label:"Short job description",error:null==K?void 0:K.shortDescription}}))}}),(0,i.jsx)(of.i,{isSubmit:g,control:Y,errors:K,register:G,setValue:Q,entity:"jobSchedule",entityId:w||r,hasPreview:!0,linkedTo:{entity:"Taxonomy",entityId:null==ee?void 0:ee.value}}),(0,i.jsx)(nZ.Z,{fullWidth:!0,color:"secondary",inputRef:G,name:"reference",sx:ox.textField,placeholder:"Customer reference"}),(0,i.jsx)(nZ.Z,{fullWidth:!0,multiline:!0,color:"secondary",inputRef:G,name:"description",sx:ox.multilineTextField,error:null==K?void 0:K.description,placeholder:"Work description"}),(0,i.jsx)(nZ.Z,{type:"number",color:"secondary",inputRef:G,name:"estimatedDuration",placeholder:"Estimated duration",error:null==K?void 0:K.estimatedDuration,sx:{width:"40%"}}),(0,i.jsx)(n_.Qr,{name:"estimatedDurationUnit",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ot.P,{formControl:{fullWidth:!0,variant:"outlined",color:"secondary",error:K.estimatedDurationUnit,sx:{width:"calc(60% - 16px)"}},selectProps:{fullWidth:!0},label:"Duration unit",value:n,onChange:t,options:[{label:"Hours",value:"hours"},{label:"Minutes",value:"minutes"},{label:"Days",value:"days"}]})}}),(0,i.jsx)(n_.Qr,{control:Y,name:"compliance",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{label:"Compliance",sx:{width:"100%"},control:(0,i.jsx)(nq.Z,{checked:n,color:"secondary",onChange:function(e){var n;return t(null===(n=e.target)||void 0===n?void 0:n.checked)}})})}}),et&&(null==en?void 0:en.value)&&(0,i.jsx)(n_.Qr,{control:Y,name:"complianceSelect",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n},eb,ox.groupedSelector),{groupBy:function(e){return e.category.label},onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Compliances",error:null==K?void 0:K.complianceSelect}}))}}),R("admin")&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(P.Z,{mr:1,children:"Tags: "}),(0,i.jsx)(oh,{values:ea,setValue:Q,name:"tags",entity:"JobSchedule",entityId:r,followingEntity:"Job",followingEntityIds:null===(n=eG.jobs)||void 0===n?void 0:n.map(function(e){return e.id})})]})]})}),(0,i.jsx)(nV.s,{headerAdornment:function(){return(0,i.jsx)(nn,{step:3})},title:"Select service",accordionSummarySx:ox.accordion(eZ.includes(3)||c),children:(0,i.jsxs)(s.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,i.jsx)(n_.Qr,{name:"costCategory",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n,sx:ox.selector},ex),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Cost category",error:null==K?void 0:K.costCategory}}))}}),(0,i.jsx)(n_.Qr,{fullWidth:!0,name:"service",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,value:n,sx:ox.selector},ev),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Service",error:null==K?void 0:K.service}}))}}),(0,i.jsx)(n_.Qr,{name:"supplier",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({fullWidth:!0,disabled:!(null==el?void 0:el.value)||!(null==en?void 0:en.value),value:n},eg),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Supplier",error:null==K?void 0:K.supplier}}))}})]})}),(0,i.jsx)(nV.s,{headerAdornment:function(){return(0,i.jsx)(nn,{step:4})},title:"Set schedule",accordionSummarySx:ox.accordion(eZ.includes(4)||c),children:(0,i.jsxs)(s.Z,{rowGap:2,children:[(0,i.jsx)(tH,{defaultOptions:{register:G,watch:H,control:Y},setValueParent:Q,watchParent:H,setRRuleMeta:ek,setOuterStartEndDates:eS,rruleMeta:null===(t=eG.meta)||void 0===t?void 0:t.rruleMeta,frequency:null==eG?void 0:eG.frequency}),(0,i.jsx)(nZ.Z,{multiline:!0,color:"secondary",variant:"filled",inputRef:G,name:"frequencyDescription",label:"Frequency description",sx:ox.multilineTextField,InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}})]})}),(0,i.jsxs)(nV.s,{headerAdornment:function(){return(0,i.jsx)(nn,{step:5})},title:"Invoicing",accordionSummarySx:ox.accordion(eZ.includes(5)||c),children:[(0,i.jsxs)(s.Z,{direction:"row",children:[(0,i.jsx)(nJ.Z,{label:"On completion",control:(0,i.jsx)(nY.Z,{color:"secondary",checked:"onCompletion"===W,onChange:e7("onCompletion")})}),(0,i.jsx)(nJ.Z,{label:"Fixed monthly amount",control:(0,i.jsx)(nY.Z,{color:"secondary",checked:"fixedMonthlyAmount"===W,onChange:e7("fixedMonthlyAmount")})})]}),"onCompletion"===W&&(0,i.jsxs)(s.Z,{rowGap:2,mt:2,children:[(0,i.jsx)(nZ.Z,{inputRef:G,name:"costCustomer",color:"secondary",type:"number",placeholder:"Customer cost per visit",InputProps:{startAdornment:(0,i.jsx)(nB.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(nB.Z,{position:"end",children:"Ex VAT"})}}),(0,i.jsx)(nZ.Z,{inputRef:G,name:"costSupplier",color:"secondary",type:"number",placeholder:"Supplier cost per visit",InputProps:{startAdornment:(0,i.jsx)(nB.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(nB.Z,{position:"end",children:"Ex VAT"})}})]}),"fixedMonthlyAmount"===W&&(0,i.jsxs)(s.Z,{spacing:2,mt:2,width:"100%",children:[(0,i.jsxs)(s.Z,{direction:"row",width:"100%",spacing:1,children:[(0,i.jsx)(n_.Qr,{name:"firstInvoiceDate",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of first invoice",renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}}),(0,i.jsx)(n_.Qr,{name:"finalInvoiceDate",control:Y,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of final invoice",renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}})]}),(0,i.jsx)(nZ.Z,{inputRef:G,name:"customerMonthlyCharge",color:"secondary",type:"number",placeholder:"Monthly customer charge",InputProps:{startAdornment:(0,i.jsx)(nB.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(nB.Z,{position:"end",children:"Ex VAT"})}}),(0,i.jsx)(nZ.Z,{inputRef:G,name:"supplierMonthlyCharge",color:"secondary",type:"number",placeholder:"Monthly supplier charge",InputProps:{startAdornment:(0,i.jsx)(nB.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(nB.Z,{position:"end",children:"Ex VAT"})}})]})]}),(0,i.jsx)(q.Z,{sx:{marginLeft:"calc(100% - 100px)",width:"100px",marginTop:"20px"},color:"secondary",type:"submit",variant:"contained",children:c?"Save":"Add item"})]}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:6,mt:L?3:0,children:(0,i.jsx)(nD.i,{width:"100%",getRowClassName:function(e){return e.row.id%2==0?"even":"odd"},columnHeaderHeight:35,rowHeight:35,columns:[{width:30,field:"date",renderHeader:function(){return(0,i.jsx)(nL.Z,{title:"To skip or remove jobs from the PPM schedule to be created,\n             deselect the relevant lines below",slotProps:{popper:{sx:{zIndex:1e4}}},children:(0,i.jsx)(nq.Z,{color:"secondary",checked:eD.every(function(e){return e.selected}),onChange:function(e){return e9(e)}})})},sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(nq.Z,{color:"secondary",checked:n.selected,onChange:function(e){return e4(e,n.id)}})}},{flex:1,field:"id",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.id+1}},{flex:1,field:"weekDay",headerName:"Day of week",sortable:!1},{flex:1,field:"day",headerName:"Day of month",sortable:!1},{flex:1,field:"month",headerName:"Month",sortable:!1},{flex:1,field:"year",headerName:"Year",sortable:!1}],rows:ne})})]}),(0,i.jsx)("input",(0,v.Z)((0,a.Z)({},G("tags")),{type:"hidden"})),(0,i.jsx)("input",(0,v.Z)((0,a.Z)({},G("frequency")),{type:"hidden"}))]})]})},ob={location:null,sublocation:null,frequency:null,frequencyDescription:"",reference:"",customerMonthlyCharge:null,supplierMonthlyCharge:null,firstInvoiceDate:null,finalInvoiceDate:null,estimatedDuration:null,estimatedDurationUnit:null,assetCategory:null,assets:[],costCategory:null,complianceSelect:null,compliance:!1,costCustomer:null,costSupplier:null,description:"",service:null,shortDescription:null,supplier:null,customerSignature:!1,supplierSignature:!1,reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:null,tags:[]},oy=t(11994),oj=t(50459),oZ=t(57179),ow=function(e){var n=e.locationIdWatch,t=e.locationId,o=e.accountId,r=(0,l.useState)(""),a=r[0],i=r[1],s=(0,l.useState)(""),u=s[0],d=s[1],c=(0,l.useState)(""),p=c[0],m=c[1],h=(0,l.useState)(""),v=h[0],x=h[1],g=(0,l.useState)(""),b=g[0],y=g[1],j=(0,l.useState)(""),Z=j[0],C=j[1],I=(0,l.useState)(""),S=I[0],P=I[1],_=(0,l.useState)(""),k=_[0],q=_[1],D=(0,f.Z)((0,w.t)(ni.SW,{variables:{q:""!==a?"%".concat(a,"%"):null,limit:50,offset:0}}),2),T=D[0],M=D[1],O=M.loading,F=M.data,A=(void 0===F?{items:[]}:F).items,E=(0,f.Z)((0,w.t)(ni._d,{variables:{where:{name:{_ilike:""!==u?"%".concat(u,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),R=E[0],$=E[1],N=$.loading,W=$.data,J=(void 0===W?{items:[]}:W).items,L=(0,f.Z)((0,w.t)(ni.zR,{variables:{locationId:n||t,q:""!==p?"%".concat(p,"%"):null,limit:50,offset:0}}),2),B=L[0],Y=L[1],H=Y.loading,V=Y.data,G=(void 0===V?{items:[]}:V).items,Q=(0,f.Z)((0,w.t)(ni.UM,{variables:{q:""!==v?"%".concat(v,"%"):null,limit:50,offset:0}}),2),z=Q[0],U=Q[1],K=U.loading,X=U.data,ee=(void 0===X?{items:[]}:X).items,en=(0,f.Z)((0,w.t)(ni.UH,{variables:{q:""!==b?"%".concat(b,"%"):null,limit:50,offset:0}}),2),et=en[0],eo=en[1],er=eo.loading,ea=eo.data,ei=(void 0===ea?{items:[]}:ea).items,el=(0,f.Z)((0,w.t)(ni.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==Z?"%".concat(Z,"%"):null}},limit:50,offset:0}}),2),es=el[0],eu=el[1],ed=eu.loading,ec=eu.data,ep=(void 0===ec?{items:[]}:ec).items,em=(0,f.Z)((0,w.t)(ni.K4,{variables:{accountId:o,limit:50,offset:0,q:""!==S?"%".concat(S,"%"):null}}),2),eh=em[0],ev=em[1],ef=ev.data,ex=(void 0===ef?{items:[]}:ef).items,eg=ev.loading,eb=(0,f.Z)((0,w.t)(ni.yR,{variables:{accountId:o,q:""!==k?"%".concat(k,"%"):null,limit:50,offset:0}}),2),ey=eb[0],ej=eb[1],eZ=ej.data,ew=(void 0===eZ?{items:[]}:eZ).items;return{customerProps:{onOpen:T,loading:O,options:A,setSearch:i},propertyProps:{onOpen:R,loading:N,options:J,setSearch:d},sublocationProps:{onOpen:B,loading:H,options:G,setSearch:m},assetCategoryProps:{onOpen:z,loading:K,options:ee,setSearch:x},assetProps:{onOpen:et,loading:er,options:ei,setSearch:y},supplierProps:{onOpen:es,loading:ed,options:ep,setSearch:C},customerManagerProps:{onOpen:eh,loading:eg,options:ex,setSearch:P},userProps:{onOpen:ey,loading:ej.loading,options:ew,setSearch:q}}},oC={search:"",year:j()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,showExpiredItems:!1},oI=function(e){var n={search:"Search",year:"Year",status:"Status",tags:"Tags",customerId:"Customer",locationId:"Location",sublocationId:"Sublocation",userId:"User",assetCategoryId:"Asset Category",assetId:"Asset",supplierId:"Supplier",customerManagerId:"Customer Manager",allJobs:"All Jobs",allItems:"All Items",showExpiredItems:"Show Expired Items"},t={search:function(e){return e},year:function(e){return j()(e).format("YYYY")},status:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},tags:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},customerId:function(e){return null==e?void 0:e.label},locationId:function(e){return null==e?void 0:e.label},sublocationId:function(e){return null==e?void 0:e.label},userId:function(e){return null==e?void 0:e.label},assetCategoryId:function(e){return null==e?void 0:e.label},assetId:function(e){return null==e?void 0:e.label},supplierId:function(e){return null==e?void 0:e.label},customerManagerId:function(e){return null==e?void 0:e.label},allJobs:function(e){return null==e?void 0:e.label},allItems:function(e){return null==e?void 0:e.label},showExpiredItems:function(e){return e?"True":"False"}};return Object.entries(e).reduce(function(e,o){var r=(0,f.Z)(o,2),a=r[0],i=r[1];if(!i||!n[a]||!t[a])return e;var l=n[a],s=(0,t[a])(i);return s&&e.push({key:a,label:"".concat(l," is ").concat(s)}),e},[])},oS=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,u=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,er.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,V.Z)("(max-width: 600px)"),y=(0,n_.cI)({defaultValues:(0,a.Z)({},oC)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=(0,y.watch)("locationId"),S=ow({locationIdWatch:I,locationId:n,accountId:h.accountId}),P=S.customerProps,k=S.propertyProps,D=S.sublocationProps,T=S.assetCategoryProps,M=S.assetProps,O=S.supplierProps,F=S.customerManagerProps,A=S.userProps;(0,l.useEffect)(function(){var e,t,o,r,i,l,s,d,m,h,v,f,x,g,b={search:u.search?"%".concat(u.search,"%"):null,status:(null===(e=u.status)||void 0===e?void 0:e.length)>0?null===(t=u.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=u.tags)||void 0===o?void 0:o.length)>0?null===(r=u.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(i=u.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=u.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=u.sublocationId)||void 0===s?void 0:s.value,userId:null===(d=u.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=u.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=u.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=u.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=u.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=u.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=u.allItems)||void 0===g?void 0:g.value,year:u.year||oC.year,showExpiredItems:u.showExpiredItems};w((0,a.Z)({},oC,u)),c(function(e){return(0,a.Z)({},e,b)}),p(oI((0,a.Z)({},oC,u)))},[u,n,w,c,p]);var E=function(e){try{var n=C();d(function(e){return(0,a.Z)({},e,n)})}finally{o()}},R=function(){var e=(0,a.Z)({},oC);d(e),o()};return(0,i.jsx)(oy.Z,{keepMounted:!0,open:t,onClose:o,children:(0,i.jsx)("form",{onSubmit:Z(E),children:(0,i.jsxs)(oP,{is600pxOrLess:b,children:[(0,i.jsxs)(_.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,children:(0,i.jsx)(n_.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nZ.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oj.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(oZ.r,{control:j})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({disabled:!I&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance Jobs Only"},{value:"overduePPM",label:"Overdue PPM Jobs"},{value:"incompleteFollowOn",label:"Incomplete Follow-on Jobs"},{value:"followOn",label:"Items with Follow-on Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"Items with Complete Jobs"},{value:"incomplete",label:"Items with Incomplete Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Items"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"showExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{control:(0,i.jsx)(nq.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Show expired items"})}})})]}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(q.Z,{variant:"contained",color:"danger",onClick:function(){return R()},children:"Cancel"}),(0,i.jsx)(q.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};oS.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},oS.propTypes={locationId:b().string,open:b().bool,close:b().func,hideFilters:b().array,filtersFormData:b().object,setFiltersFormData:b().func,setFilters:b().func,setFiltersChips:b().func};var oP=(0,ou.Z)(u.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),o_=t(9492),ok=t(38216),oq=t(64872),oD=t(86267),oT=function(e){var n=e.entityId,t=e.refetch;return(0,i.jsx)(oD.G,{entity:"JobSchedule",entityId:n,refetch:t})},oM=function(e){var n=e.locaitonId,t=(0,(0,er.x)().hasRole)("tenant");return(0,i.jsx)(oD.G,{showItemActions:!t,category:"PPM",entity:"Location",entityId:n,expanded:!0,hideExpandIcon:!0})},oO=t(14924),oF=t(59938),oA=function(){var e=(0,f.Z)((0,oF.X)("ppm_item_view",{}),2),n=e[0],t=e[1];return{saveSessionData:function(e,o){t((0,v.Z)((0,a.Z)({},n),(0,oO.Z)({},e,o)))},getSessionDataByKey:function(e){var t=Object.entries(n).find(function(n){return(0,f.Z)(n,1)[0]===e.toString()});return t?t[1]:null}}},oE=function(e,n){var t=new Date(e).getTime();return!e||n?"black":Date.now()+7889238e3<t?"success":Date.now()+7889238e3>t&&Date.now()<t?"info":Date.now()>t?"warning":void 0},oR=function(e){return null!==(r=e.some(function(e){var n=e.statusData;return!(null==n?void 0:n.completed)&&!(null==n?void 0:n.closed)}))&&void 0!==r?r:null},o$=(0,d.ZP)(S.Z)(function(e){var n=e.theme,t=e.backgroundColor,o=e.height;return{position:"absolute",left:-10,top:"calc(50% - ".concat(o/2,"px)"),backgroundColor:n.palette[t].main,width:"5px",height:"".concat(o,"px"),borderTopRightRadius:"".concat(o,"px"),borderBottomRightRadius:"".concat(o,"px")}}),oN=function(e,n){switch(e){case"compliance":return[{Compliances:{}}];case"overduePPM":return[{_not:{statusData:{_has_key:"inProgress"},timingStart:{_lte:n}}}];case"incompleteFollowOn":return[{Jobs:{},_not:{statusData:{_has_key:"inProgress"}}}];case"followOn":return[{Jobs:{}}];default:return[]}},oW=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},oJ=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},oL=function(e,n){var t,o,r,i,l,s,u=e.search,d=e.status,c=e.tags,p=e.customerId,m=e.locationId,h=e.sublocationId,v=e.userId,f=e.assetCategoryId,x=e.assetId,g=e.supplierId,b=e.customerManagerId,y=e.allJobs,Z=e.allItems,w=(e.year,e.showExpiredItems),C=j()().subtract(24,"hours").toISOString(),I=[];I.push(g?{_or:[{supplierId:{_eq:g}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:g},status:{_in:["offered","accepted"]}}}]}:{}),I.push(u?{_or:[{reference:{_ilike:u}},{description:{_ilike:u}},{_or:[{JobSchedule:{reference:{_ilike:u}}},{JobSchedule:{description:{_ilike:u}}}]}]}:{}),I.push((null==d?void 0:d.length)>0?{status:{_in:d}}:{}),I.push((null==c?void 0:c.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:c}}}}:{}),I.push(oJ(v,n)),I.push(x?{Assets:{assetId:{_eq:x}}}:{}),I.push(b?{Customer:{Manager:{id:{_eq:b}}}}:{}),I.push.apply(I,(0,L.Z)(oN(y,C))),I.push.apply(I,(0,L.Z)(oW(Z))),I.push({});var S=I.filter(function(e){return!oo.isEmpty(e)});return{where:(0,a.Z)({locationId:{_eq:m},sublocationId:{_eq:h}},(null==S?void 0:S.length)||f||p?{Jobs:(0,a.Z)({_and:I.filter(function(e){return!oo.isEmpty(e)})},f?{assetCategoryId:{_eq:f}}:{},p?{customerId:{_eq:p}}:{})}:{})}},oB=t(87918),oY=function(e){var n=e.filtersChips,t=e.onRemove;return(0,i.jsx)(s.Z,{direction:"row",sx:{width:"100%",maxWidth:"calc(100vw - 100px)",overflowX:"auto"},alignItems:"center",spacing:1,ml:1,mr:1,children:n.map(function(e){return(0,i.jsx)(oB.Z,{label:e.label,onDelete:function(){return t(e.key)}},e.key)})})};oY.propTypes={filtersChips:b().array,onRemove:b().func},oY.defaultProps={filters:[],onRemove:function(){}};var oH=t(75832),oV=t(23508),oG=t(98409),oQ=t(91807),oz=t(86076),oU=t(34270),oK=function(e){var n=e.columns,t=e.rows,o=e.columnVisibilityModel,r=void 0===o?{}:o,u=e.renderIdentifierCell,d=void 0===u?null:u,c=e.renderValueCell,p=void 0===c?null:c,m=e.getDetailPanelContent,h=void 0===m?null:m,f=(0,l.useState)(null),x=f[0],g=f[1],b=(0,l.useMemo)(function(){return[{headerName:"",flex:1,field:"identifier",sortable:!1,renderCell:d?function(e){return d(e.row)}:function(e){var n=e.row;return(0,i.jsx)(s.Z,{sx:{fontWeight:"600",fontSize:"16px"},children:n.identifier})}},{headerName:"",flex:1,field:"valueCell",sortable:!1,renderCell:p?function(e){return p(e.row)}:"function"==typeof n[0].renderCell?n[0].renderCell:function(e){var t=e.row;return(0,i.jsx)(s.Z,{ml:2,children:"function"==typeof n[0].valueFormatter?n[0].valueFormatter({value:t[n[0].field]}):t[n[0].field]})}},(0,v.Z)((0,a.Z)({},oG.a),{renderCell:function(e){return(0,i.jsx)(oX,{setId:g,id:e.id,value:e.value})}})]},[n,d,p]),y=(0,l.useMemo)(function(){return null==t?void 0:t.map(function(e){return(0,v.Z)((0,a.Z)({},e),{identifier:n[0].headerName})})},[n,t]),j=(0,l.useMemo)(function(){return n.slice(1,n.length).filter(function(e){var n=e.field,t=e.isGridTogglePanel;return null!==r[n]&&!1!==r[n]&&!t}).map(function(e){return{identifier:{label:e.headerName},valueCell:{label:e.field,renderCell:"function"==typeof e.renderCell?e.renderCell:null,valueFormatter:"function"==typeof e.valueFormatter?e.valueFormatter:null}}})},[r,n]);return(0,i.jsx)(nD.i,(0,v.Z)((0,a.Z)({},e),{rows:y,columns:b,getRowClassName:function(e){return e.id===x?"odd":""},slots:{columnHeaders:function(){return null}},getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,i.jsx)(o0,{row:n,columns:j,getDetailPanelContent:h})}}))},oX=function(e){var n=e.id,t=e.value,o=e.setId,r=(0,oQ.l)();(0,l.useEffect)(function(){t&&o(n)},[o,t,n]);var a=(0,oz.P)(r,oU.Z3),s=l.isValidElement(a[n]);return(0,i.jsx)(k.Z,{size:"small",tabIndex:-1,disabled:!s,"aria-label":t?"Close":"Open",children:(0,i.jsx)(oV.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},o0=function(e){var n=e.columns,t=e.row,o=e.getDetailPanelContent;return(0,i.jsxs)(i.Fragment,{children:[o?o({row:t}):null,n.map(function(e){var n=e.identifier,o=e.valueCell;return(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{padding:"10px",marginTop:"10px",borderBottom:"1px solid #E0E0E0"},children:[(0,i.jsx)(s.Z,{width:"40%",sx:{fontWeight:"600",fontSize:"16px"},children:n.label}),(0,i.jsx)(s.Z,{width:"60%",ml:2,children:o.renderCell?o.renderCell({row:t}):o.valueFormatter?o.valueFormatter({value:t[o.label]}):t[o.label]})]})})]})},o1=function(e){return(0,V.Z)("(max-width: 600px)")?(0,i.jsx)(oK,(0,a.Z)({},e)):(0,i.jsx)(nD.i,(0,a.Z)({},e))},o2=t(67720),o3=t(46901),o5=function(e){var n=e.open,t=e.close,o=e.initialFilters,r=e.columns,u=e.setColumns,d=e.submitBtnText,c=e.subtitle,p=e.onCompleted,m=(0,V.Z)("(max-width: 600px)"),h=(0,l.useState)(null),v=h[0],x=h[1],g=(0,f.Z)((0,oF.X)("scheduledjob_table_jobs_column_selector_".concat(o.filterType),o,"sessionStorage"),2),b=g[0],y=g[1],j=(0,l.useMemo)(function(){return r.filter(function(e){return e.defaultSelected})},[r]),Z=(0,n_.cI)({defaultValues:{columns:j}}),w=Z.control,C=Z.handleSubmit,I=Z.reset;(0,l.useEffect)(function(){var e=(null==b?void 0:b.columns)||j||[];I({columns:e}),u((0,L.Z)(e))},[b,I,u,j]);var S=function(e){if(!e.columns.length){x("Please select at least one column");return}try{p?p(e):y(function(n){return(0,a.Z)({},n,e)})}finally{t(),x(null)}},_=function(){p||y({columns:j}),x(null),t()};return n&&(0,i.jsx)(oy.Z,{open:n,onClose:t,children:(0,i.jsx)("form",{onSubmit:C(S),children:(0,i.jsxs)(o6,{is600pxOrLess:m,children:[(0,i.jsxs)(s.Z,{spacing:2,children:[(0,i.jsx)(P.Z,{variant:"h6",children:"Column Selection"}),(0,i.jsx)(P.Z,{variant:"body2",color:"muiGray.main",children:c}),(0,i.jsx)(o2.Z,{}),(0,i.jsx)(n_.Qr,{control:w,name:"columns",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,value:n,onChange:function(e,n){return t(n)},options:r,textFieldProps:{fullWidth:!0,label:"Columns",color:"secondary"}})}})]}),v&&(0,i.jsx)(o3.Z,{sx:{margin:"10px 0"},severity:"error",children:v}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(q.Z,{variant:"contained",color:"danger",onClick:function(){return _()},children:"Cancel"}),(0,i.jsx)(q.Z,{variant:"contained",color:"secondary",type:"submit",children:d})]})]})})})};o5.defaultProps={open:!1,close:function(){},initialFilters:{},columns:[],setColumns:function(){},onCompleted:null,submitBtnText:"Apply",subtitle:"Select the columns you would like to see in the table."},o5.propTypes={open:b().bool,close:b().func,initialFilters:b().object,columns:b().array,setColumns:b().func,submitBtnText:b().string,subtitle:b().string,onCompleted:b().func};var o6=(0,ou.Z)(u.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}}),o4=[{label:"Item name",value:"shortDescriptionName",defaultSelected:!0},{label:"Job Description",value:"description",defaultSelected:!0},{label:"Service name",value:"serviceName",defaultSelected:!0},{label:"Assigned to",value:"supplierName",defaultSelected:!0},{label:"Sublocation Name",value:"sublocation",defaultSelected:!0},{label:"Asset Category",value:"assetCategoryName",defaultSelected:!0},{label:" Assets name",value:"assetName",defaultSelected:!0},{label:"Start Date",value:"scheduleStart",defaultSelected:!0},{label:"End Date",value:"scheduleEnd",defaultSelected:!0},{label:"Frequency",value:"frequencyDescription",defaultSelected:!0},{label:"Job ID",value:"jobIds",defaultSelected:!0},{label:"Job name",value:"jobName",defaultSelected:!0},{label:"Job status",value:"jobStatus",defaultSelected:!0}],o9={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},indicator:{position:"absolute",left:-10,top:"calc(50% - 55px)",backgroundColor:"#000",width:"5px",height:"110px",borderTopRightRadius:"110px",borderBottomRightRadius:"110px"},zeroFrequencyJobScheduled:{backgroundColor:"#C1C1C1",color:"#000000",padding:"5px",borderRadius:"5px"},squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},actionsIcon:{color:"#000000"},smallButton:{height:"30px"}},o7=function(e){var n,t,o,r,u,d,c,p,m,g=e.locationId,b=e.locationName,y=e.initialFilters,N=e.columnVisibilityModel,L=e.height,B=e.hasHeader,Y=void 0===B||B,H=e.hideFilters,V=(0,er.x)(),G=V.user,Q=V.hasRole,z=Q("supplier"),U=Q("customer"),K=Q(["customer","supplier"]),X=(0,nR.D)(),ee=(0,l.useState)(y),en=ee[0],et=ee[1],ea=(0,nT.x)({filters:en}),ei=ea.initialData,el=ea.ref,es=(0,l.useState)(!1),eu=es[0],ed=es[1],ec=(0,l.useState)(!1),ep=ec[0],em=ec[1],eh=(0,l.useState)([]),ev=eh[0],ef=eh[1],ex=(0,l.useState)(null),eg=ex[0],eb=ex[1],ey=(0,l.useState)(null),ej=ey[0],eZ=ey[1],ew=oA(),eC=ew.getSessionDataByKey,eI=ew.saveSessionData,eS=(0,oq.a)(),eP=(0,f.Z)((0,oF.X)("scheduledjob_table_items_".concat(y.filterType),y,Y?"network":"state"),2),e_=eP[0],ek=eP[1],eq=(0,l.useMemo)(function(){return oL((0,a.Z)({},en),G.accountType)},[en,G.accountType]),eD=(0,Z.aM)(eY,{variables:(0,a.Z)({},ei,eq)}),eT=eD.data,eM=void 0===eT?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:eT,eO=eM.jobSchedule,eF=eM.meta,eA=eD.loading,eE=eD.refetch,eR=(0,f.Z)((0,w.t)(eY,{variables:(0,a.Z)((0,v.Z)((0,a.Z)({},ei),{limit:null,offset:0}),eq)}),2),e$=eR[0],eN=eR[1].loading,eW=(0,f.Z)((0,C.D)(e2,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){X.show({content:"Job(s) were successfully deleted.",severity:"success"})},onError:function(e){X.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eJ=eW[0],eL=eW[1].loading,eB=(0,f.Z)((0,C.D)(e3,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){X.show({content:"Job(s) were successfully created.",severity:"success"})},onError:function(e){X.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eH=eB[0],eV=eB[1].loading,eG=(0,f.Z)((0,C.D)(ok.Vw),1)[0],eQ=(0,Z.aM)(ok.Q2,{variables:{entity:"jobSchedule",entityId:eg},skip:!eg}),ez=eQ.data,eU=eQ.loading,eK=function(e){var n=e.columns;e$().then(function(e){var t=e.data,o=W().unparse(t2(null==t?void 0:t.jobSchedule,n,t0)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,o_.S)(r,"Planned_Maintenance_".concat(j()().format("YYYY/MM/DD"),".csv"))})},eX=(0,l.useCallback)(function(e){ek(function(n){var t=(0,a.Z)({},n);return delete t[e],t})},[ek]),e0=(0,l.useCallback)(function(){eS.show({title:"Add item by passing through stages below",content:(0,i.jsx)(og,{locationId:g,locationName:b,onClose:eS.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[g,b,eS]),e1=(0,l.useCallback)(function(e){var n=e.jobScheduleId;eS.show({title:"Edit item",content:(0,i.jsx)(og,{edit:!0,jobScheduleId:n,onClose:eS.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[eS]),e5=(0,l.useCallback)(function(e){var n=e.jobScheduleId,t=e.jobStatus,o=e.description;eS.show({content:(0,i.jsx)(nb,{jobScheduleId:n,status:t?[t]:null,startDate:null,endDate:null,onClose:eS.close}),title:"Works orders (".concat(o,")"),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[eS]),e6=(0,l.useCallback)(function(e){eJ({variables:{id:e}})},[eJ]),e4=(0,l.useCallback)(function(e){return function(){eS.show({title:"Media",content:(0,i.jsx)(oT,{entityId:e,refetch:eE})})}},[eS,eE]),e9=(0,l.useCallback)((p=(0,h.Z)(function(e){var n,t;return(0,x.__generator)(this,function(o){switch(o.label){case 0:return eb(e.id),[4,eH({variables:{jobScheduleId:e.id}})];case 1:return(null==(n=o.sent())?void 0:n.data)&&(t=e7(n.data))&&t.length&&eZ(t),[2]}})}),function(e){return p.apply(this,arguments)}),[eH]),e7=function(e){for(var n in e){if("returning"===n)return e[n];if("object"==typeof e[n]&&null!==e[n]){var t=e7(e[n]);if(t)return t}}return null},e8=(m=(0,h.Z)(function(e){var n,t,o,r,a,i,l,s,u,d;return(0,x.__generator)(this,function(c){switch(c.label){case 0:n=!0,t=!1,o=void 0,c.label=1;case 1:c.trys.push([1,6,7,8]),r=e[Symbol.iterator](),c.label=2;case 2:if(n=(a=r.next()).done)return[3,5];return i=a.value,[4,eG({variables:{formId:null===(l=null==ez?void 0:ez.FormSubmissions[0])||void 0===l?void 0:l.formId,userId:G.id,formFields:null===(s=null==ez?void 0:ez.FormSubmissions[0])||void 0===s?void 0:s.formFields,submissionData:null===(u=null==ez?void 0:ez.FormSubmissions[0])||void 0===u?void 0:u.submissionData,entity:"Ppm",entityId:i.id}})];case 3:c.sent(),c.label=4;case 4:return n=!0,[3,2];case 5:return[3,8];case 6:return d=c.sent(),t=!0,o=d,[3,8];case 7:try{n||null==r.return||r.return()}finally{if(t)throw o}return[7];case 8:return[2]}})}),function(e){return m.apply(this,arguments)});(0,l.useEffect)(function(){!eU&&(null==ez?void 0:ez.FormSubmissions[0])&&ej&&e8(ej)},[ej,eU,null==ez?void 0:ez.FormSubmissions[0]]);var ne=function(e){return(0,i.jsxs)(S.Z,{sx:o9.indicatorWrapper,children:[(0,i.jsx)(o$,{height:110,backgroundColor:oE(e.scheduleEnd,!oR(null!==(t=e.jobs)&&void 0!==t?t:[]))}),(0,i.jsx)(s.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},nn=function(e){var n;return(0,i.jsx)(S.Z,{sx:o9.indicatorWrapper,children:(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{overflow:"auto",height:"100%",width:"220px"},children:[e.compliance&&(0,i.jsx)($.Z,{sx:{color:"info.main",marginLeft:"10px"}}),(0,i.jsxs)(s.Z,{ml:2,children:[(0,i.jsx)(P.Z,{typography:"subtitle1",sx:(0,v.Z)((0,a.Z)({},o9.title),{whiteSpace:"normal"}),children:(null===(n=e.shortDescription)||void 0===n?void 0:n.label)||e.shortDescription}),(0,i.jsx)(eo.O,{sx:(0,v.Z)((0,a.Z)({},o9.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:e.description})]})]})})},nt=(0,l.useMemo)(function(){return[{headerName:"Job",field:"job",sortable:!1,width:250,renderCell:function(e){var n=e.row;return(0,i.jsxs)(S.Z,{sx:o9.indicatorWrapper,children:[(0,i.jsx)(o$,{height:110,backgroundColor:oE(n.scheduleEnd,!oR(null!==(o=n.jobs)&&void 0!==o?o:[]))}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{overflow:"auto",height:"100%",width:"220px"},children:[n.compliance&&(0,i.jsx)($.Z,{sx:{color:"#FFC700",marginLeft:"10px"}}),(0,i.jsxs)(s.Z,{ml:2,children:[(0,i.jsx)(P.Z,{typography:"subtitle1",sx:(0,v.Z)((0,a.Z)({},o9.title),{whiteSpace:"normal"}),children:n.shortDescription}),(0,i.jsx)(eo.O,{sx:(0,v.Z)((0,a.Z)({},o9.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:n.description})]})]})]})}},{headerName:"Service",field:"service",sortable:!1,width:250,renderCell:function(e){var n,t,o,r=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{typography:"subtitle1",children:r.serviceName}),!U&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:"Assigned to:"}),(0,i.jsx)(J.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=r.supplier)||void 0===n?void 0:n.value),noWrap:!(null===(t=r.supplier)||void 0===t?void 0:t.value)||z,children:null===(o=r.supplier)||void 0===o?void 0:o.label})]})]})}},{headerName:"Details",field:"details",sortable:!1,width:250,renderCell:function(e){var n,t,o,a=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Sublocation: ",null!==(r=null===(n=a.sublocation)||void 0===n?void 0:n.label)&&void 0!==r?r:"-"]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Asset category: ",null!==(u=null===(t=a.assetCategory)||void 0===t?void 0:t.label)&&void 0!==u?u:"-"]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Assets: ",(null===(o=a.assets)||void 0===o?void 0:o.length)?a.assets.map(function(e){return e.label}).join(", "):"-"]})]})}},{headerName:"Frequency",field:"frequency",sortable:!1,width:400,renderCell:function(e){var n,t,o=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Start date: ",j()(o.scheduleStart).format("DD-MM-YYYY")]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["End date: ",j()(o.scheduleEnd).format("DD-MM-YYYY")]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Frequency:\xa0",o.frequencyDescription.charAt(0).toUpperCase()+o.frequencyDescription.slice(1)]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,mt:1,children:[!(null===(n=o.jobs)||void 0===n?void 0:n.length)&&!K&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S.Z,{sx:o9.zeroFrequencyJobScheduled,children:"0 jobs"}),(0,i.jsx)(q.Z,{variant:"contained",color:"success",sx:o9.smallButton,onClick:function(e){e.stopPropagation(),e9(o)},children:"Create job(s)"})]}),!!(null===(t=o.jobs)||void 0===t?void 0:t.length)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(q.Z,{variant:"contained",color:"secondary",size:"small",sx:{height:"30px"},onClick:function(e){var n,t;e.stopPropagation(),e5({jobScheduleId:o.id,jobStatus:null,description:o.title,totalJobCount:null!==(t=null===(n=o.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:[o.jobs.length," jobs scheduled"]})})]})]})}},{field:"invoicePeriod",headerName:"Invoice period",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{columnGap:2,children:[(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Month of first invoice: ",null!==(d=n.firstInvoiceDate)&&void 0!==d?d:"-"]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Month of final invoice: ",null!==(c=n.finalInvoiceDate)&&void 0!==c?c:"-"]})]})}},{field:"invoiceBasis",headerName:"Invoice basis",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(P.Z,{typography:"h6",children:n.invoiceBasis?n.invoiceBasis.match(/[A-Z][a-z]+/g).join(" "):"N/A"})}},{field:"invoiceAmount",headerName:"Invoice amount",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{columnGap:2,children:[(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Customer amount:\xa0","onCompletion"===n.invoiceBasis?(0,oH.T)(n.costCustomer):(0,oH.T)(n.customerMonthlyCharge)]}),(0,i.jsxs)(P.Z,{typography:"subtitle2",sx:o9.subtitle,children:["Supplier amount:\xa0","onCompletion"===n.invoiceBasis?(0,oH.T)(n.costSupplier):(0,oH.T)(n.supplierMonthlyCharge)]})]})}},{headerName:"Work orders",field:"workOrders",sortable:!1,width:350,renderCell:function(e){var n=e.row;return(0,i.jsx)(nP,{row:n,handleOpenJobsFromSchedule:e5,sessionData:eC(n.id),saveSessionData:eI})}},{headerName:"Actions",field:"actions",sortable:!1,width:150,renderCell:function(e){var n,t,o=e.row;return(0,i.jsxs)(s.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",children:[(0,i.jsx)(k.Z,{onClick:e4(o.id),children:(0,i.jsx)(I.Z,{color:"success",variant:"dot",invisible:!(null===(n=o.media)||void 0===n?void 0:n.length),children:(0,i.jsx)(R.Z,{sx:o9.actionsIcon})})}),!K&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.Z,{children:(0,i.jsx)(A.Z,{sx:o9.actionsIcon,onClick:function(){return e1({jobScheduleId:o.id})}})}),!(null==o?void 0:null===(t=o.jobs)||void 0===t?void 0:t.length)&&(0,i.jsx)(k.Z,{onClick:function(){return e6(o.id)},children:(0,i.jsx)(O.Z,{sx:o9.actionsIcon})})]})]})}}]},[eC,e9,e6,e1,e5,e4,K,z,U,eI]),no=(0,l.useCallback)(function(){return eO.map(function(e){var n,t,o,r,a,i,l,s,u,d=e.jobs.filter(function(e){var n=e.statusData;return(null==n?void 0:n.completed)||(null==n?void 0:n.closed)}).length;return{id:e.id,serviceName:e.meta.serviceName,title:e.meta.shortDescriptionName,frequency:e.frequency,frequencyDescription:e.frequencyDescription,jobs:e.jobs,assets:(null===(n=e.meta)||void 0===n?void 0:null===(t=n.assets)||void 0===t?void 0:t.length)?e.meta.assets:[],completeCount:d,description:null!==(u=e.description)&&void 0!==u?u:e.meta.description,compliance:null===(o=e.meta)||void 0===o?void 0:o.compliance,location:e.location,scheduleEnd:e.scheduleEnd,media:e.media,firstInvoiceDate:e.firstInvoiceDate?j()(e.firstInvoiceDate).format("YYYY-MM-DD"):null,finalInvoiceDate:e.finalInvoiceDate?j()(e.finalInvoiceDate).format("YYYY-MM-DD"):null,invoiceBasis:e.invoiceBasis,customerMonthlyCharge:e.customerMonthlyCharge,supplierMonthlyCharge:e.supplierMonthlyCharge,costCustomer:null===(r=e.meta)||void 0===r?void 0:r.costCustomer,costSupplier:null===(a=e.meta)||void 0===a?void 0:a.costSupplier,assetCategory:(null===(i=e.meta)||void 0===i?void 0:i.assetCategoryName)?{value:e.meta.assetCategoryId,label:e.meta.assetCategoryName}:null,sublocation:e.sublocation?{label:null===(l=e.sublocation)||void 0===l?void 0:l.name,value:null===(s=e.sublocation)||void 0===s?void 0:s.id}:null,costCategory:{value:e.meta.costCategoryId,label:e.meta.costCategoryName},shortDescription:e.meta.shortDescriptionName,supplier:e.meta.supplierId?{value:e.meta.supplierId,label:e.meta.supplierName}:null}})},[eO]),nr=function(){eS.show({content:(0,i.jsx)(nN,{locationId:null!=g?g:null}),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},na=(0,l.useMemo)(function(){var e={};return!no().length&&(null==ei?void 0:ei.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No ppm jobs found",subtitleFirstLine:"You currently have no ppm jobs set up",subtitleSecondLine:"Click add item to get started building.",buttonText:"Add item",onAction:e0}},[e0,null==ei?void 0:ei.q,no]),ni=(0,a.Z)({},void 0===N?{}:N);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(oS,{locationId:g,open:eu,close:function(){return ed(!1)},hideFilters:void 0===H?[]:H,filtersFormData:e_,setFiltersFormData:ek,setFilters:et,setFiltersChips:ef}),(0,i.jsx)(o5,{open:ep,close:function(){return em(!1)},columns:o4,onCompleted:function(e){return eK(e)},submitBtnText:"Export",subtitle:"Select the columns you would like to export in the csv file."}),(0,i.jsx)(D.Z,{sx:{zIndex:1e5},open:eV||eL||eN,children:(0,i.jsx)(T.Z,{color:"secondary"})}),Y&&(0,i.jsxs)(_.ZP,{container:!0,pl:2,rowGap:2,justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(_.ZP,{item:!0,xs:g?4:6,md:1,lg:1,order:{xs:1},children:(0,i.jsx)(q.Z,{sx:{height:"35px"},variant:"contained",startIcon:(0,i.jsx)(E.Z,{}),onClick:function(){return ed(!0)},children:"Filters"})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:8,lg:8,order:{xs:3,md:2,lg:2},children:(0,i.jsx)(oY,{filtersChips:ev,onRemove:eX})}),(0,i.jsxs)(_.ZP,{item:!0,xs:g?8:6,md:2,lg:2,order:{xs:2,md:3,lg:3},children:[g&&!K&&(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:nr,children:(0,i.jsx)(M.Z,{})}),(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:function(){return em(!0)},children:(0,i.jsx)(F.Z,{})}),!K&&(0,i.jsx)(q.Z,{sx:{width:"100px"},variant:"contained",color:"success",onClick:e0,children:"Add Item"})]})]}),(0,i.jsx)(S.Z,{sx:{height:void 0===L?"calc(90vh - 52px)":L,overflowY:"auto"},children:(null===(n=no())||void 0===n?void 0:n.length)?(0,i.jsx)(o1,{rowHeight:120,ref:el,loading:eA,columns:nt,rows:no(),columnVisibilityModel:ni,renderIdentifierCell:ne,renderValueCell:nn,meta:eF,refetch:eE,autoHeight:!1,containerHeight:"calc(100vh - 52px)"}):!eA&&(0,i.jsx)(nx.C,(0,a.Z)({imageSrc:"/static/icons/no_locations_found.svg"},na))})]})};o7.propTypes={locationId:b().string,locationName:b().string,initialFilters:b().object,columnVisibilityModel:b().object,height:b().string,hasHeader:b().bool,hideFilters:b().array},o7.defaultProps={};var o8=t(53219),re=t(41796),rn=function(e){var n=e.children,t=e.popover,o=e.onOpen,r=e.clickOnly,a=(0,l.useState)(null),s=a[0],u=a[1],d=function(e){r||u(e.currentTarget),o&&o(e)},c=function(){u(null)},p=Boolean(s),m=p?"ribbon-select-button-popover":void 0;return(0,i.jsxs)("div",{children:[(0,i.jsx)(rt,{"aria-describedby":m,onClick:d,children:n}),(0,i.jsx)(os.ZP,{id:m,open:p,anchorEl:s,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{zIndex:1200},children:t})]})};rn.defaultProps={popover:null,onOpen:null,clickOnly:!1},rn.propTypes={children:b().node.isRequired,popover:b().node,onOpen:b().func};var rt=(0,d.ZP)("button")(function(e){return{display:"flex",alignItems:"center",border:"none",borderRadius:"4px",color:e.theme.palette.white.main,backgroundColor:"#1394FF",fontSize:"0.875rem",lineHeight:1.25,padding:"2px 4px 2px 4px",cursor:"pointer","&:hover":{backgroundColor:(0,re._j)("#1394FF",.1)}}}),ro=t(22154),rr=t(12282),ra=t(16352),ri=t(36641);function rl(){return(rl=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let rs=e=>l.createElement("svg",rl({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 20"},e),l.createElement("path",{fill:"#FFF",d:"M2.667.07C1.196.07 0 1.341 0 2.906v14.187c0 1.565 1.196 2.837 2.667 2.837h18.666c1.471 0 2.667-1.272 2.667-2.837V2.907C24 1.342 22.804.069 21.333.069zM6 11.42h2.667c1.841 0 3.333 1.586 3.333 3.546 0 .39-.3.71-.667.71h-8c-.366 0-.666-.32-.666-.71 0-1.96 1.491-3.547 3.333-3.547M4.667 7.162c0-.753.28-1.474.78-2.006a2.59 2.59 0 0 1 1.886-.832c.708 0 1.386.3 1.886.832S10 6.41 10 7.163s-.281 1.474-.781 2.006S8.04 10 7.333 10a2.59 2.59 0 0 1-1.885-.83 2.93 2.93 0 0 1-.781-2.007m10.666-1.419h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709m0 2.838h5.334c.366 0 .666.319.666.709s-.3.71-.666.71h-5.334c-.366 0-.666-.32-.666-.71s.3-.71.666-.71m0 2.837h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709"}));var ru=t(71496),rd=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(rc,{open:o,children:[(0,i.jsx)(rp,{onClick:r,children:n}),o&&(0,i.jsx)(rh,{children:(0,i.jsx)(ru.Z,{sx:{height:"32px",width:"32px",color:"#FFFFFF"}})})]}),(0,i.jsx)(S.Z,{sx:{height:"270px"},children:o&&(0,i.jsx)(rm,{open:o,children:t})})]})},rc=(0,d.ZP)(S.Z)(function(e){var n;return{display:"flex",alignItems:"center",borderRadius:"10px",flexDirection:"row",height:"fit-content",width:e.open?"80px":"42px",backgroundColor:e.theme.palette.secondary.main,transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rp=(0,d.ZP)(S.Z)(function(e){return{display:"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),rm=(0,d.ZP)(S.Z)(function(e){var n;return{position:"absolute",top:50,left:-2,borderRadius:"10px",display:e.open?"block":"none",marginTop:"15px",backgroundColor:e.theme.palette.secondary.main}}),rh=(0,d.ZP)(k.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rv=function(e){var n=(0,l.useRef)();return(0,l.useEffect)(function(){n.current=e}),n.current},rf=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen,a=e.spacing,s=(0,l.useState)(o),u=s[0],d=s[1],c=(0,l.useState)(!1),p=c[0],m=c[1],h=(0,l.useState)(!1),v=h[0],f=h[1],x=(0,l.useRef)(null),g=rv(u);(0,l.useEffect)(function(){d(o),m(!1)},[o]);var b=function(){x.current&&f(x.current.scrollHeight>=69)};(0,l.useEffect)(function(){return b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}},[]);var y=function(){d(!0),r&&r()},j=function(){m(!p)},Z=function(){b()};return(0,i.jsxs)(rx,{open:u,children:[(0,i.jsx)(rg,{open:u,onClick:y,children:n}),(0,i.jsxs)(rb,{open:u,wasOpen:g,more:p,direction:"row",alignItems:"center",justifyContent:"space-between",onTransitionEnd:Z,children:[(0,i.jsx)(ry,{ref:x,open:u,more:p,direction:"row",spacebetween:a,children:t}),v&&(0,i.jsx)(rj,{open:p,color:"white",onClick:j,children:(0,i.jsx)(ru.Z,{sx:{height:"32px",width:"32px"}})})]})]})};rf.defaultProps={expanded:!1,spacing:2,onOpen:null},rf.propTypes={icon:b().node.isRequired,children:b().node.isRequired,expanded:b().bool,onOpen:b().func,spacing:b().number};var rx=(0,d.ZP)(S.Z)(function(e){return{display:"flex",flexDirection:"row",width:e.open?"100%":"42px",transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rg=(0,d.ZP)(S.Z)(function(e){var n;return{display:e.open?"none":"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),rb=(0,d.ZP)(s.Z)(function(e){var n=e.open,t=e.wasOpen,o=e.more,r=e.theme;return(0,a.Z)({width:n?"100%":"0px",overflow:"hidden",display:!n&&t?"none":"flex",height:o?"100%":"42px",borderRadius:"8px",backgroundColor:r.palette.secondary.main,transition:"width 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms,\n  height 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"},n&&{paddingLeft:"8px",paddingRight:"8px"})}),ry=(0,d.ZP)(s.Z)(function(e){var n=e.open,t=e.more,o=e.spacebetween;return(0,a.Z)({alignItems:"center",flexWrap:"wrap",height:t?"auto":"42px",overflow:"hidden"},n&&{paddingTop:"10px",paddingBottom:"10px",rowGap:"10px","&>:not(style):not(style)":{marginRight:8*o+"px"}})}),rj=(0,d.ZP)(k.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rZ=function(e){return(0,V.Z)("(max-width: 600px)")?(0,i.jsx)(rd,(0,a.Z)({},e)):(0,i.jsx)(rf,(0,a.Z)({},e))},rw={mobileItem:function(e){return e?{padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rC=function(e){var n,t,o,r,a,l,u,d,c,p,m=e.expanded,h=e.handleOpen,v=e.locationId,f=(0,er.x)().hasRole,x=f("admin"),g=f("customer"),b=(0,V.Z)("(max-width: 600px)"),y=(0,oq.a)(),j=(0,Z.aM)(eX,{skip:!v||!m,variables:{id:v}}),w=j.data,C=(void 0===w?{location:{}}:w).location,I=j.refetch,S=null==C?void 0:null===(n=C.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address,_=function(e){var n;e.stopPropagation(),y.show({content:(0,i.jsx)(ra.Z,{defaultValues:{monthlyAmount:null===(n=C.meta)||void 0===n?void 0:n.monthlyAmount},location:C,offCanvas:y,refetch:I}),submit:!0,title:"Billing"})},q=function(e){var n,t;e.stopPropagation(),y.show({content:(0,i.jsx)(ri.H,{addressId:(null==S?void 0:S.id)||null,entity:"Location",entityId:v,id:(null==C?void 0:null===(n=C.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.id)||null,onSubmit:I,type:"invoice"}),submit:!1,title:"Manage addresses"})},D=function(e){e.stopPropagation(),y.show({content:(0,i.jsx)(oM,{locaitonId:v}),submit:!1,title:"Upload Documents"})};return(0,i.jsx)(rZ,{icon:(0,i.jsx)(o8.Z,{component:rs,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:m,onOpen:h,spacing:1,children:v?(0,i.jsxs)(i.Fragment,{children:[(x||g)&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rw.mobileItem(b),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Customer:"}),(0,i.jsx)(P.Z,{color:"white.main",children:null===(o=C.customer)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(a=r.account)||void 0===a?void 0:a.name})]}),(x||g)&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rw.mobileItem(b),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Asigned to:"}),(0,i.jsx)(P.Z,{color:"white.main",children:(null===(l=C.customer)||void 0===l?void 0:null===(u=l[0])||void 0===u?void 0:null===(d=u.account)||void 0===d?void 0:null===(c=d.manager)||void 0===c?void 0:c.fullName)||"Not assigned"})]}),(x||g)&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rw.mobileItem(b),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Monthly Amount:"}),(0,i.jsx)(P.Z,{color:"white.main",children:(null===(p=C.meta)||void 0===p?void 0:p.monthlyAmount)?(0,oH.T)(C.meta.monthlyAmount):(0,oH.T)(0)}),(0,i.jsx)(k.Z,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:_,children:(0,i.jsx)(rr.Z,{sx:{height:"16px"}})})]}),(x||g)&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:1,sx:rw.mobileItem(b),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Invoice Address:"}),(0,i.jsx)(oB.Z,{color:"white",size:"small",label:null==S?void 0:S.postCode,sx:{height:"18px",borderRadius:1}}),(0,i.jsxs)(P.Z,{color:"white.main",children:[(null==S?void 0:S.addressLine1)?S.addressLine1+", ":"",(null==S?void 0:S.addressLine2)?S.addressLine2+", ":"",(null==S?void 0:S.addressLine3)?S.addressLine3+", ":"",(null==S?void 0:S.city)?S.city+", ":"",(null==S?void 0:S.county)?S.county+", ":""]}),(0,i.jsx)(k.Z,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:q,children:(0,i.jsx)(rr.Z,{sx:{height:"16px"}})})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rw.mobileItem(b),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Documentation:"}),(0,i.jsx)(ro.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsx)(rn,{clickOnly:!0,sx:{pl:2},onOpen:D,children:"File name"})]})]}):(0,i.jsx)(P.Z,{fontWeight:700,fontSize:16,sx:b?{height:"100px",padding:"10px",width:"100%"}:{},children:"Please select a location to get details"})})},rI=t(97212),rS=t(98619),rP=t(58533),r_=function(e){var n=e.jobs,t=e.hasMore,o=e.handleFetchMore,r=e.onItemClick,a=(0,V.Z)("(max-width:600px)");return(0,i.jsx)(S.Z,{id:"scrollableDiv",sx:{display:"flex",flexDirection:"column",pt:1,overflowY:"scroll",maxHeight:a?"80vh":"50vh",width:"200px"},children:(0,i.jsx)(rP.Z,{dataLength:n.length,next:o,hasMore:t,loader:(0,i.jsx)(T.Z,{color:"secondary"}),scrollableTarget:"scrollableDiv",children:n.map(function(e){return(0,i.jsx)(rI.ZP,{component:"div",disablePadding:!0,onClick:function(n){return r(n,e)},children:(0,i.jsxs)(rS.Z,{sx:{flexDirection:"column",alignItems:"flex-start"},children:[(0,i.jsxs)(s.Z,{direction:"row",width:"100%",spacing:2,children:[(0,i.jsx)(oB.Z,{label:e.number,color:"primary",size:"small",sx:{borderRadius:1}}),(0,i.jsx)(ec.B,{value:e.status,sx:{borderRadius:1}})]}),e.title&&(0,i.jsx)(P.Z,{mt:1,children:e.title})," "]})},e.number)})})})};r_.defaultProps={jobs:[],hasMore:!1,handleFetchMore:function(){},onItemClick:function(){}},r_.propTypes={jobs:b().array,hasMore:b().bool,handleFetchMore:b().func,onItemClick:b().func};var rk=function(e){var n=e.fetchMore,t=e.offset,o=e.limit,r=e.setOffset;n({variables:{offset:t,limit:o},updateQuery:function(e,n){var t=n.fetchMoreResult;return t?{jobs:(0,L.Z)(e.jobs).concat((0,L.Z)(t.jobs))}:e}}),r(t+o)},rq=t(22713);function rD(){return(rD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let rT=e=>l.createElement("svg",rD({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 18 20"},e),l.createElement("path",{fill:"#FFF",d:"M5.143 0c.711 0 1.286.559 1.286 1.25V2.5h5.142V1.25c0-.691.575-1.25 1.286-1.25s1.286.559 1.286 1.25V2.5h1.928C17.136 2.5 18 3.34 18 4.375V6.25H0V4.375C0 3.34.864 2.5 1.929 2.5h1.928V1.25C3.857.559 4.432 0 5.143 0M0 7.5h18v10.625C18 19.16 17.136 20 16.071 20H1.93C.864 20 0 19.16 0 18.125zm2.571 3.125v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 10H3.214a.636.636 0 0 0-.643.625m5.143 0v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 10H8.357a.636.636 0 0 0-.643.625M13.5 10a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625zM2.571 15.625v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 15H3.214a.636.636 0 0 0-.643.625M8.357 15a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 15zm4.5.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625H13.5a.636.636 0 0 0-.643.625"}));var rM={jobs:{aggregate:{count:0}}},rO={mobileItem:function(e){return e?{padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rF=function(e){var n,t=e.expanded,o=e.handleOpen,r=e.locationId,a=(0,oq.a)(),u=(0,l.useMemo)(function(){return j()().toISOString()},[]),d=(0,l.useMemo)(function(){return j()().add(7,"days").toISOString()},[]),c=(0,l.useMemo)(function(){return j()().subtract(24,"hours").toISOString()},[]),p=(0,l.useState)(0),m=p[0],h=p[1],v=(0,l.useState)(0),x=v[0],g=v[1],b=(0,l.useState)(0),y=b[0],C=b[1],I=(0,l.useState)(0),S=I[0],_=I[1],k=(0,V.Z)("(max-width: 600px)"),q=(0,Z.aM)(ez,{skip:!t,variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}).data,D=(void 0===q?rM:q).jobs.aggregate.count,T=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}),2),M=T[0],O=T[1],F=O.data,A=(void 0===F?{jobs:[]}:F).jobs,E=O.fetchMore,R=(0,Z.aM)(eK,{skip:!t,variables:{locationId:r,now:u}}).data,$=(void 0===R?{nextJob:[]}:R).nextJob,N=(0,Z.aM)(ez,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:u,_lte:d}}}}).data,W=(void 0===N?rM:N).jobs.aggregate.count,J=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:u,_lte:d}}}}),2),L=J[0],B=J[1],Y=B.data,H=(void 0===Y?{jobs:[]}:Y).jobs,G=B.fetchMore,Q=(0,Z.aM)(ez,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliances:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}).data,z=(void 0===Q?rM:Q).jobs.aggregate.count,U=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliances:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}),2),K=U[0],X=U[1],ee=X.data,en=(void 0===ee?{jobs:[]}:ee).jobs,et=X.fetchMore,eo=(0,Z.aM)(ez,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}).data,er=(void 0===eo?rM:eo).jobs.aggregate.count,ea=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}),2),ei=ea[0],el=ea[1],es=el.data,eu=(void 0===es?{jobs:[]}:es).jobs,ed=el.fetchMore,ec=function(e,n){var t=n.id;e.stopPropagation(),a.show({content:(0,i.jsx)(rq.g,{jobId:t,toggleShow:a.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},ep=function(e){e({variables:{offset:0,limit:50}})};return(0,i.jsxs)(rZ,{icon:(0,i.jsx)(o8.Z,{component:rT,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:t,onOpen:o,children:[(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rO.mobileItem(k),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Total jobs:"}),(0,i.jsx)(P.Z,{color:"white.main",mr:1,children:D}),(0,i.jsx)(rn,{onOpen:function(){return ep(M)},popover:(0,i.jsx)(r_,{onItemClick:ec,jobs:A,hasMore:A.length<D,handleFetchMore:function(){return rk({fetchMore:E,offset:m,limit:50,setOffset:h})}}),children:(0,i.jsx)(ru.Z,{sx:{height:"14px"}})})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rO.mobileItem(k),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Next Job:"}),(0,i.jsx)(P.Z,{color:"white.main",mr:1,children:(null===(n=$[0])||void 0===n?void 0:n.title)||"N/A"}),(0,i.jsx)(rn,{popover:(0,i.jsx)(r_,{onItemClick:ec,jobs:$}),children:(0,i.jsx)(ru.Z,{sx:{height:"14px"}})})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rO.mobileItem(k),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Next 7 Days Jobs:"}),(0,i.jsx)(P.Z,{color:"white.main",mr:1,children:W}),(0,i.jsx)(rn,{onOpen:function(){return ep(L)},popover:(0,i.jsx)(r_,{onItemClick:ec,jobs:H,hasMore:H.length<W,handleFetchMore:function(){return rk({fetchMore:G,offset:x,limit:50,setOffset:g})}}),children:(0,i.jsx)(ru.Z,{sx:{height:"14px"}})})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rO.mobileItem(k),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Overdue Compliance Jobs:"}),(0,i.jsx)(P.Z,{color:"white.main",mr:1,children:z}),(0,i.jsx)(rn,{onOpen:function(){return ep(K)},popover:(0,i.jsx)(r_,{onItemClick:ec,jobs:en,hasMore:en.length<z,handleFetchMore:function(){return rk({fetchMore:et,offset:y,limit:50,setOffset:C})}}),children:(0,i.jsx)(ru.Z,{sx:{height:"14px"}})})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:rO.mobileItem(k),children:[(0,i.jsx)(P.Z,{fontWeight:700,mr:1,children:"Overdue PPM Jobs:"}),(0,i.jsx)(P.Z,{color:"white.main",mr:1,children:er}),(0,i.jsx)(rn,{onOpen:function(){return ep(ei)},popover:(0,i.jsx)(r_,{onItemClick:ec,jobs:eu,hasMore:eu.length<er,handleFetchMore:function(){return rk({fetchMore:ed,offset:S,limit:50,setOffset:_})}}),children:(0,i.jsx)(ru.Z,{sx:{height:"14px"}})})]})]})};function rA(){return(rA=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}rF.defaultProps={expanded:!1,handleOpen:function(){}},rF.propTypes={expanded:b().bool,handleOpen:b().func};let rE=e=>l.createElement("svg",rA({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 20 20"},e),l.createElement("path",{fill:"#FFF",d:"M7.54 8.964c.05 0 .1-.014.141-.04a.25.25 0 0 0 .094-.107c.105-.437.35-.832.703-1.13.057-.035.08-.111.08-.183a.2.2 0 0 0-.03-.085.2.2 0 0 0-.068-.062l-5.511-3.05 3.52-1.941a.46.46 0 0 0 .169-.156.39.39 0 0 0 .005-.432.4.4 0 0 0-.174-.153l-1.057-.571a.48.48 0 0 0-.449 0L.236 3.643a.46.46 0 0 0-.17.156.4.4 0 0 0-.066.214v5.139a.4.4 0 0 0 .062.217.4.4 0 0 0 .174.153l1.052.572c.071.04.153.058.236.053a.46.46 0 0 0 .311-.111.47.47 0 0 0 .137-.313V5.915l5.473 3.031q.045.02.095.018m7.152 6.469a.6.6 0 0 0-.236.053l-3.515 1.924v-5.986c0-.13-.136-.26-.292-.205-.446.126-.92.132-1.368.017a.24.24 0 0 0-.2.035.2.2 0 0 0-.067.075.2.2 0 0 0-.026.096v5.95l-3.515-1.924a.43.43 0 0 0-.236-.053.47.47 0 0 0-.315.125.42.42 0 0 0-.133.299v1.165a.4.4 0 0 0 .061.217.4.4 0 0 0 .175.154l4.727 2.57q.107.06.232.055a.54.54 0 0 0 .235-.054l4.728-2.571a.46.46 0 0 0 .17-.157.4.4 0 0 0 .066-.214v-1.165c-.043-.201-.26-.406-.49-.406m-1.76-13.38c.215 0 .425-.06.603-.173.179-.112.318-.273.4-.46a.98.98 0 0 0 .062-.594A1 1 0 0 0 13.7.301a1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m3.001-.45c-.215 0-.424.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m2.982 3.736c.215 0 .424-.06.603-.173a1.04 1.04 0 0 0 .4-.46.98.98 0 0 0 .061-.594 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.555-.28c-.211-.04-.43-.02-.627.058-.199.078-.368.21-.487.378a.99.99 0 0 0 .134 1.296c.204.193.48.301.768.301m-2.982-.41c-.215 0-.424.06-.603.172a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m-3 3.714c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m-2.93 1.625c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m8.912-3.679c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.593c.041.2.145.382.297.526.151.143.345.241.555.28s.429.02.627-.058c.198-.077.368-.209.487-.378a.99.99 0 0 0-.135-1.296c-.203-.193-.48-.3-.767-.3m0 3.228c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.041.199.145.382.297.525.151.144.345.242.555.281s.429.02.627-.058.368-.21.487-.378a.99.99 0 0 0-.135-1.297c-.203-.192-.48-.3-.767-.3"}));var rR={jobs:{aggregate:{count:0}}},r$={mobileItem:function(e){return e?{width:"50%",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rN=function(e){var n=e.expanded,t=e.handleOpen,o=e.locationId,r=(0,oq.a)(),u=(0,l.useState)(0),d=u[0],c=u[1],p=(0,l.useState)(0),m=p[0],h=p[1],x=(0,l.useState)(0),g=x[0],b=x[1],y=(0,l.useState)(0),j=y[0],C=y[1],I=(0,l.useState)(0),S=I[0],_=I[1],k=(0,l.useState)(0),q=k[0],D=k[1],T=(0,l.useState)(0),M=T[0],O=T[1],F=(0,V.Z)("(max-width: 600px)"),A=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:o}}}}).data,E=(void 0===A?rR:A).jobs.aggregate.count,R=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:o}}}}),2),$=R[0],N=R[1],W=N.data,J=(void 0===W?{jobs:[]}:W).jobs,L=N.fetchMore,B=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:o}}}}).data,Y=(void 0===B?rR:B).jobs.aggregate.count,H=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:o}}}}),2),G=H[0],Q=H[1],z=Q.data,U=(void 0===z?{jobs:[]}:z).jobs,K=Q.fetchMore,X=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:o}}}}).data,ee=(void 0===X?rR:X).jobs.aggregate.count,en=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:o}}}}),2),et=en[0],eo=en[1],er=eo.data,ea=(void 0===er?{jobs:[]}:er).jobs,ei=eo.fetchMore,el=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:o}}}}).data,es=(void 0===el?rR:el).jobs.aggregate.count,eu=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:o}}}}),2),ed=eu[0],ec=eu[1],ep=ec.data,em=(void 0===ep?{jobs:[]}:ep).jobs,eh=ec.fetchMore,ev=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:o}}}}).data,ef=(void 0===ev?rR:ev).jobs.aggregate.count,ex=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:o}}}}),2),eg=ex[0],eb=ex[1],ey=eb.data,ej=(void 0===ey?{jobs:[]}:ey).jobs,eZ=eb.fetchMore,ew=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:o}}}}).data,eC=(void 0===ew?rR:ew).jobs.aggregate.count,eI=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:o}}}}),2),eS=eI[0],eP=eI[1],e_=eP.data,ek=(void 0===e_?{jobs:[]}:e_).jobs,eq=eP.fetchMore,eD=(0,Z.aM)(ez,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:o}}}}).data,eT=(void 0===eD?rR:eD).jobs.aggregate.count,eM=(0,f.Z)((0,w.t)(eU,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:o}}}}),2),eO=eM[0],eF=eM[1],eA=eF.data,eE=(void 0===eA?{jobs:[]}:eA).jobs,eR=eF.fetchMore,e$=function(e,n){var t=n.id;e.stopPropagation(),r.show({content:(0,i.jsx)(rq.g,{jobId:t,toggleShow:r.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},eN=function(e){e({variables:{offset:0,limit:50}})};return(0,i.jsx)(rZ,{icon:(0,i.jsx)(o8.Z,{component:rE,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:n,onOpen:t,spacing:3,children:(0,i.jsxs)(s.Z,{direction:"row",flexWrap:"wrap",columnGap:F?0:1,children:[(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Job raised"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN($)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:J,hasMore:J.length<E,handleFetchMore:function(){return rk({fetchMore:L,offset:d,limit:50,setOffset:c})}}),children:[E,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Job offered"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(G)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:U,hasMore:U.length<Y,handleFetchMore:function(){return rk({fetchMore:K,offset:m,limit:50,setOffset:h})}}),children:[Y,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Job accepted"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(et)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:ea,hasMore:ea.length<ee,handleFetchMore:function(){return rk({fetchMore:ei,offset:g,limit:50,setOffset:b})}}),children:[ee,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"In progress"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(ed)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:em,hasMore:em.length<es,handleFetchMore:function(){return rk({fetchMore:eh,offset:j,limit:50,setOffset:C})}}),children:[es,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Complete"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(eg)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:ej,hasMore:ej.length<ef,handleFetchMore:function(){return rk({fetchMore:eZ,offset:S,limit:50,setOffset:_})}}),children:[ef,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(F),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Report sent"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(eS)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:ek,hasMore:ek.length<eC,handleFetchMore:function(){return rk({fetchMore:eq,offset:q,limit:50,setOffset:D})}}),children:[eC,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",sx:(0,v.Z)((0,a.Z)({},r$.mobileItem(F)),{width:F?"100%":"auto"}),children:[(0,i.jsx)(P.Z,{fontWeight:700,children:"Closed"}),(0,i.jsx)(t8.Z,{color:"white",sx:{height:"16px"}}),(0,i.jsxs)(rn,{onOpen:function(){return eN(eO)},popover:(0,i.jsx)(r_,{onItemClick:e$,jobs:eE,hasMore:eE.length<eT,handleFetchMore:function(){return rk({fetchMore:eR,offset:M,limit:50,setOffset:O})}}),children:[eT,(0,i.jsx)(ru.Z,{sx:{height:"14px"}})]})]})]})})},rW=function(e){var n=e.defaultExpanded,t=e.locationId,o=(0,l.useState)(n),r=o[0],a=o[1],s=(0,V.Z)("(max-width: 600px)"),u=function(e){a(e)};return(0,i.jsxs)(rJ,{direction:"row",justifyContent:s?"flex-start":"flex-end",width:"100%",spacing:1,children:[(0,i.jsx)(rC,{expanded:"info"===r,handleOpen:function(){return u("info")},locationId:t}),(0,i.jsx)(rF,{expanded:"jobs"===r,handleOpen:function(){return u("jobs")},locationId:t}),(0,i.jsx)(rN,{expanded:"event"===r,handleOpen:function(){return u("event")},locationId:t})]})};rW.defaultProps={defaultExpanded:null},rW.propTypes={defaultExpanded:b().string,locationId:b().string};var rJ=(0,d.ZP)(s.Z)(function(){return{position:"relative",color:"#BEEFFF"}}),rL=t(97824),rB=t(39474),rY=t(45416),rH=t(18586),rV=t(15843),rG=t(48381),rQ=t(5336),rz={search:"",year:j()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,showExpiredItems:!1},rU=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(0,a.Z)({},e.reduce(function(e,o){var r=n.find(function(e){return e.value===o.field&&!t.includes(o.field)});return(0,v.Z)((0,a.Z)({},e),(0,oO.Z)({},o.field,Boolean(r)))},{}))},rK=function(e){var n={search:"Search",year:"Year",status:"Status",tags:"Tags",customerId:"Customer",locationId:"Location",sublocationId:"Sublocation",userId:"User",assetCategoryId:"Asset Category",assetId:"Asset",supplierId:"Supplier",customerManagerId:"Customer Manager",allJobs:"All Jobs",allItems:"All Items",showExpiredItems:"Show Expired Items"},t={search:function(e){return e},year:function(e){return j()(e).format("YYYY")},status:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},tags:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},customerId:function(e){return null==e?void 0:e.label},locationId:function(e){return null==e?void 0:e.label},sublocationId:function(e){return null==e?void 0:e.label},userId:function(e){return null==e?void 0:e.label},assetCategoryId:function(e){return null==e?void 0:e.label},assetId:function(e){return null==e?void 0:e.label},supplierId:function(e){return null==e?void 0:e.label},customerManagerId:function(e){return null==e?void 0:e.label},allJobs:function(e){return null==e?void 0:e.label},allItems:function(e){return null==e?void 0:e.label},showExpiredItems:function(e){return e?"True":"False"}};return Object.entries(e).reduce(function(e,o){var r=(0,f.Z)(o,2),a=r[0],i=r[1];if(!i||!n[a]||!t[a])return e;var l=n[a],s=(0,t[a])(i);return s&&e.push({key:a,label:"".concat(l," is ").concat(s)}),e},[])},rX=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,u=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,er.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,V.Z)("(max-width: 600px)"),y=(0,n_.cI)({defaultValues:(0,a.Z)({},rz)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=(0,y.watch)("locationId"),S=ow({locationIdWatch:I,locationId:n,accountId:h.accountId}),P=S.customerProps,k=S.propertyProps,D=S.sublocationProps,T=S.assetCategoryProps,M=S.assetProps,O=S.supplierProps,F=S.customerManagerProps,A=S.userProps;(0,l.useEffect)(function(){var e,t,o,r,i,l,s,d,m,h,v,f,x,g,b={search:u.search?"%".concat(u.search,"%"):null,status:(null===(e=u.status)||void 0===e?void 0:e.length)>0?null===(t=u.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=u.tags)||void 0===o?void 0:o.length)>0?null===(r=u.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(i=u.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=u.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=u.sublocationId)||void 0===s?void 0:s.value,userId:null===(d=u.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=u.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=u.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=u.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=u.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=u.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=u.allItems)||void 0===g?void 0:g.value,year:u.year||rz.year,showExpiredItems:u.showExpiredItems};w((0,a.Z)({},rz,u)),c(function(e){return(0,a.Z)({},e,b)}),p(rK((0,a.Z)({},rz,u)))},[u,n,w,c,p]);var E=function(e){try{var n=C();d(function(e){return(0,a.Z)({},e,n)})}finally{o()}},R=function(){var e=(0,a.Z)({},rz);d(e),o()};return(0,i.jsx)(oy.Z,{keepMounted:!0,open:t,onClose:o,children:(0,i.jsx)("form",{onSubmit:Z(E),children:(0,i.jsxs)(r0,{is600pxOrLess:b,children:[(0,i.jsxs)(_.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,children:(0,i.jsx)(n_.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nZ.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oj.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(oZ.r,{control:j})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({disabled:!I&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance Jobs Only"},{value:"overduePPM",label:"Overdue PPM Jobs"},{value:"incompleteFollowOn",label:"Incomplete Follow-on Jobs"},{value:"followOn",label:"Items with Follow-on Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"Items with Complete Jobs"},{value:"incomplete",label:"Items with Incomplete Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Items"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"showExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{control:(0,i.jsx)(nq.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Show expired items"})}})})]}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(q.Z,{variant:"contained",color:"danger",onClick:function(){return R()},children:"Cancel"}),(0,i.jsx)(q.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};rX.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},rX.propTypes={locationId:b().string,open:b().bool,close:b().func,hideFilters:b().array,filtersFormData:b().object,setFiltersFormData:b().func,setFilters:b().func,setFiltersChips:b().func};var r0=(0,ou.Z)(u.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),r1=t(83178),r2=function(e){var n=j()(e).startOf("year").toISOString(),t=j()(e).endOf("year").toISOString();return{status:{_neq:"canceled"},timingStart:{_gte:n,_lte:t}}},r3=function(e,n){switch(e){case"compliance":return[{Compliances:{}}];case"overduePPM":return[{_not:{statusData:{_has_key:"inProgress"},timingStart:{_lte:n}}}];case"incompleteFollowOn":return[{Jobs:{},_not:{statusData:{_has_key:"inProgress"}}}];case"followOn":return[{Jobs:{}}];default:return[]}},r5=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},r6=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},r4=function(e,n){var t,o,r,a,i,l,s=e.search,u=e.status,d=e.tags,c=e.customerId,p=e.locationId,m=e.sublocationId,h=e.userId,v=e.assetCategoryId,f=e.assetId,x=e.supplierId,g=e.customerManagerId,b=e.allJobs,y=e.allItems,Z=e.year,w=e.showExpiredItems,C=j()().subtract(24,"hours").toISOString(),I=[];return I.push(r2(Z)),I.push(x?{_or:[{supplierId:{_eq:x}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:x},status:{_in:["offered","accepted"]}}}]}:{}),I.push(s?{_or:[{reference:{_ilike:s}},{description:{_ilike:s}},{_or:[{JobSchedule:{reference:{_ilike:s}}},{JobSchedule:{description:{_ilike:s}}}]}]}:{}),I.push((null==u?void 0:u.length)>0?{status:{_in:u}}:{}),I.push((null==d?void 0:d.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:d}}}}:{}),I.push(r6(h,n)),I.push(f?{Assets:{assetId:{_eq:f}}}:{}),I.push(g?{Customer:{Manager:{id:{_eq:g}}}}:{}),I.push.apply(I,(0,L.Z)(r3(b,C))),I.push.apply(I,(0,L.Z)(r5(y))),I.push({}),{where:{type:{_eq:"ppm"},locationId:{_eq:p},sublocationId:{_eq:m},assetCategoryId:{_eq:v},customerId:{_eq:c},_and:I}}},r9=function(e){var n,t,o=e.locationId,r=e.initialFilters,u=e.hideFilters,d=e.containerHeight,c=e.tableHeight,p=e.onViewChange,m=(0,er.x)(),h=m.user,x=m.hasRole,g=x("supplier"),b=x("customer"),y=(0,V.Z)("(max-width: 600px)"),C=(0,rH.q)().admin,I=null==C?void 0:null===(n=C.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,P=null==C?void 0:null===(t=C.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,k=(0,f.Z)((0,oF.X)("scheduledjob_table_jobs".concat(r.filterType),r,"network"),2),D=k[0],T=k[1],M=(0,l.useState)(r),O=M[0],A=M[1],E=(0,l.useState)([]),R=E[0],$=E[1],N=(0,l.useState)(!1),B=N[0],Y=N[1],H=(0,l.useState)([]),G=H[0],z=H[1],U=(0,l.useState)(!1),K=U[0],X=U[1],ee=(0,l.useState)(!1),en=ee[0],et=ee[1],eo=(0,nT.x)({filters:O}),ea=eo.ref,ei=eo.initialData,el=(0,l.useMemo)(function(){return r4((0,a.Z)({},O),h.accountType)},[O,h.accountType]),es=(0,Z.aM)(e5,{variables:(0,a.Z)({},ei,el)}),eu=es.data,ed=void 0===eu?{jobs:[],meta:{aggregate:{totalCount:0}}}:eu,ep=ed.jobs,em=ed.meta,eh=es.loading,ev=es.refetch,ef=(0,f.Z)((0,w.t)(e5,{variables:(0,a.Z)((0,v.Z)((0,a.Z)({},ei),{limit:null,offset:0}),el)}),1)[0],ex=(0,l.useCallback)(function(e){var n=[];return b||g||n.push({context:"secondary",icon:"edit",onClick:function(n){return Q().push("/dashboard/issues/manage?id=".concat(e.number))},tooltip:"Edit"}),n.push({context:"secondary",icon:"info",onClick:function(n){return Q().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"Info"}),n},[b,g]),eg=(0,l.useMemo)(function(){return[{defaultSelected:!0,minWidth:60,field:"id",headerName:"Job ID",renderCell:function(e){var n=e.row;return(0,i.jsx)(rY.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:I,numberSuffix:P})}},{defaultSelected:!0,minWidth:60,field:"invoiceNumber",headerName:"Invoice ID",renderCell:function(e){return e.row.invoiceNumber},sortable:!1},{defaultSelected:!0,minWidth:200,field:"service",headerName:"Service",sortName:'{"Service": {"name": "ORDER"}}'},{width:60,field:"type",headerName:"Type",sortable:!1},{minWidth:300,field:"tags",headerName:"Tags",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(rG.K,{row:n,refetchQueries:["GetScheduledJobs"],entity:"Job"})}},{defaultSelected:!0,minWidth:200,flex:1,field:"description",headerName:"Description",sortable:!1},{defaultSelected:!0,minWidth:130,flex:1,field:"manager",headerName:"Assigned to",sortName:'{"Manager": {"nameFirst": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(J.r,{noWrap:!n.managerId||g,color:"secondary",href:"/dashboard/users/view?id=".concat(n.managerId),children:n.manager})}},{minWidth:130,flex:1,field:"sublocation",headerName:"Sub Location",sortName:'{"Sublocation": {"name": "ORDER"}}',renderCell:function(e){return e.row.sublocation}},{minWidth:130,flex:1,field:"customer",headerName:"Customer",sortName:'{"Customer": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(J.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(n.customerId),noWrap:b,children:n.customer})}},{defaultSelected:!0,minWidth:180,flex:1,field:"customerManager",headerName:"Account Manager",sortName:'{"Customer": {"Manager": {"fullName": "ORDER"}}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(J.r,{noWrap:!n.customerManagerId,color:"secondary",href:"/dashboard/users/view?id=".concat(n.customerManagerId),children:n.customerManager})}},{defaultSelected:!0,minWidth:140,flex:1,field:"supplier",headerName:"Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(J.r,{noWrap:!n.supplierId||g,color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),children:n.supplier})}},{minWidth:140,flex:1,field:"assetCategory",headerName:"Asset Category",sortName:'{"AssetCategory": {"name": "ORDER"}}',renderCell:function(e){return e.row.assetCategory}},{minWidth:140,flex:1,field:"assets",headerName:"Assets Name",sortable:!1,renderCell:function(e){return e.row.assets}},{defaultSelected:!0,minWidth:100,flex:1,field:"scheduled",headerName:"Scheduled",sortName:"timingStart",renderCell:function(e){var n=e.row;return j()(n.timingStart).format("YYYY-MM-DD")}},{minWidth:100,flex:1,field:"createdAt",headerName:"Created",sortName:"createdAt",renderCell:function(e){var n=e.row;return j()(n.createdAt).format("YYYY-MM-DD")}},{defaultSelected:!0,minWidth:140,flex:1,field:"status",headerName:"Status",sortName:"status",renderCell:function(e){var n=e.row;return(0,i.jsx)(ec.B,{value:n.status})}},{defaultSelected:!0,width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var n=e.row;return y?(0,i.jsxs)(s.Z,{direction:"row",rowGap:2,children:[(0,i.jsx)(IconButton,{onClick:function(e){return Q().push("/dashboard/issues/manage?id=".concat(n.number))},children:(0,i.jsx)(Edit,{sx:{color:"#000000"}})}),(0,i.jsx)(IconButton,{onClick:function(e){return Q().push("/dashboard/issues/view?id=".concat(n.number))},children:(0,i.jsx)(Info,{sx:{color:"#000000"}})})]}):(0,i.jsx)(rQ.C,{actionsData:ex,row:n})}}]},[I,P,g,b,y,ex]),eb=(0,l.useMemo)(function(){return ep.map(function(e){var n,t,o,r,a,i,l,s,u,d,c,p,m,h,v,f,x;return{id:e.id,type:e.type,number:e.number,invoiceNumber:(0,L.Z)(new Set(e.invoices.map(function(e){return e.invoiceNumber}))).join(", ")||"-",service:(null===(n=e.service)||void 0===n?void 0:n.name)||"-",description:(null===(t=e.shortJobDesc)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:null===(r=o.taxonomy)||void 0===r?void 0:r.name)||"-",manager:(null===(a=e.manager)||void 0===a?void 0:a.fullName)||"-",managerId:null===(i=e.manager)||void 0===i?void 0:i.id,sublocation:(null===(l=e.sublocation)||void 0===l?void 0:l.name)||"-",customer:null===(s=e.customer)||void 0===s?void 0:s.name,customerId:null===(u=e.customer)||void 0===u?void 0:u.id,customerManager:(null===(d=e.customer)||void 0===d?void 0:null===(c=d.manager)||void 0===c?void 0:c.fullName)||"-",customerManagerId:null===(p=e.customer)||void 0===p?void 0:null===(m=p.manager)||void 0===m?void 0:m.id,supplier:(null===(h=e.supplier)||void 0===h?void 0:h.name)||"-",supplierId:null===(v=e.supplier)||void 0===v?void 0:v.id,assetCategory:(null===(f=e.assetCategory)||void 0===f?void 0:f.name)||"-",assets:(null===(x=e.assets)||void 0===x?void 0:x.map(function(e){return e.asset.name}).join(", "))||"-",timingStart:e.timingStart,createdAt:e.createdAt,status:e.status,tags:e.tags}})},[ep]),ey=(0,l.useMemo)(function(){return b?["manager","supplier","tags"]:g?["customer","customerManager","tags"]:void 0},[b,g]),ej=function(e){var n=e.columns;ef().then(function(e){var t=e.data,o=W().unparse(t2(null==t?void 0:t.jobs,n,t1)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,o_.S)(r,"Planned_Maintenance_".concat(j()().format("YYYY/MM/DD"),".csv"))})},eZ=(0,l.useMemo)(function(){return rU(eg,G,ey)},[eg,G,ey]),ew=(0,l.useCallback)(function(e){T(function(n){var t=(0,a.Z)({},n);return delete t[e],t})},[T]),eC=(0,l.useMemo)(function(){return eg.map(function(e){var n,t=e.headerName;return{label:t,value:e.field,defaultSelected:e.defaultSelected}})},[eg]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(rX,{locationId:o,open:B,close:function(){return Y(!1)},hideFilters:u,filtersFormData:D,setFiltersFormData:T,setFilters:A,setFiltersChips:$}),(0,i.jsx)(o5,{open:K,close:function(){et(!1),X(!1)},onCompleted:en?function(e){return ej(e)}:null,initialFilters:r,columns:eC,setColumns:z,submitBtnText:en?"Export":"Apply",subtitle:en?"Select the columns you would like to export in the csv file.":"Select the columns you would like to see in the table."}),(0,i.jsxs)(s.Z,{sx:{height:d},children:[(0,i.jsxs)(_.ZP,{container:!0,rowGap:2,pl:2,justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,i.jsx)(_.ZP,{item:!0,xs:8,md:2,lg:2,order:{xs:1},children:(0,i.jsxs)(rB.Z,{variant:"contained",children:[(0,i.jsx)(q.Z,{startIcon:(0,i.jsx)(r1.Z,{}),onClick:function(){return X(!0)},children:"Columns"}),(0,i.jsx)(q.Z,{startIcon:(0,i.jsx)(rV.Z,{}),onClick:function(){return Y(!0)},children:"Filters"})]})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:8,lg:8,order:{xs:3,md:2,lg:2},children:(0,i.jsx)(oY,{filtersChips:R,onRemove:ew})}),(0,i.jsxs)(_.ZP,{item:!0,xs:4,md:2,lg:2,order:{xs:2,md:3,lg:3},children:[(0,i.jsx)(q.Z,{onClick:function(){et(!0),X(!0)},disableMinWidth:!0,color:"info",variant:"contained",children:(0,i.jsx)(F.Z,{})}),(0,i.jsx)(q.Z,{variant:"contained",color:"info",startIcon:(0,i.jsx)(o8.Z,{component:rT,inheritViewBox:!0}),onClick:function(e){return p("calendar")},sx:{minWidth:"110px",maxHeight:"40px",marginLeft:"10px!important"},children:"Calendar"})]})]}),(0,i.jsx)(S.Z,{sx:{height:d},children:(0,i.jsx)(o1,{autoHeight:!1,ref:ea,loading:eh,columns:eg,rows:eb,meta:em,refetch:ev,containerHeight:c,columnVisibilityModel:eZ})})]})]})};r9.defaultProps={initialFilters:{},containerHeight:"calc(100vh - 190px)",tableHeight:"calc(100% - 32px)"};var r7=t(99534),r8=t(48999);function ae(){return(ae=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let an=e=>l.createElement("svg",ae({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 21.007 5.03c-.31-.457-.944-.518-1.372-.169l-6.503 5.307a1 1 0 0 1-1.632-.775z"}),l.createElement("path",{fill:"#E9175E",d:"M18.472 4.944c.318-.267.446-.708.258-1.079-.49-.97-1.293-1.791-2.43-2.365a9 9 0 0 0-3.314-.963C12.44.489 12 .94 12 1.487V8.24a1 1 0 0 0 1.644.765z"}));function at(){return(at=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let ao=e=>l.createElement("svg",at({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 22.957 12.5c.047-.55-.405-.999-.957-.999h-9.5a1 1 0 0 1-1-1z"}),l.createElement("path",{fill:"#E9175E",d:"M21.399 10.31a1 1 0 0 0 1-1v-.332a9.56 9.56 0 0 0-5.159-7.202 9.7 9.7 0 0 0-3.506-.988c-.55-.048-.993.41-.985.963l.108 7.574a1 1 0 0 0 1 .985h7.542"}));function ar(){return(ar=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let aa=e=>l.createElement("svg",ar({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 1 0 9.804 18.854c.355-.423.243-1.05-.21-1.367l-8.17-5.731a1 1 0 0 1-.425-.819z"}),l.createElement("path",{fill:"#E9175E",d:"M20.395 16.094c.461.319 1.107.189 1.37-.316a10.8 10.8 0 0 0 1.207-4.395 10.55 10.55 0 0 0-1.14-5.41A9.9 9.9 0 0 0 18.15 2.01a9.6 9.6 0 0 0-4.17-1.348c-.55-.045-.996.417-.995.968l.018 8.842c0 .323.157.623.421.805z"}));function ai(){return(ai=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let al=e=>l.createElement("svg",ai({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 23"},e),l.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 0 0 0 22.914c.55.047.999-.405.999-.957V1"}),l.createElement("path",{fill:"#E9175E",d:"M12 1c0-.552.448-1.004.999-.96 2.817.225 5.472 1.398 7.486 3.328C22.735 5.525 24 8.45 24 11.5s-1.264 5.975-3.515 8.132c-2.014 1.93-4.67 3.103-7.486 3.328-.55.044-.999-.408-.999-.96V1"}));function as(){return(as=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let au=e=>l.createElement("svg",as({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552.449-1.005.999-.957a11.5 11.5 0 1 1-9.804 18.854c-.356-.423-.243-1.05.21-1.367l8.17-5.731a1 1 0 0 0 .425-.819z"}),l.createElement("path",{fill:"#E9175E",d:"M2.963 16.078c-.463.326-1.117.194-1.379-.318a10.95 10.95 0 0 1-1.178-4.377 10.7 10.7 0 0 1 1.121-5.41A9.85 9.85 0 0 1 5.151 2.01 9.3 9.3 0 0 1 9.237.663c.548-.046.995.416.994.967l-.018 8.846a.98.98 0 0 1-.415.801z"}));function ad(){return(ad=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let ac=e=>l.createElement("svg",ad({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 .043 12.5c-.048-.55.405-.999.957-.999h9.5a1 1 0 0 0 1-1z"}),l.createElement("path",{fill:"#1AB43B",d:"M1.601 10.31a1 1 0 0 1-1-1v-.332A9.56 9.56 0 0 1 5.76 1.776 9.7 9.7 0 0 1 9.266.788c.55-.048.993.41.985.963l-.108 7.574a1 1 0 0 1-1 .985H1.601"}));function ap(){return(ap=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let am=e=>l.createElement("svg",ap({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 1.993 5.03c.31-.457.944-.518 1.372-.169l6.503 5.307a1 1 0 0 0 1.632-.775z"}),l.createElement("path",{fill:"#1AB43B",d:"M4.528 4.944c-.318-.267-.446-.708-.258-1.079.49-.97 1.293-1.791 2.43-2.365a9 9 0 0 1 3.314-.963c.545-.048.985.404.985.95V8.24a1 1 0 0 1-1.644.765z"}));function ah(){return(ah=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let av=e=>l.createElement("svg",ah({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),l.createElement("circle",{cx:11.5,cy:11.5,r:11.5,fill:"#1AB43B",transform:"rotate(-90 11.5 11.5)"}));var af=function(e){var n,t,o=e.data,r=o[0]||0,a=r+(o[1]||0),l=r/a*100;return 0===a?(0,i.jsx)(ax,{component:av,inheritViewBox:!0,color:"gray"}):(0,i.jsx)("div",{children:(0===l?(n=av,t="danger"):l>0&&l<12.5?n=am:l>=12.5&&l<25?n=ac:l>=25&&l<37.5?n=au:l>=37.5&&l<50?n=al:l>=50&&l<62.5?n=aa:l>=62.5&&l<75?n=ao:l>=75&&l<100?n=an:100===l&&(n=av,t="success"),(0,i.jsx)(ax,{component:n,inheritViewBox:!0,color:t}))})};af.defaultProps={data:[]},af.propTypes={data:b().array};var ax=(0,d.ZP)(o8.Z)(function(e){var n=e.theme,t=e.color;return{"& path, circle":(0,a.Z)({},"success"===t&&{fill:n.palette.success.main},"danger"===t&&{fill:n.palette.danger.main},"gray"===t&&{fill:"#BFBFBF"})}}),ag=t(6775);function ab(e){var n=e.title,t=e.month,o=e.year,r=e.complete,a=e.inComplete,l=e.followOn,u=e.inCompleteCompliance;return(0,i.jsx)(S.Z,{sx:{padding:"8px 16px"},children:(0,i.jsxs)(s.Z,{spacing:1,children:[(t||o)&&(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:.5,children:[t&&(0,i.jsxs)(P.Z,{variant:"h6",children:[t," "]}),o&&(0,i.jsx)(P.Z,{variant:"h6",sx:{opacity:"0.54"},children:o})]}),n&&(0,i.jsx)(P.Z,{variant:"h6",children:n}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(ay,{mr:1,bgcolor:"success.main"})," ",(0,i.jsxs)(P.Z,{children:["Complete: ",r]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(ay,{mr:1,bgcolor:"danger.main"})," ",(0,i.jsxs)(P.Z,{children:["Incomplete: ",a]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(ay,{mr:1,bgcolor:"info.main"})," ",(0,i.jsxs)(P.Z,{children:["Follow on jobs: ",l]})]}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(ag.Z,{sx:{height:"14px",width:"14px",marginRight:"8px",color:"danger.main"}}),(0,i.jsxs)(P.Z,{children:["Incomplete compliance jobs: ",u]})]})]})})}ab.defaultProps={month:"",year:"",complete:0,inComplete:0,followOn:0,inCompleteCompliance:0},ab.propTypes={month:b().string,year:b().string,complete:b().number,inComplete:b().number,followOn:b().number,inCompleteCompliance:b().number};var ay=(0,d.ZP)(S.Z)(function(e){return e.theme,{width:14,height:14,borderRadius:"50%"}}),aj=function(e){var n=e.year,t=e.month,o=e.total,r=e.complete,a=e.inComplete,l=e.followOn,u=e.inCompleteCompliance,d=e.onClick,c=[0,0];return j()().isSameOrAfter(j()().month(t).year(n))&&(c[0]=r,c[1]=a),(0,i.jsx)(aZ,{followCursor:!0,title:(0,i.jsx)(ab,{year:n,month:t,complete:r,inComplete:a,followOn:l,inCompleteCompliance:u}),children:(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,backgroundColor:"#F2F2F2"},onClick:d,children:[(0,i.jsx)(I.Z,{color:"info",variant:"dot",invisible:0===l,children:(0,i.jsx)(S.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#FFFFFF"},children:(0,i.jsx)(P.Z,{fontWeight:600,children:o})})}),(0,i.jsx)("div",{children:(0,i.jsx)(af,{data:c})})]})})};aj.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,onClick:function(){}},aj.propTypes={year:b().string,month:b().string,total:b().number,complete:b().number,inComplete:b().number,followOn:b().number,inCompleteCompliance:b().number,onClick:b().func};var aZ=(0,d.ZP)(function(e){var n=e.className,t=(0,r7.Z)(e,["className"]);return(0,i.jsx)(nL.Z,(0,v.Z)((0,a.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oO.Z)({},"& .".concat(r8.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aw=function(e){var n=e.children,t=e.selected,o=(0,V.Z)("(max-width: 600px)");return(0,i.jsx)(aC,{selected:t,isWidth600PxOrLess:o,children:(0,i.jsx)(P.Z,{children:n})})};aw.defaultProps={selected:!1},aw.propTypes={children:b().node,selected:b().bool};var aC=(0,d.ZP)(S.Z)(function(e){var n=e.theme,t=e.selected,o=e.isWidth600PxOrLess;return{display:"flex",justifyContent:"center",alignItems:"center",padding:"4px 20px",borderRadius:"8px",backgroundColor:t&&!o?n.palette.secondary.main:"none","& .MuiTypography-root":{fontWeight:t?400:700,color:t?n.palette.secondary.contrastText:n.palette.black.main}}}),aI=function(e){var n=e.jobs,t=e.timePeriods,o=e.year,r={},a={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return t.forEach(function(e){var t=e.value,i={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0},l=j()().month(t).year(o).startOf("month"),s=j()().month(t).year(o).endOf("month"),u=aS(n,l,s);i.count=u.count,i.completeCount=u.completeCount,i.inCompleteCount=u.inCompleteCount,i.followOnCount=u.followOnCount,i.inCompleteComplianceCount=u.inCompleteComplianceCount,a.count+=i.count,a.completeCount+=i.completeCount,a.inCompleteCount+=i.inCompleteCount,a.followOnCount+=i.followOnCount,a.inCompleteComplianceCount+=i.inCompleteComplianceCount,r[t]=i}),{countByPeriod:r,totalCount:a}},aS=function(e,n,t){var o={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return e.forEach(function(e){var r;j()(e.timingStart).isBetween(n,t)&&((null===(r=e.statusData)||void 0===r?void 0:r.completed)?o.completeCount++:(o.inCompleteCount++,e.hasCompliance&&o.inCompleteComplianceCount++),o.count++)}),o},aP=function(e){var n=e.year,t=e.total,o=e.complete,r=e.inComplete,a=e.followOn,l=e.inCompleteCompliance;return(0,i.jsx)(a_,{followCursor:!0,title:(0,i.jsx)(ab,{year:n,complete:o,inComplete:r,followOn:a,inCompleteCompliance:l}),children:(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,border:"1px solid #BFBFBF"},children:[(0,i.jsx)(I.Z,{color:"info",variant:"dot",invisible:0===a,children:(0,i.jsx)(S.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#F2F2F2"},children:(0,i.jsx)(P.Z,{fontWeight:600,children:t})})}),(0,i.jsx)("div",{children:(0,i.jsx)(af,{data:[o,r]})})]})})};aP.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,chartColors:[],chartRotation:0},aP.propTypes={year:b().string,total:b().number,complete:b().number,inComplete:b().number,followOn:b().number,inCompleteCompliance:b().number};var a_=(0,d.ZP)(function(e){var n=e.className,t=(0,r7.Z)(e,["className"]);return(0,i.jsx)(nL.Z,(0,v.Z)((0,a.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oO.Z)({},"& .".concat(r8.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),ak=function(e){var n=e.locationId,t=e.year,o=e.month,r=(0,l.useMemo)(function(){return j()().month(o).year(t).startOf("month").toISOString()},[o,t]),a=(0,l.useMemo)(function(){return j()().month(o).year(t).endOf("month").toISOString()},[o,t]),s=(0,Z.aM)(e7,{variables:{whereComplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},statusData:{_has_key:"completed"},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereIncomplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereFollowOn:{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereIncompleteCompliance:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},Jobs:{},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}}}}),u=s.data,d=void 0===u?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:u,c=d.jobsCompleteCount.aggregate.count,p=d.jobsIncompleteCount.aggregate.count,m=d.jobsFollowOnCount.aggregate.count,h=d.jobsIncompleteComplianceCount.aggregate.count,v=s.loading,f=c+p;return v?null:(0,i.jsx)(aD,{followCursor:!0,title:(0,i.jsx)(ab,{year:t,month:o,complete:c,inComplete:p,followOn:m,inCompleteCompliance:h}),children:(0,i.jsxs)(_.ZP,{container:!0,width:"100%",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,order:{xs:2,md:1,lg:1},sx:{textAlign:"center"},children:(0,i.jsxs)(P.Z,{color:"#323E4E",children:[f," ",f>1?"jobs":"job"]})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,order:{xs:1,md:2,lg:2},sx:{display:"flex",width:"100%",alignItems:"center",height:"4px"},children:0!==f&&j()().isAfter(r)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(aq,{percentage:c/f*100,color:"success"}),(0,i.jsx)(aq,{percentage:p/f*100,color:"danger"})]}):(0,i.jsx)(aq,{percentage:100,color:"gray"})})]})})};ak.defaultProps={year:"",month:""},ak.propTypes={locationId:b().string,year:b().string,month:b().string};var aq=(0,d.ZP)(S.Z)(function(e){var n=e.theme,t=e.percentage,o=e.color;return(0,a.Z)({width:"".concat(t,"%"),height:"100%"},"success"===o&&(0,v.Z)((0,a.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===o&&(0,v.Z)((0,a.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===o&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),aD=(0,d.ZP)(function(e){var n=e.className,t=(0,r7.Z)(e,["className"]);return(0,i.jsx)(nL.Z,(0,v.Z)((0,a.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oO.Z)({},"& .".concat(r8.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aT=t(44844),aM=function(e){var n=e.locationIdWatch,t=e.locationId,o=e.accountId,r=(0,l.useState)(""),a=r[0],i=r[1],s=(0,l.useState)(""),u=s[0],d=s[1],c=(0,l.useState)(""),p=c[0],m=c[1],h=(0,l.useState)(""),v=h[0],x=h[1],g=(0,l.useState)(""),b=g[0],y=g[1],j=(0,l.useState)(""),Z=j[0],C=j[1],I=(0,l.useState)(""),S=I[0],P=I[1],_=(0,l.useState)(""),k=_[0],q=_[1],D=(0,f.Z)((0,w.t)(ni.SW,{variables:{q:""!==a?"%".concat(a,"%"):null,limit:50,offset:0}}),2),T=D[0],M=D[1],O=M.loading,F=M.data,A=(void 0===F?{items:[]}:F).items,E=(0,f.Z)((0,w.t)(ni._d,{variables:{where:{name:{_ilike:""!==u?"%".concat(u,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),R=E[0],$=E[1],N=$.loading,W=$.data,J=(void 0===W?{items:[]}:W).items,L=(0,f.Z)((0,w.t)(ni.zR,{variables:{locationId:n||t,q:""!==p?"%".concat(p,"%"):null,limit:50,offset:0}}),2),B=L[0],Y=L[1],H=Y.loading,V=Y.data,G=(void 0===V?{items:[]}:V).items,Q=(0,f.Z)((0,w.t)(ni.UM,{variables:{q:""!==v?"%".concat(v,"%"):null,limit:50,offset:0}}),2),z=Q[0],U=Q[1],K=U.loading,X=U.data,ee=(void 0===X?{items:[]}:X).items,en=(0,f.Z)((0,w.t)(ni.UH,{variables:{q:""!==b?"%".concat(b,"%"):null,limit:50,offset:0}}),2),et=en[0],eo=en[1],er=eo.loading,ea=eo.data,ei=(void 0===ea?{items:[]}:ea).items,el=(0,f.Z)((0,w.t)(ni.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==Z?"%".concat(Z,"%"):null}},limit:50,offset:0}}),2),es=el[0],eu=el[1],ed=eu.loading,ec=eu.data,ep=(void 0===ec?{items:[]}:ec).items,em=(0,f.Z)((0,w.t)(ni.K4,{variables:{accountId:o,limit:50,offset:0,q:""!==S?"%".concat(S,"%"):null}}),2),eh=em[0],ev=em[1],ef=ev.data,ex=(void 0===ef?{items:[]}:ef).items,eg=ev.loading,eb=(0,f.Z)((0,w.t)(ni.yR,{variables:{accountId:o,q:""!==k?"%".concat(k,"%"):null,limit:50,offset:0}}),2),ey=eb[0],ej=eb[1],eZ=ej.data,ew=(void 0===eZ?{items:[]}:eZ).items;return{customerProps:{onOpen:T,loading:O,options:A,setSearch:i},propertyProps:{onOpen:R,loading:N,options:J,setSearch:d},sublocationProps:{onOpen:B,loading:H,options:G,setSearch:m},assetCategoryProps:{onOpen:z,loading:K,options:ee,setSearch:x},assetProps:{onOpen:et,loading:er,options:ei,setSearch:y},supplierProps:{onOpen:es,loading:ed,options:ep,setSearch:C},customerManagerProps:{onOpen:eh,loading:eg,options:ex,setSearch:P},userProps:{onOpen:ey,loading:ej.loading,options:ew,setSearch:q}}},aO={search:"",year:j()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,showExpiredItems:!1},aF=function(e){var n={search:"Search",year:"Year",status:"Status",tags:"Tags",customerId:"Customer",locationId:"Location",sublocationId:"Sublocation",userId:"User",assetCategoryId:"Asset Category",assetId:"Asset",supplierId:"Supplier",customerManagerId:"Customer Manager",allJobs:"All Jobs",allItems:"All Items",showExpiredItems:"Show Expired Items"},t={search:function(e){return e},year:function(e){return j()(e).format("YYYY")},status:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},tags:function(e){return null==e?void 0:e.map(function(e){return e.label}).join(", ")},customerId:function(e){return null==e?void 0:e.label},locationId:function(e){return null==e?void 0:e.label},sublocationId:function(e){return null==e?void 0:e.label},userId:function(e){return null==e?void 0:e.label},assetCategoryId:function(e){return null==e?void 0:e.label},assetId:function(e){return null==e?void 0:e.label},supplierId:function(e){return null==e?void 0:e.label},customerManagerId:function(e){return null==e?void 0:e.label},allJobs:function(e){return null==e?void 0:e.label},allItems:function(e){return null==e?void 0:e.label},showExpiredItems:function(e){return e?"True":"False"}};return Object.entries(e).reduce(function(e,o){var r=(0,f.Z)(o,2),a=r[0],i=r[1];if(!i||!n[a]||!t[a])return e;var l=n[a],s=(0,t[a])(i);return s&&e.push({key:a,label:"".concat(l," is ").concat(s)}),e},[])},aA=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,u=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,er.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,V.Z)("(max-width: 600px)"),y=(0,n_.cI)({defaultValues:(0,a.Z)({},aO)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=(0,y.watch)("locationId"),S=aM({locationIdWatch:I,locationId:n,accountId:h.accountId}),P=S.customerProps,k=S.propertyProps,D=S.sublocationProps,T=S.assetCategoryProps,M=S.assetProps,O=S.supplierProps,F=S.customerManagerProps,A=S.userProps;(0,l.useEffect)(function(){var e,t,o,r,i,l,s,d,m,h,v,f,x,g,b={search:u.search?"%".concat(u.search,"%"):null,status:(null===(e=u.status)||void 0===e?void 0:e.length)>0?null===(t=u.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=u.tags)||void 0===o?void 0:o.length)>0?null===(r=u.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(i=u.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=u.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=u.sublocationId)||void 0===s?void 0:s.value,userId:null===(d=u.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=u.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=u.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=u.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=u.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=u.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=u.allItems)||void 0===g?void 0:g.value,year:u.year||aO.year,showExpiredItems:u.showExpiredItems};w((0,a.Z)({},aO,u)),c(function(e){return(0,a.Z)({},e,b)}),p(aF((0,a.Z)({},aO,u)))},[u,n,w,c,p]);var E=function(e){try{var n=C();d(function(e){return(0,a.Z)({},e,n)})}finally{o()}},R=function(){var e=(0,a.Z)({},aO);d(e),o()};return(0,i.jsx)(oy.Z,{keepMounted:!0,open:t,onClose:o,children:(0,i.jsx)("form",{onSubmit:Z(E),children:(0,i.jsxs)(aE,{is600pxOrLess:b,children:[(0,i.jsxs)(_.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,children:(0,i.jsx)(n_.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nZ.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oj.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(oZ.r,{control:j})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({disabled:!I&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance Jobs Only"},{value:"overduePPM",label:"Overdue PPM Jobs"},{value:"incompleteFollowOn",label:"Incomplete Follow-on Jobs"},{value:"followOn",label:"Items with Follow-on Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"Items with Complete Jobs"},{value:"incomplete",label:"Items with Incomplete Jobs"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Items"}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n_.Qr,{name:"showExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nJ.Z,{control:(0,i.jsx)(nq.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Show expired items"})}})})]}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(q.Z,{variant:"contained",color:"danger",onClick:function(){return R()},children:"Cancel"}),(0,i.jsx)(q.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};aA.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},aA.propTypes={locationId:b().string,open:b().bool,close:b().func,hideFilters:b().array,filtersFormData:b().object,setFiltersFormData:b().func,setFilters:b().func,setFiltersChips:b().func};var aE=(0,ou.Z)(u.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),aR=function(e){var n=e.locationId,t=e.year,o=(0,l.useMemo)(function(){return j()().year(t).startOf("year").toISOString()},[t]),r=(0,l.useMemo)(function(){return j()().year(t).endOf("year").toISOString()},[t]),a=(0,Z.aM)(e7,{variables:{whereComplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},statusData:{_has_key:"completed"},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereIncomplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereFollowOn:{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereIncompleteCompliance:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},Jobs:{},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}}}}),u=a.data,d=void 0===u?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:u,c=d.jobsCompleteCount.aggregate.count,p=d.jobsIncompleteCount.aggregate.count,m=d.jobsFollowOnCount.aggregate.count,h=d.jobsIncompleteComplianceCount.aggregate.count,v=a.loading,f=c+p;return v?null:(0,i.jsx)(aN,{followCursor:!0,title:(0,i.jsx)(ab,{year:t,complete:c,inComplete:p,followOn:m,inCompleteCompliance:h}),children:(0,i.jsxs)(s.Z,{width:"100%",alignItems:"center",children:[(0,i.jsxs)(P.Z,{color:"#323E4E",children:[f," ",f>1?"jobs":"job"]}),(0,i.jsx)(S.Z,{sx:{display:"flex",width:"100%",height:"4px"},children:0!==f&&j()().isAfter(o)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a$,{percentage:c/f*100,color:"success"}),(0,i.jsx)(a$,{percentage:p/f*100,color:"danger"})]}):(0,i.jsx)(a$,{percentage:100,color:"gray"})})]})})};aR.defaultProps={year:""},aR.propTypes={locationId:b().string,year:b().string};var a$=(0,d.ZP)(S.Z)(function(e){var n=e.theme,t=e.percentage,o=e.color;return(0,a.Z)({width:"".concat(t,"%"),height:"100%"},"success"===o&&(0,v.Z)((0,a.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===o&&(0,v.Z)((0,a.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===o&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),aN=(0,d.ZP)(function(e){var n=e.className,t=(0,r7.Z)(e,["className"]);return(0,i.jsx)(nL.Z,(0,v.Z)((0,a.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oO.Z)({},"& .".concat(r8.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aW=function(e){var n=j()(e).startOf("year").toISOString(),t=j()(e).endOf("year").toISOString();return{status:{_neq:"canceled"},timingStart:{_gte:n,_lte:t}}},aJ=function(e,n){switch(e){case"compliance":return[{Compliances:{}}];case"overduePPM":return[{_not:{statusData:{_has_key:"inProgress"},timingStart:{_lte:n}}}];case"incompleteFollowOn":return[{Jobs:{},_not:{statusData:{_has_key:"inProgress"}}}];case"followOn":return[{Jobs:{}}];default:return[]}},aL=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},aB=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},aY=function(e,n){var t,o,r,i,l,s,u,d=e.search,c=e.status,p=e.tags,m=e.customerId,h=e.locationId,v=e.sublocationId,f=e.userId,x=e.assetCategoryId,g=e.assetId,b=e.supplierId,y=e.customerManagerId,Z=e.allJobs,w=e.allItems,C=e.year,I=e.showExpiredItems,S=j()().subtract(24,"hours").toISOString(),P=[],_=[],k=[];return(d||(null==c?void 0:c.length)>0||(null==p?void 0:p.length)>0||f||g||m||b||y||Z||w)&&_.push(aW(C)),k.push.apply(k,(0,L.Z)(b?[{supplierId:{_eq:b}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:b},status:{_in:["offered","accepted"]}}}]:[])),_.push((null==c?void 0:c.length)>0?{status:{_in:c}}:{}),_.push((null==p?void 0:p.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:p}}}}:{}),_.push(aB(f,n)),_.push(g?{Assets:{assetId:{_eq:g}}}:{}),_.push(m?{customerId:{_eq:m}}:{}),_.push(y?{Customer:{Manager:{id:{_eq:y}}}}:{}),_.push.apply(_,(0,L.Z)(aJ(Z,S))),_.push.apply(_,(0,L.Z)(aL(w))),_.push({}),P.push.apply(P,(0,L.Z)(d?[{reference:{_ilike:d}},{description:{_ilike:d}},{_or:[{Jobs:{reference:{_ilike:d}}},{Jobs:{description:{_ilike:d}}}]}]:[])),{jobWhere:{status:{_neq:"canceled"},timingStart:{_gte:j()(C).startOf("year").toISOString(),_lte:j()(C).endOf("year").toISOString()}},where:(0,a.Z)({locationId:{_eq:h},sublocationId:{_eq:v},assetCategoryId:{_eq:x}},P.length>0?{_or:P}:{},_.length>0||k.length>0?{Jobs:(0,a.Z)({},k.length>0&&{_or:k},_.length>0&&{_and:_})}:{})}},aH={monthHeaderWrapper:function(e){return{padding:"5px",borderRadius:"10px",border:"2px solid #F2F2F2",backgroundColor:e?"#F2F2F2":"inherit"}}},aV=(0,l.forwardRef)(function(e,n){var t=e.rows,o=e.meta,r=e.refetch,u=e.loading,d=e.locationId,c=e.yearDate,p=(0,l.useState)(t$.uJ[0].value),m=p[0],h=p[1],v=[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{justifyContent:"center",sx:{overflow:"auto",height:"100%"},children:[(0,i.jsx)(P.Z,{color:"secondary",fontWeight:600,sx:{whiteSpace:"normal"},children:n.serviceName}),(0,i.jsx)(P.Z,{fontWeight:600,mt:2,sx:{whiteSpace:"normal"},children:n.title}),(0,i.jsx)(eo.O,{fontSize:"12px",sx:{whiteSpace:"normal"},maxLength:20,children:n.description})]})}},{minWidth:120,field:"count",headerName:"Count",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(aP,{year:c.year(),total:n.totalCount.count,complete:n.totalCount.completeCount,inComplete:n.totalCount.inCompleteCount,followOn:n.totalCount.followOnCount,inCompleteCompliance:n.totalCount.inCompleteComplianceCount})}}],f=(0,l.useMemo)(function(){return t.filter(function(e){var n;return(null===(n=e[m])||void 0===n?void 0:n.count)>0})},[t,m]),x=(0,l.useMemo)(function(){var e={};return f.length||(e={title:"No scheduled item",subtitleFirstLine:"Selected month <".concat(m,"> has no items with jobs"),subtitleSecondLine:"Please select another and try again if necessary."}),e},[f.length,m]);return(0,i.jsxs)(s.Z,{sx:{height:"calc(100vh - 190px)",width:"100%"},children:[(0,i.jsx)(s.Z,{direction:"row",flexWrap:"wrap",justifyContent:"space-between",rowGap:2,p:3,children:t$.uJ.map(function(e){var n=e.label,t=e.value;return(0,i.jsxs)(s.Z,{width:"90px",sx:aH.monthHeaderWrapper(m===t),onClick:function(){return h(t)},children:[(0,i.jsx)(aw,{children:n}),(0,i.jsx)(ak,{locationId:d,year:c.year(),month:n})]})})}),(null==f?void 0:f.length)?(0,i.jsx)(nD.i,{ref:n,slots:{columnHeaders:function(){return null}},rowHeight:120,columns:v,rows:f,meta:o,refetch:r,loading:u,containerHeight:"calc(100% - 52px)"}):(0,i.jsx)(nx.C,(0,a.Z)({imageSrc:"/static/icons/no_locations_found.svg"},x))]})}),aG=function(e){var n=e.initialFilters,t=e.hideFilters,o=e.locationId,r=e.onViewChange,u=(0,V.Z)("(max-width: 600px)"),d=(0,er.x)().user,c=(0,oq.a)(),p=(0,f.Z)((0,oF.X)("scheduledjob_calendar_".concat(n.filterType),n,"network"),2),m=p[0],h=p[1],v=(0,l.useState)({}),x=v[0],g=v[1],b=(0,l.useState)([]),y=b[0],w=b[1],C=(0,l.useState)(!1),I=C[0],k=C[1],D=(0,nT.x)({filters:x}),T=D.initialData,M=D.ref,O=j()(x.year),F=(0,l.useMemo)(function(){return aY((0,a.Z)({},x),d.accountType)},[x,d.accountType]),A=(0,Z.aM)(e6,{variables:(0,a.Z)({},T,F)}),E=A.data,R=void 0===E?{jobSchedules:[],meta:{aggregate:{totalCount:0}}}:E,$=R.jobSchedules,N=R.meta,W=A.loading,J=A.refetch,B=(0,l.useCallback)(function(e){var n=e.id,t=(e.total,e.year),o=e.month,r=j()().year(t).month(o).startOf("month").toISOString(),a=j()().year(t).month(o).endOf("month").toISOString();c.show({content:(0,i.jsx)(nb,{jobScheduleId:n,status:null,startDate:r,endDate:a,onClose:c.close}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[c]),Y=(0,l.useMemo)(function(){return[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderHeader:function(){return""},renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{justifyContent:"center",sx:{overflow:"auto",height:"100%"},children:[(0,i.jsx)(P.Z,{color:"secondary",fontWeight:600,sx:{whiteSpace:"normal"},children:n.serviceName}),(0,i.jsx)(P.Z,{fontWeight:600,mt:2,sx:{whiteSpace:"normal"},children:n.title}),(0,i.jsx)(eo.O,{fontSize:"12px",sx:{whiteSpace:"normal"},maxLength:20,children:n.description})]})}}].concat((0,L.Z)(t$.uJ.map(function(e,n){var t=e.label,r=e.value;return{flex:1,minWidth:120,field:r,headerName:t,headerAlign:"center",sortable:!1,renderHeader:function(){return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(aw,{selected:j()().month()===n,children:t}),(0,i.jsx)(ak,{locationId:o,year:O.year(),month:t})]})},renderCell:function(e){var n=e.row;return(0,i.jsx)(aj,{year:O.year(),month:t,total:n[r].count,complete:n[r].completeCount,inComplete:n[r].inCompleteCount,followOn:n[r].followOnCount,inCompleteCompliance:n[r].inCompleteComplianceCount,onClick:function(){return B({id:n.id,total:n[r].count,year:O.year(),month:t})}})}}})),[{minWidth:120,field:"count",headerName:"Count",sortable:!1,renderHeader:function(){return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(aw,{children:"Count"}),(0,i.jsx)(aR,{locationId:o,year:O.year()})]})},renderCell:function(e){var n=e.row;return(0,i.jsx)(aP,{year:O.year(),total:n.totalCount.count,complete:n.totalCount.completeCount,inComplete:n.totalCount.inCompleteCount,followOn:n.totalCount.followOnCount,inCompleteCompliance:n.totalCount.inCompleteComplianceCount})}}])},[B,o,O]),H=(0,l.useMemo)(function(){return $.map(function(e){var n=aI({jobs:e.jobs,timePeriods:t$.uJ,year:O.year()}),t=n.countByPeriod,o=n.totalCount;return(0,a.Z)({id:e.id,serviceName:e.serviceName,title:e.title,description:e.description,totalCount:o},t)})},[$,O]),G=(0,l.useCallback)(function(e){h(function(n){var t=(0,a.Z)({},n);return delete t[e],t})},[h]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(aA,{locationId:o,open:I,close:function(){return k(!1)},filtersFormData:m,setFiltersFormData:h,hideFilters:t,setFilters:g,setFiltersChips:w}),(0,i.jsxs)(S.Z,{sx:{height:"calc(100vh - 190px)",width:"100%"},children:[(0,i.jsxs)(_.ZP,{container:!0,justifyContent:"space-between",alignItems:"center",pl:2,pr:2,pb:1,pt:1,rowGap:2,children:[(0,i.jsx)(_.ZP,{item:!0,xs:9,md:1,lg:1,children:(0,i.jsx)(q.Z,{variant:"contained",startIcon:(0,i.jsx)(rV.Z,{}),onClick:function(){return k(!0)},children:"Filters"})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:9,lg:9,order:{xs:3,md:2,lg:2},children:(0,i.jsx)(oY,{filtersChips:y,onRemove:G})}),(0,i.jsx)(_.ZP,{item:!0,xs:3,md:1,lg:1,order:{xs:2,md:3,lg:3},children:(0,i.jsx)(q.Z,{variant:"contained",color:"info",startIcon:(0,i.jsx)(aT.Z,{}),onClick:function(e){return r("table")},children:"Table"})})]}),(0,i.jsx)(S.Z,{sx:{height:"calc(95% - 52px)",overflowY:"auto"},children:u?(0,i.jsx)(aV,{ref:M,meta:N,loading:W,refetch:J,locationId:o,yearDate:O,rows:H}):(0,i.jsx)(aQ,{disableSelectionOnClick:!0,disableColumnResize:!0,autoHeight:!1,ref:M,rows:H,columns:Y,loading:W,meta:N,refetch:J,rowHeight:140,containerHeight:"calc(100% - 20px)"})})]})]})};aG.defaultProps={initialFilters:{},onViewChange:function(){}},aG.propTypes={initialFilters:b().object,onViewChange:b().func};var aQ=(0,d.ZP)(nD.i)(function(e){var n;return e.theme,n={},(0,oO.Z)(n,"& .MuiDataGrid-columnHeaders",{border:"none"}),(0,oO.Z)(n,"& .MuiDataGrid-columnHeader",{padding:"0px"}),(0,oO.Z)(n,"& .MuiDataGrid-cell--withRenderer",{justifyContent:"center"}),(0,oO.Z)(n,"& .MuiDataGrid-columnHeaderTitleContainer",{width:"100%",justifyContent:"center"}),(0,oO.Z)(n,"& .MuiDataGrid-row:hover, .MuiDataGrid-row.Mui-hovered",{backgroundColor:"unset"}),n}),az=function(e){var n=e.calendarInitialFilters,t=e.hideCalendarFilters,o=e.tableInitialFilters,r=e.hideTableFilters,a=e.locationId,u=(0,G.useRouter)(),d=(0,l.useState)(u.query.scheduledTab||"calendar"),c=d[0],p=d[1];(0,l.useEffect)(function(){var e=u.query;delete e.scheduledTab,e.scheduledTab=c,Q().push({pathname:u.pathname,query:e,shallow:!0})},[c]);var m=function(e){p(e)};return(0,i.jsxs)(s.Z,{children:["table"===c&&(0,i.jsx)(r9,{initialFilters:o,hideFilters:r,locationId:a,onViewChange:m}),"calendar"===c&&(0,i.jsx)(aG,{initialFilters:n,hideFilters:t,locationId:a,onViewChange:m})]})};az.propTypes={calendarInitialFilters:b().object,hideCalendarFilters:b().array,locationId:b().string};var aU,aK=t(72852),aX=t(63441),a0=t(78840),a1=t.n(a0),a2=t(75708),a3=t.n(a2),a5=Array(12).fill("").map(function(e,n){return j()().startOf("year").add(n,"month").format("MM.YYYY")}).map(function(e){return{name:e,y:0,color:"#BFBFBF"}}),a6=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return e.reduce(function(e,o){var r=n(o),i=t(r);return e[i]?(0,v.Z)((0,a.Z)({},e),(0,oO.Z)({},i,(0,L.Z)(e[i]).concat([o]))):(0,v.Z)((0,a.Z)({},e),(0,oO.Z)({},i,[o]))},{})},a4=function(e){var n;return Object.entries(a6(e,function(e){return e.invoiceDate},function(e){return j()(e).format("MM.YYYY")})).map(function(e){var t,o=(0,f.Z)(e,2),r=o[0],a=o[1];return{name:r,y:a.reduce(function(e,t){var o;return null!==(n=e+(null===(o=t.accountEntry)||void 0===o?void 0:o.debit))&&void 0!==n?n:0},0),color:a.some(function(e){var n=e.accountEntry;return(null==n?void 0:n.paymentStatus)==="unpaid"||(null==n?void 0:n.paymentStatus)==="partially"})?"#E9175E":"#1AB43B"}})},a9=function(e){var n,t,o,r,a,i,l=e.filter(function(e){return"onCompletion"===e.jobSchedule.invoiceBasis}),s=e.filter(function(e){return"fixedMonthlyAmount"===e.jobSchedule.invoiceBasis}),u=(n=l,Object.entries(a6(n,function(e){return e.timingStart},function(e){return j()(e).format("MM.YYYY")})).map(function(e){var n=(0,f.Z)(e,2),t=n[0],o=n[1];return{name:t,y:o.length*(null==o?void 0:o[0].jobSchedule.meta.costCustomer),color:"#BFBFBF"}})),d=(t=s,Object.entries(a6(t,function(e){return e.timingStart},function(e){return j()(e).format("MM.YYYY")})).map(function(e){var n,t=(0,f.Z)(e,2),o=t[0],r=t[1];return{name:o,y:null===(n=null==r?void 0:r[0].jobSchedule)||void 0===n?void 0:n.customerMonthlyCharge,color:"#BFBFBF"}}));return a=function(e){e.forEach(function(e){if(i.has(e.name)){var n=i.get(e.name);n.y+=e.y}else i.set(e.name,{name:e.name,y:e.y,color:e.color})})},i=new Map,a(u),a(d),Array.from(i.values())},a7=function(e,n){var t=a4(e),o=a9(n);return a5.map(function(e){var n,r,a=null!==(n=t.find(function(n){return n.name===e.name}))&&void 0!==n?n:null,i=null!==(r=o.find(function(n){return n.name===e.name}))&&void 0!==r?r:null;return a||i||e})},a8=function(e){var n=e.previousInvoices,o=e.futureInvoicesData,r=function(e){e.reflow()};t(18393)(a1());var a=(0,l.useMemo)(function(){return Array(12).fill("").map(function(e,n){return j()().startOf("year").add(n,"month").format("MM.YYYY")})},[]);return(0,i.jsx)(a3(),{callback:r,constructorType:"chart",Highcharts:a1(),options:{chart:{type:"column"},title:{text:null},series:[{name:null,data:a7(n,o)}],xAxis:{title:null,categories:a},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},ie=t(63139),it=t(13777),io=(aU=(0,h.Z)(function(e){var n;return(0,x.__generator)(this,function(t){switch(t.label){case 0:return(0,ie.a)()||(n=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-staging.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){var t,o,r;null==n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),(null==window?void 0:null===(o=window.Capacitor)||void 0===o?void 0:null===(r=o.Plugins)||void 0===r?void 0:r.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,it.Tb)({message:e,section:"fetch"})})];case 1:return t.sent(),[2]}})}),function(e){return aU.apply(this,arguments)}),ir=function(e){switch(e){case"paid":return{backgroundColor:"rgb(0, 180, 60)"};case"partiallyPaid":return{backgroundColor:"rgb(248, 139, 157)"};case"unpaid":return{backgroundColor:"rgb(232, 9, 94)"};default:return{backgroundColor:"rgb(0,0,0)"}}},ia={squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},statusBox:{width:"fit-content",padding:"2px 10px",borderRadius:"5px",color:"#fff"}},ii=function(e){var n,t=e.locationId,o=e.locationName,r=(0,nT.x)({filters:{locationId:t}}),u=r.initialData,d=r.ref,c=(0,l.useMemo)(function(){return j()().startOf("month").toISOString()},[]),p=(0,l.useMemo)(function(){return j()().endOf("year").toISOString()},[]),m=(0,Z.aM)(e4,{variables:{locationId:u.locationId}}),h=m.data,f=void 0===h?{invoices:[]}:h,x=f.invoices,g=f.meta,b=m.loading,y=m.refetch,w=(0,Z.aM)(e9,{variables:{locationId:t,now:c,endOfYear:p}}).data,C=(void 0===w?{jobs:[]}:w).jobs,I=[{minWidth:130,field:"invoiceNumber",headerName:"Invoice number",valueFormatter:function(e){var n=e.value;return"PM ".concat(n)},flex:1,sortable:!1},{minWidth:130,flex:1,field:"createdAt",headerName:"Date invoiced",valueFormatter:function(e){var n=e.value;return j()(n).format("YYYY-MM-DD")},sortable:!1},{minWidth:130,flex:1,field:"debit",headerName:"Invoice total",valueFormatter:function(e){var n=e.value;return n>=0?(0,oH.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"status",headerName:"Status",renderCell:function(e){var t=e.row;return(0,i.jsx)(S.Z,{sx:(0,a.Z)({},ia.statusBox,ir(null==t?void 0:t.status)),children:null!==(n=null==t?void 0:t.status)&&void 0!==n?n:"-"})},sortable:!1},{minWidth:100,flex:1,field:"outstandingAmount",headerName:"Amount outstanding",valueFormatter:function(e){var n=e.value;return n>=0?(0,oH.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"outstandingdays",headerName:"Days outstanding",valueFormatter:function(e){var n=e.value;return null!=n?n:"N/A"},sortable:!1},{minWidth:100,flex:1,field:"actions",headerName:"Actions",renderCell:function(e){var n,t=e.row;return(0,i.jsx)(s.Z,{direction:"row",children:(0,i.jsx)(k.Z,{sx:ia.squaredIconButton,onClick:function(){var e,n,o,r,i,l,s=(null==t?void 0:null===(e=t.amountPaid)||void 0===e?void 0:null===(n=e.aggregate)||void 0===n?void 0:null===(o=n.sum)||void 0===o?void 0:o.amount)||0,u=(null==t?void 0:null===(r=t.amountDeducted)||void 0===r?void 0:null===(i=r.aggregate)||void 0===i?void 0:null===(l=i.sum)||void 0===l?void 0:l.amount)||0;io((0,v.Z)((0,a.Z)({},t.meta),{amountPaid:s,amountDeducted:u}))},children:(0,i.jsx)(aX.Z,{})})})},sortable:!1}];return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(_.ZP,{container:!0,sx:{height:"50%"},children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,md:7,sx:{padding:"0px 16px"},children:(0,i.jsx)(o1,{columns:I,rows:x.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,createdAt:e.createdAt,debit:e.debit,status:e.paymentStatus,outstandingAmount:e.outstandingAmount,outstandingdays:e.outstandingdays,meta:e.meta,amountPaid:e.amountPaid,amountDeducted:e.amountDeducted}}),loading:b,ref:d,meta:g,refetch:y,autoHeight:!1,containerHeight:"calc(100% - 52px)"})}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:5,sx:{padding:"0px 16px"},children:(0,i.jsx)(a8,{previousInvoices:x,futureInvoicesData:C})})]}),(0,i.jsx)(S.Z,{sx:{padding:"0px 16px"},children:(0,i.jsx)(o7,{locationId:t,locationName:o,columnVisibilityModel:{workOrders:!1,actions:!1},height:"calc(80vh - 52px)",hasHeader:!1,initialFilters:{locationId:t,filterType:"customer_fin_".concat(location.id)},hideFilters:["location"]})})]})};ii.propTypes={locationId:b().string,locationName:b().string};var il=t(40656),is=function(e){var n=e.items,t=e.dates,o=e.type,r=e.color;return t.map(function(e){var t=n.filter(function(n){return j()(n.month).format("MM.YYYY")===e}).reduce(function(e,n){return e+n[o]},0);return{name:e,y:t,color:r}})},iu=function(e){var n=e.locationId;t(18393)(a1());var o=(0,er.x)(),r=o.user,a=(0,o.hasRole)("supplier")?r.accountId:null,s=(0,l.useMemo)(function(){return j()().startOf("year")},[]),u=(0,l.useMemo)(function(){return j()().endOf("year")},[]),d=(0,Z.aM)(nr,{variables:{locationId:n,supplierId:a,startDate:s,endDate:u}}).data,c=(void 0===d?{items:[]}:d).items,p=(0,l.useMemo)(function(){return Array(12).fill("").map(function(e,n){return j()().startOf("year").add(n,"month").format("MM.YYYY")})},[]),m=(0,l.useMemo)(function(){return is({dates:p,items:c,type:"totalPaid",color:il.Q.COLOUR.success})},[p,c]),h=(0,l.useMemo)(function(){return is({dates:p,items:c,type:"totalUnpaid",color:il.Q.COLOUR.danger})},[p,c]),v=(0,l.useMemo)(function(){return is({dates:p,items:c,type:"totalPartial",color:il.Q.COLOUR.pink})},[p,c]);return(0,i.jsx)(a3(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:a1(),options:{chart:{type:"column"},title:{text:null},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[{name:"Paid",color:il.Q.COLOUR.success,data:m},{name:"Partially paid",color:il.Q.COLOUR.pink,data:v},{name:"Unpaid",color:il.Q.COLOUR.danger,data:h}],xAxis:{title:null,categories:p},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},id=t(94054),ic=t(40476),ip=t(97432),im=t(9489),ih=t(26936),iv=function(e){var n=e.id,t=e.description,o=e.quantity,r=e.rate,a=e.vatType,u=e.vatPercentage,d=e.onSubmit,c=(0,oQ.l)(),p=(0,n_.cI)({defaultValues:{description:t,quantity:o,rate:r,vatType:void 0===a?"default":a,vatPercentage:u},resolver:(0,nk.S)(nE)}),m=p.control,h=p.errors,v=p.watch,f=p.handleSubmit,x=v("vatType"),g=v("quantity"),b=v("rate"),y=v("vatPercentage"),j=g*b||0,Z=j*(y/100)||0,w=j+Z||0,C=function(e){var t={id:n,description:e.description,quantity:e.quantity,rate:(0,ip.l)(e.rate,2),net:(0,ip.l)(j,2),vatPercentage:e.vatPercentage,vatType:e.vatType,vat:(0,ip.l)(Z,2),gross:(0,ip.l)(w,2)};d(t),c.current.toggleDetailPanel(n)},I=(0,l.useCallback)(function(e){e.stopPropagation(),c.current.toggleDetailPanel(n)},[c,n]);return(0,i.jsx)("form",{children:(0,i.jsxs)(s.Z,{width:"100%",spacing:2,p:1,sx:{backgroundColor:"muiLight.main"},children:[(0,i.jsx)(n_.Qr,{name:"description",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(nZ.Z,{minRows:3,multiline:!0,fullWidth:!0,variant:"filled",color:"secondary",label:"Description",value:t,onChange:o,error:h.description,helperText:null===(n=h.description)||void 0===n?void 0:n.message})}}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"space-between",spacing:2,children:[(0,i.jsxs)(s.Z,{width:"100%",children:[(0,i.jsx)(P.Z,{children:"Rate"}),(0,i.jsx)(n_.Qr,{name:"rate",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(im.I,{leftLabel:(0,i.jsx)(ih.Z,{sx:{height:"18px"}}),rightLabel:"Ex Vat",sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0}},value:t,onChange:o,error:h.rate,helperText:null===(n=h.rate)||void 0===n?void 0:n.message})}})]}),(0,i.jsxs)(s.Z,{width:"100%",children:[(0,i.jsx)(P.Z,{children:"Quantity"}),(0,i.jsx)(n_.Qr,{name:"quantity",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(im.I,{sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0,step:"1"}},value:t,onChange:o,error:h.quantity,helperText:null===(n=h.quantity)||void 0===n?void 0:n.message})}})]})]}),(0,i.jsx)(s.Z,{width:"100%",children:(0,i.jsx)(n_.Qr,{name:"vatType",control:m,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsxs)(id.Z,{color:"secondary",children:[(0,i.jsx)(ic.Z,{children:"VAT %"}),(0,i.jsxs)(tF.Z,{row:!0,value:n,onChange:function(e,n){return t(n)},color:"secondary",children:[(0,i.jsx)(nJ.Z,{value:"default",control:(0,i.jsx)(nY.Z,{color:"secondary"}),label:"Default (".concat(u,"%)")}),(0,i.jsx)(nJ.Z,{value:"custom",control:(0,i.jsx)(nY.Z,{color:"secondary"}),label:"Custom"})]})]})}})}),(0,i.jsx)(s.Z,{width:"100%",children:(0,i.jsx)(n_.Qr,{name:"vatPercentage",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(nZ.Z,{fullWidth:!0,type:"number",variant:"standard",color:"secondary",label:"Custom VAT %",value:t,onChange:o,error:h.vatAmount,helperText:null===(n=h.vatAmount)||void 0===n?void 0:n.message,sx:{display:"custom"===x?"block":"none"}})}})}),(0,i.jsxs)(s.Z,{width:"100%",children:[(0,i.jsxs)(P.Z,{children:["Net: ",(0,oH.T)(j)]}),(0,i.jsxs)(P.Z,{children:["VAT: ",(0,oH.T)(Z)]}),(0,i.jsxs)(P.Z,{children:["Gross: ",(0,oH.T)(w)]})]}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,i.jsx)(q.Z,{color:"danger",variant:"contained",size:"small",onClick:I,children:"Cancel"}),(0,i.jsx)(q.Z,{color:"secondary",variant:"contained",size:"small",type:"submit",onClick:f(C),children:"Save"})]})]})})};iv.propTypes={id:b().number,description:b().string,quantity:b().number,rate:b().number,vatType:b().oneOf(["default","custom"]),vatPercentage:b().number,onSubmit:b().func};var ix=t(83395),ig=t(85412),ib=t(25934),iy=function(e){var n=e.values,t=e.setValues,o=e.name,r=e.vatId,u=(0,l.useState)([]),d=u[0],c=u[1],p=(0,l.useCallback)(function(){var e=(0,ix.b)(r),n=(0,ib.Z)();t(function(t){return(0,L.Z)(t).concat([{id:n,description:"",quantity:0,rate:0,net:0,vatPercentage:e?20:0,vatType:"default",vat:0,gross:0}])}),c(function(e){return(0,L.Z)(e).concat([n])})},[t,r]),m=(0,l.useCallback)(function(e){t(function(n){return n.filter(function(n){return n.id!==e})})},[t]),h=(0,l.useCallback)(function(e){t(function(n){return n.map(function(n){return n.id===e.id?(0,a.Z)({},e):n})})},[t]),v=(0,l.useCallback)(function(e){c((0,L.Z)(e))},[]),f=(0,l.useMemo)(function(){return[{field:"description",headerName:"Description",minWidth:120,sortable:!1,flex:1},{field:"quantity",headerName:"Qty",sortable:!1,flex:1},{field:"rate",headerName:"Rate",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oH.T)(n)}},{field:"net",headerName:"Net",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oH.T)(n)}},{field:"vatPercentage",headerName:"Vat %",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return"".concat(n,"%")}},{field:"vat",headerName:"Vat",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oH.T)(n)}},{field:"gross",headerName:"Gross",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oH.T)(n)}},{field:oG.u,headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(){return(0,i.jsx)(k.Z,{children:(0,i.jsx)(rr.Z,{})})}},{field:"delete",headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(e){var n=e.id;return(0,i.jsx)(k.Z,{onClick:function(){return m(n)},children:(0,i.jsx)(ig.Z,{})})}}]},[m]),x=n.reduce(function(e,n){return e+n.gross},0);return(0,i.jsxs)(s.Z,{width:"100%",children:[(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,i.jsx)(P.Z,{fontSize:22,sx:{opacity:.46},children:o}),(0,i.jsxs)(q.Z,{color:"secondary",variant:"contained",onClick:p,children:["Insert ",o.toLowerCase()," item"]})]}),(0,i.jsx)(nD.i,{columns:f,rows:n,loading:!1,detailPanelExpandedRowIds:d,onDetailPanelExpandedRowIdsChange:v,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,i.jsx)(iv,{id:n.id,description:n.description,quantity:n.quantity,rate:n.rate,vatType:n.vatType,vatPercentage:n.vatPercentage,onSubmit:h})}}),(0,i.jsx)(s.Z,{width:"100%",alignItems:"flex-end",children:(0,i.jsxs)(P.Z,{children:["Subtotal - ",o.toLowerCase(),": ",(0,oH.T)(x)]})})]})};iy.defaultProps={values:[],setValues:function(){}},iy.propTypes={values:b().array,setValues:b().func,name:b().string,vatId:b().string};var ij=function(e){var n=e.jobScheduleId,t=(0,l.useState)(""),o=t[0],r=t[1],a=(0,f.Z)((0,w.t)(ni.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},name:{_ilike:""!==o?"%".concat(o,"%"):null},_or:[{SupplierJobs:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}},{SupplierOffers:{status:{_eq:"offered"},Job:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}}}]},limit:50,offset:0}}),2),i=a[0],s=a[1],u=s.loading,d=s.data;return{supplierProps:{onOpen:i,loading:u,options:(void 0===d?{items:[]}:d).items,setSearch:r}}},iZ=t(13262),iw=t(60185),iC=function(e){var n=parseInt(e.adminDueDate)||30,t=new Date().getTime()+864e5*n;return new Date(t)},iI=function(e){var n,t,o=e.id,r=e.edit,u=e.supplierId,d=e.supplierName,c=e.locationId,p=e.jobScheduleId,m=e.vatId,g=e.close,b=(0,nR.D)(),y=(0,rH.q)().admin,j=(0,er.x)(),w=j.user,I=j.hasRole,S=(0,iw.z)("AccountEntry",w.adminId,w.id),_=S.createMediaInput,k=S.loadingAddMedia,M=null==y?void 0:null===(n=y.meta)||void 0===n?void 0:null===(t=n.finance)||void 0===t?void 0:t.invoiceDueDate,O=I("supplier"),F=(0,l.useState)([]),A=F[0],E=F[1],R=(0,l.useState)([]),$=R[0],N=R[1],W=(0,n_.cI)({defaultValues:(0,v.Z)((0,a.Z)({},iS),{dueDate:iC({adminDueDate:M}),supplier:{value:u,label:d}}),resolver:(0,nk.S)(nA),context:{isSupplier:O}}),J=W.control,L=W.errors,B=W.register,Y=W.setValue,H=W.watch,V=W.reset,G=W.handleSubmit,Q=H("attachments"),z=(0,Z.aM)(nn,{skip:!r,variables:{id:o},onCompleted:function(e){var n=e.invoice,t=n.items,o=n.dueDate,r=n.meta,a=n.account,i=t.filter(function(e){return"Labour"===e.type}),l=t.filter(function(e){return"Materials"===e.type});E(i),N(l),V({supplier:{value:a.id,label:a.name},dueDate:o,reference:null==r?void 0:r.reference,description:null==r?void 0:r.description})}}).loading,U=(0,f.Z)((0,C.D)(nt,{refetchQueries:["GetJobSchedules","GetSupplierPpmInvoices","SupplierInvoiceTotalByMonth"],onCompleted:function(){b.show({content:"Supplier invoice saved",color:"success"}),g()},onError:function(e){b.show({content:"Error: ".concat(e.message),color:"error"})}}),2),K=U[0],X=U[1].loading,ee=ij({jobScheduleId:p}).supplierProps,en=(0,l.useCallback)(function(e){var n;return n=(0,h.Z)(function(n){var t,o,r,a,i,l;return(0,x.__generator)(this,function(a){switch(a.label){case 0:if(0===A.length&&0===$.length)return[2,b.show({content:"Please add at least one item",color:"error"})];if(!(A.reduce(function(e,n){return e+n.quantity*n.rate},0)+$.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return[2,b.show({content:"Gross should be greater than 0",color:"error"})];return[4,_(n.attachments)];case 1:return i=a.sent(),l={labours:A,materials:$,supplierId:null===(t=n.supplier)||void 0===t?void 0:t.value,locationId:c,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e,attachments:null==i?void 0:null===(o=i.Media_Entity)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.map(function(e){return{caption:e.Medium.data.caption,extension:e.Medium.data.extension,filename:e.Medium.data.filename,type:e.Medium.data.type,meta:e.Medium.data.meta}})},K({variables:{data:l}}),[2]}})}),function(e){return n.apply(this,arguments)}},[_,p,A,c,$,b,K]),et=(0,l.useCallback)(function(e){return function(n){if(0===A.length&&0===$.length)return b.show({content:"Please add at least one item",color:"error"});if(!(A.reduce(function(e,n){return e+n.quantity*n.rate},0)+$.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return b.show({content:"Gross should be greater than 0",color:"error"});var t,r={id:o,labours:A,materials:$,supplierId:null===(t=n.supplier)||void 0===t?void 0:t.value,locationId:c,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e};K({variables:{data:r}})}},[o,p,A,c,$,b,K]),eo=A.reduce(function(e,n){return e+n.net},0)+$.reduce(function(e,n){return e+n.net},0),ea=A.reduce(function(e,n){return e+n.vat},0)+$.reduce(function(e,n){return e+n.vat},0),ei=A.reduce(function(e,n){return e+n.gross},0)+$.reduce(function(e,n){return e+n.gross},0);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(D.Z,{open:z||X||k,sx:{zIndex:1e4},children:(0,i.jsx)(T.Z,{color:"secondary"})}),(0,i.jsx)("form",{children:(0,i.jsxs)(s.Z,{width:"100%",spacing:4,children:[(0,i.jsx)(iy,{values:A,setValues:E,name:"Labour",vatId:m}),(0,i.jsx)(iy,{values:$,setValues:N,name:"Materials",vatId:m}),(0,i.jsxs)(s.Z,{width:"100%",alignItems:"flex-end",children:[(0,i.jsxs)(P.Z,{children:["Net Total: ",(0,oH.T)(eo)]}),(0,i.jsxs)(P.Z,{children:["VAT Total: ",(0,oH.T)(ea)]}),(0,i.jsxs)(P.Z,{children:["Gross Total: ",(0,oH.T)(ei)]})]}),r?(0,i.jsx)(s.Z,{width:"100%",children:(0,i.jsx)(oD.G,{carousel:!1,elevation:0,accordionSx:{"& .MuiAccordionSummary-root":{paddingLeft:0,"& .MuiTypography-root":{fontSize:22,opacity:.46}}},expanded:!0,hideExpandIcon:!0,entityId:o,entity:"AccountEntry",columnVisibilityModel:{name:!1},mediaFormProps:{showSubmitButton:!0},offCanvasProps:{submit:!1}})}):(0,i.jsxs)(s.Z,{width:"100%",children:[(0,i.jsx)(iZ.f,{title:"Media",name:"attachments",titleSx:{fontSize:22,opacity:.46},values:Q,setValue:Y}),(0,i.jsx)("input",(0,v.Z)((0,a.Z)({},B("attachments")),{type:"hidden"}))]}),(0,i.jsxs)(s.Z,{width:"100%",spacing:2,children:[!O&&(0,i.jsx)(n_.Qr,{name:"supplier",control:J,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(ed.q,(0,v.Z)((0,a.Z)({},ee),{value:t,onChange:function(e,n){return o(n)},textFieldProps:{label:"Supplier",fullWidth:!0,color:"secondary",variant:"standard"},sx:{width:"300px"},error:L.supplier,helperText:null===(n=L.supplier)||void 0===n?void 0:n.message}))}}),!O&&(0,i.jsx)(n_.Qr,{name:"dueDate",control:J,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nH.M,{inputFormat:"Do MMM YYYY",value:n,onChange:t,label:"Due Date",renderInput:function(e){var n;return(0,i.jsx)(nZ.Z,(0,v.Z)((0,a.Z)({},e),{sx:{width:"300px"},color:"secondary",variant:"standard",error:L.dueDate,helperText:null===(n=L.dueDate)||void 0===n?void 0:n.message}))}})}}),(0,i.jsx)(n_.Qr,{name:"reference",control:J,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(nZ.Z,{color:"secondary",variant:"standard",label:"Reference",value:t,onChange:o,error:L.reference,helperText:null===(n=L.reference)||void 0===n?void 0:n.message})}}),(0,i.jsx)(n_.Qr,{name:"description",control:J,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(nZ.Z,{multiline:!0,minRows:3,color:"secondary",variant:"filled",label:"Description",value:t,onChange:o,error:L.description,helperText:null===(n=L.description)||void 0===n?void 0:n.message})}})]}),(0,i.jsxs)(s.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,i.jsx)(q.Z,{variant:"contained",color:"info",type:"submit",onClick:G(r?et(!1):en(!1)),children:"Save"}),!O&&(0,i.jsx)(q.Z,{variant:"contained",color:"success",type:"submit",onClick:G(r?et(!0):en(!0)),children:"Generate Invoice"})]})]})})]})};iI.propTypes={id:b().string,edit:b().bool,supplierId:b().string,supplierName:b().string,locationId:b().string,vatId:b().string,close:b().func},iI.defaultProps={};var iS={supplier:null,dueDate:new Date,description:"",reference:""},iP=t(66252),i_=t(84193),ik=function(e){var n=e.status;return(0,i.jsx)(oB.Z,{color:{paid:"success",unpaid:"danger",partial:"pink"}[n],label:{paid:"Paid",unpaid:"Unpaid",partial:"Partially paid"}[n],sx:{borderRadius:2,height:"26px",width:"fit-content"}})};function iq(){var e=(0,ep.Z)(["\n  mutation CreateSupplierPpmInvoicePdf($invoiceId: Int!) {\n    invoice: createSupplierPpmInvoicePdf(invoiceId: $invoiceId) {\n      success\n      key\n    }\n  }\n"]);return iq=function(){return e},e}ik.propTypes={status:b().oneOf(["paid","unpaid","partial"])};var iD=(o=(0,h.Z)(function(e){var n,t,o,r,a,i,l,s,u,d,c,p;return(0,x.__generator)(this,function(i){switch(i.label){case 0:n=e.client,t=e.invoiceId,o=e.getUrl,i.label=1;case 1:return i.trys.push([1,3,,4]),a="",(0,ie.a)()||o||(r=window.open("/download","_blank")),[4,n.mutate({mutation:iT,variables:{invoiceId:t}})];case 2:return s=i.sent().data.invoice.key,o?a="".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(s):(null==r||null===(u=r.location)||void 0===u||u.assign("".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(s)),(null==window?void 0:null===(d=window.Capacitor)||void 0===d?void 0:null===(c=d.Plugins)||void 0===c?void 0:c.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-staging-media.s3.eu-west-2.amazonaws.com","/").concat(s)})),[2,a];case 3:return p=i.sent(),(0,it.Tb)({message:p,section:"fetch"}),[3,4];case 4:return[2]}})}),function(e){return o.apply(this,arguments)}),iT=(0,em.Ps)(iq()),iM=function(e){var n=e.jobScheduleId,t=e.supplierId,o=e.locationId,r=(0,oq.a)(),a=(0,iP.x)(),u=(0,nT.x)({filters:{jobScheduleId:n,supplierId:t,locationId:o}}),d=u.initialData,c=u.ref,p=(0,Z.aM)(e8,{variables:{supplierId:t}}),m=p.data,h=(void 0===m?{supplier:{}}:m).supplier,v=p.loading,f=(0,Z.aM)(ne,{variables:d}),x=f.data,g=void 0===x?{invoices:[],meta:{aggregate:{totalCount:0}}}:x,b=g.invoices,y=g.meta,w=f.loading,C=f.refetch,I=(0,l.useCallback)(function(e){e.stopPropagation(),r.show({content:(0,i.jsx)(iI,{supplierId:h.id,supplierName:h.name,locationId:o,jobScheduleId:n,vatId:h.vatId,close:r.close}),submit:!1,title:"Add supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,r,h.id,h.name,h.vatId]),S=(0,l.useCallback)(function(e){r.show({content:(0,i.jsx)(iI,{edit:!0,id:e,supplierId:h.id,supplierName:h.name,locationId:o,jobScheduleId:n,vatId:h.vatId,close:r.close}),submit:!1,title:"Edit supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,r,h.id,h.name,h.vatId]),P=(0,l.useCallback)(function(e){iD({client:a,invoiceId:e})},[a]),_=(0,l.useMemo)(function(){return[{field:"invoiceNumber",headerName:"Invoice number",sortable:!1,flex:1,valueFormatter:function(e){return e.value||"Draft"}},{field:"dateInvoiced",headerName:"Date invoiced",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.dateInvoiced?j()(n.dateInvoiced).format("YYYY-MM-DD"):"N/A"}},{field:"invoiceTotal",headerName:"Invoice Total",sortable:!1,flex:1},{field:"status",headerName:"Status",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,i.jsx)(ik,{status:n.status}):"N/A"}},{field:"amountOutstanding",headerName:"Amount outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.amountOutstanding:"N/A"}},{field:"daysOutstanding",headerName:"Days outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.daysOutstanding:"N/A"}},{field:"actions",headerName:"Actions",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",sx:{width:"fit-content"},onClick:function(e){e.stopPropagation(),P(n.id)},children:(0,i.jsx)(i_.Z,{})}):(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(e){e.stopPropagation(),S(n.id)},children:(0,i.jsx)(rr.Z,{})})}}]},[P,S]),k=(0,l.useMemo)(function(){return b.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,dateInvoiced:e.invoicedDate,invoiceTotal:(0,oH.T)(e.debit),status:e.paymentStatus,amountOutstanding:(0,oH.T)(e.outstandingAmount),daysOutstanding:e.outstandingdays}})},[b]);return(0,i.jsxs)(s.Z,{width:"100%",sx:{backgroundColor:"muiLight.main"},p:1,children:[(0,i.jsx)(o1,{ref:c,loading:w||v,columns:_,rows:k,meta:y,refetch:C}),(0,i.jsx)(s.Z,{width:"100%",alignItems:"flex-end",mt:1,children:(0,i.jsx)(q.Z,{disabled:v||!(null==h?void 0:h.id),color:"secondary",variant:"contained",onClick:I,children:"Add supplier invoice"})})]})};iM.propTypes={jobScheduleId:b().number.isRequired,supplierId:b().number.isRequired,locationId:b().number.isRequired};var iO=t(52122),iF=function(e){var n=e.percentage,t=e.reverse,o=null;return t?n<100&&n>0?o="info":n>=100?o="danger":0===n&&(o="success"):n<100&&n>0?o="info":0===n?o="danger":n>=100&&(o="success"),(0,i.jsx)(S.Z,{sx:{borderRadius:"5px",padding:"2px 4px",backgroundColor:"".concat(o,".main"),color:"".concat(o,".contrastText")},children:(0,i.jsxs)(P.Z,{children:[n,"%"]})})};iF.propTypes={percentage:b().number.isRequired,reverse:b().bool};var iA=t(32320),iE={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},jobsBadge:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"5px",minWidth:"50px"}},iR=function(e){var n=e.locationId,t=(0,(0,er.x)().hasRole)("supplier"),o=(0,oq.a)(),r=(0,nT.x)({filters:{locationId:n}}),u=r.initialData,d=r.ref,c=(0,Z.aM)(no,{variables:u}),p=c.data,m=void 0===p?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:p,h=m.jobSchedule,f=m.meta,x=c.loading,g=c.refetch,b=(0,l.useCallback)(function(e){var n=e.jobScheduleId,r=e.jobStatuses,a=e.description;o.show({content:(0,i.jsx)(nb,{jobScheduleId:n,status:r,startDate:null,endDate:null,onClose:o.close,hideFilters:t}),title:"Works orders (".concat(a,")"),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[o,t]),y=(0,l.useMemo)(function(){return[{field:"title",headerName:"Job",minWidth:250,renderCell:function(e){var n=e.row,t=oE(n.scheduleEnd,!oR(n.jobs));return(0,i.jsxs)(S.Z,{sx:iE.indicatorWrapper,children:[(0,i.jsx)(o$,{height:90,backgroundColor:t}),(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,children:[(0,i.jsx)(S.Z,{sx:{width:"24px",marginLeft:"8px"},children:n.compliance&&(0,i.jsx)(ag.Z,{sx:{color:"info.main"}})}),(0,i.jsxs)(s.Z,{ml:2,children:[(0,i.jsx)(P.Z,{typography:"subtitle1",sx:(0,a.Z)({},iE.title),children:n.title}),(0,i.jsx)(eo.O,{sx:(0,a.Z)({},iE.subtitle),fontSize:"12px",maxLength:20,children:n.description})]})]})]})},sortable:!1,flex:1},{headerName:"Service",field:"service",sortable:!1,width:250,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(P.Z,{typography:"subtitle1",children:n.serviceName}),(0,i.jsx)(P.Z,{typography:"subtitle2",sx:(0,a.Z)({},iE.subtitle),children:"Assigned to:"}),(0,i.jsx)(J.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),noWrap:!n.supplierId,children:n.supplierName||"No supplier assigned"})]})}},{field:"numberOfJobs",headerName:"Number of jobs",minWidth:130,sortable:!1,flex:1},{field:"lastJob",headerName:"Last job",minWidth:100,renderCell:function(e){var n=e.row;return n.lastJob?j()(n.lastJob).format("YYYY-MM-DD"):"-"},sortable:!1,flex:1},{field:"totalInvoiceDue",headerName:"Total invoice due",minWidth:100,renderCell:function(e){var n=e.row;return(0,oH.T)(n.totalInvoiceDue)},sortable:!1,flex:1},{field:"totalInvoiceReceived",headerName:"Total invoice received",minWidth:130,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(P.Z,{children:(0,oH.T)(n.totalInvoiceReceived)}),(0,i.jsx)(iF,{reverse:!0,percentage:n.totalInvoiceReceivedPercentage})]})},sortable:!1,flex:1},{field:"totalInvoicePaid",headerName:"Total invoice paid",minWidth:130,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(P.Z,{children:(0,oH.T)(n.totalInvoicePaid)}),(0,i.jsx)(iF,{reverse:!0,percentage:n.totalInvoicePaidPercentage})]})},sortable:!1,flex:1},{field:"amountLeftToPay",headerName:"Amount left to pay",minWidth:130,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(P.Z,{children:(0,oH.T)(n.amountLeftToPay)}),(0,i.jsx)(iF,{percentage:n.amountLeftToPayPercentage})]})},sortable:!1,flex:1},{field:"numberOfIncompleteJobs",headerName:"Number of incomplete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsxs)(S.Z,{sx:(0,v.Z)((0,a.Z)({},iE.jobsBadge),{color:"info.contrastText",backgroundColor:"info.main"}),children:[n.numberOfIncompleteJobs," jobs"]}),(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(){return b({jobScheduleId:n.id,jobStatuses:["raised","offered","accepted","inProgress","onHold","continued","paused"],description:n.title})},children:(0,i.jsx)(iO.Z,{})})]})},sortable:!1,flex:1},{field:"numberOfCompleteJobs",headerName:"Number of complete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,i.jsxs)(s.Z,{direction:"row",spacing:1,children:[(0,i.jsxs)(S.Z,{sx:(0,v.Z)((0,a.Z)({},iE.jobsBadge),{color:"success.contrastText",backgroundColor:"success.main"}),children:[n.numberOfCompleteJobs," jobs"]}),(0,i.jsx)(q.Z,{disableMinWidth:!0,color:"success",variant:"contained",size:"small",onClick:function(){return b({jobScheduleId:n.id,jobStatuses:["completed","reportSent","invoiceSent","customerPaid","supplierPaid","closed"],description:n.title})},children:(0,i.jsx)(iO.Z,{})})]})},sortable:!1,flex:1},(0,v.Z)((0,a.Z)({},oG.a),{isGridTogglePanel:!0,renderCell:function(e){return(0,i.jsx)(i$,{id:e.id,value:e.value})}})]},[b]),w=(0,l.useMemo)(function(){return null==h?void 0:h.map(function(e){var n,t,o=(0,L.Z)(e.jobs).sort(function(e,n){return new Date(n.timingStart)-new Date(e.timingStart)}),r=null==o?void 0:null===(n=o[0])||void 0===n?void 0:n.timingStart,a=null==o?void 0:null===(t=o[o.length-1])||void 0===t?void 0:t.timingStart,i=0,l=e.jobs.length,s=e.jobs.filter(function(e){var n,t;return!(null===(n=e.statusData)||void 0===n?void 0:n.completed)&&!(null===(t=e.statusData)||void 0===t?void 0:t.closed)}).length;if("fixedMonthlyAmount"===e.invoiceBasis){var u=j().duration(j()(r).diff(j()(a))).asMonths();i=e.supplierMonthlyCharge*u}else"onCompletion"===e.invoiceBasis&&(i=e.jobs.reduce(function(e,n){return e+(n.supplierGross||0)},0));var d=(0,iA.lt)(i>0?e.invoicesReceived/i*100:0,0),c=(0,iA.lt)(i>0?e.invoicesPaid/i*100:0,0),p=(0,iA.lt)(i-e.invoicesPaid>0?(i-e.invoicesPaid)/i*100:0,0);return{id:e.id,compliance:e.meta.compliance,title:e.meta.shortDescriptionName,description:e.meta.description,serviceName:e.meta.serviceName,supplierName:e.meta.supplierName,supplierId:e.meta.supplierId,jobs:e.jobs,numberOfJobs:l,lastJob:j()(r).format("YYYY-MM-DD"),totalInvoiceDue:i,totalInvoiceReceived:e.invoicesReceived,totalInvoiceReceivedPercentage:d,totalInvoicePaid:e.invoicesPaid,totalInvoicePaidPercentage:c,amountLeftToPay:i-e.invoicesPaid,amountLeftToPayPercentage:p,numberOfIncompleteJobs:s,numberOfCompleteJobs:l-s,scheduleStart:e.scheduleStart,scheduleEnd:e.scheduleEnd}})},[h]),C=function(e){return(0,i.jsxs)(S.Z,{sx:iE.indicatorWrapper,children:[(0,i.jsx)(o$,{height:90,backgroundColor:oE(e.scheduleEnd,!oR(e.jobs))}),(0,i.jsx)(s.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},I=function(e){return(0,i.jsx)(S.Z,{sx:iE.indicatorWrapper,children:(0,i.jsxs)(s.Z,{direction:"row",alignItems:"center",columnGap:2,children:[(0,i.jsx)(S.Z,{sx:{width:"24px",marginLeft:"8px"},children:e.compliance&&(0,i.jsx)(ag.Z,{sx:{color:"info.main"}})}),(0,i.jsxs)(s.Z,{ml:.5,children:[(0,i.jsx)(P.Z,{fontWeight:500,children:e.title}),(0,i.jsx)(P.Z,{typography:"subtitle2",fontWeight:300,children:e.description})]})]})})};return(0,i.jsxs)(_.ZP,{container:!0,children:[(0,i.jsx)(_.ZP,{item:!0,xs:12,md:6,lg:6,children:(0,i.jsx)(iu,{locationId:n})}),(0,i.jsx)(_.ZP,{xs:12,p:2,children:(0,i.jsx)(o1,{columns:y,renderIdentifierCell:C,renderValueCell:I,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var t=e.row;return(0,i.jsx)(iM,{jobScheduleId:t.id,supplierId:t.supplierId,supplierName:t.supplierName,locationId:n})},rows:w,loading:x,ref:d,meta:f,refetch:g,autoHeight:!1,containerHeight:"400px",rowHeight:100})})]})},i$=function(e){var n=e.id,t=e.value,o=(0,oQ.l)(),r=(0,oz.P)(o,oU.Z3),a=l.isValidElement(r[n]);return(0,i.jsx)(k.Z,{size:"small",tabIndex:-1,disabled:!a,"aria-label":t?"Close":"Open",children:(0,i.jsx)(oV.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},iN=function(e){var n=e.isSupplier,t=e.isCustomer,o=e.financeTab;return n?"supplier":t?"customer":o||"customer"},iW=function(e){var n=e.locationId,t=e.locationName,o=(0,er.x)().hasRole,r=o("supplier"),a=o("customer"),u=(0,G.useRouter)(),d=iN({isSupplier:r,isCustomer:a,financeTab:u.query.financeTab}),c=(0,l.useState)(d),p=c[0],m=c[1];(0,l.useEffect)(function(){var e=u.query;delete e.financeTab,e.financeTab=p,Q().push({pathname:u.pathname,query:e,shallow:!0})},[p]);var h=function(e){return function(){m(e)}},v=(0,l.useMemo)(function(){switch(p){case"customer":return(0,i.jsx)(ii,{locationId:n,locationName:t});case"supplier":return(0,i.jsx)(iR,{locationId:n})}},[p,n,t]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.Z,{direction:"row",columnGap:2,p:3,children:[!r&&(0,i.jsx)(nJ.Z,{label:"Customer",control:(0,i.jsx)(aK.Z,{color:"secondary",checked:"customer"===p,onChange:h("customer")})}),!a&&(0,i.jsx)(nJ.Z,{label:"Supplier",control:(0,i.jsx)(aK.Z,{color:"secondary",checked:"supplier"===p,onChange:h("supplier")})})]}),v]})};iW.propTypes={locationId:b().string.isRequired,locationName:b().string};var iJ=function(e){var n=e.showLocationSelector,t=e.locationId,o=e.locationName,r=e.calendarInitialFilters,u=e.hideCalendarFilters,d=e.tableInitialFilters,c=e.hideTableFilters,h=e.itemsInitialFilters,v=e.hideItemsFilters,f=(0,G.useRouter)(),x=(0,l.useState)(f.query.viewTab||"schedules"),g=x[0],b=x[1];(0,l.useEffect)(function(){var e=f.query;delete e.viewTab,e.viewTab=g,Q().push({pathname:f.pathname,query:e,shallow:!0})},[g]);var y=function(e,n){b(n)};return(0,i.jsxs)(s.Z,{children:[n&&(0,i.jsx)(m.c,{locationId:t,locationName:o}),(0,i.jsxs)(s.Z,{sx:(0,a.Z)({},n&&{paddingTop:"25px"}),children:[(0,i.jsx)(rW,{defaultExpanded:"info",locationId:t}),(0,i.jsxs)(iB,{value:g,children:[(0,i.jsxs)(iL,{value:g,onChange:y,"aria-label":"basic tabs example",textColor:"black.main",children:[(0,i.jsx)(p.Z,{label:"Schedules",value:"schedules"}),(0,i.jsx)(p.Z,{label:"Items",value:"items"}),t&&(0,i.jsx)(p.Z,{label:"Finances",value:"finances"})]}),(0,i.jsx)(rL.x,{value:g,index:"schedules",boxSx:{padding:"0px 0px 0px 0px"},children:(0,i.jsx)(az,{locationId:t,calendarInitialFilters:r,hideCalendarFilters:u,tableInitialFilters:d,hideTableFilters:c})}),(0,i.jsx)(rL.x,{value:g,index:"items",boxSx:{padding:"0px 0px 0px 0px"},children:(0,i.jsx)(o7,{locationId:t,locationName:o,initialFilters:h,hideFilters:v,columnVisibilityModel:{invoicePeriod:!1,invoiceBasis:!1,invoiceAmount:!1}})}),t&&(0,i.jsx)(rL.x,{value:g,index:"finances",boxSx:{padding:"0px 0px 0px 0px"},children:(0,i.jsx)(iW,{locationId:t})})]})]})]})},iL=(0,d.ZP)(c.Z)(function(e){return{"&.MuiTabs-root":{paddingLeft:"16px",minHeight:"auto"},"& .MuiTabs-scroller":{minHeight:"auto"},"& .MuiTab-root":{fontSize:"18px",textTransform:"none",padding:"12px 0px",minWidth:"auto",minHeight:"auto",marginRight:"60px"},"& .MuiTabs-indicator":{bottom:"8px",backgroundColor:e.theme.palette.black.main}}}),iB=(0,d.ZP)(u.Z)(function(e){e.theme;var n=e.value;return(0,a.Z)({marginTop:"25px"},"schedules"===n&&{height:"calc(100vh - 100px)"},"items"===n&&{height:"calc(100vh - 22px)"},"overview"===n&&{height:"calc(100vh - 22px)"})})},16352:function(e,n,t){var o=t(26042),r=t(69396),a=t(828),i=t(85893),l=t(50319),s=t(42283),u=t(51809),d=t(76600),c=t(49501),p=t(28497),m=t(51466),h=function(e){var n=e.defaultValues,t=e.location,h=e.offCanvas,v=e.refetch,f=(0,s.cI)({defaultValues:n}),x=f.errors,g=f.handleSubmit,b=f.register,y=(0,a.Z)((0,l.D)(u.zg,{onCompleted:function(e){v(),h.close()}}),1)[0],j=function(e){var n,a=e.monthlyAmount,i=t.meta;y({variables:{id:t.id,changes:{meta:(0,r.Z)((0,o.Z)({},void 0===i?{}:i),{monthlyAmount:a})}}})};return(0,i.jsxs)(d.Z,{id:"offCanvasForm",handleSubmit:g(j),children:[(0,i.jsx)(c.Z,{label:"Monthly amount",children:(0,i.jsx)(p.Z,{errors:x,name:"monthlyAmount",register:b,vat:"Ex VAT"})}),(0,i.jsx)(m.Z,{size:"xs",content:"Updating the monthly billing figure will overide any per item customer billing"})]})};n.Z=h},2388:function(e,n,t){t.d(n,{v:function(){return Z}});var o=t(14924),r=t(85893),a=t(45697),i=t.n(a),l=t(60888),s=t(59462),u=t(5616),d=t(11057),c=t(19370),p=t(51233),m=t(44472),h=t(14621),v=t(57249),f=t(10556),x=t(70490),g=t(66647),b=t(1698),y=t(15861),j=t(90948),Z=function(e){var n=e.steps,t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){return!!e.active})},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){var n=e.active,t=e.data;return!!n&&!!t})};return(0,r.jsx)(u.Z,{children:(0,r.jsx)(c.Z,{orientation:"vertical",connector:(0,r.jsx)(w,{}),children:n.filter(function(e){var n=e.active;return void 0===n||n}).map(function(e,n){var a=e.id,i=e.label,c=e.info,h=e.date,v=e.content,f=e.actions,x=!!h,g=o(v),b=t(f),j=x?(0,r.jsx)(l.Z,{color:"primary"}):(0,r.jsx)(s.Z,{color:"primary"});return(0,r.jsxs)(m.Z,{completed:x,expanded:!0,children:[(0,r.jsxs)(I,{icon:j,children:[(0,r.jsx)(y.Z,{sx:{fontSize:"13px",fontWeight:600},children:i}),(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontWeight:400,ml:3,opacity:.6},children:h})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(u.Z,{children:x||(null==g?void 0:g.length)>0?g.map(function(e){return"function"==typeof e.data?e.data():(0,r.jsx)(y.Z,{sx:{fontSize:"10px"},children:e.data})}):(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontStyle:"italic"},children:c})}),(null==b?void 0:b.length)>0&&(0,r.jsx)(p.Z,{mt:.5,spacing:.5,children:b.map(function(e){return"button"!==e.type?null:(0,r.jsx)(u.Z,{children:(0,r.jsx)(d.Z,{color:e.context,variant:"contained",size:"small",onClick:e.handleClick,children:e.content})})})})]})]},"".concat(i,"-").concat(a))})})})};Z.propTypes={steps:i().arrayOf(i().shape({id:i().number,label:i().string,info:i().string,date:i().oneOfType([i().string,i().bool]),active:i().bool,content:i().arrayOf(i().shape({id:i().number,active:i().bool,data:i().oneOfType([i().string,i().element])})),actions:i().arrayOf(i().shape({id:i().number,active:i().bool,content:i().string,context:i().string,handleClick:i().func,type:"button"}))}))};var w=(0,j.ZP)(h.Z)(function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"&.".concat(v.Z.active),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"&.".concat(v.Z.completed),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"& .".concat(v.Z.line),{borderColor:t.palette.primary.main,borderLeftWidth:4,borderRadius:1,marginLeft:"-2px"}),n}),C=(0,j.ZP)(f.Z)(function(e){var n=e.theme;return(0,o.Z)({},"&.".concat(x.Z.root),{borderColor:n.palette.primary.main,borderLeftWidth:4,marginLeft:"10px"})}),I=(0,j.ZP)(g.Z)(function(e){var n;return e.theme,n={},(0,o.Z)(n,"&.".concat(b.Z.root),{padding:0}),(0,o.Z)(n,"& .".concat(b.Z.labelContainer),{color:"inherit"}),(0,o.Z)(n,"& .".concat(b.Z.label),{display:"flex",alignItems:"center",color:"inherit"}),n})},97824:function(e,n,t){t.d(n,{x:function(){return u}});var o=t(26042),r=t(69396),a=t(99534),i=t(85893),l=t(90948),s=t(5616),u=function(e){var n=e.children,t=e.value,l=e.index,u=e.boxProps,c=e.boxSx,p=(0,a.Z)(e,["children","value","index","boxProps","boxSx"]);return(0,i.jsx)(d,(0,r.Z)((0,o.Z)({role:"tabpanel",hidden:t!==l,id:"simple-tabpanel-".concat(l),"aria-labelledby":"simple-tab-".concat(l)},p),{children:t===l&&(0,i.jsx)(s.Z,(0,r.Z)((0,o.Z)({},u),{sx:(0,o.Z)({padding:"25px 0"},c),children:n}))}))};u.defaultProps={boxProps:{},boxSx:{}};var d=(0,l.ZP)(s.Z)(function(){return{"& .MuiTabs-root":{}}})},32320:function(e,n,t){t.d(n,{lt:function(){return o},pv:function(){return r}});var o=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t},r=function(e){return parseInt(e).toLocaleString("en-GB",{minimumIntegerDigits:2,useGrouping:!1})}},83395:function(e,n,t){t.d(n,{b:function(){return o}});var o=function(e){return String(e).toLowerCase().replace("gb","").length>=9}},97871:function(e,n,t){t.d(n,{a:function(){return o},e:function(){return r}});var o=[{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"4",value:"4"},{text:"5",value:"5"},{text:"6",value:"6"},{text:"7",value:"7"},{text:"8",value:"8"},{text:"9",value:"9"},{text:"10",value:"10"},{text:"11",value:"11"},{text:"12",value:"12"},{text:"13",value:"13"},{text:"14",value:"14"},{text:"15",value:"15"},{text:"16",value:"16"},{text:"17",value:"17"},{text:"18",value:"18"},{text:"19",value:"19"},{text:"20",value:"20"},{text:"21",value:"21"},{text:"22",value:"22"},{text:"23",value:"23"},{text:"24",value:"24"},{text:"25",value:"25"},{text:"26",value:"26"},{text:"27",value:"27"},{text:"28",value:"28"},{text:"29",value:"29"},{text:"30",value:"30"},{text:"31",value:"31"}],r=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"},{label:"8",value:"8"},{label:"9",value:"9"},{label:"10",value:"10"},{label:"11",value:"11"},{label:"12",value:"12"},{label:"13",value:"13"},{label:"14",value:"14"},{label:"15",value:"15"},{label:"16",value:"16"},{label:"17",value:"17"},{label:"18",value:"18"},{label:"19",value:"19"},{label:"20",value:"20"},{label:"21",value:"21"},{label:"22",value:"22"},{label:"23",value:"23"},{label:"24",value:"24"},{label:"25",value:"25"},{label:"26",value:"26"},{label:"27",value:"27"},{label:"28",value:"28"},{label:"29",value:"29"},{label:"30",value:"30"},{label:"31",value:"31"}]},67574:function(e,n,t){t.d(n,{$9:function(){return c},$i:function(){return x},CM:function(){return r},Fs:function(){return y},HG:function(){return p},Ib:function(){return o},Ic:function(){return h},MF:function(){return a},_f:function(){return s},c7:function(){return v},e6:function(){return d},jT:function(){return u},p3:function(){return b},pH:function(){return m},qG:function(){return f},um:function(){return l},ut:function(){return g},y7:function(){return i}});var o=[{id:"anyTimeOption",label:"any time",value:"anyTimeOption"}],r=[{id:"anyTimeOption",label:"any time (during month)",value:"anyTimeOption"}],a=[{id:"excludingWeekends",label:"excluding weekends",value:!0}],i=[{text:"Yearly",value:"Yearly"},{text:"Monthly",value:"Monthly"},{text:"Weekly",value:"Weekly"},{text:"Daily",value:"Daily"},{text:"Hourly",value:"Hourly"}],l=[{label:"Yearly",value:"Yearly"},{label:"Monthly",value:"Monthly"},{label:"Weekly",value:"Weekly"},{label:"Daily",value:"Daily"},{label:"Hourly",value:"Hourly"}],s={Yearly:"month",Monthly:"month",Weekly:"isoWeek",Daily:"day"},u=[{id:"on",label:"on",value:"on"}],d=[{id:"onThe",label:"on the",value:"on the"}],c=[{text:"First",value:"First"},{text:"Second",value:"Second"},{text:"Third",value:"Third"},{text:"Fourth",value:"Fourth"},{text:"Last",value:"Last"}],p=[{label:"First",value:"First"},{label:"Second",value:"Second"},{label:"Third",value:"Third"},{label:"Fourth",value:"Fourth"},{label:"Last",value:"Last"}],m=[{text:"Monday",value:"Monday"},{text:"Tuesday",value:"Tuesday"},{text:"Wednesday",value:"Wednesday"},{text:"Thursday",value:"Thursday"},{text:"Friday",value:"Friday"},{text:"Saturday",value:"Saturday"},{text:"Day",value:"Day"},{text:"Weekday",value:"Weekday"},{text:"Weekend day",value:"Weekend day"}],h=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Day",value:"Day"},{label:"Weekday",value:"Weekday"},{label:"Weekend day",value:"Weekend day"}],v=[{id:"on",label:"on day",value:"on"}],f=[{id:"onThe",label:"on the",value:"on the"}],x=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],g=[{text:"After",value:"After"},{text:"On date",value:"On date"}],b={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},y={0:2,6:1}},89331:function(e,n,t){t.d(n,{e7:function(){return o},lb:function(){return r},uJ:function(){return a}});var o=[{text:"Month",value:""},{text:"Jan",value:"Jan"},{text:"Feb",value:"Feb"},{text:"Mar",value:"Mar"},{text:"Apr",value:"Apr"},{text:"May",value:"May"},{text:"Jun",value:"Jun"},{text:"Jul",value:"Jul"},{text:"Aug",value:"Aug"},{text:"Sep",value:"Sep"},{text:"Oct",value:"Oct"},{text:"Nov",value:"Nov"},{text:"Dec",value:"Dec"}],r=[{label:"Jan",value:"Jan"},{label:"Feb",value:"Feb"},{label:"Mar",value:"Mar"},{label:"Apr",value:"Apr"},{label:"May",value:"May"},{label:"Jun",value:"Jun"},{label:"Jul",value:"Jul"},{label:"Aug",value:"Aug"},{label:"Sep",value:"Sep"},{label:"Oct",value:"Oct"},{label:"Nov",value:"Nov"},{label:"Dec",value:"Dec"}],a=[{label:"January",value:"january"},{label:"February",value:"february"},{label:"March",value:"march"},{label:"April",value:"april"},{label:"May",value:"may"},{label:"June",value:"june"},{label:"July",value:"july"},{label:"August",value:"august"},{label:"September",value:"september"},{label:"October",value:"october"},{label:"November",value:"november"},{label:"December",value:"december"}]},82749:function(e,n,t){t.d(n,{O:function(){return r},y:function(){return o}});var o=[{area:"AB",name:"Aberdeen"},{area:"AL",name:"St. Albans"},{area:"B",name:"Birmingham"},{area:"BA",name:"Bath"},{area:"BB",name:"Blackburn"},{area:"BD",name:"Bradford"},{area:"BH",name:"Bournemouth"},{area:"BL",name:"Bolton"},{area:"BN",name:"Brighton"},{area:"BR",name:"Bromley"},{area:"BS",name:"Bristol"},{area:"BT",name:"Belfast"},{area:"CA",name:"Carlisle"},{area:"CB",name:"Cambridge"},{area:"CF",name:"Cardiff"},{area:"CH",name:"Chester"},{area:"CM",name:"Chelmsford"},{area:"CO",name:"Colchester"},{area:"CR",name:"Croydon"},{area:"CT",name:"Canterbury"},{area:"CV",name:"Coventry"},{area:"CW",name:"Crewe"},{area:"DA",name:"Dartford"},{area:"DD",name:"Dundee"},{area:"DE",name:"Derby"},{area:"DG",name:"Dumfries"},{area:"DH",name:"Durham"},{area:"DL",name:"Darlington"},{area:"DN",name:"Doncaster"},{area:"DT",name:"Dorchester"},{area:"DY",name:"Dudley"},{area:"E",name:"London E"},{area:"EC",name:"London EC"},{area:"EH",name:"Edinburgh"},{area:"EN",name:"Enfield"},{area:"EX",name:"Exeter"},{area:"FK",name:"Falkirk"},{area:"FY",name:"Blackpool"},{area:"G",name:"Glasgow"},{area:"GL",name:"Gloucester"},{area:"GU",name:"Guildford"},{area:"GY",name:"Guernsey"},{area:"HA",name:"Harrow"},{area:"HD",name:"Huddersfield"},{area:"HG",name:"Harrogate"},{area:"HP",name:"Hemel Hempstead"},{area:"HR",name:"Hereford"},{area:"HS",name:"Western Isles"},{area:"HU",name:"Hull"},{area:"HX",name:"Halifax"},{area:"IG",name:"Ilford"},{area:"IM",name:"Isle Of Man"},{area:"IP",name:"Ipswich"},{area:"IV",name:"Inverness"},{area:"JE",name:"Jersey"},{area:"KA",name:"Kilmarnock"},{area:"KT",name:"Kingston Upon Thames"},{area:"KW",name:"Kirkwall"},{area:"KY",name:"Kirkcaldy"},{area:"L",name:"Liverpool"},{area:"LA",name:"Lancaster"},{area:"LD",name:"Llandrindod Wells"},{area:"LE",name:"Leicester"},{area:"LL",name:"Llandudno"},{area:"LN",name:"Lincoln"},{area:"LS",name:"Leeds"},{area:"LU",name:"Luton"},{area:"M",name:"Manchester"},{area:"ME",name:"Medway"},{area:"MK",name:"Milton Keynes"},{area:"ML",name:"Motherwell"},{area:"N",name:"London N"},{area:"NE",name:"Newcastle Upon Tyne"},{area:"NG",name:"Nottingham"},{area:"NN",name:"Northampton"},{area:"NP",name:"Newport"},{area:"NR",name:"Norwich"},{area:"NW",name:"London NW"},{area:"OL",name:"Oldham"},{area:"OX",name:"Oxford"},{area:"PA",name:"Paisley"},{area:"PE",name:"Peterborough"},{area:"PH",name:"Perth"},{area:"PL",name:"Plymouth"},{area:"PO",name:"Portsmouth"},{area:"PR",name:"Preston"},{area:"RG",name:"Reading"},{area:"RH",name:"Redhill"},{area:"RM",name:"Romford"},{area:"S",name:"Sheffield"},{area:"SA",name:"Swansea"},{area:"SE",name:"London SE"},{area:"SG",name:"Stevenage"},{area:"SK",name:"Stockport"},{area:"SL",name:"Slough"},{area:"SM",name:"Sutton"},{area:"SN",name:"Swindon"},{area:"SO",name:"Southampton"},{area:"SP",name:"Salisbury"},{area:"SR",name:"Sunderland"},{area:"SS",name:"Southend-On-Sea"},{area:"ST",name:"Stoke-On-Trent"},{area:"SW",name:"London SW"},{area:"SY",name:"Shrewsbury"},{area:"TA",name:"Taunton"},{area:"TD",name:"Galashiels"},{area:"TF",name:"Telford"},{area:"TN",name:"Tonbridge"},{area:"TQ",name:"Torquay"},{area:"TR",name:"Truro"},{area:"TS",name:"Cleveland"},{area:"TW",name:"Twickenham"},{area:"UB",name:"Southall"},{area:"W",name:"London W"},{area:"WA",name:"Warrington"},{area:"WC",name:"London WC"},{area:"WD",name:"Watford"},{area:"WF",name:"Wakefield"},{area:"WN",name:"Wigan"},{area:"WR",name:"Worcester"},{area:"WS",name:"Walsall"},{area:"WV",name:"Wolverhampton"},{area:"YO",name:"York"},{area:"ZE",name:"Lerwick"}],r=new Map([["UK",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["GB",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["JE",/^JE\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["GG",/^GY\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["IM",/^IM\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["US",/^([0-9]{5})(?:-([0-9]{4}))?$/],["CA",/^([ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ])\s*([0-9][ABCEGHJKLMNPRSTVWXYZ][0-9])$/i],["IE",/^([AC-FHKNPRTV-Y]\d{2}|D6W)\s[0-9AC-FHKNPRTV-Y]{4}$/],["DE",/^\d{5}$/],["JP",/^\d{3}-\d{4}$/],["FR",/^\d{2}[ ]?\d{3}$/],["AU",/^\d{4}$/],["IT",/^\d{5}$/],["CH",/^\d{4}$/],["AT",/^(?!0)\d{4}$/],["ES",/^(?:0[1-9]|[1-4]\d|5[0-2])\d{3}$/],["NL",/^\d{4}[ ]?[A-Z]{2}$/],["BE",/^\d{4}$/],["DK",/^\d{4}$/],["SE",/^(SE-)?\d{3}[ ]?\d{2}$/],["NO",/^\d{4}$/],["FI",/^(FI-|AX-)?\d{5}$/],["AX",/^22\d{3}$/],["KR",/^\d{5}$/],["CN",/^\d{6}$/],["TW",/^\d{3}(\d{2})?$/],["SG",/^\d{6}$/],["DZ",/^\d{5}$/],["AD",/^AD\d{3}$/],["AR",/^([A-HJ-NP-Z])?\d{4}([A-Z]{3})?$/],["AM",/^(37)?\d{4}$/],["AZ",/^\d{4}$/],["BH",/^((1[0-2]|[2-9])\d{2})?$/],["BD",/^\d{4}$/],["BB",/^(BB\d{5})?$/],["BY",/^\d{6}$/],["BM",/^[A-Z]{2}[ ]?[A-Z0-9]{2}$/],["BA",/^\d{5}$/],["IO",/^BBND 1ZZ$/],["BN",/^[A-Z]{2}[ ]?\d{4}$/],["BG",/^\d{4}$/],["KH",/^\d{5}$/],["CV",/^\d{4}$/],["CL",/^\d{7}$/],["CR",/^(\d{4,5}|\d{3}-\d{4})$/],["HR",/^(HR-)?\d{5}$/],["CY",/^\d{4}$/],["CZ",/^\d{3}[ ]?\d{2}$/],["DO",/^\d{5}$/],["EC",/^([A-Z]\d{4}[A-Z]|(?:[A-Z]{2})?\d{6})?$/],["EG",/^\d{5}$/],["EE",/^\d{5}$/],["FO",/^\d{3}$/],["GE",/^\d{4}$/],["GR",/^\d{3}[ ]?\d{2}$/],["GL",/^39\d{2}$/],["GT",/^\d{5}$/],["HT",/^\d{4}$/],["HN",/^(?:\d{5})?$/],["HU",/^\d{4}$/],["IS",/^\d{3}$/],["IN",/^\d{6}$/],["ID",/^\d{5}$/],["IL",/^\d{5,7}$/],["JO",/^\d{5}$/],["KZ",/^\d{6}$/],["KE",/^\d{5}$/],["KW",/^\d{5}$/],["LA",/^\d{5}$/],["LV",/^(LV-)?\d{4}$/],["LB",/^(\d{4}([ ]?\d{4})?)?$/],["LI",/^(948[5-9])|(949[0-7])$/],["LT",/^(LT-)?\d{5}$/],["LU",/^(L-)?\d{4}$/],["MK",/^\d{4}$/],["MY",/^\d{5}$/],["MV",/^\d{5}$/],["MT",/^[A-Z]{3}[ ]?\d{2,4}$/],["MU",/^((\d|[A-Z])\d{4})?$/],["MX",/^\d{5}$/],["MD",/^\d{4}$/],["MC",/^980\d{2}$/],["MA",/^\d{5}$/],["NP",/^\d{5}$/],["NZ",/^\d{4}$/],["NI",/^((\d{4}-)?\d{3}-\d{3}(-\d{1})?)?$/],["NG",/^(\d{6})?$/],["OM",/^(PC )?\d{3}$/],["PK",/^\d{5}$/],["PY",/^\d{4}$/],["PH",/^\d{4}$/],["PL",/^\d{2}-\d{3}$/],["RO",/^\d{6}$/],["RU",/^\d{6}$/],["SM",/^4789\d$/],["SA",/^\d{5}$/],["SN",/^\d{5}$/],["SK",/^\d{3}[ ]?\d{2}$/],["SI",/^(SI-)?\d{4}$/],["ZA",/^\d{4}$/],["LK",/^\d{5}$/],["TJ",/^\d{6}$/],["TH",/^\d{5}$/],["TN",/^\d{4}$/],["TR",/^\d{5}$/],["TM",/^\d{6}$/],["UA",/^\d{5}$/],["UY",/^\d{5}$/],["UZ",/^\d{6}$/],["VA",/^00120$/],["VE",/^\d{4}$/],["ZM",/^\d{5}$/],["AS",/^96799$/],["CC",/^6799$/],["CK",/^\d{4}$/],["RS",/^\d{5,6}$/],["ME",/^8\d{4}$/],["CS",/^\d{5}$/],["YU",/^\d{5}$/],["CX",/^6798$/],["ET",/^\d{4}$/],["FK",/^FIQQ 1ZZ$/],["NF",/^2899$/],["PN",/^PCRN 1ZZ$/],["PW",/^96940$/],["RE",/^9[78]4\d{2}$/],["SH",/^(ASCN|STHL) 1ZZ$/],["SJ",/^\d{4}$/],["SO",/^\d{5}$/],["SZ",/^[HLMS]\d{3}$/],["TC",/^TKCA 1ZZ$/],["WF",/^986\d{2}$/],["XK",/^\d{5}$/],["YT",/^976\d{2}$/],["INTL",/^(?:[A-Z0-9]+([- ]?[A-Z0-9]+)*)?$/i]])}}]);